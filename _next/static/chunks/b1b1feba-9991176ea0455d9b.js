!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a3912b91-03f5-455c-8f23-b625dc882e8e",e._sentryDebugIdIdentifier="sentry-dbid-a3912b91-03f5-455c-8f23-b625dc882e8e")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5714],{75422:function(e,t,n){n.d(t,{$b:function(){return ij},DA:function(){return ob},Dx:function(){return os},FT:function(){return lu},G5:function(){return a0},H9:function(){return a4},HT:function(){return oy},HU:function(){return iv},Jk:function(){return aF},K3:function(){return uc},KZ:function(){return i_},LX:function(){return um},MQ:function(){return of},M_:function(){return ol},Mc:function(){return uo},NJ:function(){return a7},Ne:function(){return ot},Nk:function(){return a5},Oj:function(){return aK},QA:function(){return a6},Qo:function(){return uy},R7:function(){return up},S3:function(){return og},US:function(){return uw},VN:function(){return tw.VN},WJ:function(){return ov},WQ:function(){return tw.WQ},XK:function(){return ly},Y8:function(){return uu},YK:function(){return oo},Y_:function(){return uC},ZX:function(){return tv.ZX},_:function(){return tv._},_F:function(){return function e(t){var n;if(!t)return!0;if(Array.isArray(t))return 0===t.length||t.every(e);if("object"!=typeof t)throw TypeError("content must be an object");return!t.text&&(n=t.type,!aM.has(n)&&e(t.content))}},_u:function(){return aN},_w:function(){return tw._w},b8:function(){return uf},bo:function(){return uv},cO:function(){return uE},d1:function(){return tv.d1},d5:function(){return ia},e$:function(){return tw.e$},e3:function(){return tw.e3},eJ:function(){return ud},fK:function(){return sH},fL:function(){return oc},hH:function(){return uh},jU:function(){return oa},kB:function(){return aV},kE:function(){return ii},kF:function(){return ug},kv:function(){return oC},lW:function(){return uk},mD:function(){return a1},n8:function(){return oE},nM:function(){return aq},nv:function(){return a2},pU:function(){return tw.Y},rM:function(){return or},rc:function(){return ie},rx:function(){return ou},sW:function(){return od},sd:function(){return a3},tW:function(){return ox},tw:function(){return tw.tw},uu:function(){return rv},wk:function(){return oh},wn:function(){return ir},x4:function(){return tw.x4},xV:function(){return ux}});var r,a,i,l,o,s,c,u,d,p,m,f,h,g,k,y,b,w,v,x,E,C,L,S,N,T,M,I,D,A,_,R,H,j,O,$,B,z,P,W,Z,V,F,K,q,Y,U,Q,X,J,G,ee,et,en,er,ea,ei,el,eo,es,ec,eu,ed,ep,em,ef,eh,eg,ek,ey,eb,ew,ev,ex,eE,eC,eL,eS,eN,eT,eM,eI,eD,eA,e_,eR,eH,ej,eO,e$,eB,ez,eP,eW,eZ,eV,eF,eK,eq,eY,eU,eQ,eX,eJ,eG,e0,e1,e5,e2,e7,e3,e4,e8,e6,e9,te,tt,tn,tr,ta,ti,tl,to,ts,tc,tu,td,tp,tm,tf,th,tg,tk,ty,tb,tw=n(83245),tv=n(32675),tx=n(6098),tE=n(76595),tC=n(45924),tL=n(50959),tS=n(17918),tN=n(72366),tT=n(28211),tM=n(8292),tI=n(41544),tD=n(78008),tA=n(9346),t_=n(43659),tR=n(32568),tH=n(46098),tj=n(5185),tO=n(91535),t$=n(30620),tB=n(68794),tz=n(3317),tP=n(16322),tW=n(52012),tZ=n(37018),tV=n(96452),tF=n(40762),tK=n(25388),tq=n(82325),tY=n(16027),tU=n(31051),tQ=n(84765),tX=n(67251),tJ=n(44771),tG=n(80387),t0=n(28852),t1=n(94164),t5=n(56799),t2=n(49165),t7=n(78835),t3=n(15292),t4=n(25127),t8=n(97263),t6=n(7143),t9=n(64950),ne=n(53469),nt=n(57434),nn=n(83988),nr=n(4601),na=n(91269),ni=n(25709),nl=n(90564),no=n(15461),ns=n(1023),nc=n(42740),nu=n(34505),nd=n(51379),np=n(898),nm=n(23726),nf=n(75286),nh=n(90237),ng=n(37738),nk=n(92129),ny=n(69e3),nb=n(34666),nw=n(56515),nv=n(43616),nx=n(49926),nE=n(55727),nC=n(76266),nL=n(4375),nS=n(2039),nN=n(59388),nT=n(2524),nM=n(73980),nI=n(31428),nD=n(9783),nA=n(76809),n_=n(84057),nR=n(88975),nH=n(63127),nj=n(98457),nO=n(59572),n$=n(44255),nB=n(38818),nz=n(12210),nP=n(51370),nW=n(84534),nZ=n(29485),nV=n(65310),nF=n(29442),nK=n(10422),nq=n(15744),nY=n(24238),nU=n(64824),nQ=n(38867),nX=n(53439),nJ=n(39385),nG=n(94240),n0=n(7681),n1=n(7945),n5=n(38125),n2=n(42037),n7=n(83567),n3=n(55220),n4=n(41656),n8=n(63521),n6=n(64476),n9=n(47899),re=n(71004),rt=n(66596),rn=n(2808),rr=n(62400);function ra(e){return null!=e}var ri=tI.xV.High,rl=ri+1,ro=ri+1,rs=rl+1,rc=ri+1,ru=e=>Promise.resolve({src:URL.createObjectURL(e),fileName:e.name}),rd=async e=>{let t=await fetch(e);return await t.blob()},rp=()=>null;function rm(){return(0,tj.Z)()}async function rf({url:e,fileName:t}){if(e)try{let n=await fetch(e);if(!n.ok)throw Error("Network response was not ok");let r=await n.blob(),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,t&&(i.download=t),i.click(),URL.revokeObjectURL(a)}catch(t){console.error("Failed to download file",t),window.open(e,"_blank")}}function rh(e){if(!e)return"";let t=e.split("/")[1];return({"vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.ms-excel":"xls"})[t]??t}function rg(e,t){if(0==e)return"0";let n=Math.floor(Math.log(e)/Math.log(1024));return Number.parseFloat((e/Math.pow(1024,n)).toFixed(t||2))+"\xa0"+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}function rk(e){return e.replace(/\.[^.]+$/,"")}function ry(e){return{"data-url":e.url,"data-file":"","data-filename":e.fileName,"data-filetype":e.fileType,"data-filesize":e.fileSize}}function rb(e){let{selected:t,context:n,node:r}=e,a=r.attrs,i=!!n,[l,o]=(0,tL.useState)(!1),s=e.onFileUrlReplace(a.url||"")??a.url;a.error&&console.warn(`Found a upload error: ${a.error}`);let[c,u]=(0,tL.useState)(1),d=(0,tL.useCallback)(e=>{e<=1||u(20+.75*(e=(0,t$.Z)(e,0,100)))},[]);return(0,tL.useEffect)(()=>{n&&n.addListener(e=>{let t=e[tw.Lr];t&&d(t)})},[n,d]),(0,tL.useEffect)(()=>{let e=setInterval(()=>{u(t=>t<20?t+1:(clearInterval(e),t))},250);return()=>clearInterval(e)},[]),tL.createElement("div",{"data-selected":t?"":void 0,className:"relative max-w-[350px] select-none overflow-hidden rounded-md bg-coolgray-50 text-sm font-medium text-coolgray-400 outline outline-offset-0 outline-transparent transition duration-300 hover:bg-coolgray-100 data-[selected]:outline-blue-400 dark:bg-coolgray-800 dark:text-near-white dark:hover:bg-coolgray-700 [.ProseMirror-selectednode_&]:outline-blue-400"},tL.createElement("div",{className:"flex select-none items-center space-x-3 p-3"},a.error?tL.createElement("div",{className:"text-red-500"},tL.createElement("p",null,"Oh no! Something went wrong when uploading your file. Please try again.")):i?tL.createElement(tL.Fragment,null,tL.createElement("div",null,"File is uploading...")):tL.createElement(tL.Fragment,null,tL.createElement("div",{className:"block max-w-14 flex-none truncate rounded-md bg-white p-2 text-center text-xs font-bold uppercase text-red-400 dark:bg-dark-black-800 dark:text-near-white"},rh(a.fileType)),tL.createElement("div",{className:"max-w-[160px] shrink truncate text-base text-blue-500"},rk(a.fileName||"")),tL.createElement("div",{className:"w-16 truncate text-coolgray-500 dark:text-near-white"},rg(a.fileSize??0,1)),tL.createElement("div",{className:"reflect-editor-spacer"}),tL.createElement("a",{href:i?void 0:s,target:"_blank",download:a.fileName,className:(0,tC.default)([l?"animate-bounce":""]),onClick:async t=>{t.preventDefault(),s&&(o(!0),await e.onFileSave({url:s,fileName:a.fileName}),o(!1))},rel:"noreferrer"},tL.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},tL.createElement("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"}))))),i&&tL.createElement("div",{className:"absolute inset-x-0 bottom-0 h-1 overflow-hidden bg-gray-200"},tL.createElement("div",{className:"h-full bg-accent transition duration-500 dark:bg-accent-dk",style:{transformOrigin:"0",transform:`scaleX(${c/100})`}})))}var rw=class extends tO.b9{createNodeSpec(e,t){let n=super.createNodeSpec(e,t),r=this.options.onFileUrlReplace;return{...n,toDOM:e=>["div",{class:"reflect-editor-attachment-container p-1",...ry(e.attrs)},function(e){let t=e.node.attrs;return["div",{class:"relative max-w-[350px] select-none overflow-hidden rounded-md bg-coolgray-50 text-sm font-medium text-coolgray-400 outline outline-offset-0 transition duration-300 hover:bg-coolgray-100 dark:bg-coolgray-800 dark:text-near-white dark:hover:bg-coolgray-700 outline-transparent"},["div",{class:"flex select-none items-center space-x-3 p-3"},["div",{class:"block max-w-14 flex-none truncate rounded-md bg-white py-2 px-2 text-center text-xs font-bold uppercase text-red-400 dark:bg-dark-black-800 dark:text-near-white"},["span",rh(t.fileType)]],["div",{class:"max-w-[160px] shrink truncate text-base text-blue-500"},["span",rk(t.fileName||"")]],["div",{class:"w-16 truncate text-coolgray-500 dark:text-near-white"},rg(t.fileSize??0,1)],["div",{class:"reflect-editor-spacer"}],["a",{href:e.onFileUrlReplace(t.url||"")??t.url,target:"_blank",download:t.fileName},["svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},["path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"}]]]]]}({node:e,onFileUrlReplace:r})]}}};function rv(e){return{...e,id:e.id||tw.S5,graphId:e.graphId||tw.S5}}function rx(e){return t=>e({...t,id:t.id===tw.S5?"":t.id,graphId:t.graphId===tw.S5?"":t.graphId})}function rE(e,t){e&&t&&setTimeout(()=>{rC(e,t)},50)}async function rC(e,t){if(e.isDestroyed)return;let n=e.state.tr;await rL(n,t),e.isDestroyed||e.dispatch(n)}async function rL(e,t){let n=e.doc,r=[];for(let{node:a,pos:i}of(n.descendants((e,t)=>{if(e.type.name===tw.qh){let n=e.attrs;n.id&&n.id!==tw.S5&&n.graphId!==tw.S5||r.push({node:e,pos:t})}}),r))await rS(e,i,a.attrs,t)}async function rS(e,t,n,r){let a=await rx(r)(n);if(a.id===tw.S5||a.groupId===tw.S5)throw Error("Backlink id cannot be a placeholder");let i=e.doc.nodeAt(t);i?.type.name===tw.qh&&e.setNodeMarkup(t,void 0,a)}var rN=tB.NZ.isMac?e=>e.metaKey:e=>e.ctrlKey;function rT(e,t){return t<0&&(t=0),t>e.content.size&&(t=e.content.size),e.resolve(t)}function rM(e){return tz.Bs.between(e,e)}function rI(e){return e&&"object"==typeof e&&"string"==typeof e.searchTerm&&"boolean"==typeof e.active}function rD(e){let t=e.map(e=>e.spec).find(rI);return t?.searchTerm??null}function rA(e,t){let n=rD(t);n&&(0,tv.CC)(e,n)}var r_=null,rR=["[","【"],rH=["]","】"],rj="["+rR.map(e=>"\\"+e).join("")+"]";function rO(e){for(let t of rH)if(e.endsWith(t))return(0,tP.Z)(e,t);return e}rH.map(e=>"\\"+e).join("");var r$=["@","＠"],rB="["+r$.join("")+"]",rz=null,rP="https://reflect.app/g/",rW=/reflect.app\/g\/([^/]+)\/([^/]+)\/?/;function rZ({graphId:e,id:t}){return`${rP}${e}/${t}`}function rV(e){return`${e.id}#${e.label}`}o=[(0,tM.AOx)({defaultOptions:{selectable:!0,draggable:!1,mentionTag:"a",appendText:" ",disableDecorations:!1,graphId:"",onOpen:null,onHover:null,onAdd:null},handlerKeys:["onBacklinkMatchV2","onBacklinkDismissV2"],staticKeys:["selectable","draggable","mentionTag","graphId"]})];var rF=class extends(l=tM.QR,i=[(0,tM.WDe)()],a=[(0,tM.WDe)()],l){constructor(){super(...arguments),(0,tx.Co)(s,5,this),(0,tx.ov)(this,"atInputStart",-1),(0,tx.ov)(this,"atInputEnd",-1)}get name(){return"backlink"}createTags(){return[tI.eX.InlineNode,tI.eX.Behavior]}shouldBacklinkSelection(e){return!(0,tB.Ab)(e)&&(0,tB.hT)(e)&&e.$head.sameParent(e.$anchor)}handleEnterKeyPress(e,{modKey:t}){let n=e.selection.node;if(n?.type.name===this.name){let e=n.attrs;return this.options.onOpen?.(null,e,{modKey:t}),!0}return!1}handleSquareBracketInsert(e,{allowEmpty:t=!1}={}){let n=e.selection;if(!(0,tB.hT)(n)||!n.$head.sameParent(n.$anchor)||!t&&n.empty)return!1;let{from:r,to:a}=n,i=e.doc.cut(r,a).textContent;if(function(e){for(let t of rR)if(e.startsWith(t+t))return!0;return!1}(i))return!1;(function(e){for(let t of rR)if(e.startsWith(t))return!0;return!1})(i)&&(i=i.slice(1));let l=`[[${i}`;return this.store.commands.replaceText({content:l,selection:e.selection,keepSelection:!1}),this.store.commands.selectText(this.store.view.state.selection.to),!0}createKeymap(){return[rc,{"Mod-Shift-k":({state:e})=>this.handleSquareBracketInsert(e,{allowEmpty:!0}),"[":({state:e})=>this.handleSquareBracketInsert(e,{allowEmpty:!1}),Enter:({state:e})=>this.handleEnterKeyPress(e,{modKey:!1}),"Mod-Enter":({state:e})=>this.handleEnterKeyPress(e,{modKey:!0})}]}createNodeSpec(e,t){return{inline:!0,selectable:this.options.selectable,draggable:this.options.draggable,atom:!0,...t,attrs:{...e.defaults(),id:{},label:{},graphId:{default:this.options.graphId}},parseDOM:[{tag:"span[data-backlink]",priority:tI.xV.High,getAttrs:t=>{if(!(0,tB.jd)(t))return!1;let n=t.getAttribute("data-id"),r=t.getAttribute("data-label"),a=t.getAttribute("data-graph-id")||this.options.graphId;return!!n&&{...e.parse(t),graphId:a,id:n,label:r}}},{tag:`${this.options.mentionTag}[href^="${rP}"]`,priority:tI.xV.High,getAttrs:t=>{if(!(0,tB.jd)(t))return!1;let{graphId:n,id:r}=function(e){if(!e)return{};let t=e.match(rW);if(t){let[e,n,r]=t;return{graphId:n,id:r}}return{}}(t.getAttribute("href"));if(!r)return!1;let a=t.textContent;return{...e.parse(t),graphId:n,id:r,label:a}}}],toDOM:e=>{let{label:t}=e.attrs;return[this.options.mentionTag,{href:this.buildHref(e)},t]},leafText:e=>e.attrs.label}}createNodeViews(){return(e,t,n,r)=>{let a=e.attrs;a.id===tw.S5&&rE(this.store.view,this.options.onAdd);let i=document.createElement(this.options.mentionTag);i.setAttribute("href",this.buildHref(e)),i.setAttribute("tabindex","-1"),i.setAttribute("data-editor-backlink",""),i.textContent=a.label,rA(i,r);let l=this.options.onOpen,o=null;return i.addEventListener("pointerdown",e=>{o={x:e.clientX,y:e.clientY},e.preventDefault()}),i.addEventListener("pointerup",e=>{o&&Math.abs(e.clientX-o.x)+Math.abs(e.clientY-o.y)<30&&l?.(e,a,{modKey:rN(e)}),o=null}),i.addEventListener("click",e=>{e.preventDefault()}),{dom:i,update:()=>!1}}}createExternalPlugins(){let e;let t=this.options.onHover;return t?[(e=null,new tz.Sy({props:{handleDOMEvents:{mouseover:(n,r)=>{var a;let i=function(e,t){let n=t.target;if(!n||!n.hasAttribute?.("data-editor-backlink"))return;let r=n.getBoundingClientRect(),a=r.left+r.width/2,i=r.top+r.height/2,l=e.posAtCoords({left:a,top:i});if(!l)return;let{inside:o}=l;if(o<=0)return;let s=e.state.doc.nodeAt(o);if(s&&s.type.name===tw.qh)return s.attrs}(n,r)||null;!(i===(a=e)||i&&a&&i.id===a.id&&i.label===a.label)&&(e&&t(r,e,!1),i&&t(r,i,!0),e=i)},mouseout:(n,r)=>{e&&t(r,e,!1),e=null}}}}))]:[]}buildHref(e){let{graphId:t,id:n}=e.attrs,r=this.options.graphId;return rZ({graphId:t??r,id:n})}replaceWithBacklink(e,t,n,r){e.replaceWith(n,r,this.type.create({...t,graphId:t.graphId??this.options.graphId}))}insertBacklink(e){return({tr:t,dispatch:n})=>{let{from:r}=rM(t.selection.$from);return this.replaceWithBacklink(t,e,r,r),n?.(t),!0}}createBacklink(e,t){let{range:n}=e;return e=>{let{tr:r,dispatch:a}=e;return this.replaceWithBacklink(r,t,n.from,n.cursor),a?.(r),!0}}createMatchRules(){return[{match:(rz||(rz="(?:(?:"+rj+rj+"\\s*)|(?:(?:^|"+((null===r_&&(r_=function(){try{return"ac"==="ab".replace(RegExp("(?<=a)b","g"),"c")}catch(e){return!1}}()),r_)?"(?<=\\s)":"\\s")+")"+rB+"))(\\S.*|\\S*)$"),RegExp(rz,"i")),onMatch:e=>{let t=e.match[0];return!(function(e){for(let t of r$)if(e.startsWith(t))return!0;return!1}(t)&&-1===this.atInputStart||function(e){for(let t of rH)if(e.includes(t+t))return!0;return!1}(rO(t)))&&this.options.onBacklinkMatchV2(e)},onDismiss:()=>{this.options.onBacklinkDismissV2()}}]}createEventHandlers(){return{textInput:({text:e,from:t,to:n})=>{if(r$.includes(e)){this.atInputStart=t,this.atInputEnd=t+1;return}-1!==this.atInputStart&&(n<this.atInputStart||t>this.atInputEnd+1?(this.atInputStart=-1,this.atInputEnd=-1):this.atInputEnd=n+1)}}}};s=(0,tx.xl)(l),(0,tx.pL)(s,1,"insertBacklink",i,rF),(0,tx.pL)(s,1,"createBacklink",a,rF),rF=(0,tx.pL)(s,0,"BacklinkExtension",o,rF),(0,tx.Co)(s,1,rF);var rK=class extends(u=tW.z,c=[(0,tM.WDe)()],u){constructor(){super(...arguments),(0,tx.Co)(d,5,this)}wrapInBlockquote(){return e=>(0,tB.ym)(this.type)(e)}createPasteRules(){return[]}};function rq(e){let t;let{regexp:n,type:r,getAttributes:a,ignoreWhitespace:i=!1,beforeDispatch:l,updateCaptured:o,shouldSkip:s,invalidMarks:c}=e,u=new tF.VK(n,(e,n,d,p)=>{let{tr:m,schema:f}=e;t||(t=(0,tV.HD)(r)?f.marks[r]:r,(0,tV.kG)(t,{code:tI.mA.SCHEMA,message:`Mark type: ${r} does not exist on the current schema.`}));let h=n[1],g=n[0],k=function({captureGroup:e,fullMatch:t,end:n,start:r,rule:a,ignoreWhitespace:i,shouldSkip:l,updateCaptured:o,state:s,invalidMarks:c}){if(null==t)return null;let u=o?.({captureGroup:e,fullMatch:t,start:r,end:n})??{};e=u.captureGroup??e,t=u.fullMatch??t,r=u.start??r,n=u.end??n;let d=s.doc.resolve(r),p=s.doc.resolve(n);return c&&(0,tK.j4)({$from:d,$to:p},c)||a.invalidMarks&&(0,tK.j4)({$from:d,$to:p},a.invalidMarks)||i&&e?.trim()===""||l?.({state:s,captureGroup:e,fullMatch:t,start:r,end:n,ruleType:"mark"})||a.shouldSkip?.({state:s,captureGroup:e,fullMatch:t,start:r,end:n,ruleType:"mark"})?null:{captureGroup:e,end:n,fullMatch:t,start:r}}({captureGroup:h,fullMatch:g,end:p,start:d,rule:u,state:e,ignoreWhitespace:i,invalidMarks:c,shouldSkip:s,updateCaptured:o});if(!k)return null;({start:d,end:p,captureGroup:h,fullMatch:g}=k);let y=(0,tV.mf)(a)?a(n):a,b=p,w=[];if(h){let e=g.search(/\S/),t=d+g.indexOf(h),n=t+h.length;w=m.storedMarks??[],n<p&&m.delete(n,p),t>d&&m.delete(d+e,t),b=d+e+h.length,d+=e}return m.insertText(" "),m.addMark(d,b,t.create(y)),m.setStoredMarks(w),l?.({tr:m,match:n,start:d,end:p}),m});return u}d=(0,tx.xl)(u),(0,tx.pL)(d,1,"wrapInBlockquote",c,rK),(0,tx.ZU)(d,rK);var rY=class extends tZ.H{createInputRules(){return[rq({regexp:/(?:\*\*|__)([^*_]+)(?:\*\*|__)\s$/,type:this.type,ignoreWhitespace:!0})]}},rU=class extends tq.W7{createKeymap(){return[ro,{Tab:rQ,"Shift-Tab":rX}]}},rQ=({tr:e,dispatch:t})=>!!(e.selection.$from.parent.type.spec.code&&e.selection.empty&&(0,tB.hT)(e.selection))&&(t?.(e.insertText("	")),!0),rX=({tr:e,dispatch:t})=>{if(e.selection.$from.parent.type.spec.code&&e.selection.empty&&(0,tB.hT)(e.selection)){let n=e.selection.from;if(n>1&&"	"===e.doc.textBetween(n-1,n))return t?.(e.deleteRange(n-1,n)),!0}return!1},rJ=/^https?:\/\/(?:www\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\/(?:watch\?v=|embed\/))(?<youtube_video_id>[\w-]+)\S*/i;function rG(e){return e?.groups?.youtube_video_id??null}function r0(e){let t=e.src??"";if("youtube"===e.type){var n;let e=(n=t,rJ.lastIndex=0,rG(n.match(rJ)));e&&(t=`https://www.youtube.com/watch?v=${e}`)}return t??""}function r1(e){return e?"string"==typeof e?e.replace(/^reflect-assets:\/\//i,"https://"):Array.isArray(e)?e.map(r1):"object"==typeof e?(0,tQ.Z)(e,e=>r1(e)):e:e}function r5(e,t){let{wrapBacklinkWithBrackets:n=!1,removeTagLinks:r=!1,normalizeListItem:a=!1,normalizeTaskListItem:i=!1,normalizeIframe:l=!1,normalizeUrlScheme:o=!0,normalizeFile:s=!1,nativeList:c=!1}=t??{},u=c?tY.SD:tU.PW,d=u.fromSchema(e),p={...d.nodes};if(n&&(p.backlink=e=>{let t=e.attrs;return["span",{"data-backlink":"","data-id":t.id,"data-graph-id":t.graphId??"","data-label":t.label},`[[${t.label}]]`]}),r&&(p.tag=e=>{let t=e.attrs;return["span",{"data-tag":"","data-id":t.id,"data-graph-id":t.graphId??"","data-label":t.label},e.textContent]}),a&&(p.listItem=e=>{if(e.firstChild?.type.name!==tw.e3)return d.nodes.listItem(e);{let t=document.createElement("li");return e.forEach((e,n,r)=>{if(0===r){let n=m.serializeNode(e);t.append(...n.childNodes)}else t.append(m.serializeNode(e))}),{dom:t}}}),i&&(p.taskListItem=e=>{if(e.firstChild?.type.name!==tw.e3)return d.nodes.listItem(e);{let t=document.createElement("li");t.setAttribute("data-task-list-item","");let n=document.createElement("input");return n.setAttribute("type","checkbox"),e.attrs.checked&&(t.setAttribute("data-checked",""),n.setAttribute("checked","")),t.appendChild(n),e.forEach((e,n,r)=>{if(0===r){let n=m.serializeNode(e);t.append(...n.childNodes)}else t.append(m.serializeNode(e))}),{dom:t}}}),c&&i&&(p.list=e=>{let t=document.createElement("ordered"===e.attrs.kind?"ol":"ul"),n=t.appendChild(document.createElement("li")),r=e.attrs;if(e.firstChild?.type.name!==tw.e3)return d.nodes.list(e);if("task"===r.kind||"checklist"===r.kind){let e=document.createElement("input");e.setAttribute("type","checkbox"),r.checked&&e.setAttribute("checked",""),n.appendChild(e)}return n.setAttribute("data-list-kind",r.kind),e.forEach((e,t,r)=>{if(0===r){let t=m.serializeNode(e);n.append(...t.childNodes)}else n.append(m.serializeNode(e))}),{dom:t}}),l&&(p.iframe=e=>{let t=r0(e.attrs);return["a",{href:t},t]}),s&&(p.file=e=>{let t=e.attrs;return["div",ry(t),["a",{href:t.url},t.fileName||t.url||"File"]]}),o){let e=p.image;p.image=t=>r1(e(t));let t=p.file;p.file=e=>r1(t(e))}let m=new u(p,d.marks);return m}function r2(e){return"+"!==e.character&&"["!==e.character}var r7=(e,t,n,r)=>tG.p.text(e,t,{...n,unsafe:n.unsafe.filter(r2)},r),r3=(...e)=>{let t=tG.p.hardBreak(...e);return"\\\n"===t?"\n":t},r4=tJ.C().handlers?.listItem;if(!r4)throw Error("gfmListItemHandle should not be null");var r8=(e,t,n,r)=>{let a=e.data?.hProperties?.dataListKind,i=n.bulletCurrent;"task"===a&&(n.bulletCurrent="+");let l=r4(e,t,n,r);return n.bulletCurrent=i,l},r6=(e,t)=>{let n=tX.q.li(e,t),r=t.properties?.dataListKind;return r&&"string"==typeof r&&(n.data||(n.data={}),n.data.hProperties||(n.data.hProperties={}),n.data.hProperties.dataListKind=r),n},r9=(e,t,n,r)=>{let a=(e.url||"").trim(),i=n.unsafe;n.unsafe=[];let l=n.containerPhrasing(e,r);n.unsafe=i;let o=a.startsWith(rP),s=a.replace(/^(tel:|mailto:|\/\/)/,""),c=s.replace(/^https?:\/\//,"");return o||l===c||l===a?l:`${l} (${s})`};function ae(e){let t={text:r7,break:r3,listItem:r8};return"clipboard"===e&&(t.link=r9),(0,t7.l)().use(t0.Z).use(t1.Z,{checked:"[x] ",unchecked:"[ ] ",handlers:{u:tX.q.span,mark:tX.q.span,strike:tX.q.span,del:tX.q.span,s:tX.q.span,li:r6}}).use(t5.Z).use(t2.Z,{handlers:t,emphasis:"_",bullet:"-",listItemIndent:"one",fences:!0,tightDefinitions:!0,join:[(e,t)=>e?.type==="listItem"&&t?.type==="listItem"||e?.type==="paragraph"&&t?.type==="list"?0:1]})}var at=null,an=null;function ar(e,t="clipboard"){return at&&an||(at=ae("markdown"),an=ae("clipboard")),String(("markdown"===t?at:an).processSync(e)).trimEnd()}function aa(e,t,n){let r=document.createElement("div");return r.appendChild(t.serializeFragment(e)),(ar(r.innerHTML,n)||"").trim()}function ai(e){let{content:t,openStart:n,openEnd:r}=e;for(;n>1&&r>1&&1==t.childCount&&1==t.child(0).childCount;)n--,r--,t=t.child(0).content;return t}function al(e,t){let n=ai(e);if("plain"===t)return n.textBetween(0,n.size," ");{let e=n.firstChild?.type?.schema;return e?aa(n,r5(e,{normalizeListItem:!0,normalizeTaskListItem:!0,normalizeIframe:!0,wrapBacklinkWithBrackets:!0,removeTagLinks:!0,nativeList:!0}),"markdown"):""}}function ao(e,t,n){let{$to:r,to:a}=e,{doc:i}=r,l=al(i.slice(Math.max(0,a-t),a),n);return l.length>t?l.slice(l.length-t,l.length):l}var as=class extends(f=tM.nNj,m=[(0,tM.WDe)()],p=[(0,tM._y)()],f){constructor(){super(...arguments),(0,tx.Co)(h,5,this)}get name(){return"reflectCommand"}insertTextAt(e,t){return n=>{let{from:r,to:a}=n.tr.selection,{position:i="before"}=t??{},l="before"===i?r:a;return this.store.commands.insertText(e,{from:l,to:l}),!0}}getPriorSelectionText(e,t){return ao(this.store.view.state.selection,e,t)}};h=(0,tx.xl)(f),(0,tx.pL)(h,1,"insertTextAt",m,as),(0,tx.pL)(h,1,"getPriorSelectionText",p,as),(0,tx.ZU)(h,as);var ac="(?:^|\\s+)([\\w-+][\\w-+=.]*@[\\w-]+(?:\\.[\\w-]+)+)",au=/(?:\+?(\d{1,3}))/.source,ad=`(?:(?:${au}[-. ]{0,3})?)`+/[(]?(\d{3})[-. )]*(\d{3})[-. ]{0,3}(\d{4})/.source,ap=`(?:^|\\s+)(${ad})(?:(?=[^0-9])|$)`,am=[{regexp:RegExp(ac+"\\s$"),contactType:"mailto"},{regexp:RegExp(ap+"\\s$"),contactType:"tel"}],af=[{regexp:new RegExp(ac),contactType:"mailto"},{regexp:new RegExp(ap),contactType:"tel"}];function ah({regexp:e,contactType:t,linkType:n}){return rq({regexp:e,type:n,getAttributes:([e])=>({href:t?`${t}:${e.trim()}`:ak(e.trim())}),shouldSkip:({state:e})=>e.selection.$from.node().type.name===tw.tw})}g=[(0,tM.AOx)({defaultPriority:tI.xV.High})];var ag=class extends(y=tM.nNj){get name(){return"contact"}createInputRules(){return am.map(({regexp:e,contactType:t})=>ah({regexp:e,contactType:t,linkType:this.store.schema.marks.link}))}createPasteRules(){return af.map(({regexp:e,contactType:t})=>(function({regexp:e,contactType:t,linkType:n,priority:r}){return{regexp:e,type:"mark",markType:n,getAttributes:([e])=>({href:t?`${t}:${e.trim()}`:ak(e.trim())}),transformMatch:e=>e[1],replaceSelection:!1,priority:r,ignoredMarks:["link"]}})({regexp:e,contactType:t,linkType:this.store.schema.marks.link,priority:tI.xV.High}))}};function ak(e,t="http:"){return e.startsWith("http")||e.startsWith("//")?e:`${t}//${e}`}function ay(e){return!!e&&tw.D4.includes(e.type.name)}function ab(e){return!!e&&tw.V9.includes(e.type.name)}function aw(e){let t=e.$from,n=(0,tB.Tr)({selection:t,types:tw.V9});return!!n&&n.depth===t.depth-2&&0==t.index(t.depth-1)&&(n.node.type.name===tw.xy?tw.xy:n.node.type.name===tw.oL?tw.oL:tw.IH)}function av(e,t,n=t){let r=!1;return e.nodesBetween(t,n,(e,t,n)=>{((0,tY.Sz)(e)||n&&(0,tY.Sz)(n))&&(r=!0)}),r}function ax(e){return!!(e&&e.type.name===tw.e3&&0===e.childCount)}k=(0,tx.xl)(y),ag=(0,tx.pL)(k,0,"ContactExtension",g,ag),(0,tx.Co)(k,1,ag);var aE=/reflect.app\/g\/([^/]+)\/tag\/([^/]+)/;function aC({graphId:e,id:t}){return`https://reflect.app/g/${e}/tag/${t}`}function aL(e){return`#${e.label}`}function aS(e){let{url:t,tweetData:n}=e;return n?[n.text??"",n.user?.name??"","@"+(n.user?.screen_name??"")].join(" "):t}function aN(e){let t=[];for(let n=0;n<e.childCount;n++)t.push(e.child(n));return t}function aT(e){return e?.type.name===tw.tw}var aM=new Set(["text","horizontalRule","emoji","image","tweet","file","tag","backlink","hardBreak","iframe"]),aI=/::\d{2,5}/,aD=/[#/?]\S*/,aA=RegExp("(?!"+/(https?|file|ftp|javascript|data|vbscript|about|blob|smb|wss?):\/\//.source+")\\b[a-z-_]+:\\/\\/+(?:[a-z0-9\\u00a1-\\uffff%@_-]+\\.)*(?:[a-z0-9\\u00a1-\\uffff%@_-]+)"),a_=RegExp("(?:(?:https?:)?\\/\\/)?(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:a(?:a(?:a|rp)|b(?:arth|b(?:ott|vie)?|c|le|ogado|udhabi)|c(?:ademy|c(?:enture|ountants?)|o|tor)?|d(?:s|ult)?|e(?:g|ro|tna)?|f(?:l|rica)?|g(?:akhan|ency)?|i(?:g|r(?:bus|force|tel))?|kdn|l(?:faromeo|i(?:baba|pay)|l(?:finanz|state|y)|s(?:ace|tom))?|m(?:azon|e(?:rican(?:express|family)|x)|fam|ica|sterdam)?|n(?:alytics|droid|quan|z)|ol?|p(?:artments|p(?:le)?)|q(?:uarelle)?|r(?:a(?:b|mco)|chi|my|pa|te?)?|s(?:da|ia|sociates)?|t(?:hleta|torney)?|u(?:ction|di(?:ble|o)?|spost|t(?:hor|os?))?|vianca|ws?|xa?|z(?:ure)?)|b(?:a(?:by|idu|n(?:a(?:mex|narepublic)|d|k)|r(?:c(?:elona|lay(?:card|s))|efoot|gains)?|s(?:eball|ketball)|uhaus|yern)?|b(?:c|t|va)?|c[gn]|d|e(?:a(?:ts|uty)|er|ntley|rlin|st(?:buy)?|t)?|f|g|h(?:arti)?|i(?:ble|d|ke|ngo?|o|z)?|j|l(?:ack(?:friday)?|o(?:ckbuster|g|omberg)|ue)|m[sw]?|n(?:pparibas)?|o(?:ats|ehringer|fa|m|nd|o(?:k(?:ing)?)?|s(?:ch|t(?:ik|on))|t|utique|x)?|r(?:adesco|idgestone|o(?:adway|ker|ther)|ussels)?|s|t|u(?:ild(?:ers)?|siness|y|zz)|v|w|y|zh?)|c(?:a(?:b|fe|l(?:l|vinklein)?|m(?:era|p)?|non|p(?:etown|ital(?:one)?)|r(?:avan|ds|e(?:ers?)?|s)?|s(?:a|e|h|ino)|t(?:ering|holic)?)?|b(?:a|n|re|s)|c|d|e(?:nter|o|rn)|f[ad]?|g|h(?:a(?:n(?:el|nel)|rity|se|t)|eap|intai|r(?:istmas|ome)|urch)?|i(?:priani|rcle|sco|t(?:adel|ic?|y(?:eats)?))?|k|l(?:aims|eaning|i(?:ck|ni(?:c|que))|o(?:thing|ud)|ub(?:med)?)?|m|n|o(?:ach|des|ffee|l(?:lege|ogne)|m(?:cast|m(?:bank|unity)|p(?:a(?:ny|re)|uter)|sec)?|n(?:dos|s(?:truction|ulting)|t(?:act|ractors))|o(?:king(?:channel)?|l|p)|rsica|u(?:ntry|pons?|rses))?|pa|r(?:edit(?:card|union)?|icket|own|s|uises?)?|u(?:isinella)?|v|w|x|y(?:mru|ou)?|z)|d(?:a(?:bur|d|nce|t(?:a|e|ing|sun)|y)|clk|ds|e(?:al(?:er|s)?|gree|l(?:ivery|l|oitte|ta)|mocrat|nt(?:al|ist)|si(?:gn)?|v)?|hl|i(?:amonds|et|gital|rect(?:ory)?|s(?:co(?:unt|ver)|h)|y)|j|k|m|np|o(?:c(?:s|tor)|g|mains|t|wnload)?|rive|tv|u(?:bai|nlop|pont|rban)|v(?:ag|r)|z)|e(?:a(?:rth|t)|co?|d(?:eka|u(?:cation)?)|e|g|m(?:ail|erck)|n(?:ergy|gineer(?:ing)?|terprises)|pson|quipment|r(?:icsson|ni)?|s(?:q|tate)?|t(?:isalat)?|u(?:rovision|s)?|vents|x(?:change|p(?:ert|osed|ress)|traspace))|f(?:a(?:ge|i(?:l|rwinds|th)|mily|ns?|rm(?:ers)?|s(?:hion|t))|e(?:dex|edback|rr(?:ari|ero))|i(?:at|d(?:elity|o)|lm|na(?:l|nc(?:e|ial))|r(?:e(?:stone)?|mdale)|sh(?:ing)?|t(?:ness)?)?|j|k|l(?:i(?:ckr|ghts|r)|o(?:rist|wers)|y)|m|o(?:o(?:d(?:network)?|tball)?|r(?:d|ex|sale|um)|undation|x)?|r(?:e(?:e|senius)|l|o(?:gans|nt(?:door|ier)))?|tr|u(?:jitsu|nd?|rniture|tbol)|yi)|g(?:a(?:l(?:l(?:ery|o|up))?|mes?|p|rden|y)?|b(?:iz)?|dn?|e(?:a|nt(?:ing)?|orge)?|f|g(?:ee)?|h|i(?:fts?|v(?:es|ing))?|l(?:ass|e|ob(?:al|o))?|m(?:ail|bh|o|x)?|n|o(?:daddy|l(?:d(?:point)?|f)|o(?:dyear|g(?:le)?)?|p|t|v)|p|q|r(?:a(?:inger|phics|tis)|een|ipe|o(?:cery|up))?|s|t|u(?:ardian|cci|ge|i(?:de|tars)|ru)?|w|y)|h(?:a(?:ir|mburg|ngout|us)|bo|dfc(?:bank)?|e(?:alth(?:care)?|l(?:p|sinki)|r(?:e|mes))|gtv|i(?:phop|samitsu|tachi|v)|kt?|m|n|o(?:ckey|l(?:dings|iday)|me(?:depot|goods|s(?:ense)?)|nda|rse|s(?:pital|t(?:ing)?)|t(?:el(?:es|s)|mail)?|use|w)|r|sbc|t|u(?:ghes)?|y(?:att|undai))|i(?:bm|c(?:bc|e|u)|d|e(?:ee)?|fm|kano|l|m(?:amat|db|mo(?:bilien)?)?|n(?:c|dustries|f(?:initi|o)|g|k|s(?:titute|ur(?:ance|e))|t(?:ernational|uit)?|vestments)?|o|piranga|q|r(?:ish)?|s(?:maili|t(?:anbul)?)?|t(?:au|v)?)|j(?:a(?:guar|va)|cb|e(?:ep|tzt|welry)?|io|ll|mp?|nj|o(?:b(?:s|urg)|t|y)?|p(?:morgan|rs)?|u(?:egos|niper))|k(?:aufen|ddi|e(?:rry(?:hotels|logistics|properties))?|fh|g|h|i(?:a|ds|m|nd(?:er|le)|tchen|wi)?|m|n|o(?:eln|matsu|sher)|p(?:mg|n)?|r(?:d|ed)?|uokgroup|w|y(?:oto)?|z)|l(?:a(?:caixa|m(?:borghini|er)|n(?:c(?:aster|ia)|d(?:rover)?|xess)|salle|t(?:ino|robe)?|w(?:yer)?)?|b|c|ds|e(?:ase|clerc|frak|g(?:al|o)|xus)|gbt|i(?:dl|fe(?:insurance|style)?|ghting|ke|lly|m(?:ited|o)|n(?:coln|de|k)|psy|v(?:e|ing))?|k|l[cp]|o(?:ans?|c(?:ker|us)|l|ndon|tt[eo]|ve)|pl(?:financial)?|r|s|t(?:da?)?|u(?:ndbeck|x(?:e|ury))?|v|y)|m(?:a(?:cys|drid|i(?:f|son)|keup|n(?:agement|go)?|p|r(?:ket(?:ing|s)?|riott|shalls)|serati|ttel)?|ba|c(?:kinsey)?|d|e(?:d(?:ia)?|et|lbourne|m(?:e|orial)|nu?|rckmsd)?|g|h|i(?:ami|crosoft|l|n[it]|t(?:subishi)?)|k|l[bs]?|ma?|n|o(?:bi(?:le)?|da|e|i|m|n(?:ash|ey|ster)|r(?:mon|tgage)|scow|to(?:rcycles)?|v(?:ie)?)?|p|q|r|sd?|t[nr]?|u(?:s(?:eum|ic)|tual)?|v|w|x|y|z)|n(?:a(?:b|goya|me|tura|vy)?|ba|c|e(?:c|t(?:bank|flix|work)?|ustar|ws?|x(?:t(?:direct)?|us))?|fl?|go?|hk|i(?:co|k(?:e|on)|nja|ssa[ny])?|l|o(?:kia|rt(?:hwesternmutual|on)|w(?:ruz|tv)?)?|p|r[aw]?|tt|u|yc|z)|o(?:b(?:i|server)|ffice|kinawa|l(?:ayan(?:group)?|dnavy|lo)|m(?:ega)?|n(?:e|g|l(?:ine)?)|oo|pen|r(?:a(?:cle|nge)|g(?:anic)?|igins)|saka|t(?:suka|t)|vh)|p(?:a(?:ge|nasonic|r(?:is|s|t(?:ners|s|y))|ssagens|y)?|ccw|et?|f(?:izer)?|g|h(?:armacy|d|ilips|o(?:ne|to(?:graphy|s)?)|ysio)?|i(?:c(?:s|t(?:et|ures))|d|n[gk]?|oneer|zza)|k|l(?:a(?:ce|y(?:station)?)|u(?:mbing|s))?|m|nc?|o(?:hl|ker|litie|rn|st)|r(?:a(?:merica|xi)|ess|ime|o(?:d(?:uctions)?|f|gressive|mo|pert(?:ies|y)|tection)?|u(?:dential)?)?|s|t|ub|wc?|y)|q(?:a|pon|ue(?:bec|st))|r(?:a(?:cing|dio)|e(?:a(?:d|l(?:estate|t(?:or|y)))|cipes|d(?:stone|umbrella)?|hab|i(?:sen?|t)|liance|n(?:t(?:als)?)?|p(?:air|ort|ublican)|st(?:aurant)?|views?|xroth)?|i(?:c(?:h(?:ardli)?|oh)|l|o|p)|o(?:c(?:her|ks)|deo|gers|om)?|s(?:vp)?|u(?:gby|hr|n)?|we?|yukyu)|s(?:a(?:arland|fe(?:ty)?|kura|l(?:e|on)|ms(?:club|ung)|n(?:dvik(?:coromant)?|ofi)|p|rl|s|ve|xo)?|b[is]?|c(?:a|b|h(?:aeffler|midt|o(?:larships|ol)|ule|warz)|ience|ot)?|d|e(?:a(?:rch|t)|cur(?:e|ity)|ek|lect|ner|rvices|ven|w|xy?)?|fr|g|h(?:a(?:ngrila|rp|w)|ell|i(?:a|ksha)|o(?:es|p(?:ping)?|uji|w(?:time)?))?|i(?:lk|n(?:a|gles)|te)?|j|k(?:in?|y(?:pe)?)?|l(?:ing)?|m(?:art|ile)?|n(?:cf)?|o(?:c(?:cer|ial)|ft(?:bank|ware)|hu|l(?:ar|utions)|n[gy]|y)?|p(?:a(?:ce)?|o(?:rt|t))|rl?|s|t(?:a(?:da|ples|r|te(?:bank|farm))|c(?:group)?|o(?:ckholm|r(?:age|e))|ream|ud(?:io|y)|yle)?|u(?:cks|pp(?:l(?:ies|y)|ort)|r(?:f|gery)|zuki)?|v|w(?:atch|iss)|x|y(?:dney|stems)?|z)|t(?:a(?:b|ipei|lk|obao|rget|t(?:a(?:motors|r)|too)|xi?)|ci?|dk?|e(?:am|ch(?:nology)?|l|masek|nnis|va)|f|g|h(?:d|eat(?:er|re))?|i(?:aa|ckets|enda|ffany|ps|r(?:es|ol))|j(?:maxx|x)?|k(?:maxx)?|l|m(?:all)?|n|o(?:day|kyo|ols|p|ray|shiba|tal|urs|wn|y(?:ota|s))?|r(?:a(?:d(?:e|ing)|ining|vel(?:channel|ers(?:insurance)?)?)|ust|v)?|t|u(?:be|i|nes|shu)|vs?|w|z)|u(?:a|b(?:ank|s)|g|k|n(?:i(?:com|versity)|o)|ol|ps|s|y|z)|v(?:a(?:cations|n(?:a|guard))?|c|e(?:gas|ntures|r(?:isign|sicherung)|t)?|g|i(?:ajes|deo|g|king|llas|n|p|rgin|s(?:a|ion)|v[ao])?|laanderen|n|o(?:dka|l(?:kswagen|vo)|t(?:e|ing|o)|yage)|u(?:elos)?)|w(?:a(?:l(?:es|mart|ter)|ng(?:gou)?|tch(?:es)?)|e(?:ather(?:channel)?|b(?:cam|er|site)|d(?:ding)?|i(?:bo|r))|f|hoswho|i(?:en|ki|lliamhill|n(?:dows|e|ners)?)|me|o(?:lterskluwer|odside|r(?:ks?|ld)|w)|s|t[cf])|x(?:box|erox|finity|i(?:huan|n)|xx|yz)|y(?:a(?:chts|hoo|maxun|ndex)|e|o(?:dobashi|ga|kohama|u(?:tube)?)|t|un)|z(?:a(?:ppos|ra)?|ero|ip|m|one|uerich|w))"),aR=RegExp("(?:(?:\\b)"+aA.source+"|(?:\\b|\\/\\/)"+a_.source+")(?"+aI.source+")?(?:"+aD.source+")?(?=$|\\s|\\.|,|;)","gi"),aH=RegExp("(?:"+a_.source+")(?"+aI.source+")?(?:"+aD.source+")?(?=$|\\s|\\.|,|;)","gi"),aj=RegExp("^"+ad),aO=/^(([^\s"(),.:;<>@[\]]+(\.[^\s"(),.:;<>@[\]]+)*)|(".+"))@(([^\s"(),.:;<>@[\]]+\.)+[^\s"(),.:;<>@[\]]{2,})$/i;function a$(e){if(!e)return"";switch(aB(e)){case"email":return e.startsWith("mailto:")?e:`mailto:${e}`;case"phone":return e.startsWith("tel:")?e:`tel:${e}`;case"http":case"https":case"valid_protocol":case"current_protocol":return e;default:return`http://${e}`}}function aB(e){return e.startsWith("mailto:")||aO.test(e)?"email":e.startsWith("tel:")||aj.test(e)?"phone":e.startsWith("https://")?"https":e.startsWith("http://")?"http":e.startsWith("//")?"current_protocol":aA.test(e)?"valid_protocol":null}var az=e=>"phone"===aB(e),aP=e=>"email"===aB(e);function aW(e){aR.lastIndex=0;let t=aR.exec(e);return!!t&&t[0]===e}function aZ(e){let t=aB(e);return!t||"http"===t||"https"===t}function aV(e){let t=e.firstChild;return t?.type.name===tw.tw?t.textContent:""}function aF(e){return e&&"object"==typeof e&&e.content?.[0]?.type===tw.tw?{...e,content:e.content.slice(1)}:e}function aK(e){return e.textBetween(aQ(e),e.content.size," ")}function aq(e){let t=e?.content;return t?(t[0]?.type===tw.tw&&(t=t.slice(1)),t.map(aY).join(" ")):""}function aY(e){if(!e)return"";if(e.text)return e.text;switch(e.type){case tw.lr:return aL(e.attrs);case tw.qh:return String(e.attrs?.label||"");case tw.r9:return" ";case tw.Q0:return aS(e.attrs).trim()}if(e.content&&e.content.length>0){let t=null!=e.content[0].text;return e.content.map(aY).join(t?"":" ")}return""}function aU(e){return Math.max(aQ(e)-1,0)}function aQ(e){let t=e.firstChild;return t?.type.name===tw.tw&&1===t.attrs.level?t.nodeSize:0}function aX(e){if(e.isTextblock)return null;let t=-1,n=-1,r=e.type.schema.topNodeType===e.type?0:1;for(let a=0;a<e.childCount;a++){let i=e.child(a);if((0,tY.yD)(i))-1===t&&(t=r),r+=i.nodeSize,n=r;else if(-1===t)r+=i.nodeSize;else break}if(-1===t)return null;let a=t+1,i=n-1;return a>i?null:[a,i]}function aJ(e){let t=(0,tB.N2)({node:e,predicate:({node:e})=>e.type.name===tw.l1}).pop();if(t)return t.pos+t.node.nodeSize-2}function aG(e){let t=[];return e.descendants(e=>{for(let n of e.marks)n.type.name===tw.et&&t.push(n)}),t}function a0(e){let t=aG(e).filter(e=>aP(e.attrs.href)).map(e=>e.attrs.href.replace("mailto:",""));return(0,t3.Z)(t)}function a1(e){let t=aG(e).filter(e=>az(e.attrs.href)).map(e=>e.attrs.href.replace("tel:",""));return(0,t3.Z)(t)}function a5(e){let t=aG(e).filter(e=>aZ(e.attrs.href)).map(e=>(function(e){let t=/:\/\//.test(e)?e:`http://${e}`;try{let e=new URL(t);if(/^\/.+/.test(e.pathname))return;return e.hostname?.replace("www.","")}catch(e){return null}})(e.attrs.href)).filter(e=>e);return(0,t3.Z)(t)}function a2(e){let t=aG(e).filter(e=>aZ(e.attrs.href)).map(e=>e.attrs.href);return(0,t3.Z)(t)}function a7(e){let t=[];return e.descendants(e=>{if(e.type.name===tw.lr)return t.push(e.attrs.label),!1}),(0,t3.Z)(t)}function a3(e){let t={};for(let{node:n}of(0,tB.N2)({node:e,predicate:({node:e})=>e.type.name===tw.l1||e.type.name===tw.WQ,descend:!0}).flatMap(({node:e})=>(0,tB.N2)({node:e,predicate:({node:e})=>e.type.name===tw.e3,descend:!1}))){let e=n.textContent,r=e.indexOf(":");if(r<0)continue;let a=e.slice(0,r),i=(0,t4.Z)((0,t4.Z)(e.slice(r),":")),l=(0,t8.Z)(a);l&&i&&(t[l]=i)}return t}function a4(e){let t=[];return e.descendants((e,n)=>e.type.name===tw.qh?(t.push([e,n]),!1):e.isBlock),t}function a8(e){return!!a6(e,()=>!0)}function a6(e,t){let n=null;return e.descendants(e=>{if(n)return!1;if(e.type.name===tw.qh){let r=e.attrs;t(r)&&(n=r)}}),n}function a9(e,t){for(let n=0;n<e.childCount;n++){let r=e.child(n);if(r.type.name===tw.qh&&r.attrs.id===t)return!0}return!1}function ie(e){let t=[];return e.descendants((n,r,a)=>{if(n.type.name===tw.qh){let i=n.attrs,l=e.resolve(r);if(!a)return;let o=function(e,t,n){let r=e.depth;if(aT(n))return(function(e,t){let n=[e.child(t)];for(let r=t+1;r<e.childCount;r++){let t=e.child(r);if(aT(t))break;n.push(t)}return n})(e.node(r-1),e.index(r-1)).map(e=>(0,tB.Em)(e)).join("");let a=r>=1&&e.node(r-1),i=r>=2&&e.node(r-2);if(a&&(0,tY.yD)(a)){if(!(i&&(0,tY.yD)(i))||i.firstChild?.type.name!==tw.e3)return(0,tB.Em)(a);{let e=aN(i.content),n=e.slice(1).filter(e=>(function(e,t){if(e.isTextblock)return a9(e,t);for(let n=0;n<e.childCount;n++){let r=e.child(n);if(r.isTextblock&&a9(r,t))return!0}return!1})(e,t)),r=i.copy(tU.HY.from([e[0],...n]));return(0,tB.Em)(r)}}return(0,tB.Em)(n)}(l,i.id,a);t.push({...i,contextHtml:o})}}),(0,t6.Z)(t,e=>JSON.stringify([e.id,e.graphId,e.contextHtml]))}function it(e){let{node:t,posFrom:n=0,wordsToMatch:r}=e,a=[];return t.descendants((e,t)=>{e.isText&&t>n&&(a=[...a,...(function(e,t){if(!e||0===t.length)return[];let n=` ${e.toLowerCase()} `,r=t.map(e=>e.toLowerCase().trim()).filter(Boolean).map(e=>` ${e} `),a=[];for(let e of r){let t=0,r=0;for(;r>-1;)(r=n.indexOf(e,t))>-1&&(a.push(r),t=r+e.length-1)}return a})(e.textContent,r).map(e=>e+t)])}),a}function ir(e,t){return it({node:e,wordsToMatch:t})}function ia(e){let t=!1;return e.descendants(e=>{if(e.isTextblock||t)return!1;il(e)&&(t=!0)}),t}function ii(e){let t=[],n=[],r=new Set,a=e=>{if(!e||e.isTextblock)return;let i=(0,tY.yD)(e.firstChild),l=!i&&(0,tY.yD)(e);if(!i&&il(e)){let a=e.attrs.guid;a&&!r.has(a)&&(r.add(a),t.push({task:e,parentBreadcrumbs:[...n]}))}let o=l?function(e){if(!e)return null;let t=function e(t){if(!t)return null;if(t.isTextblock)return t;for(let n=0;n<t.childCount;n++){let r=e(t.child(n));if(r)return r}return null}(e);if(t){let n=t.content;return e.type.schema.nodes[tw.e3].createChecked(null,n)}return null}(e)?.textContent:null;o&&n.push(o);for(let t=0;t<e.childCount;t++)a(e.child(t));o&&n.pop()};return a(e),t}function il(e){return e.type.name===tw.RF||e.type.name===tw.VM&&"task"===e.attrs.kind}function io(e){let t=aX(e);if(!t)return null;let[n,r]=t;return(0,tY.gY)(e.resolve(n),e.resolve(r))}function is(e){let t=io(e);if(!t){let t=aQ(e);return[t,t]}let{parent:n,endIndex:r,startIndex:a,end:i}=t,l=i;for(let e=r-1;e>=a;e--){let t=n.child(e);if(function(e){if(!e.firstChild)return!0;if(e.textContent)return!1;for(let t of aN(e))if(!t.type.isTextblock||aN(t).some(e=>!e.type.isText)||t.textContent)return!1;return!0}(t))l-=t.nodeSize;else break}return[l,i]}function ic(e){return r5(e,{normalizeListItem:!0,normalizeTaskListItem:!0,wrapBacklinkWithBrackets:!1,removeTagLinks:!1,normalizeIframe:!0,normalizeFile:!0,nativeList:!0})}var iu=()=>e=>{(0,ni.Vn)(e,"text",(e,t,n)=>{n&&"element"===n.type&&"code"===n.tagName&&e.value.endsWith("\n")&&(e.value=e.value.slice(0,-1))})},id=function(){let e=this.data().DATA_ON_BACKLINK_ADD;e&&nl.Z.call(this,{pageResolver:e=>[e.trim()],hrefTemplate:t=>{let n=e({label:t.trim(),id:""});if(!n.graphId)throw Error("Backlink should not have an empty graphId");if(!n.id)throw Error("Backlink should not have an empty id");return rZ({graphId:n.graphId,id:n.id})},aliasDivider:"//"})},ip=/#([^\s!#$&'"*+,\\/:;=?@%|(){}[\]<>]+)/giu,im=function(){let e=this.data().DATA_ON_TAG_ADD;return t=>{e&&(0,no.n)(t,[[ip,t=>{let n=(t=t.toLocaleLowerCase()).startsWith("#")?t.slice(1):null;if(!n)return!1;let r=e({label:n,id:""});if(!r.graphId)throw Error("Tag should not have an empty graphId");if(!r.id)throw Error("Tag should not have an empty id");return{type:"link",title:null,url:aC({graphId:r.graphId,id:r.id}),children:[{type:"text",value:t}]}}]],{ignore:["link","linkReference"]})}};function ih(e,t){let n=String(t);(0,nu.S4)(e,function(e,t){if((0,ns.w)(e))return nu.AM;if("listItem"!==e.type)return;let r=t.at(-1);if(!r||"list"!==r.type||r.ordered)return;let a=(0,nc.Pk)(e);a&&"number"==typeof a.offset&&"+"===n[a.offset]&&(e.data||(e.data={}),e.data.hProperties||(e.data.hProperties={}),e.data.hProperties["data-list-kind"]="task")})}var ig=()=>e=>(0,na.U)(e,e=>"link"!==e.type||aW(e.url||"")||e.children?.length!==1?e:e.children[0]),ik=(0,t9.Z)(function(e){return(0,t7.l)().use(nn.Z).use(nt.Z).use(()=>ih).use(t5.Z).use(id).use(im).use(ig).use(nr.Z,{allowDangerousHtml:!0}).use(iu).use(ne.Z,{allowDangerousHtml:e})});function iy(e,t){let{onTagAdd:n,onBacklinkAdd:r,allowDangerousHtml:a=!1}=t??{},i=ik(a)();return n&&i.data("DATA_ON_TAG_ADD",n),r&&i.data("DATA_ON_BACKLINK_ADD",r),String(i.processSync(e))}function ib(e){return e?"string"!=typeof e?`<obfuscated ${typeof e}>`:e.replace(/\S/g,"a"):e}function iw(e){if("object"==typeof e){for(let n of Object.keys(e)){var t;e[n]=(t=e[n])&&"number"!=typeof t&&"boolean"!=typeof t?"string"==typeof t?t.startsWith("tel:")?"tel:123-456-7890":t.startsWith("mailto:")?"mailto:hi@example.com":t.startsWith("http://")?"http://example.com":t.startsWith("https://")?"https://example.com":ib(t):`<obfuscated ${typeof t}>`:t}return e}}function iv(e){return e?function e(t){var n;if(!t)return t;for(let r of(t.text&&(t.text=(n=t.text)?ib(n):n),t.attrs&&(t.attrs=iw(t.attrs)),t.content||[]))e(r);for(let e of t.marks||[])e&&"string"!=typeof e&&"object"==typeof e&&(e.type,iw(e.attrs));return t}((0,nd.Z)(e)):e}function ix(e){let{openStart:t,openEnd:n}=e,{openStart:r,openEnd:a}=tU.p2.maxOpen(e.content);return!(t>r)&&!(n>a)||(console.warn(`[reflect-editor] Found wrong open for pasted slice. result=${JSON.stringify({openStart:t,openEnd:n,maxOpenStart:r,maxOpenEnd:a})}`),console.warn(`[reflect-editor] Pasted content: ${JSON.stringify(iv(e.toJSON()))}`),!1)}function iE(e){return!!e}b=[(0,tM.AOx)({defaultOptions:{markdown:{},onBacklinkAdd:null}})];var iC=class extends(v=tM.nNj){get name(){return"plainPaste"}shiftKey=!1;createPlugin(){let e=this.store.schema,t=ic(e);return{props:{transformCopied:e=>(0,tY.Yf)(e),transformPasted:e=>{let[t,n]=function(e){let t=new Map,n=(e,n)=>{let r=e.attrs,a=t.get(n)||(0,np.Z)("pending-image-");t.set(r.src,a);let i={...r,id:a,src:n};return e.type.createChecked(i,e.content,e.marks)},r=e=>{let t=function(e){try{let[t,n]=e.split(","),r=t.match(/:(.*?);/)[1],a=function(e,t=""){let n=atob(e),r=n.length,a=new Uint8Array(r);for(let e=0;e<r;e++)a[e]=n.charCodeAt(e);return new Blob([a],{type:t})}(n,r);return URL.createObjectURL(a)}catch(t){return console.warn(`Failed to parse base64 URL: ${e.slice(0,20)} ...: ${t}`),null}}(e.attrs.src);return t?n(e,t):null},a=e=>{if(e.isText)return e;if(e.type.name===tw.MM){let t=e.attrs;return!function(e){let t=e.src||"";return e.settled||t.toLowerCase().startsWith("https://firebasestorage.googleapis.com/")||t.includes("reflect-settled-image-mocking")}(t)?"string"==typeof t.src&&t.src.startsWith("data:")?r(e):n(e,t.src):e}return e.copy(i(e.content))},i=e=>{let t=aN(e).map(a).filter(iE);return tU.HY.from(t)};return e=new tU.p2(i(e.content),e.openStart,e.openEnd),[Array.from(t.entries()).map(([e,t])=>({url:e,id:t})),e]}(e=function(e){let t=function(e){let t=[];for(let n=0;n<e.childCount;n++)t.push(function(e){if(e.isInline)return e;let t=e.firstChild,n=e.lastChild,r=[];for(let t=0;t<e.childCount;t++)r.push(e.child(t));return t?.type.name===tw.r9?r.shift():n?.type.name===tw.r9&&r.pop(),e.copy(tU.HY.from(r))}(e.child(n)));return tU.HY.from(t)}(e.content);return new tU.p2(t,e.openStart,e.openEnd)}(e=function(e){if(1!==e.content.childCount)return e;let t=e.content.child(0);if(t.type.name!==tw.iL)return e;let n=t.marks.find(e=>e.type.name===tw.et),r=n?.attrs?.href;return r&&(rJ.test(r)||tw.W2.test(r))?new tU.p2(tU.HY.fromArray([t.type.schema.text(r,t.marks)]),0,0):e}(e)));return this.store.commands.uploadImagesInBackground(t),n},clipboardTextParser:(t,n,r,a)=>{let i=document.createElement("div");if(r){let e=n.marks(),{schema:r}=this.store.view.state,a=tU.PW.fromSchema(r);t.split(/(?:\r\n?|\n)+/).forEach(t=>{let n=i.appendChild(document.createElement("p"));t&&n.appendChild(a.serializeNode(r.text(t,e)))})}else if(aW(t)){let e=document.createElement("a");e.textContent=t,e.setAttribute("href",a$(t)),i.appendChild(e)}else i.innerHTML=iy(t,{onBacklinkAdd:this.options.markdown.onBacklinkAdd,allowDangerousHtml:!1});let l=tU.aw.fromSchema(e).parseSlice(i);return ix(l)||console.warn("[reflect-editor] Found error in CopyPasteExtension"),a8(l.content)&&rE(a,this.options.onBacklinkAdd),l},clipboardSerializer:t,clipboardTextSerializer:e=>{let n=ai(e),r=1==n.childCount&&(n.child(0).isTextblock||n.child(0).isInline);return this.shiftKey||r?e.content.textBetween(0,e.content.size,"\n\n"):aa(n,t)},handleDOMEvents:{keydown:(e,t)=>{this.shiftKey=t.shiftKey},keyup:(e,t)=>{this.shiftKey=t.shiftKey}}}}}};w=(0,tx.xl)(v),iC=(0,tx.pL)(w,0,"CopyPasteExtension",b,iC),(0,tx.Co)(w,1,iC);var iL=class extends tM.nNj{get name(){return"debugPastedSliceExtension"}createPlugin(){return{props:{transformPasted:e=>(ix(e)||console.warn("[reflect-editor] Found error in DebugPastedSliceExtension"),e)}}}},iS=class extends Error{constructor(e,t){super(e,t)}},iN=class extends iS{constructor(){super("This note has been edited in a newer version of Reflect. Please update your app to the latest version"),this.name="UnsupportedDocumentVersionError"}};function iT(e){return"attachment"===e.type&&(e.type="file"),Array.isArray(e.content)&&e.content.forEach(iT),e}function iM(e){return"object"==typeof e&&e?.type==="link"}function iI(e){let t=(0,tY.b7)(e);return t?(function e(t){if(t&&"object"==typeof t){if(t.type===tw.WQ){t.attrs||(t.attrs={});let e=t.attrs;e.guid||(e.guid=rm())}t.content&&Array.isArray(t.content)&&t.content.forEach(e)}}(t),t):e}function iD(e,t){let{debug:n}=t||{};return function(t,r,a){let i=a?`[prosemirror-migration] (${a}):`:"[prosemirror-migration]:",l=t.attrs?.version??0;if(!(0,nf.Z)(l))return console.error(`${i} "doc.attrs.version" must be a number, undefined or null`),!1;if(l===r)return!1;if(l-r>=1)throw console.error(`${i} downgrading version is not supported`),new iN;if(l-r>=0)return!1;let o=(0,nd.Z)(t),s=Object.keys(e).map(e=>Number.parseInt(e)).filter(e=>r>=e&&e>l).sort((e,t)=>e-t);n&&console.log(`${i} migrationKeys`,s);let c=!1,u=s.reduce((t,r)=>{n&&console.log(`${i} running migration for versionKey`,r);let a=e[r](t);return a?(c=!0,a):t},o);return!!c&&u}}var iA={0:e=>e,1:e=>{let t=function(e){if("doc"!==e.type)throw Error(`node.type must be "doc", instead of "${e.type}"`);return function e(t){for(let n of t)n.content&&(n.content=e(n.content));let n=t.map(e=>(function(e,t){if("listItem"!==e.type)return e;if(t||e.attrs?.hasCheckbox){let t={...e.attrs};return delete t.hasCheckbox,delete t.closed,delete t.nested,t.checked=!!t.checked,{...e,attrs:t,type:"taskListItem"}}{let t=e.attrs;return t&&(delete t.hasCheckbox,delete t.checked),e}})(e,!1));return(0,nh.Z)(n.map(e=>(function(e){if("bulletList"!==e.type&&"orderedList"!==e.type)return[e];let t=e.attrs;return t&&(delete t.order,0===Object.keys(t).length&&delete e.attrs),(function(e,t){let n=[],r=[];return e.map(e=>{0===r.length?r.push(e):t(e)===t(r[0])?r.push(e):(n.push(r),r=[e])}),r.length>0&&n.push(r),n})(e.content??[],e=>e.type).map(t=>{let n="taskListItem"===t[0].type;return{...e,type:n?"taskList":e.type,content:t}})})(e)))}([e])[0]}(e);return t.attrs={...t.attrs,version:1},t},2:e=>{let t=iT(e);return t.attrs={...t.attrs,version:2},t},3:e=>{let t=iT(e);return t.attrs={...t.attrs,version:3},t},4:e=>{let t=function e(t){if("text"===t.type&&t.marks?.length){let e=t.marks.filter(iM);if(e.length>=2){let n=t.marks.filter(e=>!iM(e));t.marks=[...n,e[0]]}}return Array.isArray(t.content)&&t.content.forEach(e),t}(e);return t.attrs={...t.attrs,version:4},t},5:e=>{let t=function e(t){return t.type!==tw.RF||t.attrs?.guid||(t.attrs||(t.attrs={}),t.attrs.guid=rm()),Array.isArray(t.content)&&t.content.forEach(e),t}(e);return t.attrs={...t.attrs,version:5},t},6:e=>{let t=iI(e);return t.attrs={...t.attrs,version:6},t},6.1:e=>{let t=iI(e);return t.attrs={...t.attrs,version:6.1},t}},i_=6.1,iR=iD(iA,{debug:!1}),iH=iD(iA,{debug:!0});function ij(e){return iR(e,i_,"migrateJson")||e}var iO=class extends nm.V{createNodeSpec(e,t){return{...super.createNodeSpec(e,t),attrs:{version:{default:i_}}}}};x=[(0,tM.AOx)({defaultOptions:{enabled:!1}})];var i$=class extends(C=tM.nNj){get name(){return"doubleSpace"}createPlugin(){let e=0;return{state:{init:()=>null,apply:(t,n,r,a)=>{t.docChanged&&!r.doc.eq(a.doc)&&(e=Date.now())}},props:{decorations:t=>{if(!this.options.enabled||!(Date.now()-e<500))return null;let n=t.selection;return n.empty&&(0,tB.hT)(n)&&n.$to.parentOffset===n.$to.parent.content.size?ng.EH.create(t.doc,[ng.p.widget(n.$to.pos,iB,{side:1,key:"cursor-telomere"})]):null}}}}};function iB(){let e=document.createElement("span");return e.innerText="\uFEFF",e}E=(0,tx.xl)(C),i$=(0,tx.pL)(E,0,"DoubleSpaceExtension",x,i$),(0,tx.Co)(E,1,i$);var iz=null,iP=null;function iW(e){let t=e.nodeAfter;return t&&tz.qv.isSelectable(t)?new tz.qv(e):null}function iZ(e,t,n){let r=e.posAtCoords({left:t.clientX,top:t.clientY});if(!r)return null;let a=r.inside>=0&&e.state.doc.nodeAt(r.inside);if(a&&a.type.spec.disableDropCursor)return null;let i=r.inside>=0?r.inside:r.pos;if(a&&r.inside>=0){let n=e.domAtPos(r.inside)?.node,l=n?.getBoundingClientRect();l&&t.clientY>(l.top+l.height)/2&&(i+=a.nodeSize)}return function(e,t,n){if(t>e.content.size)return null;let r=(0,nb.nj)(e,t,n);if(null==r||av(e,r))return null;let a=e.resolve(r);if(0===a.index()&&a.nodeAfter?.type.isTextblock&&a.depth>=1){let t=a.before();return av(e,t)?null:t}return r}(e.state.doc,i,n)}function iV(e,t,n,r,a){if(!r||0===n.size)return!1;let i=iZ(e,t,n);if(!i)return!1;if(!a){a=e.state.tr;let t=iP?.node;t?t.replace(a):a.deleteSelection()}let l=a.mapping.map(i),o=0===n.openStart&&0===n.openEnd&&1===n.content.childCount&&n.content.firstChild,s=a.doc;if(o?a.replaceRangeWith(l,l,o):a.replaceRange(l,l,n),a.doc.eq(s))return!1;let c=a.doc.resolve(l);if(o&&tz.qv.isSelectable(o)&&c.nodeAfter&&c.nodeAfter.sameMarkup(o)){let e=iW(c);e&&a.setSelection(e)}else{let e=a.mapping.map(i);a.mapping.maps[a.mapping.maps.length-1].forEach((t,n,r,a)=>e=a),a.setSelection(tz.Bs.between(c,a.doc.resolve(e)))}return e.focus(),e.dispatch(a.setMeta("uiEvent","drop")),!0}function iF(e,t){if(e.content.maybeChild(0)?.type?.schema===t)return e;try{return tU.p2.fromJSON(t,e.toJSON())}catch(e){return tU.p2.empty}}var iK=tB.NZ.isMac?"altKey":"ctrlKey";L=[(0,tM.AOx)({customHandlerKeys:["draggable"]})];var iq=class extends(N=tM.nNj){draggableHandler=null;get name(){return"drag"}onAddCustomHandler=({draggable:e})=>{if(e)return this.draggableHandler=e,()=>this.draggableHandler=null};createPlugin(){return{props:{handleDrop:iV,handleDOMEvents:{mousemove:(0,nk.Z)((e,t)=>(this.draggableHandler?.(function(e,t){let n=e.dom,r=n.getBoundingClientRect(),a=e.posAtCoords({left:Math.max(r.left+r.width/2,t.clientX),top:t.clientY});if(!a)return null;let i=function(e){let t=e.nodeAfter;if(t&&t.isAtom&&!t.isInline)return iY(t,e.parent)?e.before(e.depth):e.pos;if(0===e.depth)return null;let n=e.parent,r=e.node(e.depth-1);return e.depth-1>0&&iY(n,r)?e.before(e.depth-1):e.before()}(e.state.doc.resolve(a.pos));if(!i)return null;let l=e.domAtPos(i,1),o=-1===l.offset?l.node:l.node.children[l.offset];if(!o?.getBoundingClientRect)return null;let s=o.getBoundingClientRect();return{pos:i,element:o,lineHeight:iU(window.getComputedStyle(o).lineHeight),left:iU(window.getComputedStyle(n).paddingLeft)??0,top:s.top-r.top,width:s.width,height:s.height,clientX:t.clientX-r.left,clientY:t.clientY-r.top}}(e,t)),!0),100),dragstart:e=>(iz=e,!1),drop:(e,t)=>(function(e,t){var n;if(!t.dataTransfer)return!1;(iP=n=e.dragging??null)&&setTimeout(()=>{iP===n&&(iP=null)},50);let r=function(){let e=iz;return iz=null,e}();if(!r||r===e||r.isDestroyed)return!1;let a=r.dragging?.slice;if(!a)return!1;r.dragging=null;let i=iF(a,e.state.schema);if(e.someProp("transformPasted",t=>{i=t(i,e)}),!e.posAtCoords({left:t.clientX,top:t.clientY}))return!1;let l=!t[iK],o=e.state.tr,s=iV(e,t,i,l,o);return s&&r.dispatch(r.state.tr.deleteSelection()),s})(e,t)}}}}};function iY(e,t){return!!((e.isTextblock||e.isAtom&&e.isBlock)&&[tw.WQ,tw.H1].includes(t.type.name))}function iU(e){if("number"==typeof e)return(0,ny.Z)(e)?null:e;if(e.endsWith("px")&&(e=e.slice(0,-2)),/\d+(?:\.\d*)?/.test(e)){let t=Number.parseFloat(e);if(!(0,ny.Z)(t))return t}return null}S=(0,tx.xl)(N),iq=(0,tx.pL)(S,0,"DraggableExtension",L,iq),(0,tx.Co)(S,1,iq);var iQ=class{constructor(e,t){this.editorView=e,this.width=t.width??1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}})}width;color;class;cursorPos=null;element=null;elementStartLeft=-1;elementStartTop=-1;timeout=null;handlers;prevEventX=null;prevEventY=null;destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null,this.elementStartLeft=-1,this.elementStartTop=-1):this.updateOverlay())}updateOverlay(){let e,t;let n=this.editorView.state.doc.resolve(this.cursorPos),r=!n.parent.inlineContent,a=null;if(r){let e=n.nodeBefore,t=n.nodeAfter;if(e||t){let n=this.editorView.nodeDOM(this.cursorPos-(e?e.nodeSize:0));if(n){let r=n.getBoundingClientRect(),i=n.classList.contains("list-content")&&n.parentElement?.classList.contains("prosemirror-flat-list")||n.classList.contains("prosemirror-flat-list"),l=e?r.bottom:r.top;e&&t&&(l=(l+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),a={left:r.left-(i?20:0),right:r.right,top:l-this.width/2,bottom:l+this.width/2}}}}if(!a){let e=this.editorView.coordsAtPos(this.cursorPos);a={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let i=this.editorView.dom.offsetParent;if(!this.element&&(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r),i&&(i!=document.body||"static"!=getComputedStyle(i).position)){let n=i.getBoundingClientRect();e=n.left-i.scrollLeft,t=n.top-i.scrollTop}else e=-pageXOffset,t=-pageYOffset;let l=a.left-e,o=a.top-t,s=a.right-a.left,c=a.bottom-a.top;-1===this.elementStartLeft&&(this.elementStartLeft=l,this.elementStartTop=o),this.element.style.left=`${this.elementStartLeft}px`,this.element.style.top=`${this.elementStartTop}px`,this.element.style.transform=`translate(${l-this.elementStartLeft}px, ${o-this.elementStartTop}px)`,this.element.style.width=`${s}px`,this.element.style.height=`${c}px`}scheduleRemoval(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable||this.prevEventX===e.clientX&&this.prevEventY===e.clientY)return;this.prevEventX=e.clientX,this.prevEventY=e.clientY;let t=this.editorView.dragging?this.editorView:iz,n=t?.dragging?.slice;if(!n)return;let r=iF(n,this.editorView.state.schema),a=iZ(this.editorView,e,r);a&&(this.setCursor(a),this.scheduleRemoval(5e3))}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.scheduleRemoval(20)}};T=[(0,tM.AOx)({defaultOptions:{width:2}})];var iX=class extends(I=tM.nNj){get name(){return"reflectDropCursor"}createPlugin(){return{view:e=>new iQ(e,{width:this.options.width,color:!1})}}};M=(0,tx.xl)(I),iX=(0,tx.pL)(M,0,"ReflectDropCursorExtension",T,iX),(0,tx.Co)(M,1,iX);var iJ=[{annotation:"red question mark",hexcode:"2753",tags:["?","mark","punctuation","question"],emoji:"❓️",text:"❓︎",type:1,order:4163,group:8,subgroup:91,version:.6,shortcodes:["red_question_mark"]},{annotation:"red heart",hexcode:"2764",tags:["heart"],emoji:"❤️",text:"❤︎",type:0,order:142,group:0,subgroup:14,version:.6,emoticon:"<3",shortcodes:["red_heart"]},{annotation:"grinning face",hexcode:"1F600",tags:["face","grin"],emoji:"\uD83D\uDE00",text:"",type:1,order:1,group:0,subgroup:0,version:1,emoticon:":D",shortcodes:["grinning_face"]},{annotation:"face with tears of joy",hexcode:"1F602",tags:["face","joy","laugh","tear"],emoji:"\uD83D\uDE02",text:"",type:1,order:8,group:0,subgroup:0,version:.6,emoticon:":')",shortcodes:["face_with_tears_of_joy"]},{annotation:"slightly smiling face",hexcode:"1F642",tags:["face","smile"],emoji:"\uD83D\uDE42",text:"",type:1,order:9,group:0,subgroup:0,version:1,emoticon:":)",shortcodes:["slightly_smiling_face"]},{annotation:"winking face",hexcode:"1F609",tags:["face","wink"],emoji:"\uD83D\uDE09",text:"",type:1,order:11,group:0,subgroup:0,version:.6,emoticon:";)",shortcodes:["winking_face"]}],iG=class extends nv.h{createNodeSpec(e,t){return{...super.createNodeSpec(e,t),parseDOM:[{tag:"br",getAttrs:e=>{let t=e?.parentElement;return(!t||"P"!==t.tagName||1!==t.childNodes.length)&&null}}]}}createKeymap(){let e=super.createKeymap();return delete e["Mod-Enter"],e}},i0=class extends(A=nE.e,D=[(0,tM.WDe)()],A){constructor(){super(...arguments),(0,tx.Co)(_,5,this)}setHeading({level:e}){return(0,nx.QF)((0,tB.uJ)(this.type,{level:e}),t=>{let{state:n,dispatch:r}=t,a=n.selection.$anchor,i=(0,tB.Tr)({types:tw.D4,selection:a});return!!i&&!(a.depth-i.depth>=3)&&(!r||(this.store.commands.liftListItemOutOfList(i.node.type),this.store.commands.setBlockNodeType(this.type,{level:e}),!0))})}createKeymap(){let e={Backspace:({state:e,dispatch:t})=>{let{selection:n}=e;if(!n.empty)return!1;let r=(0,tB.Tr)({types:this.type,selection:n});if(r?.start!==n.from)return!1;let a=e.tr.setBlockType(r.start,r.start,e.schema.nodes.paragraph);return t&&t(a),!0}};return this.options.levels.forEach(t=>{e[`mod-alt-${t}`]=this.setHeading({level:t})}),e}};function i1({pos:e}){return(t,n)=>{let r=t.doc.nodeAt(e);if(r?.type?.name!==tw._M)return!1;let a=r0(r.attrs),i=t.schema,l=t.tr.replaceRangeWith(e,e+r.nodeSize,i.nodes.paragraph.createChecked(null,[i.text(a,[i.marks.link.create({href:a})])]));return n?.(l),!0}}_=(0,tx.xl)(A),(0,tx.pL)(_,1,"setHeading",D,i0),(0,tx.ZU)(_,i0);var i5=class extends(H=nC.a,R=[(0,tM.WDe)()],H){constructor(){super(...arguments),(0,tx.Co)(j,5,this)}createNodeSpec(e,t){let n=super.createNodeSpec({...e,dom:t=>({...e.dom(t),loading:"lazy"})},t);return{...n,attrs:{...n.attrs,width:{default:560},height:{default:315}},selectable:!0}}createEventHandlers(){return{blur:()=>(setTimeout(()=>{let e=document.activeElement;if(e?.tagName!=="IFRAME")return;let t=this.store.view;if(!t||t.isDestroyed)return;let n=t.posAtDOM(e,0,-1);if(n&&!(n<=0))for(let e of[n-1,n])try{let n=tz.qv.create(t.state.doc,e);if(n.node.type.name===this.type.name){t.dispatch(t.state.tr.setSelection(n));return}}catch(e){console.warn("Failed to select iframe:",e)}}),!1)}}createPasteRules(){return[{type:"node",nodeType:this.type,regexp:rJ,getAttributes:e=>{var t;return{src:(t=rG(e)??"",`https://www.youtube-nocookie.com/embed/${t}`),type:"youtube"}},getContent:()=>{}}]}replaceIframeToLink({pos:e}){return(0,nx.A_)(i1({pos:e}))}};function i2(e,t=3e3){return new Promise(n=>{let r=new Image;r.addEventListener("load",()=>{n({width:r?.naturalWidth,height:r?.naturalHeight})}),r.addEventListener("error",()=>n({})),r.src=e,setTimeout(()=>n({}),t)})}function i7(e){return/\.(gif|jpe?g|tiff?|png|webp|bmp)$/i.test(e)}j=(0,tx.xl)(H),(0,tx.pL)(j,1,"replaceIframeToLink",R,i5),(0,tx.ZU)(j,i5);var i3=new Map,i4={"audio/aac":".aac","application/x-abiword":".abw","application/x-freearc":".arc","image/avif":".avif","video/x-msvideo":".avi","application/vnd.amazon.ebook":".azw","application/octet-stream":".bin","image/bmp":".bmp","application/x-bzip":".bz","application/x-bzip2":".bz2","application/x-cdf":".cda","application/x-csh":".csh","text/css":".css","text/csv":".csv","application/msword":".doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":".docx","application/vnd.ms-fontobject":".eot","application/epub+zip":".epub","application/gzip":".gz","image/gif":".gif","text/html":".html","image/vnd.microsoft.icon":".ico","text/calendar":".ics","application/java-archive":".jar","image/jpeg":".jpeg","text/javascript":".js","application/json":".json","application/ld+json":".jsonld","audio/midi":".midi","audio/x-midi":".midi","audio/mpeg":".mp3","video/mp4":".mp4","video/mpeg":".mpeg","application/vnd.apple.installer+xml":".mpkg","application/vnd.oasis.opendocument.presentation":".odp","application/vnd.oasis.opendocument.spreadsheet":".ods","application/vnd.oasis.opendocument.text":".odt","audio/ogg":".oga","video/ogg":".ogv","application/ogg":".ogx","audio/opus":".opus","font/otf":".otf","image/png":".png","application/pdf":".pdf","application/x-httpd-php":".php","application/vnd.ms-powerpoint":".ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":".pptx","application/vnd.rar":".rar","application/rtf":".rtf","application/x-sh":".sh","image/svg+xml":".svg","application/x-tar":".tar","image/tiff":".tiff","video/mp2t":".ts","font/ttf":".ttf","text/plain":".txt","application/vnd.visio":".vsd","audio/wav":".wav","audio/webm":".weba","video/webm":".webm","image/webp":".webp","font/woff":".woff","font/woff2":".woff2","application/xhtml+xml":".xhtml","application/vnd.ms-excel":".xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":".xlsx","application/xml":".xml","application/vnd.mozilla.xul+xml":".xul","application/zip":".zip","video/3gpp":".3gp","audio/3gpp":".3gp","video/3gpp2":".3g2","audio/3gpp2":".3g2","application/x-7z-compressed":".7z"};function i8({id:e,attrs:t,fileType:n,view:r}){let a=(0,tM.fZ6)(r.state,e);if(null==a)return;let i=r.state.doc.resolve(a).nodeAfter;if(!i||i.type.name!==n||i.attrs.id!==e){let t=r.state.tr;(0,tM.en2)(t,{type:1,id:e}),r.dispatch(t);return}let l=r.state.tr;(0,tM.en2)(l,{type:1,id:e});let o={...i.attrs,...t,id:null};l.setNodeMarkup(a,void 0,o),r.dispatch(l)}async function i6(e,t,{id:n,url:r},a){let{context:i,fileUploader:l}=t,o=await i9(r,a),s=l.insert(o);try{let t=await l.upload(i);i8({id:n,fileType:tw.MM,view:e,attrs:t})}catch(t){i8({id:n,fileType:tw.MM,view:e,attrs:s})}}async function i9(e,t){let n=await t(e);return new File([n],"image"+(i4[n.type]??null??""),{type:n.type})}z=[(0,tM.AOx)({defaultOptions:{...nL.Gc.defaultOptions,onClick:null,uploadImageHandler:null,uploadImageSyncHandler:null,onFileDownload:rd}})];var le=class extends(B=nL.Gc,$=[(0,tM.WDe)()],O=[(0,tM.WDe)()],B){constructor(e){super(e),(0,tx.Co)(P,5,this)}createNodeSpec(e,t){return{...super.createNodeSpec({defaults:()=>({...e.defaults(),id:{default:null},error:{default:null},settled:{default:!1}}),parse:e=>"string"!=typeof e&&"IMG"===e.nodeName?{id:e.getAttribute("data-image-id"),error:e.getAttribute("data-image-error"),settled:e.hasAttribute("data-image-settled")}:{},dom:e=>{let t=e.attrs,n={};return t.id&&(n["data-image-id"]=t.id),t.error&&(n["data-image-error"]=t.error),t.settled&&(n["data-image-settled"]=""),n.loading="lazy",n}},t),selectable:!0}}createEventHandlers(){let e=this.options;return{mousedown:t=>(function(e,t,n){let r=t.target;if(r?.tagName!=="IMG")return!1;let a=e.posAtCoords({left:t.clientX,top:t.clientY})?.inside;if(!a||a<0||a>=e.state.doc.content.size)return!1;let i=e.state.doc.resolve(a),l=i.nodeAfter;if(l?.type.name!==tw.MM)return!1;let{selection:o}=e.state,{from:s,to:c}=o,u=(0,tB.EG)(e.state.selection)&&(s===a||c===a)||s===a&&c===a;if(n?.(r,u))t.preventDefault();else{let t=new tz.qv(i);e.dispatch(e.state.tr.setSelection(t))}return!0})(this.store.view,t,e.onClick)}}createPasteRules(){return[{type:"file",regexp:/^image.*$/i,fileHandler:e=>{if("paste"===e.type&&e.event.clipboardData?.types.includes("text/html"))return!1;let t="drop"===e.type?function(e,t){let n=e.state.doc.resolve(t);return tz.Bs.near(n).from}(e.view,e.pos):void 0;if(this.options.uploadImageSyncHandler){for(let n of e.files)this.uploadFileSync(n,t);return!0}for(let n of e.files)this.uploadFileV2(n,t);return!0}}]}async uploadFileV2(e,t){let n=URL.createObjectURL(e),{width:r,height:a}=await i2(n),{uploadImageHandler:i}=this.options;if(!i)throw Error("The 'uploadImageHandler' option is required.");(0,tM.cTq)({file:e,pos:t,view:this.store.view,fileType:this.type,uploadHandler:this.createUploadHandler({src:n,width:r,height:a})})}uploadFileSync(e,t){let{uploadImageSyncHandler:n}=this.options;if(!n)throw Error("The 'uploadImageSyncHandler' option is required.");let{src:r,fileName:a,finished:i}=n(e);i3.set(r,i);let l=this.type.createChecked({src:r,fileName:a,settled:!0});this.store.commands.insertNode(l,{selection:t})}createUploadHandler(e){let{uploadImageHandler:t}=this.options;if(!t)throw Error("The 'uploadImageHandler' option is required.");return()=>{let n;return{insert:t=>(n=t,e),upload:async r=>{if(t){let a=await t(n,e=>{r.set(tw.Lr,e)});return i7(a.fileName??"")&&await i2(a.src),{...e,src:a.src||e.src,fileName:a.fileName||e.fileName,settled:!0}}return e},abort:()=>{}}}}uploadImages(e){return()=>{for(let t of e)this.uploadFileV2(t);return!0}}uploadImagesInBackground(e){let t=this.createUploadHandler({src:""});return()=>{let{onFileDownload:n}=this.options;return!function(e,t,n,r){for(let a of n)(function(e,t,{id:n,url:r},a){let i={context:function(){let e={},t=(0,nS.i)();return{set:(n,r)=>{e[n]=r,t.emit("set",e)},get:t=>e[t],addListener:e=>t.on("set",e)}}(),fileUploader:t()};i6(e,i,{id:n,url:r},a);let l=e.state.tr;(0,tM.en2)(l,{type:0,id:n,payload:i,pos:1}),e.dispatch(l)})(e,t,a,r)}(this.store.view,t,e,n),!0}}createNodeViews(){return{}}};function lt(e,t){let n=(0,tB.OC)({content:"<h1></h1>"+e,schema:t});return n.cut(n.child(0).nodeSize).content}function ln(e,t,...n){let r=document.createElement(e);for(let[e,n]of Object.entries(t))r.setAttribute(e,n);return r.append(...n),r}P=(0,tx.xl)(B),(0,tx.pL)(P,1,"uploadImages",$,le),(0,tx.pL)(P,1,"uploadImagesInBackground",O,le),le=(0,tx.pL)(P,0,"ReflectImageExtension",z,le),(0,tx.Co)(P,1,le),X=[(0,tM.AOx)({defaultOptions:{markdown:{},onBacklinkAdd:null}})];var lr=class extends(Q=tM.nNj,U=[(0,tM.IGC)({shortcut:"Backspace",priority:tI.xV.High})],Y=[(0,tM.WDe)()],q=[(0,tM.WDe)()],K=[(0,tM.WDe)()],F=[(0,tM.WDe)()],V=[(0,tM.WDe)()],Z=[(0,tM.WDe)()],W=[(0,tM.WDe)()],Q){constructor(){super(...arguments),(0,tx.Co)(J,5,this)}get name(){return"reflectIndicator"}createPlugin(){let e=null,t=(t,n)=>ng.EH.create(t,[ng.p.widget(n,()=>(e||(e=ln("div",{class:"relative h-5 w-5 mx-2 my-1 select-none inline-flex align-middle",contentEditable:"false"},ln("div",{class:"absolute h-full w-full rounded-[50%] border-[3px] border-bluegray-500/10"}),ln("div",{class:"animate-spin ease-in-out absolute h-full w-full rounded-[50%] border-l-[3px] border-t-[3px] border-purple-500 border-t-transparent"}))),e),{key:"reflect-indicator",side:-20,ignoreSelection:!0,stopEvent:()=>!0})]);return{state:{init:()=>({decoration:null}),apply:(e,n)=>{let r=e.getMeta("updateSpinner");return r?r.pos?{decoration:t(e.doc,r.pos)}:{decoration:null}:n.decoration?{decoration:n.decoration.map(e.mapping,e.doc)}:n}},props:{decorations:e=>{let t=this.getPluginState(e);return t?.decoration}}}}deleteSpinnerKeyBinding(e){let t=e.state.selection;if(t.empty){let n=this.getPluginState(e.state),r=n?.decoration&&la(n.decoration);if(r&&t.from===r)return this.disableSpinner()(e),!0}return!1}updateSpinner(e){return({tr:t,dispatch:n})=>(t.setMeta("updateSpinner",{pos:e}),n?.(t),!0)}enableSpinner(){return e=>{let{tr:t}=e,n=t.selection.to;return this.updateSpinner(n)(e)}}disableSpinner(){return e=>this.updateSpinner(null)(e)}replaceMarkdown(e){return({view:t,tr:n,dispatch:r})=>{let a=lt(iy(e,this.options.markdown),this.store.schema),i=tU.p2.maxOpen(a);return n.replaceSelection(i),r?.(n),a8(i.content)&&rE(t,this.options.onBacklinkAdd),!0}}insertMarkdownAt(e,t,n){return({view:r,tr:a,dispatch:i})=>{t=Math.min(a.doc.content.size-1,t);let l=lt(iy(e,this.options.markdown),this.store.schema),o=n?tU.p2.maxOpen(l):new tU.p2(l,0,0);return a.replaceRange(t,t,o),i?.(a),a8(o.content)&&rE(r,this.options.onBacklinkAdd),!0}}insertMarkdownAtIndicator(e){return t=>{let n=this.getPluginState(),r=n?.decoration;if(!r)return!1;let a=la(r);return!!a&&this.insertMarkdownAt(e,a,!0)(t)}}insertMarkdownAfterSelection(e){return t=>{let n=t.tr.selection.to;return this.insertMarkdownAt(e,n,!1)(t)}}};function la(e){for(let t of e.find())return t.from;return null}J=(0,tx.xl)(Q),(0,tx.pL)(J,1,"deleteSpinnerKeyBinding",U,lr),(0,tx.pL)(J,1,"updateSpinner",Y,lr),(0,tx.pL)(J,1,"enableSpinner",q,lr),(0,tx.pL)(J,1,"disableSpinner",K,lr),(0,tx.pL)(J,1,"replaceMarkdown",F,lr),(0,tx.pL)(J,1,"insertMarkdownAt",V,lr),(0,tx.pL)(J,1,"insertMarkdownAtIndicator",Z,lr),(0,tx.pL)(J,1,"insertMarkdownAfterSelection",W,lr),lr=(0,tx.pL)(J,0,"ReflectIndicatorExtension",X,lr),(0,tx.Co)(J,1,lr);var li=class extends nN.f{createPasteRules(){return[{type:"mark",markType:this.type,regexp:/\b_([^_]+)_\b/g,ignoredMarks:["link"]},{type:"mark",markType:this.type,regexp:/(?:^|\s+)\*([^*]+)\*/g,ignoredMarks:["link"]}]}createInputRules(){return[rq({regexp:/(?:^|\s+)\*([^*]+)\*(?:\s$|\s+)$/,type:this.type.name,updateCaptured:({fullMatch:e,start:t})=>e.startsWith("*")?{}:{fullMatch:e.slice(1),start:t+1}}),rq({regexp:/(?:^|\s+)_([^_]+)_(?:\s$|\s+)$/,type:this.type.name,updateCaptured:({fullMatch:e,start:t})=>e.startsWith("_")?{}:{fullMatch:e.slice(1),start:t+1}})]}};G=[(0,tM.AOx)({defaultPriority:rs,customHandlerKeys:["keymap"]})];var ll=class extends(et=tM.nNj){get name(){return"reflectBeforeKeymap"}extraKeyBindings=[];inputRuleKeyDownHandler;keymapKeyDownHandler;setupKeymapKeyDownHandler(){this.keymapKeyDownHandler=this.createKeyDownHandler(this.extraKeyBindings)}setupInputruleKeyDownHandler(){this.inputRuleKeyDownHandler=this.createKeyDownHandler([this.createEnterInputRuleKeymap()])}createExternalPlugins(){return this.setupKeymapKeyDownHandler(),this.setupInputruleKeyDownHandler(),[new tz.Sy({props:{handleKeyDown:(e,t)=>this.keymapKeyDownHandler?.(e,t)?(t.stopPropagation(),!0):this.inputRuleKeyDownHandler?.(e,t)}})]}createKeyDownHandler(e){let t=this.sortKeymaps(e),n={};for(let e of t)for(let[t,r]of Object.entries(e))n[t]||(n[t]=[]),n[t].push(r);let r=()=>{throw Error("Not implemented")},a={};for(let[e,t]of Object.entries(n)){let n=(e,n,a)=>{if(!a)return!1;for(let e of t){let t=a.state,i=t.tr;if(e({view:a,state:t,tr:i,dispatch:n,next:r}))return!0}return!1};a[e]=n}return(0,nT.$)(a)}onAddCustomHandler=({keymap:e})=>{if(e)return this.extraKeyBindings=[...this.extraKeyBindings,e],this.setupKeymapKeyDownHandler(),()=>{this.extraKeyBindings=this.extraKeyBindings.filter(t=>t!==e),this.setupKeymapKeyDownHandler()}};sortKeymaps(e){return(0,tV.DY)(e.map(e=>(0,tV.kJ)(e)?e:[tI.xV.Default,e]),(e,t)=>t[0]-e[0]).map(e=>e[1])}extractInputRules(){let e=[];for(let t of this.store.extensions)if(!(this.store.managerSettings.exclude?.inputRules||!t.createInputRules||t.options.exclude?.inputRules))for(let n of t.createInputRules())e.push(n);return e}createEnterInputRuleKeymap(){let e=this.extractInputRules();return[rl,{Enter:t=>{let{view:n,state:r,dispatch:a}=t;if(!n||n.composing)return!1;let i=function(e,t){if(!e.selection.empty)return!1;let{$from:n,from:r}=e.selection;if(n.parent.type.spec.code)return!1;let a=n.parent.textBetween(Math.max(0,n.parentOffset-500),n.parentOffset,void 0,"￼")+" ";for(let n of t){n.match.lastIndex=0;let t=n.match.exec(a);if(!t)continue;let i=t[0].slice(0,-1),l=n.handler(e,t,r-i.length,r);if(l){if(l.selection.empty){let e=l.selection.$from,t=e.parentOffset;t>=1&&" "===e.parent.textBetween(t-1,t)&&l.delete(e.pos-1,e.pos)}return l}}return!1}(r,e);return!!i&&(a?.(i),!!i.selection.empty&&!!i.selection.$from.parent.type.spec.code)}}]}};ee=(0,tx.xl)(et),ll=(0,tx.pL)(ee,0,"ReflectBeforeKeymapExtension",G,ll),(0,tx.Co)(ee,1,ll);var lo=class extends nM.y5{createMarkSpec(e,t){return{...super.createMarkSpec(e,t),excludes:void 0}}createPasteRules(){return[{type:"mark",regexp:aR,markType:this.type,getAttributes:(e,t)=>({href:(0,tB.FI)(e),auto:!t}),replaceSelection:e=>!(iP||(0,tB.EG)(this.store.view.state.selection))&&!!e.trim(),ignoredMarks:["link"]}]}createInputRules(){return[ah({regexp:RegExp(this.options.autoLinkRegex.source+"\\s$","gi"),contactType:void 0,linkType:this.type})]}};function ls(e){return(...t)=>(e(...t),!0)}function lc(e,t){let n=[];for(let[r,a]of Object.entries(e)){let e=(0,nI.Jv)(r,{layout:t??void 0});n.push([e,a])}return n}function lu(e){return e.toJSON()}en=[(0,tM.AOx)({defaultOptions:{onCheckboxChange:()=>{},getKeyboardLayoutMap:()=>null}})];var ld=class extends(ea=tM.QR){get name(){return"list"}createTags(){return[tI.eX.Block]}createNodeSpec(e,t){return function(e){let t=(0,tY.LX)(),n=e=>{let t=e.attrs,n=["task","checklist"].includes(t.kind)&&t.guid||void 0;return{...(0,tY.YD)(e),"data-guid":n}},r=(0,tY.EN)().map(t=>{var n;return{...t,getAttrs:(n=t.getAttrs)?t=>{let r=n(t);if(!r||"string"==typeof t)return r;if(Object.assign(r,e.parse(t)),"task"===r.kind&&"task"!==t.getAttribute("data-list-kind")&&(r.kind="checklist"),"string"!=typeof t){let e=t.getAttribute("data-list-kind");if(e&&"object"==typeof r)return{...r,kind:e}}return r}:n}});return{...t,attrs:{...t.attrs,...e.defaults()},toDOM:e=>(0,tY.QI)({node:e,getMarkers:lf,getAttributes:n}),parseDOM:r}}(e)}createKeymap(){var e;let t=(0,nx.A_)((0,tY.ej)({isToggleable:lp,collapsed:!0})),n=(0,nx.A_)((0,tY.ej)({isToggleable:lp,collapsed:!1}));return{Enter:(0,nx.A_)((e=lb(tY.Kb),(t,n,r)=>{try{return e(t,n,r)}catch(n){let e=JSON.stringify({selection:t.selection.toJSON(),doc:iv(lu(t.doc))});throw console.warn(`Command fail. State: ${e}`),n}})),Backspace:(0,nx.A_)(lb(tY.FI)),Delete:(0,nx.A_)(lb(tY.JL)),"Shift-Tab":ls((0,nx.A_)(lb((0,tY.xH)()))),Tab:ls((0,nx.A_)(lb((0,tY.RI)()))),"Alt-Mod-[":t,"Alt-Mod-]":n,"Mod-Enter":lk,"Mod-Shift-Enter":lg,"Alt-ArrowUp":(0,nx.A_)((0,tY.C$)("up")),"Alt-ArrowDown":(0,nx.A_)((0,tY.C$)("down")),"Mod-Shift-7":(0,nx.A_)((0,tY.vP)({kind:"ordered",archived:!1})),"Mod-Shift-8":(0,nx.A_)((0,tY.vP)({kind:"bullet",archived:!1})),"Mod-Shift-9":(0,nx.A_)((0,tY.vP)({kind:"task",archived:!1}))}}createPlugin(){return{props:{handleDOMEvents:{mousedown:(e,t)=>{var n;return(0,tY.pH)({view:e,event:t,onListClick:(n=this.options.onCheckboxChange,e=>{let t=e.attrs;return"task"===t.kind||"checklist"===t.kind?(n?.(),{...t,archived:!1,checked:!t.checked}):"bullet"===t.kind?{...t,archived:!1,collapsed:!!lp(e)&&!t.collapsed}:t})})}}}}}createExternalPlugins(){var e,t;let n,r;let a=(0,nx.A_)((0,tY.ej)({isToggleable:lp,collapsed:!0})),i=(0,nx.A_)((0,tY.ej)({isToggleable:lp,collapsed:!1}));return[(0,tY.pm)(),(0,tY.xf)(),(e={"alt+mod+BracketLeft":a,"alt+mod+BracketRight":i},t=this.options.getKeyboardLayoutMap,new tz.Sy({props:{handleKeyDown:(r=lc(e,n=t?.()||null),(a,i)=>{var l;let o=t?.()||null;for(let[t,s]of((l=n)===o||l&&o&&(0,nD.d)(l)===(0,nD.d)(o)||(r=lc(e,n=o)),r))if(t(i)&&s({view:a,state:a.state,dispatch:a.dispatch.bind(a),tr:a.state.tr}))return i.preventDefault(),!0;return!1})}}))]}createInputRules(){return[(0,tY.T2)(/^\s?([*-])\s$/,{kind:"bullet",collapsed:!1,archived:!1}),(0,tY.T2)(/^\s?(\+)\s$/,{kind:"task",collapsed:!1,archived:!1}),(0,tY.T2)(/^\s?(\d+)\.\s$/,({match:e})=>{let t=(0,tY.Lk)(e[1]);return{kind:"ordered",collapsed:!1,order:null!=t&&t>=2?t:null,archived:!1}}),(0,tY.T2)(/^\s?\[([\sXx]?)]\s$/,({match:e,attributes:t})=>({kind:t?.kind==="task"?"task":"checklist",checked:["x","X"].includes(e[1]),collapsed:!1,archived:!1}))]}createCommands(){return{indentList:e=>{let{from:t,to:n,onSuccess:r}=e??{};return lm((0,nx.A_)((0,tY.RI)({from:t,to:n})),r)},dedentList:e=>{let{from:t,to:n,onSuccess:r}=e??{};return lm((0,nx.A_)((0,tY.xH)({from:t,to:n})),r)},wrapInList:e=>(0,nx.A_)((0,tY.BA)(e)),moveList:e=>(0,nx.A_)((0,tY.C$)(e)),wrapInCheckableList:()=>(0,nx.A_)((0,tY.BA)(e=>{let t=e.parent.maybeChild(e.startIndex);return t?.type.name===tw.WQ&&t?.attrs.kind==="checklist"?{kind:"task",archived:!1,collapsed:!1}:{kind:"checklist",archived:!1,collapsed:!1}}))}}};function lp(e){return!!(0,tY.yD)(e)&&"bullet"===e.attrs.kind&&e.childCount>=2&&!(0,tY.yD)(e.firstChild)}function lm(e,t){return n=>{let r=e(n);return r&&n.dispatch&&t&&t(),r}}function lf(e){let t=e.attrs;switch(t.kind){case"task":case"checklist":return[["label",["input",{type:"checkbox",checked:t.checked?"":void 0}]]];case"bullet":return[["div",{class:"list-bullet-bottom list-marker-click-target"}],["div",{class:"list-spine list-marker-click-target"}]];default:return null}}function lh(e){return({tr:t,dispatch:n})=>{let{$from:r,$to:a}=t.selection,i=(0,tY.gY)(r,a);if(!i)return!1;if(n){let{parent:a,startIndex:l,endIndex:o,depth:s}=i,c=e(a.child(l).attrs);for(let e=l;e<o;e++){let n=r.posAtIndex(e,s);for(let[r,i]of Object.entries(c))a.child(e).attrs[r]!==i&&t.setNodeAttribute(n,r,i)}n?.(t)}return!0}}er=(0,tx.xl)(ea),ld=(0,tx.pL)(er,0,"ReflectListExtension",en,ld),(0,tx.Co)(er,1,ld);var lg=lh(function(e){switch(!0){case"task"===e.kind&&!e.checked:return{kind:"task",checked:!0,collapsed:!1,archived:!1};case"task"===e.kind&&e.checked:return{kind:"bullet",checked:!1,collapsed:!1,archived:!1};default:return{kind:"task",checked:!1,collapsed:!1,archived:!1}}}),lk=lh(function(e){switch(!0){case"checklist"===e.kind&&!e.checked:return{kind:"checklist",checked:!0,collapsed:!1,archived:!1};case"checklist"===e.kind&&e.checked:return{kind:"bullet",checked:!1,collapsed:!1,archived:!1};default:return{kind:"checklist",checked:!1,collapsed:!1,archived:!1}}});function ly(e){let t=e.target?.closest(".list-marker-click-target"),n=t?.closest(".prosemirror-flat-list");if(!t||!n||!["task","checklist"].includes(n.getAttribute("data-list-kind")||""))return null;let r=n.getAttribute("data-guid"),a=t.querySelector('input[type="checkbox"]');return r&&a?{guid:r,checked:a.hasAttribute("checked")}:null}function lb(e){return function(t,n,r){return e(t,n?e=>n(function(e){if(!e.docChanged||!e.selection.empty)return e;let{$from:t}=e.selection,n=t.depth-1;if(n<=0)return e;let r=t.node(n);return r&&r.type.name===tw.WQ&&r.attrs.archived?e.setNodeAttribute(t.before(n),"archived",!1):e}(e)):void 0,r)}}function lw(e){return!!e&&tw.D4.includes(e.type.name)}var lv="(paragraph|tweet|blockquote|codeBlock) block*";function lx({node:e,mark:t,updateDOM:n,updateMark:r}){let a=document.createElement("label");a.contentEditable="false",a.classList.add(n_.MQ.LIST_ITEM_MARKER_CONTAINER),a.append(t);let i=document.createElement("div"),l=document.createElement("li");l.classList.add(n_.MQ.LIST_ITEM_WITH_CUSTOM_MARKER),l.append(a),l.append(i);let o=a=>a.type===e.type&&(n(e=a,l),r(e,t),!0);return o(e),{dom:l,contentDOM:i,update:o}}var lE=class extends(el=nA.UQ,ei=[(0,tM.WDe)()],el){constructor(){super(...arguments),(0,tx.Co)(eo,5,this)}createNodeSpec(e,t){return{...super.createNodeSpec(e,t),parseDOM:[]}}createInputRules(){return[]}wrapInBulletList(){return e=>{let{state:t,dispatch:n}=e;if(!(0,tB.hT)(t.selection))return!1;if(!n)return!0;let r=this.store.chain;return aw(t.selection)?r.wrapSelectedItemsToBulletList():r.toggleBulletList(),r.focus(),r.run(),!0}}createExtensions(){return[]}};eo=(0,tx.xl)(el),(0,tx.pL)(eo,1,"wrapInBulletList",ei,lE),(0,tx.ZU)(eo,lE);var lC=class extends(ec=nA._3,es=[(0,tM.WDe)()],ec){constructor(){super(...arguments),(0,tx.Co)(eu,5,this)}createNodeSpec(e,t){return{...super.createNodeSpec(e,t),parseDOM:[]}}createInputRules(){return[]}wrapInOrderedList(){return e=>{let{state:t,dispatch:n}=e;if(!(0,tB.hT)(t.selection))return!1;if(!n)return!0;let r=this.store.chain;return aw(t.selection)?r.wrapSelectedItemsToOrderedList():r.toggleOrderedList(),r.focus(),r.run(),!0}}createExtensions(){return[]}};eu=(0,tx.xl)(ec),(0,tx.pL)(eu,1,"wrapInOrderedList",es,lC),(0,tx.ZU)(eu,lC);var lL=class extends(ek=nA.Jb,eg=[(0,tM.WDe)()],eh=[(0,tM.WDe)()],ef=[(0,tM.WDe)()],em=[(0,tM.WDe)()],ep=[(0,tM.WDe)()],ed=[(0,tM.WDe)()],ek){constructor(){super(...arguments),(0,tx.Co)(ey,5,this)}createKeymap(){return{}}createNodeSpec(e,t){return{...super.createNodeSpec(e,t),content:lv,toDOM:t=>["li",{...e.dom(t),class:"remirror-list-item-with-custom-mark"},["span",{class:"remirror-list-item-marker-container"},["div",{class:"remirror-collapsible-list-item-button"}]],["div",0]]}}createNodeViews(){return this.options.enableCollapsible?(e,t,n)=>{let r=document.createElement("div");return r.classList.add(n_.MQ.COLLAPSIBLE_LIST_ITEM_BUTTON),r.contentEditable="false",r.addEventListener("click",()=>{if(r.classList.contains("disabled"))return;let e=n(),a=t.state.doc.nodeAt(e);if(a){let n=!a.attrs.closed,r=t.state.tr;t.dispatch(r.setNodeMarkup(e,void 0,{...a.attrs,closed:n})),n&&this.store.commands.moveCursorOutOfCollapsedContent()}}),r.addEventListener("pointerdown",e=>{e.preventDefault()}),lx({mark:r,node:e,updateDOM:lS,updateMark:lN})}:{}}createExtensions(){return[]}safeSinkListItem({listItemStartPos:e,afterAction:t}){let n=(0,nx.A_)(function(t,n){let r=t.doc.resolve(e),a=r.blockRange(r,e=>e.childCount>=1&&lw(e.firstChild));if(!a)return!1;let i=a.startIndex;if(0==i)return!1;let l=a.parent,o=l.child(i-1);if(!lw(o))return!1;let s=o.type;if(n){let e=o.lastChild&&o.lastChild.type==l.type,r=tU.HY.from(e?s.create():void 0),i=new tU.p2(tU.HY.from(s.create(null,tU.HY.from(l.type.create(null,r)))),e?3:1,0),c=a.start,u=a.end;n(t.tr.step(new nb.FC(c-(e?3:1),u,c,u,i,1,!0)))}return!0});return e=>{let r=n(e);return r&&e.dispatch&&t?.(),r}}safeLiftListItem({listItemStartPos:e,afterAction:t}){let n=(0,nx.A_)(function(t,n){let r=t.doc.resolve(e),a=r.blockRange(r,e=>ab(e)&&ay(e.firstChild));if(!a)return!1;if(!n)return!0;let i=r.node(a.depth-1);if(!lw(i))return!1;{let e=i.type;return a.parent.firstChild?.type===e&&function(e,t,n,r){let a=e.tr,i=r.end,l=r.$to.end(r.depth);i<l&&(a.step(new nb.FC(i-1,l,i,l,new tU.p2(tU.HY.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new tU.Ts(a.doc.resolve(r.$from.pos),a.doc.resolve(l),r.depth));let o=(0,nb.k9)(r);return null!=o&&(t(a.lift(r,o)),!0)}(t,n,e,a)}});return e=>{let r=n(e);return r&&e.dispatch&&t?.(),r}}wrapSelectedItemsToBulletList(){return({tr:e,state:{schema:t},dispatch:n})=>((0,nA.g5)({listType:t.nodes[tw.oL],itemType:t.nodes[tw.l1],tr:e}),n?.(e),!0)}wrapSelectedItemsToOrderedList(){return({tr:e,state:{schema:t},dispatch:n})=>((0,nA.g5)({listType:t.nodes[tw.IH],itemType:t.nodes[tw.l1],tr:e}),n?.(e),!0)}wrapSelectedItemsToTaskList(){return({tr:e,state:{schema:t},dispatch:n})=>((0,nA.g5)({listType:t.nodes[tw.xy],itemType:t.nodes[tw.RF],tr:e}),n?.(e),!0)}moveCursorOutOfCollapsedContent(){return({tr:e,dispatch:t})=>{try{if(function(e){let t=e.selection.empty?[e.selection.$from]:[e.selection.$from,e.selection.$to],n=-1;for(let e of t)for(let t=e.depth;t>=1;t--){let r=e.node(t);if(r.type.name===tw.l1&&r.attrs.closed){let a=e.start(t)+1+(r.firstChild?.content.size||0);e.pos>a&&(n=a)}}return -1!==n&&(e.setSelection(tz.Bs.near(e.doc.resolve(n),-1)),!0)}(e))return t?.(e),!0;return!1}catch(e){return console.warn("failed to call command moveCursorOutOfCollapsedContent:",e),!1}}}};function lS(e,t){e.attrs.closed?t.classList.add(n_.MQ.COLLAPSIBLE_LIST_ITEM_CLOSED):t.classList.remove(n_.MQ.COLLAPSIBLE_LIST_ITEM_CLOSED)}function lN(e,t){e.childCount<=1?t.classList.add("disabled"):t.classList.remove("disabled")}ey=(0,tx.xl)(ek),(0,tx.pL)(ey,1,"safeSinkListItem",eg,lL),(0,tx.pL)(ey,1,"safeLiftListItem",eh,lL),(0,tx.pL)(ey,1,"wrapSelectedItemsToBulletList",ef,lL),(0,tx.pL)(ey,1,"wrapSelectedItemsToOrderedList",em,lL),(0,tx.pL)(ey,1,"wrapSelectedItemsToTaskList",ep,lL),(0,tx.pL)(ey,1,"moveCursorOutOfCollapsedContent",ed,lL),(0,tx.ZU)(ey,lL);var lT=class extends nA.Mc{get priority(){return tI.xV.High}createKeymap(){let e=super.createKeymap();return{...e,Tab:t=>e?.Tab?.(t)??!1,"Shift-Tab":({tr:e,dispatch:t})=>{if((0,nA.QY)(e))return t?.(e.scrollIntoView()),!0;{let t=function(e){let{$from:t,$to:n}=e;return t.blockRange(n,ab)}(e.selection),n=t?.parent.firstChild?.type;if(n&&tw.D4.includes(n.name))return this.store.commands.liftListItemOutOfList(n),!0}return!1}}}};function lM(e,t){let n,r,a,i;let l=t||e.selection.$from,o=[];for(let e=l.depth;e>=0;e--){if(r=l.node(e),n=l.index(e),a=r.maybeChild(n-1),i=r.maybeChild(n),a&&i&&a.type.name===i.type.name&&ab(a)){let t=l.before(e+1);o.push(t)}if(n=l.indexAfter(e),a=r.maybeChild(n-1),i=r.maybeChild(n),a&&i&&a.type.name===i.type.name&&ab(a)){let t=l.after(e+1);o.push(t)}}o=[...new Set(o)].sort((e,t)=>t-e);let s=!1;for(let t of o)(0,nb.Mn)(e.doc,t)&&(e.join(t),s=!0);return s}var lI=class extends nA.JQ{createExtensions(){return[]}createNodeSpec(e,t){return{...super.createNodeSpec(e,t),parseDOM:[]}}};eE=[(0,tM.AOx)({defaultOptions:{onCheckboxChange:()=>{}}})];var lD=class extends(ex=nA.nc,ev=[(0,tM.WDe)()],ew=[(0,tM.WDe)()],eb=[(0,tM.WDe)()],ex){constructor(){super(...arguments),(0,tx.Co)(eC,5,this)}createNodeSpec(e,t){return{...super.createNodeSpec(e,t),parseDOM:[],toDOM:e=>["li",{class:"remirror-list-item-with-custom-mark","data-task-list-item":"","data-checked":e.attrs.checked?"":void 0,"data-task-guid":"string"==typeof e.attrs.guid?e.attrs.guid:void 0},["span",{class:"remirror-list-item-marker-container"},["input",{type:"checkbox",class:"remirror-list-item-checkbox",checked:e.attrs.checked?"":void 0}]],["div",0]],content:lv}}createInputRules(){return[]}createExtensions(){return[]}createNodeViews(){return(e,t,n)=>{let r;let a=document.createElement("input");a.type="checkbox",a.classList.add(n_.MQ.LIST_ITEM_CHECKBOX),a.contentEditable="false";let i=(r=n(),()=>{let e=n();return e||0===e?r=e:console.warn(`getPos() returned ${e}, using cached value`),r});return a.addEventListener("click",e=>{if(i(),t.editable){let e=this.options;e?.onCheckboxChange?.()}else e.preventDefault()}),a.addEventListener("change",()=>{let e=i(),n=t.state.doc.resolve(e+1);this.store.commands.toggleCheckboxChecked({$pos:n})}),a.addEventListener("pointerdown",e=>{i(),e.preventDefault()}),lx({node:e,mark:a,updateDOM:lA,updateMark:l_})}}createKeymap(){return{Enter:function(e,t=["checked"]){return function({tr:n,dispatch:r,state:a}){let i=(0,tB.jo)(e,a.schema),{$from:l,$to:o}=n.selection;if((0,tB.EG)(n.selection)&&n.selection.node.isBlock||l.depth<2||!l.sameParent(o))return!1;let s=l.node(-1);if(s.type!==i)return!1;if(0===l.parent.content.size&&l.node(-1).childCount===l.indexAfter(-1)){if(2===l.depth||l.node(-3).type!==i||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let e=l.index(-1)>0,t=tU.HY.empty;for(let n=l.depth-(e?1:2);n>=l.depth-3;n--)t=tU.HY.from(l.node(n).copy(t));let a=i.contentMatch.defaultType?.createAndFill()||void 0;t=t.append(tU.HY.from(i.createAndFill(null,a)||void 0));let o=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3;n.replace(l.before(e?void 0:-1),l.after(-o),new tU.p2(t,e?3:2,2)),n.setSelection(n.selection.constructor.near(n.doc.resolve(l.pos+(e?3:2)))),r(n.scrollIntoView())}return!0}if(s.attrs.closed&&l.sameParent(o)&&o.pos===o.end()){if(r){let e=l.after(-1),t=i.contentMatch.defaultType?.createAndFill()||void 0,a=i.createAndFill(null,t);a&&(n.insert(e,a),n.setSelection(tz.Bs.create(n.doc,e+1))),n.delete(l.pos,o.pos),r(n.scrollIntoView())}return!0}let c=Object.fromEntries(Object.entries(s.attrs).filter(([e])=>!t.includes(e))),u=o.pos===l.end()?s.contentMatchAt(0).defaultType:null,d={...l.node().attrs};return n.delete(l.pos,o.pos),!!(0,nb.Ax)(n.doc,l.pos,2)&&(r&&r(n.split(l.pos,2,u?[{type:i,attrs:c},{type:u,attrs:d}]:[{type:i,attrs:c}]).scrollIntoView()),!0)}}(this.type,["checked","guid"])}}checkAllUncheckedCheckboxs(){return({tr:e,dispatch:t})=>{let{$from:n,$to:r,to:a}=e.selection,i=n.sharedDepth(a),l=-1;for(let e=i;e>=0;e--)if(n.node(e).type.name===tw.xy){l=e;break}if(-1===l)return!1;let o=n.index(l),s=r.index(l),c=[];for(let t=o;t<=s;t++){let r=n.posAtIndex(t,l),a=e.doc.nodeAt(r);a&&c.push({pos:r,node:a})}if(0===c.length)return!1;let u=!1;for(let t of c)t.node.attrs.checked||(e.setNodeMarkup(t.pos,void 0,{checked:!0}),u=!0);return!!u&&(t?.(e),!0)}}wrapInTaskList(){return e=>{let{state:t,dispatch:n}=e;if(!(0,tB.hT)(t.selection))return!1;if(!n)return!0;let r=this.store.chain;return aw(t.selection)?r.wrapSelectedItemsToTaskList():r.toggleTaskList(),r.focus(),r.run(),!0}}liftTaskListItemOutOfList(){var e;return e=this.type,t=>{let{dispatch:n,tr:r}=t,a=(0,nx.Ux)(r,t.state),i=function(e,t){let{$from:n,$to:r}=t;return n.blockRange(r,t=>t.firstChild?.type===e)}(e,r.selection);return!!i&&(!n||(function(e,t,n){let r=e.tr,a=n.parent,i=r.mapping.maps.length;for(let e=n.end,t=n.endIndex-1,i=n.startIndex;t>i;t--)e-=a.child(t).nodeSize,r.delete(e-1,e+1);let l=r.doc.resolve(n.start),o=l.nodeAfter;if(!o||r.mapping.slice(i).map(n.end)!==n.start+o.nodeSize)return;let s=0===n.startIndex,c=n.endIndex===a.childCount,u=l.node(-1),d=l.index(-1);if(!u.canReplace(d+(s?0:1),d+1,o.content.append(c?tU.HY.empty:tU.HY.from(a))))return;let p=l.pos,m=p+o.nodeSize;r.step(new nb.FC(p-(s?1:0),m+(c?1:0),p+1,m-1,new tU.p2((s?tU.HY.empty:tU.HY.from(a.copy(tU.HY.empty))).append(c?tU.HY.empty:tU.HY.from(a.copy(tU.HY.empty))),s?0:1,c?0:1),s?0:1)),t(r.scrollIntoView())}(a,n,i),!0))}}};function lA(e,t){e.attrs.checked?t.setAttribute("data-checked",""):t.removeAttribute("data-checked"),t.setAttribute("data-task-list-item",""),t.setAttribute("data-task-guid","string"==typeof e.attrs.guid?e.attrs.guid:"")}function l_(e,t){t.checked=!!e.attrs.checked}function lR(e){let t=e.type.schema.cached,n=t.excludeSuggestMarkCache||(t.excludeSuggestMarkCache={});return n[e.type.name]??(n[e.type.name]=(e.type.spec.group||"").split(" ").includes(tI.eX.ExcludeInputRules))}eC=(0,tx.xl)(ex),(0,tx.pL)(eC,1,"checkAllUncheckedCheckboxs",ev,lD),(0,tx.pL)(eC,1,"wrapInTaskList",ew,lD),(0,tx.pL)(eC,1,"liftTaskListItemOutOfList",eb,lD),lD=(0,tx.pL)(eC,0,"ReflectTaskListItemExtension",eE,lD),(0,tx.Co)(eC,1,lD);var lH="__prosemirror_suggest_ignore_key__",lj=class extends(eS=tM.nNj,eL=[(0,tM.WDe)()],eS){constructor(){super(...arguments),(0,tx.Co)(eN,5,this)}get name(){return"reflectMatchRules"}createExternalPlugins(){let e=[];for(let t of this.store.extensions)t.createMatchRules&&e.push(...t.createMatchRules());return e.length>0?[function({rules:e}){let t=null,n=-1;return new tz.Sy({state:{init:()=>null,apply:e=>(t&&e.getMeta(lH)&&(n=t.from),null)},view:()=>({update:r=>{let a=function(e,t){let{$from:n}=e.selection;if(n.parent.type.spec.code||n.marks().some(lR))return null;let r=Math.max(0,n.parentOffset-500),a=n.parent.textBetween(r,n.parentOffset,null,"￼");if(!a)return null;for(let i of t){i.match.lastIndex=0;let t=i.match.exec(a);if(!t)continue;let l=t[0];if(l.includes("￼"))continue;let o=n.start()+r+t.index,s=o+l.length;if(!function(e,t,n){let r=!1;return e.nodesBetween(t,n,e=>{e.marks.some(lR)&&(r=!0)}),r}(e.doc,o,s)&&i.onMatch({match:t,start:o,end:s}))return{from:o,to:s,match:t,rule:i}}return null}(r.state,e);a||(n=-1),t&&t.rule!==a?.rule&&(t.rule.onDismiss(),t=null),a&&-1!==n&&a.from===n&&a.rule.onDismiss(),t=a}})})}({rules:e})]:[]}ignoreMatchRulePosition(){return({tr:e,dispatch:t})=>(t?.(e.setMeta(lH,!0)),!0)}};eN=(0,tx.xl)(eS),(0,tx.pL)(eN,1,"ignoreMatchRulePosition",eL,lj),(0,tx.ZU)(eN,lj),eT=[(0,tM.AOx)({defaultOptions:{getNodeViews:()=>({})},staticKeys:[],handlerKeys:[],customHandlerKeys:[]})];var lO=class extends(eI=tM.nNj){name="reflectNodeViews";createPlugin(){return{props:{nodeViews:this.options.getNodeViews()}}}};eM=(0,tx.xl)(eI),lO=(0,tx.pL)(eM,0,"NodeViewExtension",eT,lO),(0,tx.Co)(eM,1,lO);var l$=class extends tM.nNj{get name(){return"reflectOfflineStatus"}createExternalPlugins(){return[new tz.Sy({key:lB,state:{init:()=>!1,apply:(e,t)=>{let n=e.getMeta("REFLECT_OFFLINE_STATUS");return!0===n||!1===n?n:t}},props:{decorations:e=>{let t=e.doc.firstChild;if(!lB.getState(e)||!t||t.type.name!==tw.tw)return ng.EH.empty;let n=ng.p.widget(t.nodeSize-1,lz);return ng.EH.create(e.doc,[n])}}})]}},lB=new tz.H$("offlineStatus");function lz(){let e=document.createElement("span");return e.setAttribute("data-offline-status-indicator",""),e.className='relative bottom-1 left-2 cursor-help select-none rounded-md border border-gray-300 dark:border-near-white px-1 align-text-bottom text-xs font-normal leading-normal text-gray-400 dark:text-near-white tracking-wide transition-opacity after:content-["Offline"] inline-block',e}var lP=class extends tM.nNj{get name(){return"reflectPatchTransaction"}createPlugin(){return{appendTransaction:(e,t,n)=>{let r=n.tr;return!function(e){let t=e.selection;if((0,tB.hT)(t)){let{$anchor:n,$head:r,anchor:a,head:i}=t,l=a===i?tz.Bs.near(n):tz.Bs.between(n,r);if(l.anchor!==a||l.head!==i)return console.warn(`Found a unexpected TextSelection with invalid positions. Fixing it. Old selection: ${a} ${i}, Fixed selection: ${l.anchor} ${l.head}`),e.setSelection(l),!0}return!1}(r)?null:r}}}},lW=class extends(eR=tM.nNj,e_=[(0,tM._y)()],eA=[(0,tM.WDe)()],eD=[(0,tM.WDe)()],eR){constructor(){super(...arguments),(0,tx.Co)(eH,5,this),(0,tx.ov)(this,"searching",!1),(0,tx.ov)(this,"searchTerm",""),(0,tx.ov)(this,"searchNodeGuid",""),(0,tx.ov)(this,"results",[]),(0,tx.ov)(this,"activeIndex",null)}get name(){return"reflectSearch"}createPlugin(){return{state:{init:()=>ng.EH.empty,apply:(e,t)=>{if(this.searching){let{textRanges:t,collapsedRanges:n}=function(e,t){for(let n of(0,tv._)(t)){let t=function(e,t){let n=[],r=[],a=[];return e.descendants((e,i,l,o)=>{if(l&&(0,tY.Sz)(l)&&o>=1&&a.push({from:i,to:i+e.nodeSize}),e.isLeaf&&e.isBlock)return lZ(e,t)&&n.push({from:i,to:i+e.nodeSize,blockLeafNode:!0}),!1;if(!e.isTextblock)return!0;let s=i+1,c="",u=!1,d=()=>{if(!c)return;let e=(0,tv.l9)(c);for(let r of(e.length===c.length&&(c=e),nR(c,t))){let e=s+(r.index??0),t=e+r[0].length;n.push({from:e,to:t}),u=!0}s+=c.length,c=""};if(e.nodesBetween(0,e.content.size,r=>{r.isText?c+=r.text:(d(),lZ(e,t)&&(n.push({from:s,to:s+r.nodeSize,inlineLeafNode:!0}),u=!0),s+=r.nodeSize)}),d(),u){for(let e of a)e.from<=i&&i<=e.to&&r.push(e);a=[]}return!1}),{textRanges:n,collapsedRanges:r}}(e,n);if(t.textRanges.length>0)return t}return{textRanges:[],collapsedRanges:[]}}(e.doc,this.searchTerm),{nodeRanges:r,collapsedRanges:a}=function(e,t){let n=[],r=[],a=[];return t&&e.descendants((e,i,l,o)=>{if(l&&(0,tY.Sz)(l)&&o>=1&&a.push({from:i,to:i+e.nodeSize}),n.length>0)return!1;if(e.attrs.guid===t){for(let t of(n.push({from:i,to:i+e.nodeSize}),a))t.from<=i&&i<=t.to&&r.push(t);a=[]}if(e.isTextblock)return!1}),{nodeRanges:n,collapsedRanges:r}}(e.doc,this.searchNodeGuid);this.results=t,this.normalizeActiveIndex();let i=this.results.map((e,t)=>{if(e.inlineLeafNode){let n={searchTerm:this.searchTerm,active:t===this.activeIndex};return ng.p.inline(e.from,e.to,{},n)}if(!e.blockLeafNode)return ng.p.inline(e.from,e.to,{class:t===this.activeIndex?tv.wA:tv.Dy});{let n={searchTerm:this.searchTerm,active:t===this.activeIndex};return ng.p.node(e.from,e.to,{},n)}}),l=[...n,...a].map(e=>ng.p.node(e.from,e.to,{class:tv.Ui})),o=r.map(e=>ng.p.node(e.from,e.to,{class:tv.op}));return setTimeout(()=>this.scrollToActiveResult(),50),ng.EH.create(e.doc,[...i,...l,...o])}return e.docChanged?t.map(e.mapping,e.doc):t}},props:{decorations:e=>this.getPluginState(e)}}}search(e){return this.store.commands.startSearch(e),{matches:this.results.length,activeIndex:this.activeIndex??null}}startSearch({searchTerm:e,searchNodeGuid:t,activeIndex:n}){return e||t?({tr:r,dispatch:a})=>(this.searchTerm=e,this.searchNodeGuid=t??"",this.activeIndex=n??null,this.updateView(r,a)):this.stopSearch()}stopSearch(){return({tr:e,dispatch:t})=>(this.searchTerm="",this.searchNodeGuid="",this.activeIndex=null,this.updateView(e,t))}updateView(e,t){return this.searching=!0,t&&t(e),this.searching=!1,!0}normalizeActiveIndex(){var e,t;null!=this.activeIndex&&(this.activeIndex=(e=this.activeIndex,(t=this.results.length)<=0?0:(e%t+t)%t))}scrollToActiveResult(){if(null==this.activeIndex)return;let e=this.results[this.activeIndex];if(!e)return;let t=this.store.view,n=t.state.doc.content.size,r=e.from;if(r>n)return;let a=t.domAtPos(r).node;a?.scrollIntoView?.({block:"nearest",behavior:"smooth"})}};function lZ(e,t){t.lastIndex=0;let n=t.test((0,tv.l9)(e.textContent));return t.lastIndex=0,n}eH=(0,tx.xl)(eR),(0,tx.pL)(eH,1,"search",e_,lW),(0,tx.pL)(eH,1,"startSearch",eA,lW),(0,tx.pL)(eH,1,"stopSearch",eD,lW),(0,tx.ZU)(eH,lW),ej=[(0,tM.AOx)({defaultOptions:{},handlerKeys:["onSlashChange"]})];var lV=class extends(e$=tM.nNj){get name(){return"slash"}createSuggesters(){return[{startOfLine:!1,char:"/",name:"slash",appendTransaction:!1,onChange:e=>{this.options.onSlashChange(e)},invalidMarks:["code"],supportedCharacters:/[^#*/=@[\\\]`|~]+/,emptySelectionsOnly:!0,invalidNodes:["codeBlock","codeMirror","codeMirror5","codeMirror6"]}]}};eO=(0,tx.xl)(e$),lV=(0,tx.pL)(eO,0,"SlashExtension",ej,lV),(0,tx.Co)(eO,1,lV);var lF=class extends nH.V{createPasteRules(){return super.createPasteRules().map(e=>({...e,ignoredMarks:["link"]}))}createInputRules(){return[rq({regexp:/~~([^~]+)~~\s$/,type:this.type,ignoreWhitespace:!0}),rq({regexp:/~([^~]+)~\s$/,type:this.type,ignoreWhitespace:!0})]}};eB=[(0,tM.AOx)({defaultOptions:{},handlerKeys:["onSubjectChange"]})];var lK=class extends(eP=tM.nNj){lastActive=!1;lastValue;lastPosition;get name(){return"subjectMerge"}onApplyState(e){let{tr:t}=e,n=t.selection.$from,r=n.node(),a=r.textContent,i="heading"==r.type.name&&1==r.attrs.level,l=n.parentOffset===r.content.size,o=0===n.index(0),s=1===n.depth&&i&&l&&o;(s!==this.lastActive||a!==this.lastValue||n.pos!==this.lastPosition)&&(this.lastActive=s,this.lastValue=a,this.lastPosition=n.pos,this.options.onSubjectChange(n.pos,s,s?a:void 0))}};ez=(0,tx.xl)(eP),lK=(0,tx.pL)(ez,0,"SubjectMergeExtension",eB,lK),(0,tx.Co)(ez,1,lK),eV=[(0,tM.AOx)({defaultOptions:{selectable:!0,draggable:!1,mentionTag:"a",appendText:" ",disableDecorations:!1,graphId:"",onClick:null},handlerKeys:["onTagMatchV2","onTagDismissV2"],staticKeys:["selectable","draggable","mentionTag","graphId"]})];var lq=class extends(eZ=tM.QR,eW=[(0,tM.WDe)()],eZ){constructor(){super(...arguments),(0,tx.Co)(eF,5,this)}get name(){return"tag"}createPlugin(){return{props:{handleDOMEvents:{keydown:({state:e},t)=>"Enter"===t.key&&this.handleEnterKeyPress(t,e)}}}}createTags(){return[tI.eX.InlineNode,tI.eX.Behavior]}createNodeSpec(e,t){let n="data-tag";return{inline:!0,selectable:this.options.selectable,draggable:this.options.draggable,atom:!0,...t,attrs:{...e.defaults(),id:{},label:{},graphId:{default:this.options.graphId}},parseDOM:[{tag:"span[data-tag]",getAttrs:t=>{if(!(0,tB.jd)(t))return!1;let n=t.getAttribute("data-id"),r=t.getAttribute("data-label"),a=t.getAttribute("data-graph-id")||this.options.graphId;return!!n&&{...e.parse(t),id:n,label:r,graphId:a}}},{tag:`${this.options.mentionTag}[${n}]`,getAttrs:t=>{if(!(0,tB.jd)(t))return!1;let r=t.getAttribute(n),a=t.textContent?.replace(/#/g,"");return{...e.parse(t),id:r,label:a}}},{tag:`${this.options.mentionTag}[href^="https://reflect.app/g/"][href*="/tag/"]`,priority:tI.xV.Highest,getAttrs:t=>{if(!(0,tB.jd)(t))return!1;let{graphId:n,id:r}=function(e){if(!e)return{};let t=e.match(aE);if(t){let[e,n,r]=t;return{graphId:n,id:r}}return{}}(t.getAttribute("href"));if(!r)return!1;let a=t.textContent?.replace(/#/g,"");return{...e.parse(t),graphId:n,id:r,label:a}}}],toDOM:t=>{let{label:n,graphId:r,id:a}=(0,tB.Kh)(t.attrs,e),i=this.options.graphId,l={...e.dom(t),href:aC({graphId:r||i,id:a}),"data-editor-tag":n};return[this.options.mentionTag,l,`#${n}`]},leafText:e=>aL(e.attrs)}}createNodeViews(){return(e,t,n,r)=>{let a=e.attrs,i=document.createElement(this.options.mentionTag);i.setAttribute("href",this.buildHref(e)),i.setAttribute("data-editor-tag",a.label),i.setAttribute("tabindex","-1"),i.textContent="#"+a.label,rA(i,r);let l=this.options.onClick,o=null;return i.addEventListener("pointerdown",e=>{o={x:e.clientX,y:e.clientY},e.preventDefault()}),i.addEventListener("pointerup",e=>{o&&Math.abs(e.clientX-o.x)+Math.abs(e.clientY-o.y)<30&&l?.(e,a),o=null}),i.addEventListener("click",e=>{e.preventDefault()}),{dom:i,update:()=>!1}}}buildHref(e){let{graphId:t,id:n}=e.attrs,r=this.options.graphId;return aC({graphId:t??r,id:n})}createTag(e,t){let{name:n,range:r}=e;return(0,tB.lp)({type:this.type,appendText:this.options.appendText,attrs:{name:n,...t,graphId:this.options.graphId},range:{from:r.from,to:r.cursor}})}handleEnterKeyPress(e,t){if(!e.metaKey&&!e.ctrlKey)return!1;let n=t.selection.node;if(n?.type.name===this.name){e.preventDefault();let t=n.attrs;return this.options.onClick?.(e,t),!0}return!1}createMatchRules(){return[{match:/#(([\p{L}\d#][\p{L}\d_-]*)?)$/u,onMatch:e=>!e.match[0].startsWith("##")&&this.options.onTagMatchV2(e),onDismiss:()=>{this.options.onTagDismissV2()}}]}};eF=(0,tx.xl)(eZ),(0,tx.pL)(eF,1,"createTag",eW,lq),lq=(0,tx.pL)(eF,0,"TagExtension",eV,lq),(0,tx.Co)(eF,1,lq);var lY=class extends(eq=tM.nNj,eK=[(0,tM.WDe)()],eq){constructor(){super(...arguments),(0,tx.Co)(eY,5,this)}get name(){return"reflectTemplate"}insertContentTemplate(e){return({dispatch:t,tr:n,state:r})=>{let a=(0,nd.Z)(e.document);!function e(t){if(t){if(Array.isArray(t))t.forEach(e);else if("object"==typeof t){for(let n of Object.keys(t))"guid"===n?delete t[n]:e(t[n]);"list"===t.type&&t.attrs&&"object"==typeof t.attrs&&(t.attrs.archived=!1)}}}(a=iH(a,i_,"contentTemplate")||a);let i=tU.HY.fromJSON(r.schema,a.content),l=tU.p2.maxOpen(function(e){for(;1===e.childCount&&(0,tY.yD)(e.child(0))&&(0,tY.yD)(e.child(0).firstChild);)e=e.child(0).content;return e}(i));return n.setSelection(tz.Bs.near(n.selection.$from)),n.replaceSelection(l),t?.(n),!0}}};eY=(0,tx.xl)(eq),(0,tx.pL)(eY,1,"insertContentTemplate",eK,lY),(0,tx.ZU)(eY,lY);var lU=class extends nj.x{createKeymap(){return{"Mod-Shift-h":e=>(this.toggleHighlight(e.state.selection),!0)}}createMarkSpec(e,t){return{...super.createMarkSpec(e,t),parseDOM:[{tag:"mark",mark:this.name}]}}createInputRules(){return[rq({regexp:/={2}([^=]+)={2}\s$/,type:this.type,ignoreWhitespace:!0}),rq({regexp:/\^{2}([^^]+)\^{2}\s$/,type:this.type,ignoreWhitespace:!0})]}toggleHighlight(e){return this.store.commands.toggleMark({type:this.type,selection:e})}};eU=[(0,tM.AOx)({defaultOptions:{filterTransaction:()=>!0}})];var lQ=class extends(eX=tM.nNj){name="transactionFilter";createPlugin(){return{filterTransaction:(e,t)=>this.options.filterTransaction(e,t)}}};function lX({listening:e,speaking:t}){return nO.ZP.createElement("span",{className:"relative inline-flex cursor-default select-none",contentEditable:!1},nO.ZP.createElement("span",null,nO.ZP.createElement("br",null)),nO.ZP.createElement("span",{className:(0,tC.default)("absolute top-[1lh] left-[-12px] inline-flex h-[24px] w-[24px] items-center justify-center rounded-full",t?"bg-purple-600":"bg-gray-400",e?"p-[5px]":"p-[4px]")},nO.ZP.createElement("span",{className:(0,tC.default)("h-full w-full text-white",e?"i-ri-mic-line":"i-line-md-loading-loop")})))}eQ=(0,tx.xl)(eX),lQ=(0,tx.pL)(eQ,0,"TransactionFilterExtension",eU,lQ),(0,tx.Co)(eQ,1,lQ);var lJ=new tz.H$("transcription-indicator");function lG(e,t){return e.setMeta(lJ,t)}var l0=new tz.H$("transcription-text"),l1=class extends tM.nNj{name="transcription";createExternalPlugins(){return[new tz.Sy({key:lJ,state:{init:()=>null,apply(e,t){let n=e.getMeta(lJ);return null==n?t:!1===n?null:{speaking:!1,listening:!1,...t,...n}}},props:{decorations:e=>{let t=lJ.getState(e);if(null==t)return null;let n=e.selection;if(!(0,tB.hT)(n))return null;let r=n.$to.pos,a=ng.p.widget(r,()=>nO.ZP.createElement(lX,{...t}),{key:`${!!t.listening}${!!t.speaking}`,side:25,ignoreSelection:!0});return ng.EH.create(e.doc,[a])}}}),new tz.Sy({key:l0,state:{init:()=>null,apply(e,t){let n=e.getMeta(l0);if(!1===n)return null;if(n)return n;if(t){let{from:n,to:r}=t,a=n===r;return n=e.mapping.map(t.from,1),r=e.mapping.map(t.to,-1),(a?n>r:n>=r)&&(n=r=e.selection.to),{from:n,to:r}}return null}},props:{decorations:e=>{let t=l0.getState(e);if(!t)return null;let{from:n,to:r}=t,a=ng.p.inline(n,r,{"data-interim-text":""});return ng.EH.create(e.doc,[a])}}})]}createCommands(){return{updateTranscriptionState:e=>(0,nx.A_)((t,n)=>{if(!n)return!0;let r=t.tr;switch(e.type){case"starting":case"stopping":r=lG(r,{listening:!1});break;case"started":r=lG(r,{listening:!0});break;case"stopped":r=lG(r,!1);break;case"speech":r=lG(r,{speaking:!0});break;case"silence":r=lG(r,{speaking:!1});break;case"text":r=function(e,t,n){let r;if(0===t.length)return e.tr;let a=l0.getState(e),i=!0;if(a){let t=e.selection.to;i=t>=a.from&&t<=a.to}let l=a?tz.Bs.between(rT(e.doc,a.from),rT(e.doc,a.to)):rM(e.selection.$to),o=e.tr;if(i)r={from:l.from,to:l.from+t.length},o.insertText(t,l.from,l.to);else{o.deleteRange(l.from,l.to);let e=rM(o.selection.$to).to;o.insertText(t,e),r={from:e,to:e+t.length}}o.setSelection(rM(rT(o.doc,r.to)));let s=!!n&&r;return o.setMeta(l0,s),o}(t,e.text,e.interim)}return n(r),!0})}}};function l5(e){throw Error("Didn't expect to get here")}function l2(e,t,n,r){try{let a=n?function e(t){if((0,tB.PH)(t))return tU.HY.from(t);if((0,tB.mt)(t))return t;if((0,n$.Z)(t))return t.reduce((t,n)=>t.append(e(n)),tU.HY.empty);throw Error(`unknown content type: ${t}`)}(n):null;return e.createAndFill(t,a,r)||e.createChecked(t,a,r)}catch(e){if(e instanceof RangeError)throw RangeError(`${e.message} (content: ${n?.toString()})`);throw e}}function l7(e,t){!function(e,t){l3(e).map(t)}(e,e=>{if(!t.includes(e.type.name))throw Error(`expected node type ${t} but got ${e.type.name}`)})}function l3(e){return(0,tB.PH)(e)?[e]:(0,tB.mt)(e)?aN(e):(0,n$.Z)(e)?e.flatMap(l3):void l5(e)}function l4(e){let t=(t,n)=>e.text(t,n),n=()=>e.nodes.hardBreak.create(),r=(n="")=>l2(e.nodes.heading,{level:1},n?[t(n)]:[]),a=(e="")=>i(e?[t(e)]:[]),i=t=>l2(e.nodes.paragraph,null,t),l=t=>l2(e.nodes.backlink,t),o=t=>{let n={kind:"bullet",guid:rm(),archived:!1};return l2(e.nodes.list,n,t)},s=e=>(l7(e,["listItem","list"]),e),c=()=>s(o(a(""))),u=e=>o([a(e),c()]),d=e=>o([i(l(e)),c()]);return{doc:t=>l2(e.nodes.doc,{},t),docWithSubject:(t="")=>l2(e.nodes.doc,{},[r(t),a()]),text:t,header:r,paragraphText:a,paragraphTextWithHardBreaks:(e="")=>{let r=e.split("\n").filter(e=>e.length>0);return i(r.reduce((e,a,i)=>(e.push(t(a)),i<r.length-1&&e.push(n()),e),[]))},paragraph:i,codeBlock:(n="")=>l2(e.nodes.codeBlock,null,n?[t(n)]:[]),blockquote:t=>((function(e,t){l3(e).map(t)})(t,e=>{if(!e.isBlock)throw Error(`expected node to be a block node but get ${e.type.name}`)}),l2(e.nodes.blockquote,null,t)),backlink:l,tag:t=>l2(e.nodes.tag,t),link:(t,n)=>{if(!n)throw Error("link href should not be empty");return e.text(t,[e.marks.link.create({href:n})])},listItem:o,list:s,taskListItem:(t,n)=>{let r={kind:"task",checked:!!n.checked,guid:n.guid||rm(),archived:!!n.archived};return l2(e.nodes.list,r,t)},taskList:e=>(l7(e,["taskListItem","list"]),e),checklistListItem:(t,n)=>{let r={kind:"checklist",checked:!!n.checked,guid:n.guid||rm(),archived:!1};return l2(e.nodes.list,r,t)},emptyList:c,namedList:e=>s(u(e)),namedListItem:u,backlinkedList:e=>s(d(e)),backlinkedListItem:d,parentList:e=>o([i(e),c()]),image:t=>{if(!t.src)throw Error("image link should exist");return l2(e.nodes.image,t)},tweet:t=>{if(!t.url)throw Error("tweet link should exist");return l2(e.nodes.tweet,t)},file:t=>l2(e.nodes.file,t)}}function l8(e,t){let n=null;return e.descendants((e,r)=>!n&&(t(e)?(n={node:e,pos:r},!1):void 0)),n}function l6(e,t){return l8(e,e=>(0,tY.yD)(e)&&function(e,t){if(!e||!t)return e===t;if(e.childCount!==t.childCount)return!1;for(let n=0;n<e.childCount;n++)if(!function(e,t){if(e.eq(t))return!0;if(e.type.name===tw.qh&&e.type.name===tw.qh){let n=e.attrs,r=t.attrs;if(n.label===r.label)return!0}return!1}(e.child(n),t.child(n)))return!1;return!0}(function(e){if((0,tY.yD)(e.firstChild))return null;let t=l8(e,e=>e.isTextblock);return t?t.node.content:null}(e),t))}function l9(e,t){let n=l6(e,t);return n?function(e,t){let n=aX(t.node);if(n){let[r,a]=n;return r+=t.pos,a+=t.pos,(0,tY.gY)(e.resolve(r),e.resolve(a))}return null}(e,n):null}function oe(e){let t=[];t=e instanceof tU.HY?aN(e):(0,n$.Z)(e)?e:[e],console.assert((0,nB.Z)(t,e=>e.type.name===tw.WQ),"the prosemirror nodes must be flat list nodes")}function ot(e,t){if(!e)return;let n=(0,tB.Z)(e)?e:tz.yy.create({schema:e.type.schema,doc:e}),{tr:r,schema:a}=n;return t({tr:r,schema:a}),n.apply(r).doc}async function on(e,t){let n=tz.yy.create({schema:e.type.schema,doc:e}),{tr:r,schema:a}=n;return await t({tr:r,schema:a}),n.apply(r).doc}async function or(e,t){return await on(e,async({tr:e})=>{await rL(e,t)})}function oa(e,t){let n=[];for(let e=1;e<t.content.childCount;e++){let r=t.content.child(e);n.push(r)}return oi(e,n=n.filter(e=>!ax(e)))}function oi(e,t){let n=e.tr.doc,r=n.content.size,a=r;for(let e=n.childCount-1;e>=0;e--)ax(n.child(e))&&(a-=2);let i=new tU.p2(tU.HY.fromArray(t),0,0);return e.tr.replaceRange(a,r,i),lM(e.tr,e.tr.doc.resolve(a)),!0}function ol(e,t){let n=l4(e.schema);return e.tr.replaceRangeWith(0,aQ(e.tr.doc),n.header(t)),!0}function oo(e,t,n,r={}){let a=a4(e.tr.doc);for(let[i,l]of a)i.attrs.id===t&&e.tr.setNodeMarkup(l,void 0,{...i.attrs,id:n,...r});return a.length>0}function os(e,t){let n=a4(e.tr.doc);for(let[r,a]of n)r.attrs.graphId!==t&&e.tr.setNodeMarkup(a,void 0,{...r.attrs,graphId:t});return n.length>0}function oc(e){var t;if((t=e.tr.doc,(0,tB.N2)({node:t,predicate:({node:e})=>e.type.name===tw.oL||e.type.name===tw.WQ})).length>0)return!1;let n=l4(e.schema);return e.tr.insert(aQ(e.tr.doc),n.emptyList()),function(e){let t=e.tr.doc,n=t.content.size,r=n;for(let e=t.childCount-1;e>=2;e--){let n=t.child(e);ax(n)&&(r-=n.nodeSize)}r<n&&e.tr.delete(r,n)}(e),!0}function ou(e,t){oe(t);let[n,r]=is(e.tr.doc);return e.tr.replaceRange(n,r,new tU.p2(tU.HY.from(t),0,0)),!0}function od(e,t){let{tr:n,schema:r}=e,a=l4(r),i=aQ(n.doc),l=it({node:n.doc,posFrom:i,wordsToMatch:[t.label]});if(0===l.length)return!1;let o=a.backlink(t);for(let e of l.reverse())n.replaceWith(e,e+t.label.length,o);return!0}function op(e){if(!e)throw Error("Unexpected empty doc");if("doc"!==e.type)throw Error(`Invalid doc type: ${e.type}`)}function om(){return{type:tw.e3,content:[]}}function of(e){op(e);let t=e?.content?.[0],n=t?.type===tw.e3?t:om();return{...e,content:[n]}}function oh({doc:e,inlineDoc:t}){op(e),op(t);let n=t?.content?.[0]??om(),r=e?.content??[],a=e?.content?.[0]?.type===tw.e3?[n,...r.slice(1)]:[n,...r];return{...t,content:a}}function og(e,t,n){var r;let a,i,l;let o=l4(e.type.schema).backlink(t);return(e.descendants(e=>{if(a)return!1;e.type.name===tw.qh&&n(e.attrs)&&(a=e)}),a)?(r=a,i=!1,function e(t){if(i)return t;if(t.eq(r))return i=!0,o;let n=t.content;if(0===n.size)return t;let a=tU.HY.fromArray(aN(n).map(e));return t.copy(a)}(e)):(l=!1,function e(t){if(l)return t;if(t.isTextblock){let e=t.content,n=t.type.schema.text(" "),r=e.addToEnd(n).addToEnd(o);return l=!0,t.copy(r)}let n=t.content;if(0===n.size)return t;let r=tU.HY.fromArray(aN(n).map(e));return t.copy(r)}(e))}function ok(e,t,{position:n="bottom"}={}){var r;let a=l6(e.tr.doc,t);if(a)return function(e,t){let n=t.node.maybeChild(1);if(n?.type?.name!==tw.WQ){let n=l4(e.schema),r=t.pos+t.node.child(0).nodeSize;return e.tr.insert(r,n.emptyList()),!0}return!1}(e,a);let i=(r=e.tr.doc,"bottom"===n?is(r):function(e){let t=io(e);if(!t){let t=aQ(e);return[t,t]}let{start:n}=t;return[n,n]}(r))[0],l=l4(e.schema);return e.tr.insert(i,l.parentList(t)),!0}function oy(e,t,n){oe(n),ok(e,t);let r=l9(e.tr.doc,t);return e.tr.insert(r.end,n),!function(e,t){let n=l9(e.tr.doc,t);n&&function(e,t){console.assert((0,tY.ji)(t),"range should only contain list nodes");let{startIndex:n,endIndex:r,parent:a}=t,{end:i}=t,l=i;if(!(r-n<2))for(let t=r-1;t>=n;t--){let n=a.child(t);l=i-n.nodeSize,(ay(n)||(0,tY.yD)(n))&&n.childCount<=1&&ax(n.firstChild)&&e.tr.deleteRange(l,i),i=l}}(e,n)}(e,t),!0}function ob(e,t,n,r){oe(n),ok(e,t,r);let a=l9(e.tr.doc,t);if(!a)return!1;let i=new Set((function(e){let{parent:t,startIndex:n,endIndex:r}=e,a=[];for(let e=n;e<r;e++)a.push(t.child(e));return a})(a).map(e=>e.textContent.trim()));return oy(e,t,n.filter(e=>{let t=e.textContent.trim();return!i.has(t)})),!0}function ow(e,t){let n=l4(e.schema);return tU.HY.from(n.backlink(t))}function ov(e,t,{position:n="bottom"}={}){return ok(e,oL(e,t),{position:n})}function ox(e,t,n){return oy(e,oL(e,t),n)}function oE(e,t,n){let r=l4(e.schema),a=n.filter(e=>e).map(e=>r.listItem(r.paragraphText(e)));return ob(e,oL(e,t),a)}function oC(e,t,n,r){return ob(e,oL(e,t),n,r)}function oL(e,t){if(!t)throw Error("listName cannot be empty");let n=l4(e.schema);return tU.HY.from(n.text(t))}var oS="force-update-subject",oN=class extends(tr=tM.nNj,tn=[(0,tM.WDe)()],tt=[(0,tM.WDe)()],te=[(0,tM.WDe)()],e9=[(0,tM.WDe)()],e6=[(0,tM.WDe)()],e8=[(0,tM.WDe)()],e4=[(0,tM.WDe)()],e3=[(0,tM.WDe)()],e7=[(0,tM.WDe)()],e2=[(0,tM.WDe)()],e5=[(0,tM.WDe)()],e1=[(0,tM.WDe)()],e0=[(0,tM.WDe)()],eG=[(0,tM.WDe)()],eJ=[(0,tM.WDe)()],tr){constructor(){super(...arguments),(0,tx.Co)(ta,5,this)}get name(){return"transformCommands"}ensureNamedList(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!ov({schema:n,tr:r},e)&&(t?.(r),!0)}syncNamedListItems(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!oE({schema:r,tr:a},e,t)&&(n?.(a),!0)}syncNodesToParentList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!ob({schema:r,tr:a},e,t)&&(n?.(a),!0)}appendNodesToNamedList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!ox({schema:r,tr:a},e,t)&&(n?.(a),!0)}appendNodesToParentList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!oy({schema:r,tr:a},e,t)&&(n?.(a),!0)}ensureBacklinkedList(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!function(e,t,{position:n="bottom"}={}){return ok(e,ow(e,t),{position:n})}({schema:n,tr:r},e)&&(t?.(r),!0)}syncBacklinkedListItems(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!function(e,t,n){let r=l4(e.schema),a=n.filter(e=>e).map(e=>r.listItem(r.paragraphText(e)));return ob(e,ow(e,t),a)}({schema:r,tr:a},e,t)&&(n?.(a),!0)}appendNodesToBacklinkedList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>{var i;return!!oy(i={schema:r,tr:a},ow(i,e),t)&&(n?.(a),!0)}}ensureList(){return({dispatch:e,state:{schema:t,tr:n}})=>!!oc({schema:t,tr:n})&&(e?.(n),!0)}appendNodesToFirstList(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!ou({schema:n,tr:r},e)&&(t?.(r),!0)}rewriteBacklinkNoteIds(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!oo({schema:r,tr:a},e,t)&&(n?.(a),!0)}rewriteBacklinkGraphIds(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!os({schema:n,tr:r},e)&&(t?.(r),!0)}addSubjectToContent(e,t=!1){return({dispatch:n,state:{schema:r,tr:a}})=>!!ol({schema:r,tr:a},e)&&(t&&a.setMeta(oS,!0),n?.(a),!0)}mergeDocument(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!oa({schema:n,tr:r},e)&&(t?.(r),!0)}addSuggestedBacklinkToNodes(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!od({schema:n,tr:r},e)&&(t?.(r),!0)}};function oT({pos:e}){return(t,n)=>{let r=t.tr,a=r.doc.nodeAt(e);if(a?.type?.name!==tw.Q0)return!1;let{url:i}=a.attrs,l=t.schema;return r.replaceRangeWith(e,e+a.nodeSize,l.nodes.paragraph.createChecked(null,[l.text(i||" ",[l.marks.link.create({href:i})])])),n?.(r),!0}}ta=(0,tx.xl)(tr),(0,tx.pL)(ta,1,"ensureNamedList",tn,oN),(0,tx.pL)(ta,1,"syncNamedListItems",tt,oN),(0,tx.pL)(ta,1,"syncNodesToParentList",te,oN),(0,tx.pL)(ta,1,"appendNodesToNamedList",e9,oN),(0,tx.pL)(ta,1,"appendNodesToParentList",e6,oN),(0,tx.pL)(ta,1,"ensureBacklinkedList",e8,oN),(0,tx.pL)(ta,1,"syncBacklinkedListItems",e4,oN),(0,tx.pL)(ta,1,"appendNodesToBacklinkedList",e3,oN),(0,tx.pL)(ta,1,"ensureList",e7,oN),(0,tx.pL)(ta,1,"appendNodesToFirstList",e2,oN),(0,tx.pL)(ta,1,"rewriteBacklinkNoteIds",e5,oN),(0,tx.pL)(ta,1,"rewriteBacklinkGraphIds",e1,oN),(0,tx.pL)(ta,1,"addSubjectToContent",e0,oN),(0,tx.pL)(ta,1,"mergeDocument",eG,oN),(0,tx.pL)(ta,1,"addSuggestedBacklinkToNodes",eJ,oN),(0,tx.ZU)(ta,oN);var oM=({sources:e,...t})=>{let[n,r]=(0,tL.useState)(0);return tL.createElement("img",{...t,onError:()=>{r(t=>t<e.length-1?t+1:t)},src:e.length>0?e[n]:""})},oI=({children:e})=>{let t=(0,nW.GH)();return t?(0,nK.createPortal)(tL.createElement(tv.UP,null,e),t):null},oD=(0,tL.forwardRef)(function({label:e,disabled:t,...n},r){return tL.createElement("button",{type:"button",...n,ref:r,role:"menuitem",disabled:t},e)}),oA=(0,tL.forwardRef)(function(e,t){let{children:n,as:r,...a}=e,i=tL.Children.map(n,e=>{if(!tL.isValidElement(e))throw Error("Found invalid child in 'Menu'");return e})??[],[l,o]=tL.useState(!1),[s,c]=tL.useState(null),[u,d]=tL.useState(!1),p=tL.useRef([]),m=tL.useRef(i.map(e=>e.props.label||null)),f=(0,nW.ay)(),h=(0,nW.jV)(),g=(0,nW.Zm)(),k=null!=g,{x:y,y:b,strategy:w,refs:v,context:x}=(0,nW.YF)({nodeId:h,open:l,onOpenChange:o,placement:k?"right-start":"bottom-start",middleware:[(0,nZ.cv)({mainAxis:k?0:4,alignmentAxis:k?-4:0}),(0,nV.RR)(),(0,nV.uY)()],whileElementsMounted:nV.Me}),E=(0,nW.XI)(x,{enabled:k&&u,delay:{open:75},handleClose:(0,nW.xp)({blockPointerEvents:!0})}),C=(0,nW.eS)(x,{event:"mousedown",toggle:!k||!u,ignoreMouse:k}),L=(0,nW.qs)(x,{role:"menu"}),S=(0,nW.bQ)(x),N=(0,nW.c0)(x,{listRef:p,activeIndex:s,nested:k,onNavigate:c}),T=(0,nW.ox)(x,{enabled:l,listRef:m,onMatch:l?c:void 0,activeIndex:s}),{getReferenceProps:M,getFloatingProps:I,getItemProps:D}=(0,nW.NI)([E,C,L,S,N,T]);tL.useEffect(()=>{if(f)return f.events.on("click",e),f.events.on("menuopen",t),()=>{f.events.off("click",e),f.events.off("menuopen",t)};function e(){o(!1)}function t(e){e.nodeId!==h&&e.parentId===g&&o(!1)}},[f,h,g]),tL.useEffect(()=>{l&&f&&f.events.emit("menuopen",{parentId:g,nodeId:h})},[f,l,h,g]),tL.useEffect(()=>{function e({pointerType:e}){"touch"!==e&&d(!0)}function t(){d(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",t,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",t,!0)}},[u]);let A=(0,nW.qq)([v.setReference,t]);return tL.createElement(nW.mN,{id:h},tL.createElement("button",{ref:A,"data-open":l?"":void 0,...M({...a,onClick(e){e.stopPropagation()},...k&&{role:"menuitem"}})},tL.createElement(r,{isNested:k})),tL.createElement(oI,null,tL.createElement(nF.u,{show:l,enter:"transition transform ease-out duration-100",enterFrom:"opacity-0 scale-100",enterTo:"opacity-100 scale-100 z-floating-menu",leave:"transition transform ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-100"},tL.createElement(nW.wD,{context:x,modal:!1,initialFocus:k?-1:0,returnFocus:!k},tL.createElement("div",{ref:v.setFloating,className:"absolute right-0 z-floating-menu mt-2 w-max min-w-[110px] overflow-hidden rounded-md bg-white text-coolgray-900 shadow-lg outline-none ring-1 ring-black/5 transition focus:outline-none dark:bg-app-dark-tint dark:text-near-white dark:ring-white/25",style:{position:w,top:b??0,left:y??0,width:"max-content"},...I()},i.map((e,t)=>tL.cloneElement(e,D({tabIndex:s===t?0:-1,className:"flex h-8 w-full cursor-pointer items-center px-3 text-2xs leading-5 transition focus:bg-coolgray-100 focus:text-coolgray-900 focus:dark:bg-white/10 focus:dark:text-white outline-none z-floating-menu",ref(e){p.current[t]=e},onClick(t){e.props.onClick?.(t),f?.events.emit("click")},onMouseEnter(){u&&l&&c(t)}}))))))))}),o_=(0,tL.forwardRef)(function(e,t){return null===(0,nW.Zm)()?tL.createElement(nW.RB,null,tL.createElement(oA,{...e,ref:t})):tL.createElement(oA,{...e,ref:t})});function oR(e){try{return e.toLocaleDateString(void 0!=navigator.languages?navigator.languages[0]:navigator.language,{year:"numeric",month:"short",day:"numeric"})}catch(t){return e.toLocaleDateString()}}function oH({children:e,...t}){return tL.createElement("a",{target:"_blank",rel:"noopener noreferrer",...t},e)}var oj=({searchTerm:e,children:t})=>{let n=(0,tL.useRef)(null);return(0,tL.useEffect)(()=>{e&&n.current&&(0,tv.CC)(n.current,e)},[e]),tL.createElement("span",{ref:n},t)},oO=e=>`https://twitter.com/${e}`;function o$(e){return`https://twitter.com/${e.user.screen_name}/status/${e.id_str}`}function oB(e,t){let n=new URL(e.media_url_https),r=n.pathname.split(".").pop();return r?(n.pathname=n.pathname.replace(`.${r}`,""),n.searchParams.set("format",r),n.searchParams.set("name",t),n.toString()):e.media_url_https}function oz(e){return function(e){let t=function(e){if(!e.video_info)return[];let{variants:t}=e.video_info;return t.filter(e=>"video/mp4"===e.content_type).sort((e,t)=>(t.bitrate??0)-(e.bitrate??0))}(e);return 0===t.length?null:t.length>1?t[1]:t[0]}(e)?.url??""}function oP(e,t,n){for(let r of t)for(let[t,a]of e.entries()){if(r.indices[0]<a.indices[0]||r.indices[1]>a.indices[1])continue;let i=[{...r,type:n}];a.indices[0]<r.indices[0]&&i.unshift({indices:[a.indices[0],r.indices[0]],type:"text"}),a.indices[1]>r.indices[1]&&i.push({indices:[r.indices[1],a.indices[1]],type:"text"}),e.splice(t,1,...i);break}}function oW({tweet:e,searchTerm:t}){let n=function(e){let t=[{indices:e.display_text_range,type:"text"}];return oP(t,e.entities.hashtags,"hashtag"),oP(t,e.entities.user_mentions,"mention"),oP(t,e.entities.urls,"url"),oP(t,e.entities.symbols,"symbol"),e.entities.media&&oP(t,e.entities.media,"media"),t}(e);e.entities.media&&e.entities.media[0].indices[0]<e.display_text_range[1]&&(e.display_text_range[1]=e.entities.media[0].indices[0]);let r=n.at(-1);return r&&r.indices[1]>e.display_text_range[1]&&(r.indices[1]=e.display_text_range[1]),tL.createElement("div",{className:"w-full"},n.map((n,r)=>{let a=Array.from(e.text).splice(n.indices[0],n.indices[1]-n.indices[0]).join("");switch(n.type){case"hashtag":return tL.createElement(oH,{key:r,href:`https://twitter.com/hashtag/${n.text}`},a);case"mention":return tL.createElement(oH,{key:r,href:oO(n.screen_name)},a);case"url":return tL.createElement(oH,{key:r,href:n.expanded_url},n.display_url);case"symbol":return tL.createElement(oH,{key:r,href:`https://twitter.com/search?q=%24${n.text}`},a);case"media":return null;default:return tL.createElement(oj,{key:r,searchTerm:t},(0,nq.Z)(a))}}))}var oZ=({media:e,tweetUrl:t})=>{let n=e.original_info.height||200,r=e.original_info.width||200;return"video"==e.type||"animated_gif"==e.type?tL.createElement("video",{className:"!m-0",width:r,height:n,muted:!0,controls:!0,playsInline:!0,preload:"metadata",style:{aspectRatio:`${r} / ${n}`}},tL.createElement("source",{src:oz(e),type:"video/mp4"})):tL.createElement("a",{key:e.media_url_https,href:t,target:"_blank",rel:"noreferrer"},tL.createElement("img",{width:r,height:n,src:oB(e,"small")}))};function oV(e){let t=e.original_info.height||200,n=e.original_info.width||200;return"video"==e.type||"animated_gif"==e.type?["video",{class:"!m-0",width:n,height:t,muted:"",controls:"",playsInline:"",preload:"metadata",style:`aspect-ratio: ${n} / ${t};`},["source",{src:oz(e),type:"video/mp4"}]]:["img",{width:n,height:t,src:oB(e,"small")}]}var oF=({tweet:e})=>{if(!e?.mediaDetails?.length)return null;let t=o$(e);return tL.createElement("div",{className:(0,tC.default)("mt-3 inline-grid overflow-hidden rounded-xl border border-gray-300 drop-shadow-sm dark:border-gray-500",1===e.mediaDetails.length?"grid-cols-1":"grid-cols-2")},e.mediaDetails?.map((e,n)=>tL.createElement(oZ,{key:n,media:e,tweetUrl:t})))};async function oK(e){if(!navigator?.clipboard)return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.warn("Copy failed",e),!1}}function oq(e){return{type:e.type,media_url_https:e.media_url_https,original_info:{width:e.original_info.width,height:e.original_info.height},video_info:"video"===e.type||"animated_gif"===e.type?e.video_info:null}}var oY=["https://tweet.reflect.app","https://react-tweet.vercel.app","https://react-tweet-next.vercel.app"];async function oU({host:e,tweetId:t}){let n=`${e}/api/tweet/${t}`,r=await fetch(n),a=await r.json();if(!r.ok)return null;let i=a.data;if(i?.text==null||i?.user?.name==null)throw Error(`Invalid tweet data ${JSON.stringify(i)}`);return{version:2,created_at:i.created_at,display_text_range:i.display_text_range,entities:i.entities,id_str:i.id_str,text:i.text,user:i.user,mediaDetails:i.mediaDetails?.map(oq),in_reply_to_screen_name:i.in_reply_to_screen_name,in_reply_to_status_id_str:i.in_reply_to_status_id_str,in_reply_to_user_id_str:i.in_reply_to_user_id_str}}async function oQ({tweetId:e}){for(let t of oY)try{let n=await oU({host:t,tweetId:e});if(n)return n}catch(e){console.error(`Failed to fetch tweet from ${t}`,e)}return null}function oX(){let{node:e,selected:t,getPos:n,decorations:r,view:a}=(0,nz.js)(),i=rD(r),{tweetUrl:l,tweetData:o,error:s,handleCopy:c,handleReplace:u}=function(e,t,n){let r=e.attrs,a=!!r.tweetData&&!((r.tweetData.version??0)<2),i=r.url||"",[l,o]=(0,tL.useState)(null);(0,tL.useEffect)(()=>{if(!n||n.isDestroyed||a)return;let e=i.match(tw.W2)?.groups?.tweet_id;if(!e){o(Error("Can't paste tweet URL "+i));return}oQ({tweetId:e}).then(e=>{!function(e,t,n){if(e.isDestroyed||!n)return;let{state:r}=e,a=[];if(r.doc.descendants((e,r)=>{if(e.type.name===tw.Q0){let i=e.attrs;i.url!==t||(0,nY.Z)(n,i.tweetData)||a.push(r)}if(e.isTextblock)return!1}),0===a.length)return;let i=e.state.tr;for(let e of a)i.setNodeAttribute(e,"tweetData",n);e.dispatch(i)}(n,i,e)}).catch(e=>{o(e)})},[a,i,n]);let s=(0,tL.useCallback)(()=>{oK(i)},[i]),c=(0,tL.useCallback)(()=>{let e=t();e&&oT({pos:e})(n.state,e=>n.dispatch(e),n)},[t,n]);return{tweetUrl:i,tweetData:r.tweetData??null,error:l,handleCopy:s,handleReplace:c}}(e,n,a);return tL.createElement("div",{className:"p-1"},tL.createElement("div",{"data-selected":t?"":void 0,className:"relative min-h-20 w-full max-w-[500px] overflow-hidden rounded-xl bg-gray-50 p-3 outline outline-offset-0 outline-transparent data-[selected]:outline-blue-400 dark:bg-gray-800 [.ProseMirror-selectednode_&]:outline-blue-400","data-tweet-url":l},tL.createElement(oJ,{key:"tweet-"+(i??""),tweetUrl:l,tweetData:o,error:s,searchTerm:i??void 0,handleCopy:c,handleReplace:u})))}function oJ({tweetUrl:e,tweetData:t,error:n,searchTerm:r,handleCopy:a,handleReplace:i}){return n?tL.createElement(o0,{error:n,tweetUrl:e}):tL.createElement(oG,{tweet:t,searchTerm:r,handleCopy:a,handleReplace:i})}function oG({tweet:e,searchTerm:t,handleCopy:n,handleReplace:r}){let a=e?new Date(e.created_at):new Date,i=e?.user?.profile_image_url_https??"",l=[o2(i),i].filter(ra);return tL.createElement("div",{className:"flex w-full select-none space-x-4 overflow-hidden text-sm"},e?tL.createElement(oM,{className:"h-12 w-12 rounded-full",sources:l,alt:e.user.name}):tL.createElement("img",{className:"h-12 w-12 rounded-full bg-bluegray-200 dark:bg-bluegray-600"}),tL.createElement("div",{className:"flex flex-1 flex-col items-stretch overflow-hidden"},tL.createElement("div",{className:"flex items-center justify-between space-x-1 overflow-hidden"},tL.createElement("div",{className:"inline-flex min-w-0 flex-1 items-center space-x-2 overflow-hidden"},e?tL.createElement(tL.Fragment,null,tL.createElement(oH,{className:"shrink overflow-hidden",href:oO(e.user.screen_name)},tL.createElement("span",{className:"inline-block w-full overflow-hidden truncate align-top font-semibold text-coolgray-800 hover:underline dark:text-near-white"},tL.createElement(oj,{searchTerm:t},e.user.name))),tL.createElement(oH,{className:"shrink overflow-hidden",href:oO(e.user.screen_name)},tL.createElement("span",{className:"inline-block w-full overflow-hidden truncate align-top text-coolgray-500"},tL.createElement(oj,{searchTerm:t},"@",e.user.screen_name))),tL.createElement(oH,{className:"shrink-0 overflow-hidden",href:o$(e)},tL.createElement("time",{className:"inline-block w-full overflow-hidden whitespace-nowrap align-top text-coolgray-500 hover:underline",dateTime:a.toISOString()},oR(a)))):tL.createElement("span",{className:"w-full max-w-[270px] bg-bluegray-200 dark:bg-bluegray-600"},tL.createElement("br",null))),tL.createElement(o1,{handleCopy:n,handleReplace:r})),tL.createElement("div",{className:"mt-1"},e?tL.createElement(oW,{tweet:e,searchTerm:t}):tL.createElement("div",{className:"w-full max-w-[270px] bg-bluegray-200 dark:bg-bluegray-600"},tL.createElement("br",null))),tL.createElement(oF,{tweet:e})))}function o0({error:e,tweetUrl:t}){return(0,tL.useEffect)(()=>{console.error("Failed to load tweet:",e)},[e]),tL.createElement("div",{className:"flex min-h-16 items-center justify-center space-x-4"},tL.createElement("p",null,"Failed to load tweet"," ",tL.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},t)))}var o1=({handleCopy:e,handleReplace:t})=>tL.createElement(o_,{as:o5,label:"Edit",className:"flex h-7 w-7 items-center justify-center rounded-sm outline-none transition hover:bg-black/10 hover:dark:bg-white/10"},tL.createElement(oD,{label:"Copy link",onClick:e}),tL.createElement(oD,{label:"Transform to plain link",onClick:t}));function o5(){return tL.createElement(nP.T,{className:"h-5 w-5","aria-hidden":"true"})}function o2(e){if(!e||!i7(e))return null;let t=e.replace(/_normal(\.[a-z]+)$/i,"_x96$1");return t===e?null:t}ts=[(0,tM.AOx)({})];var o7=class extends(to=tM.QR,tl=[(0,tM.WDe)()],ti=[(0,tM.WDe)()],to){constructor(){super(...arguments),(0,tx.Co)(tc,5,this)}get name(){return"tweet"}createTags(){return[tI.eX.Block]}createNodeSpec(e){return{attrs:{...e.defaults(),url:{default:""},tweetData:{default:null}},selectable:!0,draggable:!0,atom:!0,content:"",parseDOM:[{tag:'a[href^="https://twitter.com/"][href*="/status/"][data-preview="1"]',priority:tI.xV.High,getAttrs:t=>{let n=t.getAttribute("href");return{...e.parse(t),url:n}},getContent:()=>tU.HY.empty},{tag:'div[data-tweet-url^="https://twitter.com/"]',priority:tI.xV.High,getAttrs:t=>{let n=t.getAttribute("data-tweet-url");return{...e.parse(t),url:n}},getContent:()=>tU.HY.empty}],toDOM:e=>["div",function(e){let{tweetData:t,url:n}=e;return["div",{class:"p-1"},["div",{class:"relative min-h-20 w-full max-w-[500px] overflow-hidden rounded-xl bg-gray-50 p-3 outline outline-offset-0 dark:bg-gray-800 outline-transparent","data-tweet-url":n},t?function(e){var t;let n=e?new Date(e.created_at):new Date;return["div",{class:"flex w-full select-none space-x-4 overflow-hidden text-sm"},["img",{class:"h-12 w-12 rounded-full",src:o2(t=e?.user?.profile_image_url_https??"")??t,alt:e?.user?.name??""}],["div",{class:"flex flex-1 flex-col items-stretch overflow-hidden"},["div",{class:"flex items-center justify-between space-x-1 overflow-hidden"},["div",{class:"inline-flex min-w-0 flex-1 items-center space-x-2 overflow-hidden"},["a",{target:"_blank",rel:"noopener noreferrer",href:oO(e?.user?.screen_name??""),class:"shrink overflow-hidden"},["span",{class:"inline-block w-full overflow-hidden truncate align-top font-semibold text-coolgray-800 hover:underline dark:text-near-white"},e?.user?.name??""]],["a",{target:"_blank",rel:"noopener noreferrer",href:oO(e?.user?.screen_name??""),class:"shrink overflow-hidden"},["span",{class:"inline-block w-full overflow-hidden truncate align-top text-coolgray-500"},"@"+(e?.user?.screen_name??"")]],["a",{target:"_blank",rel:"noopener noreferrer",className:"shrink-0 overflow-hidden",href:e?o$(e):""},["time",{class:"inline-block w-full overflow-hidden whitespace-nowrap align-top text-coolgray-500 hover:underline"},oR(n)]]]],["div",{class:"mt-1"},["div",{class:"w-full"},e?.text??""]],e?.mediaDetails?.length?["div",{class:(0,tC.default)("mt-3 inline-grid overflow-hidden rounded-xl border border-gray-300 drop-shadow-sm dark:border-gray-500",1===e.mediaDetails.length?"grid-cols-1":"grid-cols-2")},...(e.mediaDetails??[]).map(oV)]:["div",{class:"hidden"}]]]}(t):["div",{class:"flex min-h-16 items-center justify-center space-x-4"},["a",{href:n},n]]]]}(e.attrs)],leafText:e=>aS(e.attrs)}}createPasteRules(){return[{type:"node",nodeType:this.store.schema.nodes.tweet,regexp:tw.W2,getAttributes:e=>({url:`https://twitter.com/${e.groups?.user_id}/status/${e.groups?.tweet_id}`,"data-preview":"1"}),getContent:()=>{}}]}insertTweet({url:e}){return(0,nx.A_)(function({url:e}){return(t,n)=>{let{from:r,to:a}=tz.Bs.between(t.selection.$from,t.selection.$to),i=t.schema.nodes[tw.Q0].create({url:e});return n?.(t.tr.replaceRangeWith(r,a,i)),!0}}({url:e}))}replaceTweetToLink({pos:e}){return(0,nx.A_)(oT({pos:e}))}};tc=(0,tx.xl)(to),(0,tx.pL)(tc,1,"insertTweet",tl,o7),(0,tx.pL)(tc,1,"replaceTweetToLink",ti,o7),o7=(0,tx.pL)(tc,0,"TweetExtension",ts,o7),(0,tx.Co)(tc,1,o7);var o3=[{regexp:/<-/,replace:"←"},{regexp:/->/,replace:"→"},{regexp:/\(c\)/,replace:"\xa9"},{regexp:/\(r\)/,replace:"\xae"},{regexp:/1\/2/,replace:"\xbd"},{regexp:/\+\/-$/,replace:"\xb1"},{regexp:/!=/,replace:"≠"},{regexp:/<</,replace:"\xab"},{regexp:/>>/,replace:"\xbb"},{regexp:/--/,replace:"—"}];tu=[(0,tM.AOx)({})];var o4=class extends(tp=tM.nNj){get name(){return"typography"}createInputRules(){return o3.map(e=>(0,tB.TY)({regexp:RegExp(`(${e.regexp.source})[\\s]$`),transformMatch:([t])=>t?e.replace+" ":null}))}};td=(0,tx.xl)(tp),o4=(0,tx.pL)(td,0,"TypographyExtension",tu,o4),(0,tx.Co)(td,1,o4);var o8=class extends nU.A{createMarkSpec(e,t){return{...super.createMarkSpec(e,t)}}};tm=[(0,tM.AOx)({defaultOptions:{enabled:!1}})];var o6=class extends(th=tM.nNj){get name(){return"reflectVirtualCursor"}createExternalPlugins(){return this.options.enabled?[(0,nQ.K)()]:[]}onSetOptions(e){e.changes.enabled.changed&&this.store.updateExtensionPlugins(this)}};tf=(0,tx.xl)(th),o6=(0,tx.pL)(tf,0,"VirtualCursorExtension",tm,o6),(0,tx.Co)(tf,1,o6);var o9=new Set([tw.MM,tw.OE]),se=class extends tM.nNj{get name(){return"reflectVirtualSelection"}createDecorations(e){let{selection:t,doc:n}=e;if(((0,tB.hT)(t)||(0,tB.d7)(t))&&!t.empty){let{from:e,to:r}=t,a=[];return n.nodesBetween(e,r,(e,t)=>{o9.has(e.type.name)&&a.push(ng.p.node(t,t+e.nodeSize,{class:"ProseMirror-selectednode"}))}),this.store.view?.hasFocus()||a.push(ng.p.inline(e,r,{class:"virtual-selection"})),ng.EH.create(n,a)}return ng.EH.empty}createPlugin(){return{props:{handleDOMEvents:{blur:e=>(e.dispatch(e.state.tr.setMeta("virtual-selection",!1)),!1)}}}}};ty=[(0,tM.AOx)({defaultOptions:{yjsDoc:null,yjsOnUpdate:null},defaultPriority:tI.xV.High})];var st=class extends(tk=tM.nNj,tg=[(0,tM.WDe)()],tk){constructor(){super(...arguments),(0,tx.Co)(tb,5,this),(0,tx.ov)(this,"yjsDoc",new nJ.Doc)}get name(){return"yjs"}createExternalPlugins(){let{yjsDoc:e,yjsOnUpdate:t}=this.options;if(e){let t=nJ.encodeStateAsUpdate(e);nJ.applyUpdate(this.yjsDoc,t)}this.yjsDoc.on("update",e=>{t?.({update:e,doc:this.yjsDoc})});let n=this.yjsDoc.getXmlFragment("prosemirror");return[(0,nX.Z)(n)]}yjsApplyUpdates(e){return()=>{let t=nJ.mergeUpdates(e);return nJ.applyUpdate(this.yjsDoc,t),!0}}};function sn({onFileUpload:e=ru,onFileUploadSync:t,onFileDownload:n=rd,onFileSave:r=rf,onFileUrlReplace:a=rp,onTagClick:i,onBacklinkOpen:l,onBacklinkHover:o,onBacklinkAdd:s,onTagAdd:c,onImageClick:u,onCheckboxChange:d,getKeyboardLayoutMap:p,graphId:m,isTagSelectable:f,isBacklinkSelectable:h,yjsDoc:g,yjsOnUpdate:k,subjectRequired:y=!0,inline:b=!1,virtualCursorEnabled:w=!1,doubleSpaceEnabled:v=!1,nodeViews:x={}}){let E={onTagAdd:c,onBacklinkAdd:s?e=>({...e,id:e.id||tw.S5,graphId:e.graphId||tw.S5}):void 0};return[g?new st({yjsDoc:g??null,yjsOnUpdate:k??null}):null,new iX,new iq,new tA.i,new oN,new ll,new lQ,new se,new lP,new as,new lr({markdown:E,onBacklinkAdd:s}),new i$({enabled:v}),new lO({getNodeViews:()=>x}),new l$,new iG,new tR.V,new i0,function(){let e=new lo({autoLink:!1,autoLinkRegex:aH});return e.addHandler("onClick",(e,t)=>{let n=a$(t.href);try{window.open(n,"_blank")}catch(e){console.error(`failed to open URL ${n}:`,e),window.alert(`Sorry, we couldn't open that link: ${n}`)}return!0}),e}(),new tH.Q,new rK,new rU,function(e){let{data:t,...n}=e;for(let e of t){var r;e.emoticon&&(r=e.emoticon,/[\da-z]/i.test(r))&&delete e.emoticon}return new nw.x({...n,data:t})}({plainText:!0,data:iJ}),new o4,new lC,new lE({enableSpine:!0}),new lL({enableCollapsible:!0,priority:ri}),new ld({extraAttributes:{guid:{default:()=>rm(),parseDOM:e=>e.getAttribute("data-guid")||rm(),toDOM:e=>e.guid},archived:{default:!0,parseDOM:()=>!1}},onCheckboxChange:d,getKeyboardLayoutMap:p}),new t_.u,new le({enableResizing:!0,uploadImageHandler:async(t,n)=>{let{src:r}=await e(t,n);return Promise.resolve({src:r,fileName:t.name})},uploadImageSyncHandler:t,onClick:u,onFileDownload:n}),new o7,function({uploadHandler:e,onFileUrlReplace:t,onFileSave:n}){return new rw({render:function(e){return tL.createElement(rb,{...e,onFileUrlReplace:t,onFileSave:n})},onFileUrlReplace:t,uploadFileHandler:()=>{let t;return{insert:e=>(t=e,{url:void 0,fileName:e.name,fileType:e.type,fileSize:e.size}),upload:n=>e(t,e=>{n.set(tw.Lr,e)}),abort:()=>{}}}})}({uploadHandler:async(t,n)=>{let{src:r}=await e(t,n);return Promise.resolve({url:r,fileName:t.name,fileType:t.type,fileSize:t.size})},onFileUrlReplace:a,onFileSave:r}),new i5({enableResizing:!0}),new lI,new lD({priority:ri,extraAttributes:{guid:{default:()=>rm(),parseDOM:e=>e.getAttribute("data-guid")||rm(),toDOM:e=>e.guid}},onCheckboxChange:d}),new lT,function({onTagClick:e,graphId:t,isTagSelectable:n}){return new lq({graphId:t,onClick:e,selectable:n})}({onTagClick:i,graphId:m,isTagSelectable:f}),function({onBacklinkOpen:e,onBacklinkHover:t,graphId:n,isBacklinkSelectable:r}){return new rF({appendText:"",graphId:n,onOpen:e,onHover:t,selectable:r})}({onBacklinkOpen:l,onBacklinkHover:o,graphId:m,isBacklinkSelectable:h}),new lV,new lK,new tD.l({markOverride:{excludes:""}}),new rY,new lF,new o8,new li,new ag,new lU,new tM.i8b,new tM.orf({shortcuts:{...tM.klI,[tI.vO.OrderedList]:"",[tI.vO.BulletList]:"",[tI.vO.TaskList]:"",[tI.vO.Strike]:"Mod-shift-x"}}),new iC({markdown:E,onBacklinkAdd:s}),new lj,new lW,function({subjectRequired:e,inline:t}){return new iO({content:function({subjectRequired:e,inline:t}){return t?"paragraph":e?"heading block+":"block+"}({subjectRequired:e,inline:t})})}({subjectRequired:y,inline:b}),new lY,new o6({enabled:w}),new l1,new iL({priority:tI.xV.Lowest})].filter(ra)}tb=(0,tx.xl)(tk),(0,tx.pL)(tb,1,"yjsApplyUpdates",tg,st),st=(0,tx.pL)(tb,0,"YjsExtension",ty,st),(0,tx.Co)(tb,1,st);var sr=({enabled:e})=>((0,tE.Ml)(i$,{enabled:null===e?tB.NZ.isIos:e}),null),sa=({state:e,tr:t,dispatch:n})=>!e.selection.empty&&(n?.(t.setSelection(tz.Bs.near(e.selection.$head))),!0),si=e=>{let{onNavigatePrevious:t,onNavigateNext:n}=e,r=(0,tS.Z)((e,r)=>{let{tr:a}=r,i=a.selection.$from;return"up"==e&&function(e){let t=e.doc,n=tz.Bs.near(t.resolve(0));return e.pos<=n.from}(i)?!!t&&(t({scroll:!1}),!0):!!("down"==e&&function(e){let t=e.doc,n=tz.Bs.near(t.resolve(t.content.size));return e.pos>=n.to}(i))&&!!n&&(n({scroll:!1}),!0)}),a=(0,tS.Z)(e=>r("up",e)),i=(0,tS.Z)(e=>r("down",e)),l=(0,tS.Z)(()=>!!t&&(t({scroll:!0}),!0)),o=(0,tS.Z)(()=>!!n&&(n({scroll:!0}),!0));return(0,nG.og)("ArrowUp",a,tI.xV.Low),(0,nG.og)("ArrowDown",i,tI.xV.Low),(0,nG.og)("PageUp",l,tI.xV.Low),(0,nG.og)("PageDown",o,tI.xV.Low),(0,nG.og)("Escape",sa,tI.xV.Low),null},sl=({width:e,setWidth:t,children:n,aspectRatio:r="16 / 9",view:a,className:i})=>{let[l,o]=(0,tL.useState)(e),s=(0,tL.useRef)(l),[c,u]=(0,tL.useState)(!1),[d,p]=(0,tL.useState)(!1),m=(0,tL.useCallback)(()=>{a.hasFocus()&&a.dom.blur()},[a]),f=(0,tL.useCallback)(e=>{o(t=>(s.current=t+e,s.current))},[]),h=(0,tL.useCallback)(()=>{u(!0)},[]),g=(0,tL.useCallback)((e,t)=>{m(),f(-t.deltaX)},[m,f]),k=(0,tL.useCallback)((e,t)=>{m(),f(t.deltaX)},[m,f]),y=(0,tL.useCallback)(()=>{t(s.current),u(!1)},[t]),b=(0,tL.useCallback)(()=>{p(!0)},[]),w=(0,tL.useCallback)(()=>{p(!1)},[]);return tL.createElement("div",{style:{width:Math.max(l,200),aspectRatio:r},className:(0,tC.default)("relative",i),onMouseOver:b,onMouseOut:w},tL.createElement(so,{position:"left",show:c||d,onStart:h,onDrag:g,onStop:y}),tL.createElement(so,{position:"right",show:c||d,onStart:h,onDrag:k,onStop:y}),tL.cloneElement(n,c?{style:{pointerEvents:"none"}}:void 0))},so=({position:e,show:t,onStart:n,onDrag:r,onStop:a})=>tL.createElement(n0.DraggableCore,{onStart:n,onDrag:r,onStop:a},tL.createElement("div",{className:(0,tC.default)("absolute inset-y-0 z-10 flex w-[15px] cursor-col-resize items-center justify-center opacity-0 transition-opacity duration-300 hover:opacity-100","left"===e?"left-0":"right-0",t?"opacity-100":"opacity-0")},tL.createElement("div",{className:"box-content h-[36px] max-h-[50%] w-[4px] rounded-full border border-white/50 bg-black/70"})));function ss(){let{node:e,selected:t,view:n,getPos:r}=(0,nz.js)(),a=e.attrs,i=function(e,t){if("number"==typeof e)return e;if("string"==typeof e){let t=e.match(/^(\d+(?:\.\d+)?)px/);if(t)return Number.parseInt(t[0])}return 300}(a.width??"",0),l=(0,tL.useCallback)(e=>{try{let t=r();if(t&&t>=1&&!n.isDestroyed){let r=n.state.doc.nodeAt(t);if(r&&r.type.name===tw._M&&r.attrs.width!==e){let r=n.state.tr;r.setNodeAttribute(t,"width",e),r.setNodeAttribute(t,"height",e/16*9),n.dispatch(r)}}}catch(e){console.warn("Failed to resize:",e)}},[r,n]),o=(0,tL.useCallback)(()=>{oK(r0(a))},[a]),s=(0,tL.useCallback)(()=>{let e=r();e&&i1({pos:e})(n.state,e=>n.dispatch(e),n)},[r,n]);return tL.createElement(sl,{view:n,width:i,setWidth:l,className:(0,tC.default)("max-w-full outline outline-offset-0",t?"outline-blue-400":"outline-transparent")},tL.createElement("div",{className:"relative h-full w-full"},tL.createElement(sc,{handleCopy:o,handleReplace:s}),tL.createElement("iframe",{src:a.src,"data-embed-type":a.type,className:"h-full w-full"})))}var sc=({handleCopy:e,handleReplace:t})=>tL.createElement(o_,{as:su,label:"Edit",className:"absolute top-2 right-2 flex h-7 w-7 items-center justify-center rounded-sm bg-coolgray-600/50 text-white outline-none transition hover:bg-coolgray-600/80"},tL.createElement(oD,{label:"Copy link",onClick:e}),tL.createElement(oD,{label:"Transform to plain link",onClick:t}));function su(){return tL.createElement(nP.T,{className:"h-5 w-5","aria-hidden":"true"})}var sd=(e,t,n,r,a)=>{let i=(e+=n)+(t+=r);return t=i/(a+1),[e=i-t,t]},sp=(e,t,n,r,a)=>{let i=(e-=n)+(t+=r);return t=i/(a+1),[e=i-t,t]},sm=(e,t,n,r,a)=>{let i=(e+=n)+(t-=r);return t=i/(a+1),[e=i-t,t]},sf=(e,t,n,r,a)=>{let i=(e-=n)+(t-=r);return t=i/(a+1),[e=i-t,t]},sh=(e,t,n,r,a)=>(t-=r,[e=t*a,t]),sg=(e,t,n,r,a)=>(e+=n,t=e/a,[e,t]),sk=(e,t,n,r,a)=>(t+=r,[e=t*a,t]),sy=(e,t,n,r,a)=>(e-=n,t=e/a,[e,t]);function sb(e,t=100){if("number"==typeof e&&e>0)return e;if("string"==typeof e){let t=Number.parseInt(e);if(t>0)return t}return t}var sw=({defaultSize:e,minSize:t,aspectRatio:n,className:r,onResizeEnd:a,children:i,...l})=>{let[o,s]=(0,tL.useState)(!1),[c,u]=(0,tL.useState)(null),d=t?.width??64,p=t?.height??64,[m,f]=(0,tL.useState)({width:sb(e.width),height:sb(e.height)}),h=(0,tL.useRef)(null);return(0,tL.useEffect)(()=>{if(!o)return;let e=h.current;if(!e)return;let t={width:0,height:0},r={width:e.clientWidth,height:e.clientHeight},i=()=>{let[e,a]=function(e,t,n,r,a,i){var l;switch(i="number"==typeof(l=i=i||t/n)&&Number.isFinite(l)&&l>0?i:1,e){case"bottom-right":return sd(t,n,r,a,i);case"bottom-left":return sp(t,n,r,a,i);case"top-right":return sm(t,n,r,a,i);case"top-left":return sf(t,n,r,a,i);case"top":return sh(t,n,r,a,i);case"right":return sg(t,n,r,a,i);case"bottom":return sk(t,n,r,a,i);case"left":return sy(t,n,r,a,i);default:throw RangeError(`Invalid position: ${e}`)}}("bottom-right",r.width,r.height,t.width,t.height,n);return{width:Math.max(e,d),height:Math.max(a,p)}},l=e=>{t={width:e.clientX-(c?.x||0),height:e.clientY-(c?.y||0)},f(i())},u=()=>{s(!1),a(i())};return document.addEventListener("pointermove",l),document.addEventListener("pointerup",u),()=>{document.removeEventListener("pointermove",l),document.removeEventListener("pointerup",u)}},[o,c?.x,c?.y,a,n,d,p]),tL.createElement("div",{...l,ref:h,style:{width:m.width,aspectRatio:n},className:(0,tC.default)("group relative max-w-full",r),"data-resizing":o?"":void 0},i,tL.createElement(sv,{onPointerDown:()=>s(!0),setStartCoords:u}))};function sv({onPointerDown:e,setStartCoords:t}){return tL.createElement("div",{className:"absolute bottom-1.5 right-1.5 h-6 w-6 rounded-sm bg-gray-800 p-0 text-white opacity-0 transition active:translate-x-0.5 active:translate-y-0.5 group-hover:opacity-50 group-[[data-resizing]]:opacity-80",onPointerDown:n=>{n.preventDefault(),e(),t({x:n.clientX,y:n.clientY})}},tL.createElement(n7.A,{className:"h-full w-full translate-x-0.5 translate-y-0.5 -rotate-45"}))}var sx=(0,tL.createContext)(null);function sE(){let{node:e,selected:t,setAttrs:n}=(0,nz.js)(),[r,a]=(0,tL.useState)(!1),[i,l]=(0,tL.useState)(!1),[o,s]=(0,tL.useState)(!1),[c,u]=(0,tL.useState)(0),[d,p]=(0,tL.useState)(void 0),m=(0,tL.useRef)(null),f=e.attrs,h=(0,tL.useContext)(sx),g=h?.(f.src)||f.src;(0,tL.useEffect)(()=>{let e=i3.get(g);e&&(s(!0),e.then(()=>{s(!1),i3.delete(g)}).catch(e=>{console.error("Failed to upload image:",e),l(!0)}))},[g]);let k=(0,tL.useCallback)(()=>{let e=m.current;if(!e)return;let{naturalWidth:t,naturalHeight:r}=e;t&&r&&(p(t/r),f.width&&f.height||(n({width:t,height:r}),setTimeout(()=>{u(e=>e+1)},0)))},[f,n]),y=(0,tL.useCallback)(()=>{a(!0)},[]),b=(0,tL.useCallback)(()=>{a(!1),u(e=>e+1)},[]),w=(0,tL.useCallback)(e=>{n({width:e.width,height:e.height})},[n]);return tL.createElement(sw,{key:c,defaultSize:{width:f.width,height:f.height},aspectRatio:d,onResizeEnd:w,"data-selected":t?"":void 0,className:"m-0.5 inline-flex rounded-sm outline outline-2 outline-offset-0 outline-transparent data-[selected]:outline-blue-400 [.ProseMirror-selectednode_&]:outline-blue-400"},tL.createElement(sC,{loadingError:r,uploadingError:i,isUploading:o,handleRetry:b,imgRef:m,handleImageLoad:k,handleImageError:y,src:g}))}function sC({loadingError:e,uploadingError:t,isUploading:n,handleRetry:r,imgRef:a,handleImageLoad:i,handleImageError:l,src:o}){return e?tL.createElement(sS,{onRetry:r}):tL.createElement(tL.Fragment,null,tL.createElement("img",{ref:a,src:o,className:"h-full w-full object-contain",onLoad:i,onError:l}),t&&tL.createElement(sN,null),n&&tL.createElement(sL,null))}function sL(){return tL.createElement("div",{className:"absolute left-1.5 bottom-1.5 h-6 w-6 rounded-sm bg-gray-800 p-1 text-white opacity-50"},tL.createElement(n1.o,{className:"h-full w-full animate-spin"}))}function sS({onRetry:e}){return tL.createElement("div",{className:"relative h-full max-h-full w-full max-w-full bg-gray-200 p-1 align-middle text-gray-600 @container dark:bg-gray-700 dark:text-gray-200",onClick:e,onMouseDown:e=>e.preventDefault()},tL.createElement("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3 text-xs"},tL.createElement("div",{className:"h-7 w-7"},tL.createElement(n5.F,null)),tL.createElement("div",{className:"hidden flex-col items-center justify-center gap-1 @[160px]:flex"},tL.createElement("span",null,"Failed to load image"),tL.createElement("span",null,"Tap to retry"))))}function sN(){return tL.createElement("div",{className:"absolute left-0 top-0 h-full max-h-full w-full max-w-full bg-gray-200/70 p-1 align-middle text-gray-600 @container dark:bg-gray-700/70 dark:text-gray-200"},tL.createElement("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3 text-xs",title:"The uploading will be retried automatically after restarting the app"},tL.createElement("div",{className:"h-7 w-7"},tL.createElement(n2.u,null)),tL.createElement("div",{className:"hidden flex-col items-center justify-center gap-1 @[160px]:flex"},tL.createElement("span",null,"Failed to upload image"))))}function sT(){let e=document.createElement("div");return e.classList.add("inline-flex"),e.classList.add("max-w-full"),e}function sM({onFileUrlReplace:e,children:t}){return tL.createElement(sx.Provider,{value:e||null},tL.createElement(nz.cL,null,t))}var sI=e=>((0,tE.Ml)(lQ,{filterTransaction:e.filterTransaction}),null);function sD(e,t,n){return function(e,t,{capture:n=!1,enabled:r=!0,element:a}={}){(0,tL.useEffect)(()=>{if(!r)return;let i=n=>{e(n)&&t(n)},l={capture:n};return a?(a.addEventListener("keydown",i,l),()=>a.removeEventListener("keydown",i,l)):(window.addEventListener("keydown",i,l),()=>window.removeEventListener("keydown",i,l))},[r,n,e,t,a])}((0,tL.useMemo)(()=>(0,nI.Jv)(e),[e]),t,n)}var sA=({isFocused:e,transcriber:t,toggleTranscriptionRef:n})=>t?tL.createElement(s_,{isFocused:e,transcriber:t,toggleTranscriptionRef:n}):null;function s_({isFocused:e,transcriber:t,toggleTranscriptionRef:n}){return!function({isFocused:e,transcriber:t,toggleTranscriptionRef:n}){let r=(0,tL.useRef)(!1),{updateTranscriptionState:a}=(0,tE.xd)(),i=(0,tS.Z)(async()=>{a({type:"starting"}),await t.start(a),a({type:"started"}),r.current=!0}),l=(0,tS.Z)(async()=>{a({type:"stopping"}),await t.stop(),a({type:"stopped"}),r.current=!1}),o=(0,tS.Z)(()=>{r.current?l():i()});(0,tL.useEffect)(()=>{n.current=o},[o,n]);let s=(0,tS.Z)(t=>{!r.current&&e&&(t.preventDefault(),t.stopPropagation(),i())}),c=(0,tS.Z)(e=>{r.current&&(e.preventDefault(),e.stopPropagation(),l())}),u=(0,tS.Z)(e=>{r.current?c(e):s(e)});(0,tL.useEffect)(()=>{let e=e=>{["AltGraph","Alt"].includes(e.key)&&e.preventDefault()};return document.addEventListener("keyup",e,{capture:!0}),()=>document.removeEventListener("keyup",e,{capture:!0})},[]);let d={capture:!0};sD("alt+Space",u,d),sD("Alt",function(e,t=300){let n=(0,tL.useRef)(0);return(0,tS.Z)((...r)=>{let a=performance.now(),i=n.current;if(n.current=a,a-i<=t)return n.current=0,e(...r)})}(u),d),sD("Escape",c,d)}({isFocused:e,transcriber:t,toggleTranscriptionRef:n}),null}var sR=({enabled:e})=>((0,tE.Ml)(o6,{enabled:e}),null),sH=(0,n4.J)(sn({})).schema;function sj(){let[e,t]=(0,tL.useState)(!1),n=(0,tL.useMemo)(()=>(0,n3.Z)(t,500),[]);(0,tL.useEffect)(()=>()=>n.cancel(),[n]);let r=(0,tL.useCallback)(()=>{t(!0),n(!1)},[n]);return(0,nG.xN)("keypress",r),{isTyping:e}}var sO=({spellCheck:e})=>{let{getRootProps:t}=(0,tE.rj)(),n=t(),r=function(e){let{isTyping:t}=sj();return e&&!t}(e);return tL.createElement("div",{className:"reflect-editor",spellCheck:r,autoCapitalize:"off",...n})};function s$(){let{commands:e,view:t}=(0,tE.rj)();return(0,tL.useCallback)(({selected:n,scrollSelectedIntoView:r})=>{if(t.isDestroyed)return;let a=(n=!0)=>{n&&(!0!==n&&e.selectText(n),t.hasFocus()||t.focus(),r&&t.dispatch(t.state.tr.scrollIntoView()))};if(n&&"object"==typeof n){a({anchor:n.anchor||0,head:n.head||0});return}switch(n){case"start":a("start");break;case"end":a("end");break;case"list_start":a(function(e){let t=(0,tB.N2)({node:e,predicate:({node:e})=>e.type.name===tw.l1}).shift();if(t)return t.pos+t.node.nodeSize-2}(t.state.doc)??"end");break;case"list_end":a(aJ(t.state.doc)??"end");break;case"subject_end":a(aU(t.state.doc)??"start");break;case!0:a(!0)}},[e,t])}var sB=({selected:e,scrollSelectedIntoView:t})=>{let n=s$();return(0,tL.useEffect)(()=>{setTimeout(()=>{setTimeout(()=>{n({selected:e,scrollSelectedIntoView:t})})})},[n,t,e]),null},sz=(0,tL.forwardRef)(function({setPrediction:e},t){let n=(0,tE.rj)(),r=s$();return(0,tL.useImperativeHandle)(t,()=>({yjsApplyUpdates:e=>{n.commands.yjsApplyUpdates(e)},getNode:()=>n.getState().doc,uploadImages:e=>{n.commands.uploadImages(e)},getSelectionPositions:()=>{let{anchor:e,head:t}=n.view.state.selection;return{anchor:e,head:t}},getSelectionCoords:()=>{let{view:e}=n;return e.coordsAtPos(e.state.selection.from)},getSelectionText:e=>al(n.view.state.selection.content(),e),getPriorSelectionText:(e,t)=>ao(n.view.state.selection,e,t),focus:(e,t=!1)=>{r({selected:e??!0,scrollSelectedIntoView:t})},focusEnd:()=>{let{view:e}=n,{tr:t}=n.getState(),r=function(e){let t=tz.Bs.atEnd(e),n=aJ(e);return void 0!==n&&0===(0,tB.JO)({doc:e,from:n,to:t.from}).length?tz.Bs.near(e.resolve(n),-1):t}(e.state.doc);t.setSelection(r),t.scrollIntoView(),e.dispatch(t),e.focus()},blur:()=>{n.commands.blur();let e=document.activeElement;e?.blur?.()},insertText:(e,t)=>{n.commands.insertTextAt(e,t)},replaceText:e=>{let{commands:t}=n;t.replaceText({content:e})},insertBacklink:e=>{let{commands:t}=n;t.insertBacklink(e)},turnToBulletList:()=>{let{commands:e}=n;e.wrapInList({kind:"bullet",archived:!1})},turnToTaskList:()=>{let{commands:e}=n;e.wrapInCheckableList()},canIndentListItem:()=>{let{view:e}=n;return(0,tY.RI)()(e.state)},canDedentListItem:()=>{let{view:e}=n;return(0,tY.xH)()(e.state)},indentListItem:()=>{let{view:e}=n;return(0,tY.RI)()(e.state,e.dispatch.bind(e))},dedentListItem:()=>{let{view:e}=n;return(0,tY.xH)()(e.state,e.dispatch.bind(e))},canMoveUpListItem:()=>{let{view:e}=n;return(0,tY.C$)("up")(e.state)},canMoveDownListItem:()=>{let{view:e}=n;return(0,tY.C$)("down")(e.state)},moveUpListItem:()=>{let{view:e}=n;return(0,tY.C$)("up")(e.state,e.dispatch.bind(e))},moveDownListItem:()=>{let{view:e}=n;return(0,tY.C$)("down")(e.state,e.dispatch.bind(e))},search:e=>n.helpers.search(e),stopSearch:()=>n.commands.stopSearch(),togglePrediction:()=>{e(e=>!e)},hasFocus:()=>{let{view:e}=n;return e.hasFocus()},obfuscateCurrentState:()=>{let{view:e}=n;return function(e){try{let t=e.toJSON();return t.doc=iv(t.doc),t.debugInfo={anchor:e.selection.$anchor.toString(),head:e.selection.$head.toString(),nodeSize:e.doc.nodeSize},t}catch(e){console.error("failed to obfuscate state:",e)}return null}(e.state)},getRanges:()=>{let{view:e}=n;return[...e.state.selection.ranges]},getChain:()=>n.chain})),null}),sP=({searchTerm:e})=>(!function(e){let{startSearch:t,stopSearch:n}=(0,tE.xd)();e=e||null,(0,tL.useEffect)(()=>{e?t({searchTerm:e,activeIndex:null}):n()},[e,t,n])}(e),null),sW=class extends tL.Component{constructor(e){super(e),this.state={}}static getDerivedStateFromError(e){if(e instanceof iS)return{error:e};throw e}componentDidCatch(e,t){console.error(`[reflect-editor] catch error: ${e} ${t.componentStack}`)}render(){return this.state.error?tL.createElement(sZ,{error:this.state.error}):this.props.children}},sZ=({error:e})=>tL.createElement(tv.$S,{dark:!0,className:"p-4"},tL.createElement("h1",{className:"mb-4 text-xl"},"Sorry, something went wrong!"),tL.createElement("h2",{className:"text-sm","data-testid":"reflect-editor-error-boundary-message"},e.message)),sV="__create__";function sF(e,t){try{return e.coordsAtPos(t)}catch(e){console.warn(`failed to get corrds from position ${t}:`,e)}return{top:0,left:0,right:0,bottom:0}}function sK(e,t){let n=e.dom;if(t&&n){let e=n.closest(t);if(e)return e}return n}var sq=null;function sY(e){return e&&e.endsWith("px")?Number.parseInt(e,10):0}function sU(){return null===sq&&(sq=function(){let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--reflect-editor-safe-area-inset-top"),n=e.getPropertyValue("--reflect-editor-safe-area-inset-bottom");return{top:sY(t),bottom:sY(n)}}()),sq}function sQ(e){let{x:t,y:n,width:r,height:a}=e.getBoundingClientRect(),i=sU().top,l=e.ownerDocument.body.getBoundingClientRect().height-sU().bottom,o=n<i&&a>i?i-n:0;return n=n+=o,a-=o,o=n+a>l&&n<l?n+a-l:0,{x:t,y:n,width:r,height:a-=o}}function sX(){return(0,tE.rj)().view}function sJ(e,t,n,r,a=120,i=340){let l=sX(),o=sQ(sK(l,r)),{x:s,y:c,strategy:u,update:d,refs:p,middlewareData:m}=(0,nW.YF)({strategy:"fixed",open:e&&t>0,placement:"bottom-start",whileElementsMounted:nV.Me,middleware:[(0,nZ.cv)(10),(0,nV.RR)({fallbackPlacements:["bottom","bottom-end","top-start","top","top-end"],boundary:o}),(0,nV.dp)({apply({availableHeight:e,elements:t}){Object.assign(t.floating.style,{maxHeight:`${(0,t$.Z)(e,a,i)}px`})},boundary:o,padding:10}),(0,nV.uY)({boundary:o,padding:10,mainAxis:!0,crossAxis:!0}),(0,nV.Cp)({strategy:"referenceHidden"})]});return(0,tL.useLayoutEffect)(()=>{e&&t>0?p.setReference({contextElement:l.dom,getBoundingClientRect(){let{top:e,left:n,right:r,bottom:a}=sF(l,t);return{x:n,y:e,top:e,left:n,bottom:a,right:r+2,width:r-n+2,height:a-e}}}):p.setReference(null)},[e,t,l,p,n]),(0,tL.useEffect)(()=>{d()},[n,d]),{ref:p.setFloating,style:{left:s||"",top:c||"",position:u,maxWidth:"calc(100% - 20px)",visibility:m.hide?.referenceHidden?"hidden":"visible"}}}function sG(e,t=rs){let n=(0,tL.useMemo)(()=>[t,e],[t,e]);(0,tE.T6)(ll,"keymap",n)}function s0({direction:e,matchLength:t,previousIndex:n,startNegative:r=!1}){let a=r?-1:0;return"next"===e?n+1>t-1?a:n+1:n-1<a?t-1:n-1}var s1=["Escape","Shift-Tab"],s5=["Enter","Tab"],s2=["Mod-Enter"];function s7(e){let{items:t,direction:n="vertical",isOpen:r,onDismiss:a,onSubmit:i,onModSubmit:l,focusOnClick:o=!0,dismissKeys:s=s1,submitKeys:c=s5,modSubmitKeys:u=s2}=e,d=t.length>0?0:-1,[p,m]=(0,tL.useState)(d),f=(0,tL.useCallback)(()=>m(d),[d]),{focus:h}=(0,tE.xd)(),g="vertical"===n?"ArrowDown":"ArrowRight",k="vertical"===n?"ArrowUp":"ArrowLeft",y=(0,tL.useMemo)(()=>p>-1?[p]:[],[p]),{getMenuProps:b,getItemProps:w,hoveredIndex:v,itemIsSelected:x,indexIsSelected:E,indexIsHovered:C,itemIsHovered:L}=(0,n8.kY)({items:t,isOpen:r,highlightedIndexes:y,type:n8.Dy.ControlledMenu}),S=(0,tS.Z)(()=>!!r&&(0!==p&&m(-1),!0)),N=(0,tS.Z)(()=>!!r&&(p===t.length-1&&m(t.length-1),!0)),T=(0,tS.Z)(()=>!!r&&(m(s0({direction:"next",matchLength:t.length,previousIndex:p,startNegative:!0})),!0)),M=(0,tS.Z)(()=>!!r&&(m(s0({direction:"previous",matchLength:t.length,previousIndex:p,startNegative:!0})),!0)),I=(0,tS.Z)(()=>{let e=t[p]||null;return!!r&&!!e&&i(e,"keyPress")}),D=(0,tS.Z)(()=>{let e=t[p]||null;return!!r&&!!e&&(l?.(e)??!1)}),A=(0,tS.Z)(()=>!!r&&a()),_=(0,tS.Z)(e=>({...w({...e,onClick:t=>{e.onClick?.(t),i(e.item,"click"),o&&h()}})})),R=(0,tL.useMemo)(()=>{let e={};for(let t of c)e[t]=I;return e},[I,c]),H=(0,tL.useMemo)(()=>{let e={};for(let t of u)e[t]=D;return e},[D,u]),j=(0,tL.useMemo)(()=>{let e={};for(let t of s)e[t]=A;return e},[A,s]);return sG((0,tL.useMemo)(()=>{let e={[g]:T,[k]:M,Home:S,[`Cmd-${g}`]:S,End:T,[`Cmd-${k}`]:N};return tB.NZ.isMac&&(e["Ctrl-n"]=T,e["Ctrl-p"]=M),e},[N,S,T,g,M,k])),sG(R),sG(H),sG(j),(0,tL.useMemo)(()=>({getMenuProps:b,getItemProps:_,hoveredIndex:v,indexIsSelected:E,itemIsSelected:x,indexIsHovered:C,itemIsHovered:L,index:p,setIndex:m,resetIndex:f}),[_,b,v,C,E,L,x,p,f])}function s3(e=[]){let[t,n]=(0,tL.useState)(!1);return(0,tL.useEffect)(()=>{let e=()=>{n(!0)},t=()=>{n(!1)};return document.addEventListener("mousemove",e),document.addEventListener("keydown",t,{capture:!0}),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("keydown",t,{capture:!0})}},[]),(0,tL.useEffect)(()=>{n(!1)},e),t}var s4=({text:e,ranges:t})=>{if(!t||0===t.length)return tL.createElement("span",null,e);let n=[],r=[0,...t,e.length];for(let t=0,a=!1;t<r.length-1;t++,a=!a){let i=r[t],l=r[t+1];i<l&&(a?n.push(tL.createElement("strong",{key:t},e.slice(i,l))):n.push(tL.createElement("span",{key:t},e.slice(i,l))))}return tL.createElement(tL.Fragment,null,n)};function s8(e){let[t,n]=(0,tL.useState)({width:0,height:0});return[function(e,t){let n=(0,tL.useRef)(null),r=(0,tL.useRef)({width:0,height:0}),a=n.current;return(0,tL.useEffect)(()=>{if(!a)return;let t=({width:t,height:n})=>{let a={width:t,height:n};(0,nY.Z)(a,r.current)||e?.(a)};if("undefined"==typeof ResizeObserver){t(a.getBoundingClientRect());return}let n=new ResizeObserver(([e])=>{t(e.contentRect)});return n.observe(a),()=>{n.disconnect()}},[a,e,...t??[]]),n}(n,e),t]}var s6=({children:e,active:t=!0,speed:n=20,hoverToPause:r=!0})=>{let[a,i]=s8([t]),[l,o]=s8([t]),s=Math.ceil(o.width-i.width);return tL.createElement("div",{ref:a,className:(0,tC.default)("marquee",t&&"marquee-active",r&&"marquee-hover-pause")},tL.createElement("div",{ref:l,className:"marquee-inner",style:{"--marquee-play":t?"running":"paused","--marquee-duration":`${s/n}s`,"--marquee-offset":`-${s}px`}},e))};function s9(e){let t=(0,tL.useRef)(null);return(0,tL.useEffect)(()=>{if(e){let n=setTimeout(()=>{e&&t.current?.scrollIntoView({block:"nearest",behavior:"smooth"})},0);return()=>clearTimeout(n)}},[e]),t}var ce=({src:e,className:t,children:n})=>{let[r,a]=(0,tL.useState)(!1);if(e){let t=new Image;t.addEventListener("load",()=>a(!0)),t.src=e}return e&&r?tL.createElement("img",{src:e,className:t}):tL.createElement(tL.Fragment,null,n)},ct=({item:e,props:t,query:n,mouseActive:r,selected:a})=>{let i=s9(a),l=e.id===sV,o=rO(n),s=o!==n;return tL.createElement("li",{...t,ref:i,onPointerDown:e=>e.preventDefault(),className:(0,tC.default)(["backlink-picker-item",a&&"backlink-picker-item-highlighted",r&&"hoverable-item group",l?"create-picker-item":"scroll-mb-12"]),title:l?"Create a new backlink":e.label,"data-testid":"backlink-picker-item"},l?tL.createElement("span",{className:"flex w-full items-center justify-between"},tL.createElement("span",null,"Create note: ",tL.createElement("em",null,o)),tL.createElement("kbd",{className:"flex flex-none items-center justify-center rounded-md border px-[6px] py-[1px] font-sans text-xs font-medium opacity-50"},s?"]":"]]")):tL.createElement(tL.Fragment,null,tL.createElement("div",{className:(0,tC.default)(["h-4 w-4 flex-none overflow-hidden rounded-md transition duration-150 ease-in-out",a?"bg-coolgray-300 dark:bg-coolgray-600":"bg-coolgray-200 dark:bg-coolgray-700",r&&"group-hover:bg-coolgray-300 dark:group-hover:bg-coolgray-600"])},e.previewSrc&&tL.createElement(ce,{src:e.previewSrc,className:"h-full w-full"})),tL.createElement("div",{className:"flex flex-1 overflow-hidden"},tL.createElement(s6,{hoverToPause:r,active:a},tL.createElement(s4,{text:e.label,ranges:e.ranges})))))},cn=e=>{let t=function({onBacklinkQuery:e,onBacklinkAdd:t}){let[n,r]=(0,tL.useState)(null),{createBacklink:a}=(0,tE.xd)(),i=(0,tL.useCallback)(async(n,r,i)=>{let l=(await e?.(n)??[]).find(e=>e.label===n)??{label:n};t&&(l=await t(l)),a({range:{from:r,to:i,cursor:i}},l)},[a,e,t]),l=(0,tL.useCallback)(({start:e,end:t,match:n})=>{let a=n[1];if(function(e){for(let t of rH)if(e.endsWith(t+t))return!0;return!1}(a)){let n=rO(a).trim();if(n)return r(null),i(n,e,t),!0}return r({query:a,start:e,end:t}),!0},[i]),o=(0,tL.useCallback)(()=>{r(null)},[]);return(0,tE.zf)(rF,"onBacklinkMatchV2",l),(0,tE.zf)(rF,"onBacklinkDismissV2",o),n}({onBacklinkAdd:e.onAdd??null,onBacklinkQuery:e.onBacklinkQuery??null}),n=null!=t&&e.editorFocused&&!e.isScrolling;return n?tL.createElement(cr,{...e,isOpen:n,query:t?.query??"",start:t?.start??0,end:t?.end??0}):null},cr=({isOpen:e,query:t,start:n,end:r,onAdd:a,onBacklinkQuery:i,viewportSelector:l})=>{let[o,s]=(0,tL.useState)([]),c=(0,tL.useCallback)(async()=>{let e=rO(t.trim()),n=await i?.(e)??[],r=(0,t6.Z)(n,rV),a=e.toLowerCase();a&&(r.some(e=>e.label.toLowerCase().startsWith(a))?r.push({id:sV,label:e}):r.unshift({id:sV,label:e})),s(r)},[i,t]);(0,tL.useLayoutEffect)(()=>{if(!e){s([]);return}c()},[e,c]);let u=sJ(e,n,t,l),d=s3([e,t]),{createBacklink:p,ignoreMatchRulePosition:m}=(0,tE.xd)(),f=(0,tE.Ml)(rF).options.onOpen,h=(0,tL.useCallback)(e=>{if(!e)return!1;let t=e.id===sV&&e.label?{label:e.label,id:""}:e;return new Promise(async e=>{a&&(t=await a(t)),p({range:{from:n,to:r,cursor:r}},t),e(t)})},[p,r,a,n]),{getMenuProps:g,getItemProps:k,indexIsSelected:y,resetIndex:b}=s7({items:o,isOpen:e,onDismiss:(0,tS.Z)(()=>(m(),!0)),onSubmit:(0,tS.Z)(e=>!!h(e)),onModSubmit:(0,tS.Z)(e=>{let t=h(e);return!!t&&(f&&setTimeout(async()=>{f(null,await t,{modKey:!0})}),!0)})});return((0,tL.useEffect)(b,[t,b]),e)?tL.createElement(oI,null,tL.createElement("ul",{...g(),className:"backlink-picker-menu",ref:u.ref,style:{...u.style},"data-testid":"backlink-picker"},o.map((e,n)=>tL.createElement(ct,{key:rV(e),item:e,props:k({item:e,index:n,key:rV(e)}),query:t,mouseActive:d,selected:y(n)})))):null},ca=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M14.25 9.5V7.75C14.25 6.64543 13.3546 5.75 12.25 5.75H7.75C6.64543 5.75 5.75 6.64543 5.75 7.75V12.25C5.75 13.3546 6.64543 14.25 7.75 14.25H9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("rect",{x:"9.75",y:"9.75",width:"8.5",height:"8.5",rx:"2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),ci=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.25 4C8.66421 4 9 4.33579 9 4.75V6.25C9 6.66421 8.66421 7 8.25 7C7.83579 7 7.5 6.66421 7.5 6.25V4.75C7.5 4.33579 7.83579 4 8.25 4ZM11.7093 6.25089C13.3771 4.58304 16.0812 4.58303 17.7491 6.25089C19.417 7.91875 19.417 10.6229 17.7491 12.2907L17.2595 12.7803C16.9666 13.0732 16.4917 13.0732 16.1989 12.7803C15.906 12.4874 15.906 12.0126 16.1989 11.7197L16.6884 11.2301C17.7705 10.148 17.7705 8.39362 16.6884 7.31155C15.6064 6.22948 13.852 6.22948 12.7699 7.31155L12.2803 7.80115C11.9874 8.09404 11.5126 8.09404 11.2197 7.80115C10.9268 7.50825 10.9268 7.03338 11.2197 6.74049L11.7093 6.25089ZM4 8.25C4 7.83579 4.33579 7.5 4.75 7.5H6.25C6.66421 7.5 7 7.83579 7 8.25C7 8.66421 6.66421 9 6.25 9H4.75C4.33579 9 4 8.66421 4 8.25ZM14.7803 9.21967C15.0732 9.51256 15.0732 9.98744 14.7803 10.2803L10.2803 14.7803C9.98744 15.0732 9.51256 15.0732 9.21967 14.7803C8.92678 14.4874 8.92678 14.0126 9.21967 13.7197L13.7197 9.21967C14.0126 8.92678 14.4874 8.92678 14.7803 9.21967ZM7.80115 11.2197C8.09404 11.5126 8.09404 11.9874 7.80115 12.2803L7.31155 12.7699C6.22948 13.852 6.22948 15.6064 7.31155 16.6884C8.39362 17.7705 10.148 17.7705 11.2301 16.6884L11.7197 16.1989C12.0126 15.906 12.4874 15.906 12.7803 16.1989C13.0732 16.4917 13.0732 16.9666 12.7803 17.2595L12.2907 17.7491C10.6229 19.417 7.91875 19.417 6.25089 17.7491C4.58303 16.0812 4.58304 13.3771 6.25089 11.7093L6.74049 11.2197C7.03338 10.9268 7.50825 10.9268 7.80115 11.2197ZM17 15.75C17 15.3358 17.3358 15 17.75 15H19.25C19.6642 15 20 15.3358 20 15.75C20 16.1642 19.6642 16.5 19.25 16.5H17.75C17.3358 16.5 17 16.1642 17 15.75ZM15.75 17C16.1642 17 16.5 17.3358 16.5 17.75V19.25C16.5 19.6642 16.1642 20 15.75 20C15.3358 20 15 19.6642 15 19.25V17.75C15 17.3358 15.3358 17 15.75 17Z",fill:"currentColor"}));function cl(e,t,n){let{enabled:r=!0,ref:a,capture:i,stopPropagation:l}=n??{},o=sX();(0,tL.useEffect)(()=>{if(!r)return;let n={};for(let t of e)n[t]=()=>!0;let s=(0,nT.$)(n),c=e=>{s(o,e)&&(e.preventDefault(),l&&e.stopPropagation(),t(e))};if(!a?.current)return document.addEventListener("keydown",c,i),()=>document.removeEventListener("keydown",c,i);{let e=a.current;return e.addEventListener("keydown",c,i),()=>e.removeEventListener("keydown",c,i)}},[t,r,a,e,o,i,l])}function co(){let[e,t]=(0,tL.useState)(!1),n=(0,tL.useCallback)(()=>{t(!0)},[]),r=(0,tL.useCallback)(()=>{t(!1)},[]);return(0,nG.xN)("mousedown",n),(0,nG.xN)("mouseup",r),e}function cs({isOpen:e,viewportSelector:t,placement:n,alwaysCenter:r,onDismiss:a,enabledDismiss:i,range:l,observeElementResize:o=!1}){let{view:s}=(0,tE.rj)({autoUpdate:!0}),c=sK(s,t),u=sQ(c),d=(0,tL.useMemo)(()=>({x:u.x,y:u.y,width:u.width,height:u.height}),[u.x,u.y,u.width,u.height]);if(i&&!a)throw Error("You must pass onDismiss to make dismiss work");let p=function(e){let t=(0,tL.useRef)(!1);return(0,tL.useEffect)(()=>{setTimeout(()=>{t.current=!0},50)},[]),(0,tL.useMemo)(()=>{if(e)return n=>{t.current&&!n&&e()}},[e])}(a),{x:m,y:f,strategy:h,context:g,refs:k}=(0,nW.YF)({open:e,placement:"viewport-bottom"===n?"bottom":n,middleware:[(0,nZ.cv)(10),(0,nV.RR)({boundary:d,mainAxis:"viewport-bottom"!==n}),(0,nV.uY)({boundary:d,padding:10,mainAxis:!0,crossAxis:!0})],onOpenChange:p,whileElementsMounted:o?cc:void 0}),y=(0,nW.bQ)(g,{enabled:!!(e&&i)}),{getFloatingProps:b}=(0,nW.NI)([y]),w=s.state.selection.head,v=(0,tL.useCallback)(()=>{e?"viewport-bottom"===n?k.setReference(c):k.setReference(function(e,t,n){let r=sF(e,t.anchor),a=sF(e,t.head),i=Math.min(r.left,a.left),l=Math.max(r.right,a.right),o=Math.min(r.top,a.top),s=Math.max(r.bottom,a.bottom);if(n){let t=e.dom.getBoundingClientRect();i=t.left,l=t.right}else if(Math.abs(r.top-a.top)>10){let n=Math.min(t.anchor,t.head),r=Math.max(t.anchor,t.head),a=e.domAtPos(n),o=n===r?a:e.domAtPos(r),s=document.createRange();s.setEnd(o.node,o.offset),s.setStart(a.node,a.offset);let c=s.getBoundingClientRect();c.right-c.left>l-i&&(i=c.left,l=c.right)}return{getBoundingClientRect:()=>({x:i,y:o,top:o,left:i,bottom:s,right:l,width:l-i,height:s-o})}}(s,l||s.state.selection,r)):k.setReference(null)},[r,c,e,n,l,k,s]);return(0,tL.useLayoutEffect)(()=>{v()},[w,v]),!function({enabled:e=!0,node:t,resize:n,scroll:r,update:a}){(0,tL.useEffect)(()=>{if(!e)return;let i=(0,n6.Kx)(t);return i.forEach(e=>{r&&e.addEventListener("scroll",a,{passive:!0}),n&&e.addEventListener("resize",a)}),()=>{i.forEach(e=>{r&&e.removeEventListener("scroll",a),n&&e.removeEventListener("resize",a)})}},[e,t,n,r,a])}({enabled:e,node:s.dom,resize:!0,scroll:!0,update:v}),{getFloatingProps:(0,tL.useCallback)(e=>{let t=m||f,n=null==m||null==f;return b({...e,style:{left:m||"",top:f||"",position:h,maxWidth:"calc(100% - 20px)",opacity:t?1:0,...e?.style},className:(0,tC.default)(e?.className,n?"toolbar-floating-hidden":"toolbar-floating-visible"),ref:k.setFloating})},[b,k.setFloating,h,m,f]),context:g}}var cc=(r={ancestorScroll:!1,ancestorResize:!1,elementResize:!0,animationFrame:!1},(e,t,n)=>(0,nV.Me)(e,t,n,r));function cu(e){return e.$from.sameParent(e.$to)}var cd=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M12.75 18.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M16.75 15.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M11.4369 15.6653C10.4003 16.7018 9.09893 17.4336 7.67475 17.7808L5.75 18.25L6.21921 16.3253C6.56639 14.9011 7.2982 13.5996 8.33474 12.5631M11.4369 15.6653L17.6075 9.49462C18.4642 8.63799 18.4642 7.24911 17.6075 6.39248C16.7509 5.53584 15.362 5.53584 14.5054 6.39248L8.33474 12.5631M11.4369 15.6653L8.33474 12.5631",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cp=({url:e,onLinkMetadata:t})=>{let n=function(e,t){let[n,r]=(0,tL.useState)(null),a=(0,tL.useCallback)(async()=>{if(!e||!t||!/^https?:\/\//i.test(e))return;let n=await t(e);if(!n)return;let{image:a,...i}=n;r(i),a&&(await i2(a),r(e=>e?{...e,image:a}:null))},[t,e]);return(0,tL.useEffect)(()=>{a()},[a]),n}(e,t);return n?.title?tL.createElement("div",{className:"flex flex-col"},tL.createElement("div",{className:"flex flex-col space-y-1 p-2"},tL.createElement("div",{className:"truncate text-xs font-normal text-coolgray-800 dark:text-near-white"},n.title),n.description?tL.createElement("div",{className:"truncate text-xs font-light text-coolgray-800 dark:text-near-white"},n.description):null),n.image?tL.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},tL.createElement("img",{src:n.image,alt:n.title,className:"aspect-[19/10] object-cover"})):null):null},cm=({viewportSelector:e,showLinkMenu:t,onLinkMetadata:n})=>{let[r,a]=function(){let[e,t]=(0,tL.useState)(!1),n=(0,tL.useRef)(null),r=(0,tL.useCallback)(()=>t(!0),[]),a=(0,tL.useCallback)(()=>t(!1),[]);return(0,tL.useEffect)(()=>{let e=n.current;if(e)return e.addEventListener("mouseover",r),e.addEventListener("mouseout",a),()=>{e.removeEventListener("mouseover",r),e.removeEventListener("mouseout",a)}},[a,r]),[n,e]}(),[i,l]=(0,tL.useState)(null),[o,s]=(0,tL.useState)(!1),c=(0,tS.Z)((e,{hovering:t,getMark:n})=>{try{var r;if(!t)return;let a=n(tw.et);if(a&&(r=e.target)&&window.getComputedStyle(r).display.includes("inline")){l({anchor:a.from,head:a.to,href:a.mark.attrs?.href??""}),s(!0);return}s(!1)}catch(e){}});(0,nG.XI)(c);let{isTyping:u}=sj();(0,tL.useEffect)(()=>{u&&s(!1)},[u]);let d=!!i,p=function(e,t,n){let[r,a]=(0,tL.useState)(t);return(0,tL.useEffect)(()=>{let t=setTimeout(()=>{a(e)},500);return()=>clearTimeout(t)},[500,e]),r}(a||o&&d,!1,0)&&d&&!u,{selectText:m}=(0,tE.xd)(),f=(0,tS.Z)(()=>{i&&(m(i),t())}),h=(0,tS.Z)(()=>{let e=i?.href;e&&(oK(e),l(null))});return tL.createElement("div",{ref:r},p?tL.createElement(cf,{viewportSelector:e,handleCopy:h,handleEdit:f,linkRange:i,onLinkMetadata:n}):null)},cf=({viewportSelector:e,handleCopy:t,handleEdit:n,linkRange:r,onLinkMetadata:a})=>{let{getFloatingProps:i}=cs({isOpen:!0,viewportSelector:e,placement:"bottom",alwaysCenter:!1,range:r});return tL.createElement("div",{...i({className:"inline-floating-menu w-[320px]"}),"data-testid":"inline-link-tooltip"},tL.createElement("div",{className:"flex w-full max-w-[400px] flex-col items-stretch divide-y divide-coolgray-900/10 dark:divide-white/20"},tL.createElement("div",{className:"flex items-center divide-x divide-coolgray-900/10 overflow-hidden dark:divide-white/20"},tL.createElement("div",{className:"flex-1 truncate px-3 py-1 text-sm text-coolgray-800 dark:text-near-white"},r?.href),tL.createElement("button",{className:"inline-flex h-8 w-10 shrink-0 cursor-pointer items-center justify-center bg-white text-2xs text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:t,title:"Copy link address"},tL.createElement(ca,null)),tL.createElement("button",{className:"inline-flex h-8 w-10 shrink-0 cursor-pointer items-center justify-center bg-white text-2xs text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:n,title:"Edit link"},tL.createElement(cd,null))),tL.createElement(cp,{url:r?.href,onLinkMetadata:a})))},ch=({isScrolling:e,viewportSelector:t,editingLink:n,setEditingLink:r,onLinkMetadata:a})=>{let{view:i}=(0,tE.rj)({autoUpdate:!0}),{selection:l}=i.state,o=l.empty,s=(0,tL.useCallback)(()=>{r(!0)},[r]),c=co(),u=cu(l),d=n&&!i.isDestroyed&&!e&&!c&&u,p=(0,tL.useRef)(null);!function(e,t,n){let r=(0,tE.rY)(),a=(0,tS.Z)(()=>{if(e)return t(!1),r.focus(),!0;let{selection:n}=r.state;return!!(0,tB.hT)(n)&&!n.empty&&(t(!0),!0)});cl(["mod-k"],(0,tS.Z)(e=>{a()&&(e.preventDefault(),e.stopPropagation())}),{ref:n,capture:!0}),(0,nG.og)("mod-k",a)}(n,r,p);let m=tE.l1().link()?.href??"",f=!!m.trim();return(0,tL.useEffect)(()=>{o&&!f&&r(!1)},[o,r,f]),tL.createElement(oI,null,d?tL.createElement(cg,{setEditingLink:r,view:i,selection:l,viewportSelector:t,editingLink:n,inputRef:p,url:m}):tL.createElement(cm,{viewportSelector:t,showLinkMenu:s,onLinkMetadata:a}))},cg=({setEditingLink:e,view:t,selection:n,viewportSelector:r,editingLink:a,inputRef:i,url:l})=>{let[o,s]=(0,tL.useState)(l),c=!!l.trim();(0,tL.useEffect)(()=>{s(l)},[l]);let u=n.empty,d=(0,tE.wK)(),p=(0,tS.Z)(e=>{s(e.target.value)}),m=(0,tS.Z)(t=>{if(e(!1),""===o)d.removeLink();else{let e=a$(o.trim()),t=u?(0,tB.IH)(n.$from,"link"):n;d.updateLink({href:e,auto:!1},t)}d.focus().run(),t.preventDefault()}),f=(0,tS.Z)(()=>{e(!1),d.removeLink().focus().run()}),h=(0,tS.Z)(()=>{oK(o)}),{getFloatingProps:g}=cs({isOpen:!0,viewportSelector:r,placement:"bottom",alwaysCenter:!1,onDismiss:(0,tS.Z)(()=>{e(!1),t.focus()}),enabledDismiss:!0});return(0,tL.useEffect)(()=>{if(a){let e=setTimeout(()=>{i.current?.focus()},0);return()=>clearTimeout(e)}},[a,i]),tL.createElement("div",{...g({className:(0,tC.default)("inline-floating-menu")}),"data-testid":"inline-link-menu"},tL.createElement("div",{className:"flex w-[300px] flex-col divide-y divide-coolgray-900/10 dark:divide-white/20"},tL.createElement("form",{onSubmit:m,className:"p-2"},tL.createElement("input",{ref:i,type:"text",placeholder:"Paste link",value:o,onChange:p,className:"inline-floating-menu-input"})),c?tL.createElement("button",{className:"inline-flex cursor-pointer items-center space-x-1.5 bg-white py-1 px-2 text-2xs font-medium text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:h},tL.createElement(ca,{className:"text-coolgray-500"}),tL.createElement("span",null,"Copy link")):null,c?tL.createElement("button",{className:"inline-flex cursor-pointer items-center space-x-1.5 bg-white py-1 px-2 text-2xs font-medium text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:f},tL.createElement(ci,{className:"text-coolgray-500"}),tL.createElement("span",null,"Remove link")):null))},ck=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M9.75 13C14 13 14 7.75 14 7.75C14 7.75 14 13 18.25 13C14 13 14 18.25 14 18.25C14 18.25 14 13 9.75 13Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M7.75 16.25H7.76",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M18.25 5.75H18.26",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M18.25 18.25H18.26",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M5.75 8C8 8 8 5.75 8 5.75C8 5.75 8 8 10.25 8C8 8 8 10.25 8 10.25C8 10.25 8 8 5.75 8Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cy=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M10 18C8.89543 18 8 17.1046 8 16V8C8 6.89543 8.89543 6 10 6H12.4114C13.2219 6 13.898 6.13086 14.4396 6.39258C14.9811 6.6543 15.3882 7.01758 15.6608 7.48242C15.9333 7.94336 16.0696 8.47461 16.0696 9.07617C16.0696 9.54492 15.9835 9.95703 15.8114 10.3125C15.6392 10.6641 15.4025 10.9531 15.1013 11.1797C14.8036 11.4023 14.4629 11.5605 14.0791 11.6543V11.7715C14.4987 11.791 14.8915 11.9199 15.2573 12.1582C15.6267 12.3965 15.9262 12.7305 16.1557 13.1602C16.3852 13.5859 16.5 14.0938 16.5 14.6836C16.5 15.3203 16.3547 15.8887 16.0642 16.3887C15.7773 16.8848 15.3523 17.2773 14.7892 17.5664C14.2262 17.8555 13.3916 18 12.5667 18H10ZM10 15.9258H12.3832C13.0324 15.9258 13.5058 15.791 13.8035 15.5215C14.1012 15.248 14.25 14.8848 14.25 14.4316C14.25 14.0996 14.1765 13.8066 14.0294 13.5527C13.8824 13.2988 13.6726 13.0996 13.4 12.9551C13.131 12.8105 12.81 12.7383 12.437 12.7383H10V15.9258ZM10 11.0215H12.2111C12.5303 11.0215 12.8136 10.9609 13.0611 10.8398C13.3121 10.7148 13.5094 10.5391 13.6528 10.3125C13.7999 10.0859 13.8734 9.81445 13.8734 9.49805C13.8734 9.06445 13.7318 8.71484 13.4484 8.44922C13.1687 8.18359 12.7706 8.05078 12.2541 8.05078H10V11.0215Z",fill:"currentColor"})),cb=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M5.75 16.25V15.75C5.75 15.1977 6.19772 14.75 6.75 14.75H7.25C7.80228 14.75 8.25 15.1977 8.25 15.75V16.25C8.25 16.8023 7.80228 17.25 7.25 17.25H6.75C6.19772 17.25 5.75 16.8023 5.75 16.25Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M5.75 8.25V7.75C5.75 7.19772 6.19772 6.75 6.75 6.75H7.25C7.80228 6.75 8.25 7.19772 8.25 7.75V8.25C8.25 8.80228 7.80228 9.25 7.25 9.25H6.75C6.19772 9.25 5.75 8.80228 5.75 8.25Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M12.75 7.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M12.75 16.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cw=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M5.75 7.75V12.25M5.75 16.25V12.25M11.25 7.75V12.25M11.25 16.25V12.25M5.75 12.25H11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M18.25 16.25H14.75V16.1221C14.75 15.566 14.9816 15.035 15.3891 14.6566L17.3155 12.8677C17.9114 12.3144 18.25 11.538 18.25 10.7248V10.7248C18.25 10.1864 17.8136 9.75 17.2752 9.75H15.75C15.1977 9.75 14.75 10.1977 14.75 10.75V11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cv=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M5.75 7.75V12.25M5.75 16.25V12.25M11.25 7.75V12.25M11.25 16.25V12.25M5.75 12.25H11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M14.75 9.75H17.25C17.8023 9.75 18.25 10.1977 18.25 10.75V13M14.75 13H18.25M18.25 13V15.25C18.25 15.8023 17.8023 16.25 17.25 16.25H14.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cx=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M13.25 6.75L10.75 17.25M13.25 6.75H10.75M13.25 6.75H15.25M10.75 17.25H8.75M10.75 17.25H13.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cE=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7093 6.25089C13.3771 4.58304 16.0812 4.58303 17.7491 6.25089C19.417 7.91875 19.417 10.6229 17.7491 12.2907L16.2595 13.7803C15.9666 14.0732 15.4917 14.0732 15.1989 13.7803C14.906 13.4874 14.906 13.0126 15.1989 12.7197L16.6884 11.2301C17.7705 10.148 17.7705 8.39362 16.6884 7.31155C15.6064 6.22948 13.852 6.22948 12.7699 7.31155L11.2803 8.80115C10.9874 9.09404 10.5126 9.09404 10.2197 8.80115C9.92678 8.50825 9.92678 8.03338 10.2197 7.74049L11.7093 6.25089ZM14.7803 9.21967C15.0732 9.51256 15.0732 9.98744 14.7803 10.2803L10.2803 14.7803C9.98744 15.0732 9.51256 15.0732 9.21967 14.7803C8.92678 14.4874 8.92678 14.0126 9.21967 13.7197L13.7197 9.21967C14.0126 8.92678 14.4874 8.92678 14.7803 9.21967ZM8.80115 10.2197C9.09404 10.5126 9.09404 10.9874 8.80115 11.2803L7.31155 12.7699C6.22948 13.852 6.22948 15.6064 7.31155 16.6884C8.39362 17.7705 10.148 17.7705 11.2301 16.6884L12.7197 15.1989C13.0126 14.906 13.4874 14.906 13.7803 15.1989C14.0732 15.4917 14.0732 15.9666 13.7803 16.2595L12.2907 17.7491C10.6229 19.417 7.91875 19.417 6.25089 17.7491C4.58303 16.0812 4.58304 13.3771 6.25089 11.7093L7.74049 10.2197C8.03338 9.92678 8.50825 9.92678 8.80115 10.2197Z",fill:"currentColor"})),cC=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M5.75 7.65909L7.18182 9.25C7.81818 6.54545 9.25 5.75 9.25 5.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M5.75 16.6591L7.18182 18.25C7.81818 15.5455 9.25 14.75 9.25 14.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M12.75 7.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M12.75 16.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cL=({viewportSelector:e,setEditingLink:t,setPrediction:n,predictionEnabled:r})=>{let{getFloatingProps:a}=cs({isOpen:function(e,t){let[n,r]=(0,tL.useState)(!1);return(0,tL.useEffect)(()=>{if(e){let e=setTimeout(()=>{r(!0)},150);return()=>clearTimeout(e)}r(!1)},[e,150]),!!e&&n}(!0,0),viewportSelector:e,placement:"top",alwaysCenter:!1}),i=function({setEditingLink:e,setPrediction:t,predictionEnabled:n}){let r=(0,tE.xd)(),a=(0,tE.tZ)(!0),i=(0,tE.sZ)().selection,l={bold:a.bold(),italic:a.italic(),link:a.link(),taskList:a.list({kind:"task"}),bulletList:a.list({kind:"bullet"}),h2:a.heading({level:2}),h3:a.heading({level:3}),heading:a.heading()},o={bold:r.toggleBold.enabled(),italic:r.toggleItalic.enabled(),link:cu(i),taskList:!l.heading,bulletList:!l.heading,h2:r.toggleHeading.enabled({level:2}),h3:r.toggleHeading.enabled({level:3})};return(0,tL.useMemo)(()=>{let a={width:23,height:23};return[{id:"bold",label:"Bold",icon:tL.createElement(cy,{...a}),active:l.bold,available:o.bold,submit:()=>r.toggleBold()},{id:"italic",label:"Italic",icon:tL.createElement(cx,{...a}),active:l.italic,available:o.italic,submit:()=>r.toggleItalic()},{id:"todo",label:"Todo List",icon:tL.createElement(cC,{...a}),active:l.taskList,available:o.taskList,submit:()=>{let e={kind:"task",archived:!1};return l.taskList?r.toggleWrappingNode(tw.WQ,e):r.wrapInList(e)}},{id:"list",label:"Bullet List",icon:tL.createElement(cb,{...a}),active:l.bulletList,available:o.bulletList,submit:()=>{let e={kind:"bullet",archived:!1};return l.bulletList?r.toggleWrappingNode(tw.WQ,e):r.wrapInList(e)}},{id:"h2",label:"Big header",icon:tL.createElement(cw,{...a}),active:l.h2,available:o.h2,submit:()=>r.toggleHeading({level:2})},{id:"h3",label:"Small header",icon:tL.createElement(cv,{...a}),active:l.h3,available:o.h3,submit:()=>r.toggleHeading({level:3})},{id:"link",label:"Link",icon:tL.createElement(cE,{...a}),active:l.link,available:o.link,submit:()=>e(!0)},{id:"edit-with-ai",label:"Edit with AI",icon:tL.createElement(ck,{...a}),active:!1,available:n,submit:()=>t(!0)}]},[l.bold,l.bulletList,l.h2,l.h3,l.italic,l.link,l.taskList,o.bold,o.bulletList,o.h2,o.h3,o.italic,o.link,o.taskList,r,n,e,t])}({setEditingLink:t,setPrediction:n,predictionEnabled:r});return tL.createElement("ul",{...a({className:"inline-floating-menu"}),"data-testid":"inline-toolbar-menu"},i.filter(e=>e.available).map(e=>tL.createElement("li",{key:e.id,className:(0,tC.default)("inline-floating-menu-item",e.active&&"inline-floating-menu-item-active"),onPointerDown:t=>{t.preventDefault(),e.submit()},title:e.label,"data-testid":`inline-toolbar-menu-item-${e.id}`},e.icon)))},cS=({editorFocused:e,isScrolling:t,subjectRequired:n,viewportSelector:r,setEditingLink:a,setPrediction:i,predictionEnabled:l})=>{let{view:o}=(0,tE.rj)({autoUpdate:!0}),{selection:s}=o.state,c=co(),u=!!n&&s.from<=aU(o.state.doc),d=e&&!o.isDestroyed&&!t&&!c&&!s.empty&&!u&&(0,tB.hT)(s);return tL.createElement(oI,null,d?tL.createElement(cL,{viewportSelector:r,setEditingLink:a,setPrediction:i,predictionEnabled:l}):null)};function cN(e){let[t,n]=(0,tL.useState)(!1);return(0,tL.useEffect)(()=>{let t=e?.current,r=(0,n3.Z)(()=>{n(!1)},250),a=()=>{n(!0),r()};return t?.addEventListener("scroll",a),()=>{t?.removeEventListener("scroll",a)}},[e]),t}function cT(e){let{items:t,query:n,maxItems:r,sortByExactMatch:a}=e;if(!n)return t.slice(0,r);let i=(0,tv.l9)(n).toLowerCase(),l=[];for(let e of t){let t=(0,tv.l9)(e.label).toLowerCase();if(t.includes(i)){let n=t===i?1:0;l.push([e,n])}}return a&&(l=l.sort(([,e],[,t])=>t-e)),(l=(l=(0,t6.Z)(l,([e])=>e.id)).slice(0,r)).map(([e])=>e)}function cM({selected:e,item:t,mouseActive:n,...r}){let a=s9(e);return tL.createElement("li",{onPointerDown:e=>e.preventDefault(),className:(0,tC.default)("slash-picker-item",e&&"slash-picker-item-highlighted",n&&"hoverable-item"),title:t.displayLabel,"data-testid":`slash-picker-item-${t.id}`,ref:a,...r},tL.createElement("div",{className:"slash-picker-item-icon"},t.icon),tL.createElement("div",{className:"slash-picker-item-label"},t.displayLabel))}var cI=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M9.25 5.75H6.75C6.19772 5.75 5.75 6.19772 5.75 6.75V17.25C5.75 17.8023 6.19772 18.25 6.75 18.25H9.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M14.75 5.75H17.25C17.8023 5.75 18.25 6.19772 18.25 6.75V17.25C18.25 17.8023 17.8023 18.25 17.25 18.25H14.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cD=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 6.5C8.96243 6.5 6.5 8.96243 6.5 12C6.5 15.0376 8.96243 17.5 12 17.5C15.0376 17.5 17.5 15.0376 17.5 12C17.5 8.96243 15.0376 6.5 12 6.5ZM5 12C5 8.13401 8.13401 5 12 5C15.866 5 19 8.13401 19 12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12Z",fill:"currentColor"}),tL.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 8C12.4142 8 12.75 8.33579 12.75 8.75V11.6893L13.7803 12.7197C14.0732 13.0126 14.0732 13.4874 13.7803 13.7803C13.4874 14.0732 13.0126 14.0732 12.7197 13.7803L11.4697 12.5303C11.329 12.3897 11.25 12.1989 11.25 12V8.75C11.25 8.33579 11.5858 8 12 8Z",fill:"currentColor"})),cA=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M5.75 7.75V12.25M5.75 16.25V12.25M11.25 7.75V12.25M11.25 16.25V12.25M5.75 12.25H11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M14.75 11.25L16.25 9.75V16.25M16.25 16.25H14.75M16.25 16.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),c_=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M12.75 7.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M12.75 16.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M6.75 6.875L7.75 5.75V9.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M6.75 14.75H8.27841C8.68509 14.75 8.92165 15.2097 8.68527 15.5406L7.31473 17.4594C7.07835 17.7903 7.31491 18.25 7.72159 18.25H9.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cR=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M6.75 14.5V11.75C6.75 11.75 6.75 12.75 8 12.75H8.5C9.4665 12.75 10.25 13.5335 10.25 14.5C10.25 15.4665 9.4665 16.25 8.5 16.25C7.5335 16.25 6.75 15.4665 6.75 14.5Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M13.75 14.5V11.75C13.75 11.75 13.75 12.75 15 12.75H15.5C16.4665 12.75 17.25 13.5335 17.25 14.5C17.25 15.4665 16.4665 16.25 15.5 16.25C14.5335 16.25 13.75 15.4665 13.75 14.5Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M6.75 11.75V11.75C6.75 10.0931 8.09315 8.75 9.75 8.75H10.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M13.75 11.75V11.75C13.75 10.0931 15.0931 8.75 16.75 8.75H17.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cH=e=>tL.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},tL.createElement("path",{d:"M5.75 9.25V7.75C5.75 6.64543 6.64543 5.75 7.75 5.75H16.25C17.3546 5.75 18.25 6.64543 18.25 7.75V9.25M5.75 9.25V16.25C5.75 17.3546 6.64543 18.25 7.75 18.25H11.25M5.75 9.25H18.25M18.25 9.25V11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),tL.createElement("path",{d:"M14.75 17C17 17 17 14.75 17 14.75C17 14.75 17 17 19.25 17C17 17 17 19.25 17 19.25C17 19.25 17 17 14.75 17Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),cj=({scrollingNode:e,editorFocused:t,viewportSelector:n,templates:r,timeFormat:a,transcriptionEnabled:i,toggleTranscriptionRef:l,predictionEnabled:o,setPrediction:s})=>{let{state:c,getMenuProps:u,getItemProps:d,indexIsSelected:p,query:m,filteredItems:f}=function(e){let{items:t,ignoreMatchesOnDismiss:n=!0,direction:r,dismissKeys:a,focusOnClick:i,submitKeys:l}=e,[o,s]=(0,tL.useState)(null),c=(0,tE.z8)(),u=o?.query?.partial?.trim()?.toLowerCase()??null,d=(0,tL.useMemo)(()=>null==u?[]:cT({items:t,query:u,maxItems:t.length}),[t,u]),p=!!o&&d.length>0,{delete:m}=(0,tE.xd)(),f=s7({items:d,isOpen:p,onDismiss:(0,tL.useCallback)(()=>{if(!o)return!1;let{range:e,name:t}=o;return n&&c.getSuggestMethods().addIgnored({from:e.from,name:t,specific:!0}),s(null),!0},[c,n,o]),onSubmit:(0,tL.useCallback)(e=>!!o&&(m({from:o.range.from,to:o.range.cursor}),e.submit(),s(null),!0),[m,o]),direction:r,dismissKeys:a,focusOnClick:i,submitKeys:l}),{resetIndex:h}=f,g=(0,tS.Z)(e=>{let{query:t,range:n,name:r,exitReason:a,changeReason:i,text:l}=e;if(a||t.partial.endsWith(" ")&&(0,t4.Z)(t.partial)){s(null);return}i&&(i!==tK.$Y.Move&&h(),s({query:t,range:n,name:r,reason:i,text:l}))});return(0,tE.zf)(lV,"onSlashChange",g),(0,tL.useMemo)(()=>({...f,state:o,query:u,filteredItems:d}),[f,u,o,d])}({ignoreMatchesOnDismiss:void 0,direction:void 0,items:function({templates:e,timeFormat:t,transcriptionEnabled:n,toggleTranscriptionRef:r,predictionEnabled:a,setPrediction:i}){let{commands:l}=(0,tE.rj)(),o={heading:(0,tE.tZ)(!0).heading()},s={h1:l.setHeading.enabled({level:1}),h2:l.setHeading.enabled({level:2}),h3:l.setHeading.enabled({level:3}),task:l.wrapInList.enabled({kind:"task",archived:!1})&&!o.heading,checklist:l.wrapInList.enabled({kind:"checklist",archived:!1})&&!o.heading,bullet:l.wrapInList.enabled({kind:"bullet",archived:!1})&&!o.heading,ordered:l.wrapInList.enabled({kind:"ordered",archived:!1})&&!o.heading,blockquote:l.wrapInBlockquote.enabled()},c=(0,tL.useMemo)(()=>[{id:"transcribe",label:"transcribe transcription speech audio",displayLabel:"Transcribe",available:n,icon:tL.createElement("div",{className:"h-[24px] w-[24px] p-[4px]"},tL.createElement("span",{className:"i-ri-mic-line h-full w-full"})),submit:()=>(r.current?.(),!0)},{id:"h1",label:"heading1 heading 1 h1 head1",displayLabel:"Heading 1",available:s.h1,icon:tL.createElement(cA,null),submit:()=>l.setHeading({level:1})},{id:"h2",label:"heading2 heading 2 h2 head2",displayLabel:"Heading 2",available:s.h2,icon:tL.createElement(cw,null),submit:()=>l.setHeading({level:2})},{id:"h3",label:"heading3 heading 3 h3 head3",displayLabel:"Heading 3",available:s.h3,icon:tL.createElement(cv,null),submit:()=>l.setHeading({level:3})},{id:"task",label:"To-do list todo list task list",displayLabel:"Task",available:s.task,icon:tL.createElement(cC,null),submit:()=>l.wrapInList({kind:"task",archived:!1})},{id:"bullet",label:"bulleted list bullet list",displayLabel:"Bulleted list",available:s.bullet,icon:tL.createElement(cb,null),submit:()=>l.wrapInList({kind:"bullet",archived:!1})},{id:"ordered",label:"ordered list order list number list numbered list",displayLabel:"Ordered list",available:s.ordered,icon:tL.createElement(c_,null),submit:()=>l.wrapInList({kind:"ordered",archived:!1})},{id:"checklist",label:"check checklist list",displayLabel:"Checklist",available:s.checklist,icon:tL.createElement(cC,null),submit:()=>l.wrapInList({kind:"checklist",archived:!1})},{id:"quote",label:"quote block quoteblock quote-block",displayLabel:"Quote",available:s.blockquote,icon:tL.createElement(cR,null),submit:()=>{l.wrapInBlockquote()}},{id:"backlink",label:"backlink",displayLabel:"Backlink",available:!0,icon:tL.createElement(cI,null),submit:()=>l.insertText("[[")},{id:"ai-palette",label:"AI Assistant Palette AIAssistant AIPalette GTP3 GTP-3 prediction",displayLabel:"AI Palette",available:a,icon:tL.createElement(ck,null),submit:()=>{i(!0)}},{id:"now",label:"now time",displayLabel:"Now",available:!0,icon:tL.createElement(cD,null),submit:()=>{var e;return l.insertText((e=new Date,"12"===t?function(e){let t=e.getHours(),n=e.getMinutes(),r=t>=12?"pm":"am";t%=12;let a=(t=t||12).toString(),i=n.toString().padStart(2,"0");return`${a}:${i}${r}`}(e):function(e){let t=e.getHours(),n=e.getMinutes(),r=t.toString().padStart(2,"0"),a=n.toString().padStart(2,"0");return`${r}:${a}`}(e)))}}].filter(e=>e.available),[s.h1,s.h2,s.h3,s.task,s.bullet,s.ordered,s.blockquote,s.checklist,n,r,a,l,i,t]),u=(0,tL.useMemo)(()=>e.map(e=>({id:`template-${e.id}`,label:`template${e.name}`,displayLabel:`${e.name}`,available:!0,icon:tL.createElement(cH,null),submit:()=>l.insertContentTemplate(e)})),[l,e]);return(0,tL.useMemo)(()=>[...c,...u],[c,u])}({templates:r,timeFormat:a,transcriptionEnabled:i,toggleTranscriptionRef:l,predictionEnabled:o,setPrediction:s})}),h=cN(e),g=!!c&&t&&!h&&f.length>0,k=sJ(g,c?.range.from??0,m,n),y=s3([g,m]);return g?tL.createElement(oI,null,tL.createElement("ul",{...u(),className:"slash-picker-menu",ref:k.ref,style:{...k.style},"data-testid":"slash-picker-menu"},f.map((e,t)=>tL.createElement(cM,{key:e.id,...{...d({item:e,index:t,key:e.id}),ref:void 0},item:e,mouseActive:y,selected:p(t)})))):null},cO=e=>{let{mergeNoteGenerator:t,onMergeNote:n,viewportSelector:r}=e,[a,i]=(0,tL.useState)({isActive:!1,position:void 0,value:void 0}),[l,o]=(0,tL.useState)(!1),[s,c]=(0,tL.useState)([]);(0,tE.zf)(lK,"onSubjectChange",(0,tS.Z)((e,t,n)=>{setTimeout(()=>{i({isActive:t,position:e,value:n})},0)})),(0,tL.useEffect)(()=>{let e=!1;return t&&Promise.resolve(t(a.value)).then(t=>{e||c(t)}).catch(e=>{throw e}),()=>{e=!0}},[t,a.value]);let u=(0,tL.useMemo)(()=>a.isActive&&!l&&s.length>0,[a,l,s]),d=(0,tL.useCallback)(()=>!!u&&(o(!0),!0),[u]),p=(0,tL.useCallback)(e=>!!u&&(n?.(e),!1),[u,n]),m=u&&void 0!==a.position,f=s3([m]),{getMenuProps:h,getItemProps:g,indexIsSelected:k}=s7({items:s,isOpen:m,onDismiss:d,onSubmit:p,direction:void 0,dismissKeys:void 0,focusOnClick:void 0,submitKeys:void 0}),y=sJ(m,a.position??0,a.value,r);return m?tL.createElement("ul",{...h(),className:"subject-merge-menu",ref:y.ref,style:{...y.style}},s.map((e,t)=>tL.createElement("li",{key:e.id,...g({item:e,index:t,key:e.id}),className:(0,tC.default)(["flex cursor-pointer items-center px-2 py-1 text-2xs leading-6 transition duration-150 ease-in-out",k(t)?"bg-coolgray-100 text-coolgray-900 dark:bg-white/10 dark:text-white":"bg-white text-coolgray-700 dark:bg-app-dark-tint dark:text-coolgray-300",f&&"hover:bg-coolgray-100 hover:text-coolgray-900 dark:hover:bg-white/10 dark:hover:text-white"])},"Merge note with ","'"+e.label+"'","?"))):null},c$="__create__",cB=({item:e,props:t,query:n,mouseActive:r,selected:a})=>{let i=s9(a),l=e.id===c$;return tL.createElement("li",{...t,ref:i,onPointerDown:e=>e.preventDefault(),className:(0,tC.default)(["tag-picker-item",a&&"tag-picker-item-highlighted",r&&"hoverable-item",l?"create-picker-item":"scroll-mb-12"]),"data-testid":"tag-picker-item"},l?tL.createElement("span",null,"Create new tag: #",n):tL.createElement("span",null,"#",e.label))},cz=({onAdd:e,onTagQuery:t,query:n,start:r,end:a,viewportSelector:i,isOpen:l})=>{let o=(0,tL.useMemo)(()=>{if(!l)return[];let e=n.trim(),r=t?.(e)??[];return e&&!r.some(t=>t.label===e)&&r.push({id:c$,label:e}),r},[l,t,n]),s=sJ(l,r,n,i),c=s3([l,n]),{createTag:u,ignoreMatchRulePosition:d}=(0,tE.xd)(),{getMenuProps:p,getItemProps:m,indexIsSelected:f,resetIndex:h}=s7({items:o,isOpen:l,onDismiss:(0,tS.Z)(()=>(d(),!0)),onSubmit:(0,tS.Z)(t=>{if(!t)return!1;let n=t.id===c$&&t.label?{label:t.label,id:""}:t;return e&&(n=e(n)),u({name:"tag",range:{from:r,to:a,cursor:a}},n),!0})});return((0,tL.useEffect)(h,[n,h]),l)?tL.createElement(oI,null,tL.createElement("ul",{...p,className:"tag-picker-menu",ref:s.ref,style:s.style},o.map((e,t)=>tL.createElement(cB,{key:e.id,item:e,props:m({item:e,index:t,key:e.id}),query:n,mouseActive:c,selected:f(t)})))):null},cP=({onAdd:e,onTagQuery:t,editorFocused:n,isScrolling:r,viewportSelector:a})=>{let i=function(){let[e,t]=(0,tL.useState)(null),n=(0,tL.useCallback)(e=>(t({query:e.match[1],start:e.start,end:e.end}),!0),[]),r=(0,tL.useCallback)(()=>{t(null)},[]);return(0,tE.zf)(lq,"onTagMatchV2",n),(0,tE.zf)(lq,"onTagDismissV2",r),e}(),l=null!=i&&n&&!r;return l?tL.createElement(cz,{query:i?.query??"",start:i?.start??0,end:i?.end??0,onTagQuery:t,onAdd:e,viewportSelector:a,isOpen:l}):null};function cW(e){return tL.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",...e},tL.createElement("path",{fill:"currentColor",d:"M8.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm0 6.5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0ZM15.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0Zm-1.5 8a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Z"}))}var cZ=()=>{let[e,t]=(0,tL.useState)(null);(0,tE.T6)(iq,"draggable",t);let{isTyping:n}=sj(),r=function(e){let t=(0,tL.useRef)(e);return(0,tL.useEffect)(()=>{e&&(t.current=e)},[e]),e||t.current}(e);if(!r)return null;let a=r.left-28,i=r.lineHeight?(r.lineHeight-24)/2:0,l=r.top+i,o=!!e&&!n&&r.clientX<=r.left+48;return tL.createElement(cV,{show:o,left:a,top:l,pos:r.pos,element:r.element})},cV=({show:e,left:t,top:n,pos:r,element:a})=>{let i=sX(),l=(0,tL.useMemo)(()=>ic(i.state.schema),[i.state.schema]),o=(0,tL.useRef)(null),s=(0,tL.useCallback)(e=>{let t=i.state.tr;if(r>t.doc.content.size)return;let n=iW(t.doc.resolve(r));n&&(t.setSelection(n),i.dispatch(t),o.current=n.node,setTimeout(()=>{i.focus()},0))},[r,i]),c=(0,tL.useCallback)(e=>{let t=o.current;if(!t)return;o.current=null;let n=l.serializeNode(t).innerHTML;e.dataTransfer.clearData(),e.dataTransfer.setData("text/html",n),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage(a,0,0),i.dragging={slice:new tU.p2(tU.HY.from(t),0,0),move:!0},iz=i},[l,a,i]);return tL.createElement(nF.u,{show:e,enter:"transition-opacity duration-100",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0"},tL.createElement("div",{className:(0,tC.default)("absolute top-0 left-0 flex h-[24px] w-[24px] cursor-grab flex-row-reverse items-center justify-center transition-transform"),style:{transform:`translateX(${t}px) translateY(${n}px)`},draggable:"true","data-testid":"drag-indicator",onDragStart:c,onMouseDown:s},tL.createElement(cW,{width:"22px",height:"22px",className:"text-gray-300 dark:text-gray-700"})))},cF=({offline:e,getOfflineStatus:t})=>{let[n,r]=(0,tL.useState)(!1),a=sX(),i=e?t():null,l=!!i?.since,{refs:o,x:s,y:c,strategy:u,context:d}=(0,nW.YF)({open:n,onOpenChange:r,middleware:[(0,nZ.cv)(10)],whileElementsMounted:nV.Me});return((0,nW.XI)(d),(0,tL.useEffect)(()=>{!function(e,t){e.dispatch(e.state.tr.setMeta("REFLECT_OFFLINE_STATUS",t))}(a,l);let e=setTimeout(()=>{let e=a.dom.querySelector("span[data-offline-status-indicator]");o.setReference(e)},10);return()=>clearTimeout(e)},[a,o,l]),n&&i?.since)?tL.createElement("div",{ref:o.setFloating,style:{left:s??0,top:c??0,position:u},className:"z-floating-menu max-w-[300px] rounded-md border bg-gray-50 p-2 px-2.5 text-sm text-gray-500 dark:border-gray-500 dark:bg-gray-800 dark:text-near-white"},"You have made"," ",tL.createElement("em",null,i.changes," edit",i.changes>=2?"s":""),". ",i.changes>=2?"They":"It"," will be synced when you go online."):null};function cK(...e){return(0,n9.m)((0,tC.clsx)(e))}var cq=({onClick:e,type:t="button",className:n="",children:r,disabled:a,endDecorator:i,testid:l})=>tL.createElement("button",{onClick:e,type:t,disabled:a,className:(0,tC.default)(`
          group inline-flex cursor-pointer items-center 
          space-x-1 rounded-md border border-transparent bg-indigo-600 px-2.5 py-1 text-xs 
          font-medium leading-4 text-white shadow-sm transition duration-300 
          ease-in-out hover:bg-indigo-500 
          focus:outline-none focus:ring-2 focus:ring-indigo-500
          focus:ring-offset-2 disabled:cursor-not-allowed disabled:bg-bluegray-400
        `,n),"data-testid":l},tL.createElement("span",{className:"inline-flex items-center"},r),i&&tL.createElement("kbd",{className:"\n            flex flex-none items-center justify-center rounded-md bg-indigo-800\n            px-1.5 py-0.5 font-sans text-[10px]\n            font-medium uppercase leading-4 text-white/90 transition\n            duration-300 ease-in-out group-disabled:bg-bluegray-500\n          "},i)),cY=tB.NZ.isApple?()=>tL.createElement("span",{className:"flex h-[16px] items-center justify-center"},tL.createElement(re.m,{width:10,height:10}),tL.createElement(rt.G,{width:10,height:10,className:"rotate-180"})):()=>tL.createElement("span",null,"Ctrl+Enter"),cU=(0,rn.j)("fixed z-floating-menu bg-white shadow-lg dark:bg-app-dark-tint overflow-y-auto rounded-md ring-1 ring-coolgray-900/5 dark:ring-gray-600 min-w-52  transition text-black dark:text-gray-200 divide-y divide-gray-900/5 dark:divide-white/10 select-none",{variants:{layout:{desktop:"w-[420px] max-w-xl max-h-[720px]",mobile:"w-full max-h-[70vh]"},reverse:{false:"flex flex-col",true:"flex flex-col-reverse"}},defaultVariants:{layout:"desktop",reverse:!1}}),cQ=({viewportSelector:e,mobile:t,prompt:n,text:r,setText:a,onSubmit:i,onDismiss:l})=>{let o=(0,tL.useRef)(null),{getFloatingProps:s}=cs({isOpen:!0,viewportSelector:e,placement:t?"viewport-bottom":"bottom",alwaysCenter:!0,onDismiss:l,enabledDismiss:!0,observeElementResize:!0});(0,tL.useEffect)(()=>{setTimeout(()=>{o.current?.focus({preventScroll:!0})})},[]);let c=(0,tS.Z)(()=>{i(n,r)});return cl(["Mod-Enter"],c,{capture:!0}),tL.createElement("div",{...s({className:cK(cU({layout:t?"mobile":"desktop"}))}),"data-testid":"prediction-prompt-textarea-menu"},tL.createElement("form",{className:"space-y-1 p-2"},tL.createElement("textarea",{ref:o,className:"prediction-prompt-textarea-menu-input",placeholder:n.customInputPlaceholder??"Enter some context text...",rows:4,value:r,onChange:e=>{a(e.target.value)}}),tL.createElement(cq,{endDecorator:t?null:tL.createElement(cY,null),onClick:c,disabled:!r},"Submit")))},cX=({name:e,children:t})=>tL.createElement("li",{className:"py-1"},e?tL.createElement("h3",{className:"select-none px-3 py-1 text-xs capitalize text-coolgray-400 dark:text-coolgray-500"},e):null,tL.createElement("ul",null,t)),cJ=({selected:e,mouseActive:t,item:n,unsaved:r=!1,onClick:a,onHover:i})=>{let l=s9(e);return tL.createElement("li",{ref:l,onClick:e=>{e.preventDefault(),a()},onPointerEnter:i,className:(0,tC.default)([`
        flex h-8 cursor-pointer items-center space-x-2 bg-white px-3 text-2xs
        leading-5 text-coolgray-700 transition      
        duration-150 ease-in-out dark:bg-app-dark-tint dark:text-coolgray-300
        `,e&&"bg-coolgray-100 text-coolgray-900 dark:bg-white/10 dark:text-white"]),"data-testid":e?"prediction-prompt-list-item-selected":"prediction-prompt-list-item"},tL.createElement(s6,{hoverToPause:t,active:e},r?tL.createElement("span",null,"New custom prompt: ",tL.createElement("em",null,n.label||n.template)):n.label))},cG="__CUSTOM_PROMPT__";function c0(e){return e.id===cG||!e.id}var c1=({viewportSelector:e,mobile:t,promptTemplates:n,onSubmit:r,onDismiss:a})=>{let[i,l]=(0,tL.useState)(""),o=(0,tL.useMemo)(()=>(function(e,t){e=e.trim();let n=t.filter(e=>"custom"===e.type),r=cT({query:e,items:t.filter(e=>"system"===e.type),maxItems:100});return[{groupName:"custom",items:cT({query:e,items:n,maxItems:100})},{groupName:"system",items:r},{groupName:null,items:e?[{id:cG,type:"custom",label:"",template:e}]:[]}].filter(e=>e.items.length>0)})(i,n),[i,n]),s=(0,tL.useRef)(null),[c,u]=(0,tL.useState)(-1),[d,p]=(0,tL.useState)(-1);(0,tL.useEffect)(()=>{u(0),p(0)},[i]);let{getFloatingProps:m}=cs({isOpen:!0,viewportSelector:e,placement:t?"viewport-bottom":"bottom",alwaysCenter:!0,onDismiss:a,enabledDismiss:!0,observeElementResize:!0}),f=(0,tS.Z)(async(e,t)=>{let n=o[e??c],a=n?.items[t??d];a&&r(a)}),h=(0,tS.Z)((e,t)=>{g&&(u(e),p(t))}),g=s3([i,c,d]);return cl(["ArrowDown","ctrl-n"],e=>{var t;e.preventDefault();let[n,r]=(t=d+1)===o[c].items.length?[(c+1)%o.length,0]:[c,t];u(n),p(r)},{ref:s}),cl(["ArrowUp","ctrl-p"],e=>{var t;e.preventDefault();let[n,r]=-1==(t=d-1)?function(e,t){let n=e.length,r=(t+n-1)%n;return[r,e[r].items.length-1]}(o,c):[c,t];u(n),p(r)},{ref:s}),(0,tL.useEffect)(()=>{setTimeout(()=>{s.current?.focus({preventScroll:!0})})},[]),tL.createElement("div",{...m({className:cK(cU({layout:t?"mobile":"desktop",reverse:t}))}),"data-testid":"prediction-prompt-picker-menu"},tL.createElement("form",{onSubmit:e=>{e.preventDefault(),f()},className:"p-3 pb-2"},tL.createElement("input",{className:"prediction-prompt-picker-menu-input",ref:s,value:i,placeholder:"Ask anything to AI...",onChange:e=>l(e.target.value)})),tL.createElement("ul",{className:"prediction-prompt-picker-menu-list divide-y divide-gray-900/5 dark:divide-white/20"},o.map((e,t)=>tL.createElement(cX,{key:e.groupName??"none",name:e.groupName},e.items.map((e,n)=>tL.createElement(cJ,{key:e.id,item:e,selected:t===c&&n===d,mouseActive:g,unsaved:c0(e),onClick:()=>void f(t,n),onHover:()=>h(t,n)}))))))},c5=({onClick:e,type:t="button",className:n="",children:r,disabled:a,endDecorator:i,testid:l})=>tL.createElement("button",{onClick:e,type:t,disabled:a,className:(0,tC.default)(`
          group inline-flex cursor-pointer items-center
          space-x-1 rounded-md
          border border-transparent bg-indigo-100
          px-2.5 py-1 text-xs font-medium
          leading-4 text-indigo-700
          transition duration-150 ease-in-out
          hover:bg-indigo-50
          focus:border-indigo-300 focus:outline-none active:bg-indigo-200
          disabled:cursor-not-allowed disabled:bg-bluegray-100 disabled:text-coolgray-400 dark:bg-indigo-900 dark:text-white dark:hover:bg-indigo-800 disabled:dark:bg-bluegray-800
        `,n),"data-testid":l},tL.createElement("span",{className:"inline-flex items-center"},r),i&&tL.createElement("kbd",{className:"\n            flex h-[15px] min-w-[15px] flex-none items-center justify-center \n            rounded-md border bg-indigo-500 px-[3px]\n            font-sans text-[8px] font-medium uppercase leading-4 text-white opacity-50 group-disabled:bg-bluegray-500\n          "},i)),c2=({disabled:e,done:t,mobile:n,handleReplace:r,handleInsert:a,handleRerun:i,handleCopy:l,handleStop:o})=>{let s=sX().state.selection.empty,c=t&&!s,u=!t;return tL.createElement("div",{className:"flex shrink-0 grow flex-row gap-2 overflow-x-auto whitespace-nowrap"},tL.createElement(c4,{onClick:i,disabled:e,mobile:n}),t&&tL.createElement(c3,{onClick:a,disabled:e,mobile:n}),t&&tL.createElement(c8,{onClick:l,disabled:e,mobile:n}),u&&tL.createElement(c6,{onClick:o,disabled:e,mobile:n}),tL.createElement("div",{className:"flex-1"}),c&&tL.createElement(c7,{onClick:r,disabled:e,mobile:n}))},c7=({onClick:e,disabled:t,mobile:n})=>(cl(["Mod-Enter"],e,{capture:!0,enabled:!t}),tL.createElement(cq,{onClick:e,endDecorator:n?null:tL.createElement(cY,null),disabled:t},"Replace")),c3=({onClick:e,disabled:t,mobile:n})=>(cl(["i","shift-i"],e,{enabled:!t}),tL.createElement(c5,{onClick:e,endDecorator:n?null:"I",disabled:t},"Insert")),c4=({onClick:e,disabled:t,mobile:n})=>(cl(["r","shift-r"],e,{enabled:!t}),tL.createElement(c5,{onClick:e,endDecorator:n?null:"R",disabled:t},"Re-run")),c8=({onClick:e,disabled:t,mobile:n})=>(cl(["c","shift-c"],e,{enabled:!t}),n)?null:tL.createElement(c5,{onClick:e,endDecorator:n?null:"C",disabled:t},"Copy"),c6=({onClick:e,disabled:t,mobile:n})=>(cl(["Escape"],e,{capture:!0,stopPropagation:!0,enabled:!t}),tL.createElement(c5,{onClick:e,endDecorator:n?null:"ESC",disabled:t},"Stop")),c9=({text:e})=>tL.createElement("div",{className:"select-text overflow-y-auto whitespace-pre-line rounded-md bg-gray-50 p-3 text-sm dark:bg-white/5"},e),ue=({show:e,enter:t,enterFrom:n,enterTo:r,leave:a,leaveFrom:i,leaveTo:l,children:o})=>{let s;let[c,u]=(0,tL.useState)(e?2:5),d=(0,tL.useRef)(null);(0,tL.useEffect)(()=>{u(t=>{if(e)switch(t){case 2:return t;case 4:return 1;default:return 0}else switch(t){case 5:return t;case 1:return 4;default:return 3}})},[e]),(0,tL.useEffect)(()=>{switch(c){case 0:requestAnimationFrame(()=>u(1));break;case 3:requestAnimationFrame(()=>u(4))}},[c]);let p=(0,tL.useCallback)(()=>{u(e=>{switch(e){case 1:return 2;case 4:return 5}return e})},[]);switch((0,tL.useEffect)(()=>{let e=d.current;if(e)return e.addEventListener("transitionend",p),()=>{e.removeEventListener("transitionend",p)}},[p]),c){case 0:s=(0,tC.default)(t,n);break;case 1:s=(0,tC.default)(t,r);break;case 2:case 5:s="";break;case 3:s=(0,tC.default)(a,i);break;case 4:s=(0,tC.default)(a,l);break;default:throw Error(`Invalid state ${c}`)}return tL.createElement("div",{ref:d,className:s},5===c?null:o)},ut=({open:e,children:t})=>tL.createElement(ue,{show:e,enter:"grid overflow-hidden transition-[grid-template-rows] ease-out",enterFrom:"grid-rows-[0fr]",enterTo:"grid-rows-[1fr]",leave:"grid overflow-hidden transition-[grid-template-rows] ease-in",leaveFrom:"grid-rows-[1fr]",leaveTo:"grid-rows-[0fr]"},tL.createElement("div",{className:"min-h-0"},t)),un=({prompt:e,hasPendingChange:t,setLabel:n,setTemplate:r,onClonePrompt:a,onSavePrediction:i,onDeletePrediction:l,setActionDisabled:o})=>{let[s,c]=(0,tL.useState)(!1),[u,d]=(0,tL.useState)(!1),[p,m]=(0,tL.useState)(!1),[f,h]=(0,tL.useState)(!1),[g,k]=(0,tL.useState)(!1),y=c0(e),b="system"===e.type,w=()=>{c(!s)},v=async t=>{t.preventDefault(),e.label&&e.template&&(d(!0),await i(),d(!1))},x=async()=>{m(!0),await l(),m(!1),c(!1)};(0,tL.useEffect)(()=>{o(f||g)},[f,g,o]);let E=s?rr.f:n7.A,C=!(s&&t),L=!b&&(y||t);return tL.createElement("form",{className:"flex flex-col py-3 px-4",onSubmit:v,"data-testid":"prediction-result-heading"},tL.createElement("div",{className:"flex min-h-[24px] space-x-2",onClick:s?void 0:w,"data-testid":"prediction-result-heading-label"},s&&!b?tL.createElement("input",{value:e.label,onChange:e=>n(e.target.value),onFocus:()=>h(!0),onBlur:()=>h(!1),className:"\n              m-0 inline-flex\n              w-full flex-1 rounded-sm border-0 bg-transparent\n              text-sm text-gray-700 outline-none placeholder:text-gray-500\n              dark:text-gray-300\n            ",autoFocus:!0,placeholder:"Input your prompt name here",required:!0}):tL.createElement("div",{className:"flex flex-1 items-center truncate text-sm"},tL.createElement("span",null,e.label||e.template)),C&&tL.createElement("button",{onClick:s?w:void 0,type:"button",className:"flex-none cursor-default"},tL.createElement(E,{width:24,height:24,className:"text-gray-400 dark:text-gray-400"}))),tL.createElement(ut,{open:s},tL.createElement("div",{className:"mt-3"},tL.createElement("textarea",{value:e.template,onChange:e=>r(e.target.value),onFocus:()=>k(!0),onBlur:()=>k(!1),disabled:b,placeholder:"Input your prompt template here. Use {{selectedText}} as a placeholder for selected text.",className:"\n              m-0 h-40 w-full resize-y rounded-md border-0 bg-gray-50\n              px-3 py-2 text-sm text-gray-700\n              outline-none placeholder:text-gray-500 focus:ring-2 focus:ring-accent\n              dark:bg-white/10 dark:text-gray-300\n            ",required:!0})),tL.createElement("p",{className:"mt-2 mb-3 text-xs"},"Tip: Use ",tL.createElement("strong",null,tL.createElement("code",null,"{{selectedText}}"))," as a placeholder for selected text"),tL.createElement("div",{className:"flex w-full flex-row-reverse gap-2"},!b&&!y&&tL.createElement(c5,{onClick:x,disabled:p,testid:"prediction-result-heading-button-delete",className:"items-end justify-self-end"},p?"Deleting...":"Delete"),!y&&tL.createElement(c5,{onClick:()=>{a()},testid:"prediction-result-heading-button-clone"},"Clone"),L&&tL.createElement(c5,{disabled:u,type:"submit",testid:"prediction-result-heading-button-save"},u?"Saving...":"Save"))))},ur=({viewportSelector:e,stream:t,prompt:n,hasPendingChange:r,mobile:a,setLabel:i,setTemplate:l,onDismiss:o,onRerun:s,onClonePrompt:c,onSavePrediction:u,onDeletePrediction:d})=>{let{text:p,done:m,canceled:f,cancel:h}=function(e){let[t,n]=(0,tL.useState)(""),[r,a]=(0,tL.useState)(!1),[i,l]=(0,tL.useState)(!1),[o,s]=(0,tL.useState)(null);return(0,tL.useEffect)(()=>{if(n(""),a(!1),l(!1),s(null),!e)return;if(e.locked){console.warn("Cannot read from a locked stream");return}let t=e.getReader(),r=null,i=!1,o=!1,c=async()=>{i=!0,!o&&(r&&await r,o||(l(!0),await t.cancel()))},u=async()=>{o=!0,r&&await r,t.releaseLock()};return(async()=>{for(;!i&&!o;){r=t.read();let{value:e,done:l}=await r;if(i||o)break;if(e&&n(t=>t+e),l){a(!0);break}}})(),s(()=>c),()=>{u()}},[e]),{text:t,done:r,canceled:i,cancel:o}}(t),[g,k]=(0,tL.useState)(!1),{handleReplace:y,handleInsert:b,handleRerun:w,handleCopy:v,handleStop:x}=function({text:e,onRerun:t,onDismiss:n,onCancelStream:r}){let a=(0,tL.useRef)(null),i=(0,tE.xd)();return{ref:a,handleReplace:()=>{e&&(n(),i.replaceMarkdown(e))},handleInsert:()=>{e&&(n(),i.insertMarkdownAfterSelection(e))},handleRerun:()=>{r?.(),t()},handleDismiss:()=>{r?.(),n()},handleStop:()=>{r?.()},handleCopy:()=>{oK(e),n()}}}({onCancelStream:h,text:p,onRerun:s,onDismiss:o}),{getFloatingProps:E}=cs({isOpen:!0,viewportSelector:e,placement:a?"viewport-bottom":"bottom",alwaysCenter:!0,onDismiss:o,enabledDismiss:!0,observeElementResize:!0});return tL.createElement("div",{...E({className:cK(cU({layout:a?"mobile":"desktop"}))}),"data-testid":"prediction-result-menu"},tL.createElement(un,{prompt:n,hasPendingChange:r,setLabel:i,setTemplate:l,onClonePrompt:c,onSavePrediction:u,onDeletePrediction:d,setActionDisabled:k}),tL.createElement("div",{className:"space-y-3 p-3"},tL.createElement(c9,{text:p}),t?tL.createElement(c2,{disabled:g,done:m||f,mobile:a,handleReplace:y,handleInsert:b,handleRerun:w,handleCopy:v,handleStop:x}):null))},ua=({viewportSelector:e,mobile:t,setPrediction:n,onPrediction:r,onSetPromptTemplate:a,onRemovePromptTemplate:i,promptTemplates:l=[]})=>{let[o,s]=(0,tL.useState)(null),[c,u]=(0,tL.useState)(""),[d,p]=(0,tL.useState)(!1),[m,f]=(0,tL.useState)(null),[h,g]=(0,tL.useState)(!1),k=!m&&!d,y=(0,tL.useRef)(null),b=sX(),w=(0,tL.useCallback)(e=>{g(!0),s(t=>t?{...t,label:e}:null)},[]),v=(0,tL.useCallback)(e=>{g(!0),s(t=>t?{...t,template:e}:null)},[]),x=(0,tS.Z)(()=>{(!h||window.confirm("Do you want to discard unsaved prompt template?"))&&(n(!1),b.focus())}),E=(0,tS.Z)(async(e,t)=>{s(e);let n=b.state.selection,a=n.empty?void 0:al(n.content(),"markdown"),i=c0(e)?void 0:e.id,l=e.template.includes("{{selectedText}}")||e.template.includes("{input}"),o=a||t||"";if(l&&!o)return;let c={promptTemplateId:i,prompt:l&&o?e.template.replaceAll("{input}",o).replaceAll("{{selectedText}}",o):!l&&o?`${e.template}

Use the following text in triple quotes as context for your response:
"""
${o}
"""`:e.template,temperature:e.temperature,optimize:e.optimize};p(!0);let{stream:u}=await r(c);p(!1),f(u)}),C=(0,tS.Z)(()=>{f(null),!c&&o&&E(o)}),L=(0,tL.useCallback)(()=>{s(e=>e?{...e,id:cG,label:e.label+" (cloned)",type:"custom"}:e),g(!0)},[]),S=(0,tS.Z)(async()=>{if(!o||!h)return;let{id:e}=await a({id:c0(o)?void 0:o.id,label:o.label,template:o.template});s({...o,id:e,type:"custom"}),g(!1)}),N=(0,tS.Z)(async()=>{o&&(await i({id:o.id}),s({...o,id:cG}),g(!1))});return cl(["mod-j"],x,{ref:y}),tL.createElement("div",{ref:y},o?k?tL.createElement(cQ,{viewportSelector:e,mobile:t,onSubmit:E,onDismiss:x,text:c,setText:u,prompt:o}):tL.createElement(ur,{viewportSelector:e,mobile:t,stream:m,prompt:o,hasPendingChange:h,setLabel:w,setTemplate:v,onDismiss:x,onRerun:C,onClonePrompt:L,onSavePrediction:S,onDeletePrediction:N}):tL.createElement(c1,{viewportSelector:e,mobile:t,promptTemplates:l,onSubmit:E,onDismiss:x}))},ui=({viewportSelector:e,mobile:t,prediction:n,setPrediction:r,onPrediction:a,onSetPromptTemplate:i,onRemovePromptTemplate:l,promptTemplates:o=[]})=>{let s=(0,tS.Z)(()=>!n&&(r(!0),!0));return(0,nG.og)("mod-j",s),tL.createElement(oI,null,n?tL.createElement(ua,{viewportSelector:e,mobile:t,setPrediction:r,onPrediction:a,onSetPromptTemplate:i,onRemovePromptTemplate:l,promptTemplates:o}):null)},ul=({onTagAdd:e,onBacklinkAdd:t,maxPickerItems:n=5,scrollingNode:r,viewportSelector:a="",backlinkGenerator:i,tagGenerator:l,mergeMenuEnabled:o=!0,dragIndicatorEnabled:s=!1,inlineToolbarEnabled:c=!0,mergeNoteGenerator:u,onMergeNote:d,templates:p=[],subjectRequired:m=!0,timeFormat:f="12",inline:h=!1,mobile:g=!1,offline:k,getOfflineStatus:y,onPrediction:b,onSetPromptTemplate:w,onRemovePromptTemplate:v,promptTemplates:x,onLinkMetadata:E,isFocused:C,prediction:L,setPrediction:S,transcriber:N,toggleTranscriptionRef:T})=>{let[M,I]=(0,tL.useState)(!1),D=cN(r);return tL.createElement(tL.Fragment,null,tL.createElement(cP,{onAdd:e,maxItems:n,onTagQuery:l,editorFocused:C,isScrolling:D,viewportSelector:a}),tL.createElement(cn,{onAdd:t,onBacklinkQuery:i,editorFocused:C,isScrolling:D,viewportSelector:a}),h?null:tL.createElement(cj,{editorFocused:C,scrollingNode:r,viewportSelector:a,templates:p,timeFormat:f,transcriptionEnabled:!!N,toggleTranscriptionRef:T,predictionEnabled:!!b,setPrediction:S}),s?tL.createElement(cZ,null):null,o?tL.createElement(cO,{mergeNoteGenerator:u,onMergeNote:d,viewportSelector:a}):null,c?tL.createElement(cS,{setEditingLink:I,setPrediction:S,predictionEnabled:!!b,editorFocused:C,isScrolling:D,viewportSelector:a,subjectRequired:m}):null,c?tL.createElement(ch,{editingLink:M,setEditingLink:I,isScrolling:D,viewportSelector:a,onLinkMetadata:E}):null,b&&w&&v?tL.createElement(ui,{prediction:L,setPrediction:S,mobile:g,viewportSelector:a,onPrediction:b,onSetPromptTemplate:w,onRemovePromptTemplate:v,promptTemplates:x}):null,y?tL.createElement(cF,{offline:k,getOfflineStatus:y}):null)},uo=e=>tL.createElement(sW,null,tL.createElement(sM,{onFileUrlReplace:e.onFileUrlReplace},tL.createElement(us,{...e,key:e.editorKey}))),us=({editorKey:e,content:t,onDocumentChange:n,onDocumentChangeDebounced:r,onTransaction:a,yjsOnUpdate:i,subject:l,inline:o=!1,selected:s=!1,scrollSelectedIntoView:c=!1,dark:u=!1,editableSubject:d=!0,highlightSubject:p=!1,readOnly:m=!1,editable:f=!0,mergeMenuEnabled:h=!0,dragIndicatorEnabled:g=!1,inlineToolbarEnabled:k=!0,virtualCursorEnabled:y=!1,doubleSpaceReplacement:b=null,isTagSelectable:w=!0,isBacklinkSelectable:v=!0,spellCheck:x=!0,mobile:E=!1,maxPickerItems:C=5,searchTerm:L,className:S,size:N,style:T,editorStyle:M,graphId:I,editorRef:D,offline:A,getOfflineStatus:_,onTagAdd:R,onTagClick:H,onBacklinkAdd:j,onBacklinkOpen:O,onBacklinkHover:$,backlinkGenerator:B,tagGenerator:z,onFocus:P,onBlur:W,mergeNoteGenerator:Z,onMergeNote:V,onNavigatePrevious:F,onNavigateNext:K,onSelection:q,onFileUpload:Y,onFileUploadSync:U,onFileDownload:Q,onFileSave:X,onFileUrlReplace:J,onImageClick:G,onCheckboxChange:ee,getKeyboardLayoutMap:et,transcriber:en,onLinkMetadata:er,onPrediction:ea,onSetPromptTemplate:ei,onRemovePromptTemplate:el,promptTemplates:eo,children:es,scrollingNode:ec,viewportSelector:eu="",templates:ed,subjectRequired:ep=!0,timeFormat:em})=>{var ef;let eh=function({content:e,inline:t,yjsOnUpdate:n,editorKey:r}){return(0,tL.useMemo)(()=>{if(e||l5(e),"yjs"===e.type){if(t)throw Error("inline editor does not support YJS yet");let a=function({yjsDoc:e,yjsOnUpdate:t,appVersion:n,extraLogInfo:r}){let a=(0,tw.Su)({yjsDoc:e});a!==n&&console.log(`${r} current version in the yjsDoc: ${a}`);let i=(0,tT.R3)(e);i.attrs={...i.attrs,version:a};let l=iH(i,n,r);if(!l)return e;let o=sH.nodeFromJSON(l),s=new nJ.Doc;nJ.applyUpdate(s,nJ.encodeStateAsUpdate(e));let c=[];s.on("update",e=>{c.push(e)});let u=s.get("prosemirror",nJ.XmlFragment);(0,tT.e$)(o,u),(0,tw.w2)({yjsDoc:s,version:n});let d=nJ.mergeUpdates(c);return t?.({update:d,doc:s}),s}({yjsDoc:e.yjsDoc,yjsOnUpdate:n,appVersion:i_,extraLogInfo:`editorKey: ${r} (yjs)`}),i=(0,tT.R3)(a);return{yjsDoc:a,document:i}}if("prosemirror"===e.type){let n=(e.document?iH(e.document,i_,`editorKey: ${r} (prosemirror)`):void 0)||e.document;if(t&&n){let e=function e(t){if(!t)return null;if(t?.type===tw.e3)return t;for(let n of t?.content??[]){let t=e(n);if(t)return t}return null}(n);n={...n,content:e?[e]:[]}}return{yjsDoc:void 0,document:n}}l5(e)},[e,r,t,n])}({content:t,inline:o,yjsOnUpdate:i,editorKey:e}),eg=(0,tL.useMemo)(()=>j?rx(j):j,[j]),ek=function(){let e=(0,nz.mg)();return(0,tL.useMemo)(()=>({image:e({component:sE,as:sT}),iframe:e({component:ss}),tweet:e({component:oX})}),[e])}(),{manager:ey}=(0,tE.iF)({content:eh.document,extensions:()=>sn({onTagClick:H,onBacklinkOpen:O,onBacklinkHover:$,onBacklinkAdd:eg,onTagAdd:R,onFileUpload:Y,onFileUploadSync:U,onFileDownload:Q,onFileSave:X,onFileUrlReplace:J,onImageClick:G,onCheckboxChange:ee,getKeyboardLayoutMap:et,graphId:I,isTagSelectable:w,isBacklinkSelectable:v,yjsDoc:eh.yjsDoc,yjsOnUpdate:i,subjectRequired:ep,inline:o,virtualCursorEnabled:y,nodeViews:ek})});(0,tL.useEffect)(()=>{"undefined"!=typeof window&&(window._reflect_editor_view=ey.view)},[ey.view]);let eb=function(e,t){let n=(0,tL.useMemo)(()=>{if(!e&&!t)return null;let n=t?(0,n3.Z)(t,800):null,r=t=>{let r=t.doc.toJSON();e?.(r),n?.(r)};return r.flush=()=>{n?.flush()},r},[e,t]);return(0,tL.useEffect)(()=>()=>{n?.flush()},[n]),n}(n,r),ew=function(e,t){let n=(0,tL.useRef)("__default_editor_key__");return(0,tL.useCallback)(r=>{n.current!==e&&(n.current=e);let{transactions:a}=r,i=a.some(e=>e.docChanged),l=a.every(e=>e.getMeta(tN.Gt));i&&!l&&t(r)},[e,t])}(e,(0,tL.useCallback)(({transactions:e,newState:t})=>{e.length>0&&(a?.(e,t),eb?.(t))},[eb,a]));(0,tL.useEffect)(()=>{if(!l)return;let e=ey.store?.view?.state?.doc;e&&aV(e)!==l&&ey.store?.commands?.addSubjectToContent?.(l,!0)},[ey,l]);let[ev,ex]=(0,tL.useState)(!1),eE=(0,tL.useRef)(!1),eC=(ef={onSelection:q},(e,t)=>{let{selection:n}=e,r=(0,tY.RI)()(e),a=(0,tY.xH)()(e),i=(0,tY.C$)("up")(e),l=(0,tY.C$)("down")(e),o=!!(0,tB.Tr)({selection:e.selection,types:tw.tw});ef.onSelection?.({selection:{from:n.from,to:n.to},canIndent:r,canDedent:a,canMoveUp:i,canMoveDown:l,selectedSubject:o,didFocus:t})}),[eL,eS]=(0,tL.useState)(!1),eN=(0,tL.useCallback)(e=>{e.transactions&&e.transactions.length>0?ew({transactions:e.transactions,newState:e.state}):e.tr&&(console.warn("onChange called with a tr but no transactions"),ew({transactions:[e.tr],newState:e.state})),eC(e.state,eE.current),eE.current=!1},[eC,ew]),eT=(0,tL.useCallback)((e,t)=>{let n=e.docChanged,r=!0;return m?r=!1:d||aV(e.doc)===aV(t.doc)||e.getMeta(oS)||e.getMeta(tN.Gt)||(r=!1),!!r||!n},[m,d]),eM=(0,tS.Z)((e,t)=>{eE.current=!0,ex(!0),P?.(t),eS(!1)}),eI=(0,tS.Z)((e,t)=>{ex(!1),W?.(t,e.state.doc.toJSON())}),eD=(0,tL.useMemo)(()=>eh.document?s&&"object"==typeof s?[eh.document,s]:eh.document:void 0,[eh.document,s]),eA=(0,tL.useRef)(null);return tL.createElement(tv.Q2,{dark:u,className:(0,tC.default)(S,{xs:"reflect-editor-xs",sm:"reflect-editor-sm",md:"reflect-editor-md",lg:"reflect-editor-lg"}[N??"sm"],p&&"highlight-subject",m&&"readonly"),style:T},tL.createElement(tE.O1,{onFocus:eM,onBlur:eI,onChange:eN,manager:ey,initialContent:eD,editable:f,attributes:M?{style:M}:void 0},tL.createElement(sO,{spellCheck:x}),tL.createElement(sP,{searchTerm:L}),tL.createElement(sA,{isFocused:ev,transcriber:en,toggleTranscriptionRef:eA}),tL.createElement(sI,{filterTransaction:eT}),tL.createElement(sR,{enabled:y}),tL.createElement(sr,{enabled:b}),tL.createElement(si,{onNavigatePrevious:F,onNavigateNext:K}),tL.createElement(sB,{selected:s,scrollSelectedIntoView:c}),tL.createElement(sz,{ref:D,setPrediction:eS}),f?tL.createElement(ul,{onTagAdd:R,onBacklinkAdd:eg,maxPickerItems:C,scrollingNode:ec,viewportSelector:eu,mergeMenuEnabled:h,dragIndicatorEnabled:g,inlineToolbarEnabled:k,backlinkGenerator:B,tagGenerator:z,mergeNoteGenerator:Z,onMergeNote:V,templates:ed,isFocused:ev,timeFormat:em,inline:o,mobile:E,offline:A,getOfflineStatus:_,onLinkMetadata:er,onPrediction:ea,onSetPromptTemplate:ei,onRemovePromptTemplate:el,promptTemplates:eo,prediction:eL,setPrediction:eS,transcriber:en,toggleTranscriptionRef:eA}):null,es))},uc=l4(sH);function uu(e,t){return lt(iy(e,t),sH)}function ud(e,t){let n=r5(e.type.schema,t);return function(e,t){let n=(0,tB.Me)(),r=n.createElement("div");return r.append(function(e,t,n){let r=(0,tB.PH)(e)&&(0,tB.aQ)(e)?e.content:tU.HY.from(e);return t.serializeFragment(r,{document:n})}(e,t,n)),r}(e,n).innerHTML}function up(e){let t=(0,tB.OC)({content:"<h1></h1>"+e,schema:sH});return t.maybeChild(1)?.type.name===tw.tw?t.cut(t.child(0).nodeSize):t}function um(e,t){let n=function(e){if((0,tB.PH)(e)&&e.isInline)return[e];let t=[];return e.descendants(e=>{if(e.isInline)return t.push(e),!1}),t}(uu(e,t));return tU.HY.fromArray(n)}function uf(e){return ar(ud(e,{wrapBacklinkWithBrackets:!0,removeTagLinks:!0,normalizeTaskListItem:!0,normalizeListItem:!0,normalizeIframe:!0,normalizeFile:!0,nativeList:!0}),"markdown")}function uh(e,t=sH){return tU.NB.fromJSON(t,ij(e))}function ug(e,t){return up(iy(e,t))}function uk(e,t,n){if(!(0,tY.yD)(n))throw Error("The given list must be a list node");let r=l8(e.tr.doc,e=>(0,tY.yD)(e)&&e.textContent.startsWith(t));if(!r)return oi(e,[n]);let{tr:a}=e;return a.replaceRangeWith(r.pos,r.pos+r.node.nodeSize,n),!0}function uy(e,t,n){return function(e,t){let n=e.tr.doc,r=null;if(n.descendants((e,n)=>!r&&!e.type.isTextblock&&(il(e)&&e.attrs.guid===t.attrs.guid?(r={node:e,from:n},!1):void 0)),!r)return!1;let{node:a,from:i}=r;if(!a.eq(t)){if(a.content.eq(t.content))e.tr.setNodeMarkup(i,null,t.attrs);else{let n=i+a.nodeSize,r=function(e,t){let n=t.content;n.size>1&&(n=tU.HY.fromArray([n.child(0)]));let r=e.content.firstChild?.isTextblock;for(let t=r?1:0;t<e.content.childCount;t++)n=n.addToEnd(e.content.child(t));return t.copy(n)}(a,t);e.tr.replaceRangeWith(i,n,r)}}return!0}(e,t)||function(e,t,n){let r=new Set;for(let e of t)for(let t of function(e){let t=[];return e.descendants(e=>{il(e)&&t.push(e.attrs.guid)}),t}(e))r.add(t);let a=t.filter(e=>!r.has(e.attrs.guid));if(0===a.length)return!1;let{tr:i,schema:l}=e,o=l4(l),s=n?.listName;if(!s)return oi(e,a);{let t=l6(e.tr.doc,tU.HY.fromArray([o.text(s)]));if(!t)return ou(e,o.list(o.listItem([o.paragraphText(s),...a])));{let n=t.pos+t.node.nodeSize-1;return i.replaceRange(n,n,new tU.p2(tU.HY.fromArray(a),0,0)),lM(e.tr,e.tr.doc.resolve(n)),!0}}}(e,[t],n)}function ub(e,t,n,r){if(!t)throw Error("guid must exist");let a=e.doc,i=!1;return a.descendants((a,l)=>{if(i||a.type.isTextblock)return!1;if((0,tY.yD)(a)){let o=a.attrs;o.guid===t&&(e.setNodeAttribute(l,n,r(o)),i=!0)}return!0}),i}function uw(e,{guid:t,checked:n}){return ub(e.tr,t,"checked",e=>n??!e.checked)}function uv(e,{guid:t,kind:n}){return ub(e.tr,t,"kind",()=>n)}function ux(e,t){let n=e.tr.doc,r=[];if(n.descendants((e,n)=>!e.type.isTextblock&&(!(il(e)&&t.has(e.attrs.guid))||(r.push([n,n+e.nodeSize]),!1))),0===r.length)return!1;for(let[t,n]of(r.sort((e,t)=>e[0]>t[0]?-1:1),r))e.tr.deleteRange(t,n);return!0}function uE(e,t){return{type:"doc",content:e.toJSON()?.content??[],attrs:t}}function uC(e){return(0,tB.PH)(e)&&(e.isLeaf||e.isTextblock)?[e]:aN(e).flatMap(uC)}}}]);