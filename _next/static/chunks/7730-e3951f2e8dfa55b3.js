!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f84e50cf-12ca-4dc2-927e-3d9c0771bc3b",e._sentryDebugIdIdentifier="sentry-dbid-f84e50cf-12ca-4dc2-927e-3d9c0771bc3b")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7730,2341],{37730:function(e,t,n){n.d(t,{y:function(){return a}});var r=n(58397);let a=n.n(r)()(()=>Promise.resolve().then(n.bind(n,96305)).then(e=>e.App),{loadableGenerated:{webpack:()=>[96305]},ssr:!1})},74819:function(e,t,n){n.r(t),n.d(t,{AppProvider:function(){return v}});var r=n(11527),a=n(84534),s=n(5123),i=n.n(s),o=n(50959),l=n(8680),d=n(68783);let c=()=>(0,r.jsx)("div",{className:"app-region-drag pointer-events-none absolute top-0 left-0 right-0 z-0 h-5 ipad:hidden"});var u=n(5992),h=n(71667),p=n(51085),m=n(21622),f=n(46935),x=n(11161),g=n(42104);let v=e=>{let{children:t,ready:n=!0}=e,[s,v]=(0,o.useState)(),y=(0,o.useMemo)(()=>(0,x.W)(),[]);return((0,o.useEffect)(()=>{n&&(0,d.k)().then(v)},[n]),s)?(0,r.jsx)(g.F0,{children:(0,r.jsxs)(u.S,{as:"main",className:"overflow-hidden",children:[(0,r.jsxs)(i(),{children:[(0,r.jsx)("link",{rel:"manifest",href:"/manifest.json"}),y&&(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"})]}),(0,r.jsx)(p.fc,{}),(0,r.jsx)(h.S,{children:(0,r.jsx)(l.LD,{value:s,children:(0,r.jsx)(a.RB,{children:(0,r.jsxs)(f.Q2,{children:[(0,r.jsx)(c,{}),t]})})})})]})}):(0,r.jsx)(m.T,{})}},96305:function(e,t,n){n.r(t),n.d(t,{App:function(){return iZ}});var r,a,s,i,o=n(11527),l=n(50959),d=n(96233);async function c(){var e,t;let n=await (null===(t=navigator)||void 0===t?void 0:null===(e=t.serviceWorker)||void 0===e?void 0:e.getRegistrations());if(n)for(let e of n)await e.update()}var u=n(74819),h=n(75422),p=n(59592),m=n(44838),f=n(72811),x=n(8680);let g=window,v=(0,f.Pi)(()=>{let e=(0,x.Yh)();return(0,l.useEffect)(()=>(g.rootStore=e,g.nodeFromHtml=h.R7,g.toJS=m.toJS,g.fromUint8Array=p.kZ,g.toUint8Array=p._f,()=>{g.rootStore=null,g.nodeFromHtml=null,g.toJS=null,g.api=null,g.fromUint8Array=null,g.toUint8Array=null}),[e]),null});var y=n(32709),b=n(58397),w=n.n(b);let j=w()(()=>n.e(445).then(n.bind(n,70445)).then(e=>e.Auth),{loadableGenerated:{webpack:()=>[70445]},ssr:!1}),k=w()(()=>Promise.all([n.e(9808),n.e(9031),n.e(3013)]).then(n.bind(n,33013)).then(e=>e.GraphSetupEncryption),{loadableGenerated:{webpack:()=>[33013]},ssr:!1});var N=n(88351),S=n(22802),C=n(32271),R=n(96113),I=n(99321);let E=(0,f.Pi)(e=>{let{title:t,message:n,refreshLabel:r}=e,[a,s]=(0,l.useState)(!1);return(0,o.jsxs)(R.oU,{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-purple-100 text-gray-900 dark:bg-dark-black-800 dark:text-purple-500",children:(0,o.jsx)(S.Z,{width:25,height:25})}),(0,o.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,o.jsx)("h3",{className:"text-lg font-medium leading-6 text-gray-900 dark:text-near-white",children:t}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)("p",{className:"m-auto w-2/3 text-sm leading-5 text-gray-500 dark:text-gray-200",children:n})})]})]}),(0,o.jsx)("div",{className:"mt-5 text-center sm:mt-8",children:(0,o.jsx)(C.mI,{onClick:()=>{s(!0),window.location.reload()},disabled:a,children:r})}),(0,o.jsx)("footer",{className:"absolute bottom-16 left-0 right-0 mt-10 flex items-center justify-center",children:(0,o.jsx)("button",{onClick:()=>(0,I.w7)(),className:"cursor-pointer rounded-md border border-purple-200 px-5 py-2 text-sm text-purple-500 opacity-60 transition duration-300 hover:opacity-100 dark:border-purple-500",children:"Sign out"})})]})});var D=n(80092);let P=e=>{let{className:t=""}=e;return(0,o.jsxs)("div",{className:"relative h-10 w-10 ".concat(t),children:[(0,o.jsx)("div",{className:"absolute h-full w-full rounded-[50%] border-[3px] border-bluegray-500/10"}),(0,o.jsx)("div",{className:"absolute h-full w-full animate-spin rounded-[50%] border-l-[3px] border-t-[3px] border-purple-500 border-t-transparent"})]})},T=(0,f.Pi)(e=>{var t;let{message:n,graph:r}=e,a=null==r?void 0:null===(t=r.migrationManager)||void 0===t?void 0:t.migrationProgress;return(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,o.jsx)("p",{className:"mb-10 text-center text-gray-600",children:n}),a?(0,o.jsxs)("div",{className:"space-y-3 text-center",children:[(0,o.jsx)(D.k,{progress:a.progress}),(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-600",children:[a.percentFormatted,"%"]})]}):(0,o.jsx)(P,{})]})})});var A=n(80497),M=n(21622),L=n(18734);let V=e=>{let{delayedTimeout:t=!1}=e,[n,r]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!t)return;let e=setTimeout(()=>{(0,L.j)("loading_delayed"),r(!0)},1e4);return()=>clearTimeout(e)},[t]),(0,o.jsxs)(M.T,{duration:300,startAt:.3,children:[(0,o.jsxs)("div",{className:"flex items-center justify-center space-x-1.5 text-sm text-coolgray-500",children:[(0,o.jsx)(A.Z,{className:"h-3 w-3"}),(0,o.jsx)("span",{children:"End-to-end encrypted"})]}),n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"space-y-1 text-sm text-gray-900 media-dark:text-near-white dark:text-near-white",children:[(0,o.jsx)("p",{children:"Hmm, this is taking longer than it should."}),(0,o.jsx)("p",{children:"Can you try signing out and back in again?"})]}),(0,o.jsx)("footer",{className:"absolute bottom-16 left-0 right-0 mt-10 flex items-center justify-center",children:(0,o.jsx)("button",{onClick:()=>(0,I.w7)(),className:"cursor-pointer rounded-md border border-purple-200 px-5 py-2 text-sm text-purple-500 opacity-60 transition duration-300 hover:opacity-100 media-dark:border-purple-500 dark:border-purple-600",children:"Sign out"})})]}):null]})};var Z=n(5992),F=n(71667),O=n(49753),B=n(34278),z=n(83600),_=n(53097);let U=B.fC;B.xz;let q=B.h_;B.x8;let G=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(B.aV,{ref:t,className:(0,_.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...r})});G.displayName=B.aV.displayName;let H=l.forwardRef((e,t)=>{let{className:n,children:r,hideCloseButton:a=!1,...s}=e;return(0,o.jsxs)(q,{children:[(0,o.jsx)(G,{}),(0,o.jsxs)(B.VY,{ref:t,className:(0,_.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full",n),...s,children:[r,!a&&(0,o.jsxs)(B.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,o.jsx)(z.Z,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});function K(e){let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,_.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})}H.displayName=B.VY.displayName,K.displayName="DialogHeader";let W=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(B.Dx,{ref:t,className:(0,_.cn)("text-lg font-semibold leading-none tracking-tight",n),...r})});W.displayName=B.Dx.displayName;let Y=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(B.dk,{ref:t,className:(0,_.cn)("text-sm text-muted-foreground",n),...r})});Y.displayName=B.dk.displayName;var Q=n(96697);let J=()=>Q.G6?(0,o.jsx)(U,{open:!!Q.G6,children:(0,o.jsxs)(H,{className:"sm:max-w-[425px]",hideCloseButton:!0,children:[(0,o.jsxs)(K,{children:[(0,o.jsx)(W,{children:"Safari Browser Issue"}),(0,o.jsx)(Y,{children:"Safari browser has some compatibility issues at the moment. Please use our desktop app or Google Chrome browser until this is resolved in Safari's next release."})]}),(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)(O.z,{variant:"default",onClick:()=>{window.location.href="https://reflect.app/download"},autoFocus:!0,children:"Download macOS app"})})]})}):null;var X=n(46929),$=n(98070),ee=n(10039);let et=e=>{let{icon:t,children:n}=e;return(0,o.jsx)("div",{className:"relative bg-indigo-600",children:(0,o.jsx)("div",{className:"mx-auto max-w-7xl py-3 px-3 sm:px-6 lg:px-8",children:(0,o.jsx)("div",{className:"pr-16 sm:px-16 sm:text-center",children:(0,o.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm text-white",children:[(0,o.jsx)("div",{className:"flex-none",children:t}),(0,o.jsx)("div",{className:"font-medium",children:n})]})})})})},en=()=>{let e=(0,x.Yh)(),t=(0,x.Jf)(),n=()=>{e.setScreen(N.z2.Preferences),t.setScreen(N.JY.Billing)};return(0,o.jsx)(et,{icon:(0,o.jsx)(ee.Z,{className:"w-6"}),children:(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{children:"Payment is required to continue using Reflect."})," ",(0,o.jsx)("a",{onClick:()=>n(),className:"cursor-pointer underline",children:"Go to billing →"})]})})},er=()=>{let e=(0,x.Yh)(),t=(0,x.Jf)(),n=()=>{e.setScreen(N.z2.Preferences),t.setScreen(N.JY.Billing)};return(0,o.jsx)(et,{icon:(0,o.jsx)(ee.Z,{className:"w-6"}),children:(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{children:"Your notes are in read-only mode."})," ",(0,o.jsx)("a",{onClick:()=>n(),className:"cursor-pointer underline",children:"Subscribe to continue using Reflect →"})]})})},ea=(0,f.Pi)(()=>{let e=(0,x.xJ)();return(null==e?void 0:e.subscriptionStatus)==="missing"||(null==e?void 0:e.subscriptionStatus)==="paymentRequired"?(0,o.jsxs)("div",{className:"flex-none",children:["missing"===e.subscriptionStatus&&(0,o.jsx)(er,{}),"paymentRequired"===e.subscriptionStatus&&(0,o.jsx)(en,{})]}):null});var es=n(68186);function ei(e,t){(0,l.useEffect)(()=>{let t=t=>{t.data.command&&e(t.data)};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},t)}let eo=(0,f.Pi)(()=>{var e,t;let n=(0,x.Pw)(),r=(0,x.BG)(),a=(0,x.Fq)(),s=null==a?void 0:a.noteStore;return ei(e=>{switch(e.command){case"create-note":n.createAndEditNote();break;case"select-daily-note":n.openTodaysNoteDailyScreen();break;case"open-search":case"toggle-search":n.openSearchModal();break;case"open-shortcuts":case"toggle-shortcuts":n.toggleShortcutsModal();break;case"toggle-semi-screen":n.toggleSemiScreen();break;case"open-url":n.handleDeepLink(e.args.url)}},[n]),(0,es.y)("mod+Slash",e=>{e.preventDefault(),n.toggleShortcutsModal()}),(0,es.y)(Q.Zx?["mod+n","mod+ctrl+n"]:["ctrl+n","ctrl+alt+n"],e=>{e.preventDefault(),n.closeModal(),n.createAndEditNote()}),(0,es.y)(Q.Zx?["mod+shift+n","mod+ctrl+shift+n"]:["ctrl+shift+n","ctrl+alt+shift+n"],e=>{e.preventDefault(),n.closeModal(),n.createAndEditNote({},{secondary:!0})}),(0,es.y)(["mod+d","mod+shift+d"],e=>{e.preventDefault(),n.openTodaysNoteDailyScreen()}),(0,es.y)(["mod+shift+l","mod+shift+a"],e=>{e.preventDefault(),n.openListScreen()}),(0,es.y)("mod+shift+t",e=>{e.preventDefault(),n.openTaskView()}),(0,es.y)("mod+shift+m",e=>{e.preventDefault(),n.openMapScreen()}),(0,es.y)("mod+shift+f",e=>{e.preventDefault(),n.toggleSemiScreen()}),(0,es.y)(["mod+alt+shift+ArrowLeft","mod+alt+ArrowLeft"],()=>n.focusPrimary(),{enabled:n.screenIsEditOrDaily&&!n.modal}),(0,es.y)(["mod+alt+shift+ArrowRight","mod+alt+ArrowRight"],()=>n.focusSecondary(),{enabled:n.screenIsEditOrDaily&&!n.modal}),(0,es.y)("Escape",e=>{e.defaultPrevented||(e.preventDefault(),n.closeSecondary())},{capture:!0,enabled:!n.modal&&!!(null==s?void 0:s.secondaryEditorView.hasSelectedNote)}),(0,es.y)("Escape",e=>{e.defaultPrevented||(e.preventDefault(),n.setSemiScreenUser(!1))},{capture:!0,enabled:!n.modal&&n.semiScreenUser}),(0,es.y)("Escape",e=>{e.defaultPrevented||(e.preventDefault(),n.clearEditorSearch())},{enabled:(null===(e=n.dailyEditorView)||void 0===e?void 0:e.searchEnabled)||(null===(t=n.primaryEditorView)||void 0===t?void 0:t.searchEnabled)}),(0,es.y)(["mod+1","mod+2","mod+3","mod+4","mod+5","mod+6","mod+7","mod+8","mod+9"],e=>{if(Q.d){e.preventDefault();let t=Number.parseInt(e.key.replace(/\D/,""),10),n=r.graphs[t-1];n&&r.setCurrentGraph(n)}}),(0,es.y)(["mod+o"],e=>{let t=n.selectedNote;t&&(e.preventDefault(),null==s||s.togglePinned(t))},{enabled:n.noteHasFocus}),(0,es.y)(["mod+p","mod+k"],e=>{e.preventDefault(),n.toggleSearchModal()}),null});var el=n(4814);let ed=e=>{let{active:t,children:n,persist:r=!0}=e,a="function"==typeof n,[s,i]=(0,l.useState)(null);return(0,l.useEffect)(()=>{t?s||i(a?n():n):r||i(null)},[t]),(0,o.jsx)("div",{tabIndex:t?void 0:-1,className:(0,el.Z)("tab absolute inset-0 flex flex-1 flex-col",!t&&"pointer-events-none -translate-x-full -translate-y-full"),children:s})},ec=e=>{let{children:t}=e;return(0,o.jsx)("div",{className:"relative flex flex-1 flex-col overflow-hidden",children:t})},eu=w()(()=>n.e(5052).then(n.bind(n,55052)).then(e=>e.NoteShow),{loadableGenerated:{webpack:()=>[55052]},ssr:!1}),eh=(0,f.Pi)(()=>(0,o.jsx)("div",{className:"flex h-full w-full flex-1 flex-col items-center justify-center overflow-hidden",children:(0,o.jsx)("div",{className:"space-y-6 text-center",children:(0,o.jsx)("h3",{className:"text-base text-gray-400",children:"Unknown note"})})})),ep=w()(()=>n.e(6251).then(n.bind(n,46251)).then(e=>e.NotesLoading),{loadableGenerated:{webpack:()=>[46251]},ssr:!1});var em=n(6987),ef=n(16137),ex=n(57162),eg=n(62390);let ev=e=>{let{className:t}=e;return(0,o.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 6.5C8.96243 6.5 6.5 8.96243 6.5 12C6.5 15.0376 8.96243 17.5 12 17.5C15.0376 17.5 17.5 15.0376 17.5 12C17.5 8.96243 15.0376 6.5 12 6.5ZM5 12C5 8.13401 8.13401 5 12 5C15.866 5 19 8.13401 19 12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12Z",fill:"currentColor"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 8C12.4142 8 12.75 8.33579 12.75 8.75V11.6893L13.7803 12.7197C14.0732 13.0126 14.0732 13.4874 13.7803 13.7803C13.4874 14.0732 13.0126 14.0732 12.7197 13.7803L11.4697 12.5303C11.329 12.3897 11.25 12.1989 11.25 12V8.75C11.25 8.33579 11.5858 8 12 8Z",fill:"currentColor"})]})},ey=e=>{let{className:t}=e;return(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7093 6.25089C13.3771 4.58304 16.0812 4.58303 17.7491 6.25089C19.417 7.91875 19.417 10.6229 17.7491 12.2907L16.2595 13.7803C15.9666 14.0732 15.4917 14.0732 15.1989 13.7803C14.906 13.4874 14.906 13.0126 15.1989 12.7197L16.6884 11.2301C17.7705 10.148 17.7705 8.39362 16.6884 7.31155C15.6064 6.22948 13.852 6.22948 12.7699 7.31155L11.2803 8.80115C10.9874 9.09404 10.5126 9.09404 10.2197 8.80115C9.92678 8.50825 9.92678 8.03338 10.2197 7.74049L11.7093 6.25089ZM14.7803 9.21967C15.0732 9.51256 15.0732 9.98744 14.7803 10.2803L10.2803 14.7803C9.98744 15.0732 9.51256 15.0732 9.21967 14.7803C8.92678 14.4874 8.92678 14.0126 9.21967 13.7197L13.7197 9.21967C14.0126 8.92678 14.4874 8.92678 14.7803 9.21967ZM8.80115 10.2197C9.09404 10.5126 9.09404 10.9874 8.80115 11.2803L7.31155 12.7699C6.22948 13.852 6.22948 15.6064 7.31155 16.6884C8.39362 17.7705 10.148 17.7705 11.2301 16.6884L12.7197 15.1989C13.0126 14.906 13.4874 14.906 13.7803 15.1989C14.0732 15.4917 14.0732 15.9666 13.7803 16.2595L12.2907 17.7491C10.6229 19.417 7.91875 19.417 6.25089 17.7491C4.58303 16.0812 4.58304 13.3771 6.25089 11.7093L7.74049 10.2197C8.03338 9.92678 8.50825 9.92678 8.80115 10.2197Z",fill:"currentColor"})})},eb=e=>{let{className:t,width:n,height:r}=e;return(0,o.jsx)("svg",{width:null!=n?n:24,height:null!=r?r:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.7983 7.78913C14.4128 7.40362 13.7877 7.40362 13.4022 7.78913L11.3891 9.80226C11.313 9.8784 11.2213 9.93726 11.1204 9.97482L8.10618 11.0967L12.9033 15.8938L14.0252 12.8796C14.0628 12.7787 14.1216 12.687 14.1978 12.6109L16.2109 10.5978C16.5964 10.2123 16.5964 9.58724 16.2109 9.20173L14.7983 7.78913ZM12.3416 6.72847C13.3129 5.75718 14.8877 5.75718 15.8589 6.72847L17.2715 8.14107C18.2428 9.11236 18.2428 10.6871 17.2715 11.6584L15.374 13.556L13.9017 17.5116C13.8127 17.7509 13.608 17.9284 13.3585 17.9828C13.1091 18.0372 12.8491 17.9609 12.6685 17.7803L9.97443 15.0862L7.28034 17.7803C6.98745 18.0732 6.51258 18.0732 6.21968 17.7803C5.92679 17.4874 5.92679 17.0126 6.21968 16.7197L8.91377 14.0256L6.21968 11.3315C6.03914 11.151 5.96285 10.891 6.01721 10.6415C6.07157 10.392 6.24911 10.1873 6.4884 10.0983L10.444 8.62604L12.3416 6.72847Z",fill:"currentColor"})})},ew=e=>{let{className:t}=e;return(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{d:"M17.25 8.75L15.4967 16.6817C15.2942 17.5978 14.4821 18.25 13.5438 18.25H10.4562C9.51794 18.25 8.70583 17.5978 8.50332 16.6817L6.75 8.75M17.25 8.75H18.25M17.25 8.75H15.25M6.75 8.75H5.75M6.75 8.75H8.75M8.75 8.75V8.75C8.75 7.09315 10.0931 5.75 11.75 5.75H12.25C13.9069 5.75 15.25 7.09315 15.25 8.75V8.75M8.75 8.75H15.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})};var ej=n(27447);let ek=e=>{let{className:t}=e;return(0,o.jsx)("div",{className:"px-[3px] py-[3px] ".concat(t),children:(0,o.jsx)(ej.Z,{className:"h-full w-full"})})};var eN=n(75197),eS=n(73110);let eC={};function eR(e,t){let n=(0,l.useMemo)(()=>eC[t],[t]),[r,a]=(0,l.useState)(null!=n?n:e);return[r,e=>{a(e),eC[t]=e}]}let eI=e=>{let{openKey:t,title:n,children:r}=e,[a,s]=eR(!0,t);return(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsxs)("h3",{onClick:()=>s(!a),className:"group flex items-center px-3.5 text-xs font-medium text-muted-foreground",children:[(0,o.jsx)("span",{className:"flex-1 truncate",children:n}),(0,o.jsx)("span",{className:(0,el.Z)("flex-none group-hover:visible",a&&"invisible"),children:a?(0,o.jsx)(eN.Z,{width:12,height:12}):(0,o.jsx)(eS.Z,{width:12,height:12})})]}),a&&(0,o.jsx)("div",{className:"px-2",children:r})]})};var eE=n(60154),eD=n(48491),eP=n(34462),eT=n(76007),eA=n(28806),eM=n(67135),eL=n(75240),eV=n(60279),eZ=n(46935),eF=n(43884),eO=n(15858),eB=n(34281),ez=n(82410),e_=n(69776),eU=n(15767),eq=n(99613),eG=n.n(eq);class eH{get documentNode(){return this.document?(0,h.hH)(this.document):null}constructor(e){this.id=e.id,this.document=e.document,this.createdAt=e.createdAt,this.platform=e.platform}}var eK=n(63317),eW=n(39833),eY=n(6046),eQ=n(53342),eJ=n(60065),eX=n(77956),e$=n(71157),e0=n(53967);async function e1(e){let{graph:t,noteId:n,encryptionKey:r=t.assertEncryptionKey,skipErrors:a=!1}=e,s=(0,eY.rk)({db:eJ.db,graphId:t.id,noteId:n}),i=(await eX.RZ.getDocs(s)).docs.map(e=>{let t={snapshot:e,noteId:n,encryptionKey:r};return a?e5(t):e2(t)});return(await Promise.all(i)).filter(eQ.Dw)}async function e5(e){try{return await e2(e)}catch(t){return console.warn("skipping backup",e.noteId,e.snapshot.id),(0,e$.Tb)(t),null}}async function e2(e){var t;let{encryptionKey:n,noteId:r,snapshot:a}=e,s=a.data(),i=a.id;if(!s)return;let o=await (0,e0.MJ)({type:"CommitBackup",value:s.document_json,key:n,itemId:r}),l=o?JSON.parse(o):void 0;if(l)return new eH({id:i,document:l,createdAt:null===(t=s.created_at)||void 0===t?void 0:t.toMillis(),platform:s.platform})}var e7=n(27999);class e9{dispose(){}setLoading(e){this.loading=e}setCommits(e){let{saved:t,backups:n}=e;this.savedCommits=t,this.commitBackups=n}reset(){this.savedCommits=[],this.commitBackups=[],this.selectedCommit=null}get allCommits(){return[...this.savedCommits,...this.commitBackups]}get sortedCommits(){return eG()(this.allCommits,e=>e.createdAt,"desc")}get selectedCommitHtml(){let e=this.selectedCommitNode;return e?(0,h.eJ)(e):""}get selectedCommitNode(){return this.nodeForCommit(this.selectedCommit)}nodeForCommit(e){return e instanceof eL.o?this.nodeForSavedCommit(e):e instanceof eH?this.nodeForBackupCommit(e):null}nodeForSavedCommit(e){if(e.documentNode)return e.documentNode;let t=this.savedCommits.indexOf(e);(0,eW.hu)(-1!==t,"selected commit not found in saved commits");let n=this.buildInitialYdoc(t);for(let e=0;e<=t;e++){var r;let t=this.savedCommits[e];(0,eK.Bu)(n,null!==(r=t.yjsUpdates)&&void 0!==r?r:[])}return(0,eK.gc)(n)}buildInitialYdoc(e){let t=new h.pU.Doc;for(let n=e;n>=0;n--){let e=this.savedCommits[n];if(e.yjsDocAsUpdate){h.pU.applyUpdate(t,e.yjsDocAsUpdate);break}}return t}nodeForBackupCommit(e){return e.documentNode}selectCommit(e){this.selectedCommit=e}selectFirstCommit(){var e;this.selectCommit(null!==(e=this.sortedCommits[0])&&void 0!==e?e:null)}async loadCommits(){if(this.reset(),!this.note)throw Error("blank note");if(!this.note.graph)return;this.setLoading(!0);let e=this.note.assertGraph,t=this.note.id,[n,r]=await Promise.all([(0,e7.c2)({graph:e,noteId:t,afterCommitId:null,skipErrors:!0}),e1({graph:e,noteId:t,skipErrors:!0})]);this.setCommits({saved:n,backups:r}),this.selectFirstCommit(),this.setLoading(!1)}restoreSelectedCommit(){this.selectedCommit&&this.restoreCommit(this.selectedCommit)}async restoreCommit(e){let t=this.note.assertNoteStore,n=this.nodeForCommit(e),r=n?(0,h.FT)(n):null,a=r?await t.createRecoveredNote({note:this.note,document:r}):null;a&&this.mainView.editNote(a)}constructor({note:e,mainView:t}){this.loading=!1,this.savedCommits=[],this.commitBackups=[],this.selectedCommit=null,this.note=e,this.mainView=t,(0,m.makeObservable)(this)}}(0,eU.gn)([m.observable],e9.prototype,"mainView",void 0),(0,eU.gn)([m.observable],e9.prototype,"note",void 0),(0,eU.gn)([m.observable],e9.prototype,"loading",void 0),(0,eU.gn)([m.observable],e9.prototype,"savedCommits",void 0),(0,eU.gn)([m.observable],e9.prototype,"commitBackups",void 0),(0,eU.gn)([m.observable],e9.prototype,"selectedCommit",void 0),(0,eU.gn)([m.action],e9.prototype,"setLoading",null),(0,eU.gn)([m.action],e9.prototype,"setCommits",null),(0,eU.gn)([m.action],e9.prototype,"reset",null),(0,eU.gn)([m.computed],e9.prototype,"allCommits",null),(0,eU.gn)([m.computed],e9.prototype,"sortedCommits",null),(0,eU.gn)([m.computed],e9.prototype,"selectedCommitHtml",null),(0,eU.gn)([m.computed],e9.prototype,"selectedCommitNode",null),(0,eU.gn)([m.action],e9.prototype,"selectCommit",null);let e3=(0,f.Pi)(e=>{let{onClose:t,note:n}=e,r=(0,x.Pw)(),a=(0,eF.D)(()=>new e9({note:n,mainView:r}),[n,r]),s=(0,eZ.Fg)(),i=()=>{a.restoreSelectedCommit(),t()};return(0,l.useEffect)(()=>{a.loadCommits()},[a]),(0,o.jsx)(eV.o,{onClose:t,children:(0,o.jsxs)("div",{className:"flex h-[90vh] max-h-[40rem] overflow-hidden rounded-lg border border-bluegray-200 dark:border-bluegray-800",children:[(0,o.jsx)("div",{className:"relative flex flex-1 flex-col overflow-scroll text-left",children:a.loading?(0,o.jsx)(M.T,{}):(0,o.jsx)("div",{className:"flex-1 select-text overflow-auto p-8",children:a.selectedCommitHtml?(0,o.jsx)(h.d1,{size:"sm",html:a.selectedCommitHtml,dark:"dark"===s}):null})}),(0,o.jsxs)("div",{className:"flex flex-col border-l border-bluegray-200 dark:border-bluegray-800 lg:min-w-72",children:[(0,o.jsxs)("div",{className:"flex flex-1 flex-col overflow-auto",children:[a.sortedCommits.map(e=>(0,o.jsxs)("div",{onClick:()=>a.selectCommit(e),className:(0,el.Z)("flex flex-none cursor-pointer flex-col space-y-0.5 px-5 py-3 text-sm","text-bluegray-600 dark:text-near-white","border-b border-bluegray-200 dark:border-bluegray-800",a.selectedCommit===e&&"bg-bluegray-100 dark:bg-bluegray-800"),children:[(0,o.jsxs)("div",{className:"flex justify-between space-x-[2px]",children:[e.createdAt&&(0,o.jsx)("span",{title:new Date(e.createdAt).toUTCString(),className:"font-medium",children:function(e){let t=new Date(e);return(0,e_.Z)(t)?(0,eB.Z)(t,"hh:mm a"):(0,ez.Z)(t)?(0,eB.Z)(t,"eee hh:mm a"):(0,eB.Z)(t,"MM/dd/yyyy")}(e.createdAt)}),(0,o.jsx)("div",{className:"text-bluegray-400 dark:text-near-white",children:e.platform===eO.t4.Web?(0,o.jsx)(eP.Z,{width:16}):e.platform===eO.t4.App?(0,o.jsx)(eT.Z,{width:16}):e.platform===eO.t4.Mobile?(0,o.jsx)(eA.Z,{width:16}):null})]}),(0,o.jsx)("div",{className:"flex space-x-[2px]",children:e instanceof eL.o?(0,o.jsxs)("span",{children:["Commit #",e.id]}):(0,o.jsx)("span",{children:"(Unsaved changes)"})})]},e.id)),!a.loading&&0===a.sortedCommits.length&&(0,o.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,o.jsx)("h3",{className:"text-bluegray-400 dark:text-bluegray-300",children:"No changes yet"})})]}),a.sortedCommits.length>0&&(0,o.jsxs)("footer",{className:"flex flex-none justify-between space-x-3 border-t border-bluegray-200 px-4 py-3 dark:border-bluegray-800",children:[a.selectedCommit&&(0,o.jsx)(C.KM,{title:"Create a new note from ".concat(a.selectedCommit.id),onClick:()=>i(),children:"Restore to new note"}),(0,o.jsx)("a",{className:"inline-flex cursor-pointer items-center justify-center px-3 text-sm font-medium text-bluegray-500 dark:text-near-white",onClick:t,children:"Cancel"})]}),(0,o.jsx)("div",{className:"flex flex-none items-center border-t border-bluegray-200 px-4 py-2 dark:border-bluegray-800",children:(0,o.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://reflect.academy/note-history",className:"inline-flex cursor-pointer space-x-2 text-xs text-bluegray-500 dark:text-bluegray-300",children:[(0,o.jsx)(eM.Z,{width:15,height:15}),(0,o.jsx)("span",{children:"Learn about page history"})]})})]})]})})});var e6=n(53989);let e4=l.forwardRef((e,t)=>{let{onClick:n,variant:r="default",icon:a,shortcut:s,label:i,...l}=e;return(0,o.jsxs)("button",{ref:t,className:"group relative flex w-full cursor-default items-center space-x-2 rounded-lg px-3 py-2 text-start hover:bg-gray-200/50 dark:hover:bg-white/3 dark:hover:text-white",onClick:n,...l,children:[(0,o.jsx)("div",{className:(0,el.Z)("flex h-5 w-5 flex-none items-center justify-center","disabled"===r?"opacity-50":"text-coolgray-400 group-hover:text-coolgray-900 dark:group-hover:text-white"),children:a}),(0,o.jsx)("div",{className:(0,el.Z)("flex-1 text-2xs font-medium","danger"===r?"text-red-500":"","disabled"===r?"opacity-50":""),children:i}),s&&(0,o.jsx)(e6.l,{shortcut:s,className:"invisible group-hover:visible"})]})});e4.displayName="NoteActionItem";let e8=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.dw)(),r=(0,x.Fq)(),a=(0,x.Pw)(),s=(0,y.useRouter)(),i=(0,x.xJ)(),[d,c]=(0,l.useState)(!1),u=()=>{t.deletedAt?confirm("Are you sure? This will delete your note permanently.")&&(t.destroy(),(0,eD.Am)({title:"Deleted",description:"Note was permanently deleted"})):(t.delete(),(0,eD.Am)({title:"Trashed",description:"Note sent to trash"})),a.openListScreen()},h=async()=>{await n.togglePublish(t),await navigator.clipboard.writeText(t.publishUrl),(0,eD.Am)({description:"Public URL copied to clipboard"})};return(0,o.jsxs)(eI,{openKey:"actions",title:"Note actions",children:[d&&(0,o.jsx)(e3,{note:t,onClose:()=>c(!1)}),(0,o.jsx)(e4,{onClick:()=>n.togglePinned(t),label:t.pinned?"Un-pin this note":"Pin this note",icon:(0,o.jsx)(eb,{className:(0,el.Z)(t.pinned&&"text-brand")}),shortcut:"mod+o"}),!t.daily&&(0,o.jsx)(e4,{onClick:()=>u(),variant:t.deletedAt?"danger":"default",icon:(0,o.jsx)(ew,{}),label:t.deletedAt?"Permanently delete":"Move to trash"}),!t.public&&(null==i?void 0:i.isPayingCustomer)&&(0,o.jsx)(e4,{onClick:h,icon:(0,o.jsx)(ey,{}),label:"Share with private link"}),!t.public&&!(null==i?void 0:i.isPayingCustomer)&&(0,o.jsx)(eE.u,{label:"Note publishing is only available for subscribers",delay:100,children:(0,o.jsx)(e4,{icon:(0,o.jsx)(ey,{}),label:"Share with private link",variant:"disabled"})}),t.public&&(0,o.jsx)(e4,{onClick:()=>n.togglePublish(t),icon:(0,o.jsx)(ey,{}),label:"Unpublish link"}),t.deletedAt&&(0,o.jsx)(e4,{onClick:()=>t.restore(),label:"Restore this note",icon:(0,o.jsx)(ek,{})}),(0,o.jsx)(e4,{onClick:()=>c(!0),label:"Show history",icon:(0,o.jsx)(ev,{})}),(null==r?void 0:r.hasFlag("note_debug_export"))&&(0,o.jsx)(e4,{onClick:()=>s.push("/graphs/".concat(r.id,"/").concat(t.id,"/debug/export")),label:"Export debug file",icon:(0,o.jsx)(eg.Z,{className:"w-3"})})]})});var te=n(60682),tt=n(51842),tn=n.n(tt);let tr=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.v_)(),[r,a]=(0,l.useState)(null),s=(0,l.useCallback)(async()=>{t.asin?a(await n.findByAsin(t.asin)):a(null)},[n,t.asin]);return((0,l.useEffect)(()=>{s()},[t.asin,s]),r)?(0,o.jsxs)("div",{className:"flex space-x-4",children:[(0,o.jsxs)("div",{className:"relative flex h-10 w-10 flex-none items-center justify-center overflow-hidden rounded-md",children:[(0,o.jsx)(te.Z,{className:"h-8 w-8 text-bluegray-200"}),r.coverSrc&&(0,o.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(r.coverSrc,")")}})]}),(0,o.jsx)("div",{className:"flex flex-1 flex-col space-y-2",children:(0,o.jsx)("h3",{className:"overflow-hidden text-sm leading-none text-primary",children:(0,o.jsx)("a",{href:r.listingUrl,target:"_blank",title:r.title,rel:"noreferrer",children:tn()(r.title,{length:30})})})})]}):null});var ta=n(31601),ts=n(32137);let ti=e=>{let{className:t}=e;return(0,o.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.75 6.5C7.50736 6.5 6.5 7.50736 6.5 8.75V15.25C6.5 16.4926 7.50736 17.5 8.75 17.5H15.25C16.4926 17.5 17.5 16.4926 17.5 15.25V8.75C17.5 7.50736 16.4926 6.5 15.25 6.5H8.75ZM5 8.75C5 6.67893 6.67893 5 8.75 5H15.25C17.3211 5 19 6.67893 19 8.75V15.25C19 17.3211 17.3211 19 15.25 19H8.75C6.67893 19 5 17.3211 5 15.25V8.75Z",fill:"currentColor"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 12.246C9.00002 11.8318 9.33581 11.4961 9.75003 11.4961L10.25 11.4961C10.6642 11.4961 11 11.8319 11 12.2461C11 12.6603 10.6642 12.9961 10.25 12.9961L9.74997 12.9961C9.33576 12.9961 8.99998 12.6603 9 12.246Z",fill:"currentColor"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 8.75C5 6.67893 6.67893 5 8.75 5H15.25C17.3211 5 19 6.67893 19 8.75V9.25C19 9.66421 18.6642 10 18.25 10H5.75C5.33579 10 5 9.66421 5 9.25V8.75Z",fill:"currentColor"})]})},to=e=>{let{className:t}=e;return(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.7996 8.23966C15.0814 8.5432 15.0639 9.01775 14.7603 9.2996L11.8522 12L14.7603 14.7004C15.0639 14.9823 15.0814 15.4568 14.7996 15.7603C14.5177 16.0639 14.0432 16.0815 13.7397 15.7996L10.2397 12.5496C10.0868 12.4077 10 12.2086 10 12C10 11.7915 10.0868 11.5923 10.2397 11.4504L13.7397 8.20041C14.0432 7.91856 14.5177 7.93613 14.7996 8.23966Z",fill:"currentColor"})})},tl=e=>{let{className:t}=e;return(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2004 8.23966C9.91855 8.5432 9.93613 9.01775 10.2397 9.2996L13.1478 12L10.2397 14.7004C9.93613 14.9823 9.91855 15.4568 10.2004 15.7603C10.4823 16.0639 10.9568 16.0815 11.2603 15.7996L14.7603 12.5496C14.9132 12.4077 15 12.2086 15 12C15 11.7915 14.9132 11.5923 14.7603 11.4504L11.2603 8.20041C10.9568 7.91856 10.4823 7.93613 10.2004 8.23966Z",fill:"currentColor"})})};var td=n(94523);let tc=(0,f.Pi)(e=>{let{selectedDate:t,onSelectDate:n,weekStart:r}=e,[a,s]=(0,l.useState)(!1),i=(0,x.dw)(),{cursorDate:d,headers:c,body:u,navigation:h}=(0,ta.ZP)({defaultWeekStart:r===ts.L8.Monday?1:0,defaultDate:t}),p=e=>t.getTime()===e.getTime(),m=e=>i.hasNonEmptyNoteForDate(e);return(0,l.useEffect)(()=>{h.setDate(t)},[t]),(0,l.useEffect)(()=>{(0,td.ZP)(()=>{s(!0)})},[]),(0,o.jsxs)("div",{className:"group min-w-36",children:[(0,o.jsxs)("header",{className:"flex items-center justify-between px-4 py-4",children:[(0,o.jsx)("div",{className:"cursor-default text-sm font-semibold text-coolgray-900 dark:text-near-white",children:(0,eB.Z)(d,"MMMM yyyy")}),(0,o.jsxs)("nav",{className:"flex items-center justify-center space-x-1 text-coolgray-400",children:[(0,o.jsx)("button",{onClick:h.toPrev,className:"cursor-default rounded-md transition-colors duration-100 hover:bg-gray-200/50 hover:text-coolgray-900 dark:hover:bg-white/5 dark:hover:text-white",children:(0,o.jsx)(to,{})}),(0,o.jsx)(eE.u,{label:"Jump to Today",shortcut:"mod+d",children:(0,o.jsx)("button",{onClick:()=>{h.setToday(),n(new Date)},className:"cursor-default rounded-md transition-colors duration-100 hover:bg-gray-200/50 hover:text-coolgray-900 dark:hover:bg-white/5 dark:hover:text-white",children:(0,o.jsx)(ti,{})})}),(0,o.jsx)("button",{onClick:h.toNext,className:"cursor-default rounded-md transition-colors duration-100 hover:bg-gray-200/50 hover:text-coolgray-900 dark:hover:bg-white/5 dark:hover:text-white",children:(0,o.jsx)(tl,{})})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"calendar-weekdays grid grid-cols-7 border-b border-coolgray-900/5 px-4 text-center dark:border-white/10",children:c.weekDays.map(e=>{let{key:t,value:n}=e;return(0,o.jsx)("div",{className:"py-2 text-2xs font-medium text-coolgray-900 dark:text-near-white",children:(0,eB.Z)(n,"EEEEEE")},t)})}),(0,o.jsx)("div",{className:"px-4 py-2",children:u.value.map(e=>{let{key:t,value:r}=e;return(0,o.jsx)("div",{className:"grid grid-cols-7 text-center",children:r.map(e=>{let{key:t,date:r,isCurrentMonth:s,value:i}=e;return(0,o.jsx)(tu,{date:i,dayOfMonth:r,selected:p(i),isCurrentMonth:s,onSelectDate:n,showPresent:a&&m(i)},t)})},t)})})]})]})}),tu=e=>{let{date:t,selected:n,onSelectDate:r,isCurrentMonth:a,showPresent:s,dayOfMonth:i}=e;return(0,o.jsxs)("div",{onClick:()=>r(t),className:(0,el.Z)("calendar-day relative py-1.5 text-2xs",!a&&!n&&"opacity-20"),children:[n&&(0,o.jsx)(th,{className:"bg-primary dark:bg-primary-dk"}),!n&&(0,e_.Z)(t)&&(0,o.jsx)(th,{className:"bg-gray-200/50 dark:bg-gray-700/50"}),s&&(0,o.jsx)("div",{className:"pointer-events-none absolute bottom-1 left-1/2 -ml-0.5 h-1 w-1 rounded-full bg-primary/50 opacity-0 transition-opacity group-hover:opacity-100 dark:bg-white/50"}),(0,o.jsx)("div",{className:(0,el.Z)("relative cursor-default rounded-full duration-500",n&&"font-bold text-primary-foreground dark:text-primary"),children:i})]})},th=e=>{let{className:t=""}=e;return(0,o.jsx)("div",{className:"absolute left-[50%] top-[50%] ml-[-16px] mt-[-16px] h-[32px] w-[32px] rounded-md ".concat(t)})},tp=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.nB)(),r=(0,x.Jf)();return(0,o.jsx)(tc,{selectedDate:t.dailyOrCreatedDate,weekStart:r.weekStart,onSelectDate:e=>n.setSelectedDate(e,{scroll:!0,edge:"subject_end"})})});var tm=n(64615),tf=n(75258),tx=n(98230),tg=n(42291),tv=n(68448);let ty=e=>{var t,n,r,a;let{company:s,domain:i,name:l}=e;return(0,o.jsxs)("div",{className:"flex space-x-4",children:[(0,o.jsxs)("div",{className:"relative flex h-10 w-10 flex-none items-center justify-center overflow-hidden",children:[(0,o.jsx)(tm.Z,{className:"h-8 w-8 text-coolgray-200"}),(null==s?void 0:s.logo)&&(0,o.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(s.logo,")")}})]}),(0,o.jsxs)("div",{className:"flex flex-1 flex-col space-y-2",children:[(0,o.jsx)("h3",{className:"text-sm leading-none text-primary",children:(0,o.jsx)("a",{href:"http://".concat(i),target:"_blank",rel:"noreferrer",children:l})}),(null==s?void 0:s.description)?(0,o.jsx)("div",{className:"text-2xs",title:null==s?void 0:s.description,children:tn()(null==s?void 0:s.description,{length:100})}):null,(0,o.jsxs)("div",{className:"flex space-x-3",children:[(null==s?void 0:null===(t=s.twitter)||void 0===t?void 0:t.handle)&&(0,o.jsx)("a",{href:"https://twitter.com/".concat(null==s?void 0:s.twitter.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tf.j,{className:"w-4"})}),(null==s?void 0:null===(n=s.github)||void 0===n?void 0:n.handle)&&(0,o.jsx)("a",{href:"https://github.com/".concat(null==s?void 0:s.github.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tx.R,{className:"w-4"})}),(null==s?void 0:null===(r=s.facebook)||void 0===r?void 0:r.handle)&&(0,o.jsx)("a",{href:"https://facebook.com/".concat(null==s?void 0:s.facebook.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tg.d,{className:"w-4"})}),(null==s?void 0:null===(a=s.linkedin)||void 0===a?void 0:a.handle)&&(0,o.jsx)("a",{href:"https://linkedin.com/".concat(null==s?void 0:s.linkedin.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tv.m,{className:"w-4"})})]})]})]})};class tb{dispose(){}async fetchContact(){let e=await this.contactStore.findByEmail(this.note.firstEmail);this.setContact(e)}setContact(e){this.contact=e}constructor(e,t){this.contactStore=e,this.note=t,this.contact=null,(0,m.makeObservable)(this),this.fetchContact()}}(0,eU.gn)([m.observable],tb.prototype,"contact",void 0),(0,eU.gn)([m.action],tb.prototype,"setContact",null);var tw=n(18975);let tj=e=>{var t,n,r,a,s;let{person:i,avatar:l,name:d}=e,c=(null==i?void 0:null===(t=i.linkedin)||void 0===t?void 0:t.handle)&&"https://linkedin.com/".concat(null==i?void 0:i.linkedin.handle),u=(null==i?void 0:i.site)||c;return(0,o.jsxs)("div",{className:"flex space-x-4",children:[(0,o.jsxs)("div",{className:"relative flex h-10 w-10 flex-none items-center justify-center overflow-hidden rounded-md",children:[(0,o.jsx)(tw.Z,{className:"h-8 w-8 text-bluegray-200"}),l&&(0,o.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(l,")")}})]}),(0,o.jsxs)("div",{className:"flex flex-1 flex-col space-y-2",children:[(0,o.jsx)("h3",{className:"text-sm leading-none text-primary",children:u?(0,o.jsx)("a",{href:u,target:"_blank",rel:"noreferrer",children:d}):d}),(null==i?void 0:i.bio)||(null==i?void 0:i.employment.title)?(0,o.jsx)("div",{className:"text-sm",children:tn()(i.bio||i.employment.title||void 0,{length:100})}):null,(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(null==i?void 0:null===(n=i.twitter)||void 0===n?void 0:n.handle)&&(0,o.jsx)("a",{href:"https://twitter.com/".concat(null==i?void 0:i.twitter.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tf.j,{className:"w-4"})}),(null==i?void 0:null===(r=i.github)||void 0===r?void 0:r.handle)&&(0,o.jsx)("a",{href:"https://github.com/".concat(null==i?void 0:i.github.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tx.R,{className:"w-4"})}),(null==i?void 0:null===(a=i.facebook)||void 0===a?void 0:a.handle)&&(0,o.jsx)("a",{href:"https://facebook.com/".concat(null==i?void 0:i.facebook.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tg.d,{className:"w-4"})}),(null==i?void 0:null===(s=i.linkedin)||void 0===s?void 0:s.handle)&&(0,o.jsx)("a",{href:"https://linkedin.com/".concat(null==i?void 0:i.linkedin.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,o.jsx)(tv.m,{className:"w-4"})})]})]})]})},tk=(0,f.Pi)(e=>{var t;let{note:n}=e,r=(0,x.sx)(),a=(0,eF.D)(()=>new tb(r,n),[r,n]).contact,{person:s,company:i}=n.enrichment||{},l=(null==s?void 0:null===(t=s.name)||void 0===t?void 0:t.fullName)||(null==a?void 0:a.name),d=(null==s?void 0:s.avatar)||(null==a?void 0:a.photoUrl),c=null==i?void 0:i.name,u=null==i?void 0:i.domain;return l||c||u?(0,o.jsxs)("div",{className:"space-y-4 border-t border-b border-coolgray-900/5 px-4 py-4",children:[l&&(0,o.jsx)(tj,{name:l,avatar:d,person:s}),c&&u&&(0,o.jsx)(ty,{name:c,domain:u,company:i})]}):null});var tN=n(7665);async function tS(e){let t,{meeting:n,backlinkMeeting:r,note:a,noteStore:s}=e,i=s.assertRootStore,{currentUserAssociatedEmails:o}=i,{timeFormat:l}=i.preferenceStore,d=s.assertGraph;await s.attachNote(a);let c=[];for(let e of n.buildContacts(o)){let t=await s.findOrCreateByContact(e);c.push(t)}if(r&&n.name){var u;(t=null!==(u=await s.findByTagAndSubject(x.O9,n.name))&&void 0!==u?u:void 0)||(t=await s.createNote({subject:n.name,document:(0,h.FT)((0,x._F)(n,d.id))}))}a.addMeeting({meeting:n,meetingNote:t,attendeeNotes:c,timeFormat:l}),d.findOrCreateTag(x.O9),await Promise.all(n.attendees.map(e=>tC(e)))}async function tC(e){let t=e.id,n=e.email,r=e.nameWithFallback;n&&r&&await (0,tN.Ms)({email:n,customName:r,contactId:t})}var tR=n(64467),tI=n(89252),tE=n(7653),tD=n(71357),tP=n(47329),tT=n(11161),tA=n(82317);class tM{get attendees(){return this.draftMeeting.getValidAttendees(this.invalidEmails)}submit(){this.draftMeeting.submit();let e=this.draftMeeting.model;return e.clearBlankAttendees(),e}dispose(){}constructor({invalidEmails:e,meeting:t}){this.invalidEmails=[],this.invalidEmails=e,this.draftMeeting=(0,tA.GC)(t),(0,m.makeObservable)(this)}}(0,eU.gn)([m.observable],tM.prototype,"invalidEmails",void 0),(0,eU.gn)([m.observable],tM.prototype,"draftMeeting",void 0),(0,eU.gn)([m.computed],tM.prototype,"attendees",null);var tL=n(91307),tV=n(68405);async function tZ(e){let{attendee:t,contactStore:n}=e;await tF({attendee:t,contactStore:n}),await tO(t)}async function tF(e){let{attendee:t,contactStore:n}=e;if(!t.email)return;let r=await n.findByEmail(t.email);(null==r?void 0:r.name)&&t.setName(r.name)}async function tO(e){var t;if(e.enrichedName||e.nameWithFallback||!e.email||!/.@./.test(e.email))return;let n=await (0,tV.I)({email:e.email});(null==n?void 0:null===(t=n.person)||void 0===t?void 0:t.email)===e.email&&e.setEnrichment(n)}let tB=(0,f.Pi)(e=>{var t,n;let{attendee:r,onDelete:a}=e,s=(0,x.sx)();return(0,l.useEffect)(()=>{tZ({attendee:r,contactStore:s})},[r,s]),(0,o.jsxs)("div",{className:"relative flex space-x-2",children:[(0,o.jsx)(tP.o,{value:null!==(t=r.email)&&void 0!==t?t:"",onChange:e=>r.setEmail(e),onBlur:()=>tO(r),type:"email",placeholder:"Email"}),(0,o.jsx)(tP.o,{value:null!==(n=r.nameWithFallback)&&void 0!==n?n:"",onChange:e=>r.setName(e),required:!!r.email,placeholder:"Name"}),(0,o.jsx)("div",{className:"absolute inset-y-0 right-0 flex w-8 flex-none items-center justify-center",children:(0,o.jsx)("a",{onClick:a,title:"Remove attendee",className:"cursor-pointer p-1 text-coolgray-400 transition duration-100 hover:text-coolgray-600 dark:text-near-white hover:dark:text-white",children:(0,o.jsx)(tL.Z,{className:"w-4"})})})]})}),tz=(0,f.Pi)(e=>{var t;let{meeting:n,onClose:r,onAddMeeting:a}=e,{currentUserAssociatedEmails:s}=(0,x.Yh)(),[i,d]=(0,l.useState)(n.recurring),c=(0,eF.D)(()=>new tM({meeting:n,invalidEmails:s}),[n,s]),{draftMeeting:u,attendees:h}=c,p=()=>{a(c.submit(),i)};return(0,l.useEffect)(()=>{u.hasEmptyLastAttendee||u.addBlankAttendee()},[u.hasEmptyLastAttendee,u]),(0,es.y)("mod+Enter",e=>{e.preventDefault(),p()}),(0,o.jsx)(tD.u,{onClose:r,children:(0,o.jsxs)("div",{className:"flex min-h-[400px] w-[460px] flex-1 flex-col px-10 py-10",children:[(0,o.jsx)("h3",{className:"flex-none text-center text-2xl font-medium leading-6",children:"Add meeting"}),(0,o.jsx)("div",{className:"mt-10 flex flex-1 flex-col",children:(0,o.jsxs)("form",{className:"flex flex-1 flex-col",onSubmit:e=>{e.preventDefault(),p()},children:[(0,o.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,o.jsx)("div",{children:(0,o.jsxs)("label",{className:"block space-y-1.5 text-sm font-medium",children:[(0,o.jsx)("span",{children:"Name"}),(0,o.jsx)(tP.o,{value:null!==(t=u.name)&&void 0!==t?t:"",onChange:e=>u.setName(e),autoFocus:!(0,tT.W)(),autoComplete:"meeting-name"})]})}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("h3",{className:"block text-sm font-medium",children:"Attendees"}),h.length>0?(0,o.jsx)("button",{type:"button",className:"cursor-pointer rounded-md bg-coolgray-200/50 px-1.5 py-0.5 text-xs text-coolgray-400 outline-none transition duration-300 ease-in-out hover:text-coolgray-900 focus-visible:ring focus-visible:ring-indigo-500 dark:bg-white/5 dark:text-white dark:hover:text-white",onClick:()=>u.clearAttendees(),children:"Clear all"}):null]}),(0,o.jsx)("div",{className:"mt-1.5 space-y-2",children:h.map(e=>(0,o.jsx)(tB,{attendee:e,onDelete:()=>u.removeAttendee(e)},e.id))})]}),(0,o.jsx)("div",{children:(0,o.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium",children:[(0,o.jsx)(tI.X,{checked:i,onChange:e=>d(e)}),(0,o.jsx)("span",{children:"Create backlinked note?"})]})})]}),(0,o.jsx)("footer",{className:"mt-8",children:(0,o.jsxs)(tR.M,{children:[(0,o.jsx)("span",{children:"Add to daily note"}),(0,o.jsx)(tE.f,{title:"command return",shortcut:"mod+Enter",className:"absolute right-2"})]})})]})})]})})});var t_=n(63120);let tU=(0,f.Pi)(e=>{var t;let{meeting:n,onAddMeeting:r,timeFormat:a}=e;return(0,o.jsxs)("div",{onClick:()=>null==r?void 0:r(n),className:"group flex items-center gap-2 overflow-hidden rounded-lg py-2 px-4 text-2xs hover:bg-coolgray-100 dark:hover:bg-white/3 dark:hover:text-white",children:[(0,o.jsx)("div",{className:"flex-1 truncate font-medium",title:"".concat(n.name," - ").concat(n.attendees.map(e=>e.email).join(" / ")),children:n.name}),(0,o.jsx)("div",{className:"min-w-[60px] flex-none tabular-nums text-coolgray-500",children:null!==(t=n.formatStartAtTime(a))&&void 0!==t?t:""}),(0,o.jsx)("div",{className:"flex items-center justify-center",children:(0,o.jsx)(eE.u,{label:"Add meeting to daily note",children:(0,o.jsx)("button",{className:"inline-flex cursor-default items-center justify-center rounded-md text-xs font-medium uppercase text-coolgray-400 outline-none transition duration-100 group-hover:text-coolgray-900 dark:group-hover:text-white",children:(0,o.jsx)(t_.Z,{height:15})})})})]})}),tq=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.dw)(),r=(0,x.EC)(),a=(0,x.DV)(),{timeFormat:s}=(0,x.Jf)(),[i,d]=(0,l.useState)(null),c=t.daily,u=(0,l.useCallback)(()=>{r.fetchAllMeetingsForDay(t.dailyOrCreatedDate)},[r,t.dailyOrCreatedDate]),h=async(e,r)=>{d(null),await tS({meeting:e,backlinkMeeting:r,note:t,noteStore:n}),(0,L.yV)({meetingAdded:!0}),(0,L.j)("meeting_added")};if((0,l.useEffect)(()=>{if(!c)return;u();let e=setInterval(()=>{u()},6e5);return()=>{clearInterval(e)}},[t.id,c,a.credentials.length,u]),!c)return null;let p=r.meetingsForDaySorted(t.dailyOrCreatedDate);return 0===p.length?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(eI,{openKey:"meetings",title:"Meetings",children:p.map(e=>(0,o.jsx)(tU,{meeting:e,onAddMeeting:e=>d(e),timeFormat:s},e.id))}),i&&(0,o.jsx)(tz,{meeting:i,onClose:()=>d(null),onAddMeeting:h})]})});var tG=n(95811);let tH=(0,f.Pi)(e=>{let{note:t}=e;if(!t.public)return null;let n=async()=>{await navigator.clipboard.writeText(t.publishUrl),(0,eD.Am)({description:"Public URL copied to clipboard",icon:"check"})};return(0,o.jsx)(eI,{openKey:"published-url",title:"Published URL",children:(0,o.jsxs)("div",{className:"flex items-center overflow-hidden px-4",children:[(0,o.jsx)("a",{target:"_blank",className:"flex-1 truncate text-xs text-primary",href:t.publishUrl,rel:"noreferrer",children:t.publishUrl}),(0,o.jsx)("div",{className:"flex flex-none items-center",children:(0,o.jsx)(eE.u,{label:"Copy to clipboard",delay:400,children:(0,o.jsx)(tG.Z,{onClick:n,className:"h-5 w-5 px-1 text-primary"})})})]})})});var tK=n(44915);let tW=(0,f.Pi)(e=>{var t;let{result:n,onClick:r}=e,a=n.title||(null===(t=n.contentLine)||void 0===t?void 0:t.slice(0,100))||"Untitled note";return(0,o.jsxs)("a",{className:"flex cursor-pointer items-center space-y-1 space-x-1 px-4 text-2xs",onClick:r,children:[(0,o.jsx)("div",{className:"flex-1 truncate",children:a}),(0,o.jsx)("div",{className:"flip",children:(0,o.jsx)(tK.Z,{height:13,width:13})})]})});function tY(e){var t;let{note:n}=e,[r,a]=(0,l.useState)([]),s=null===(t=n.noteStore)||void 0===t?void 0:t.searchStore,i=(0,x.Pw)();async function d(){if(!s)return;let e=n.daily?n.line:"".concat(n.subject,". ").concat(n.line);a((await s.search(e,{type:"embedding",limit:5,similarity:.2})).filter(e=>e.noteId!==n.id))}return((0,l.useEffect)(()=>{(0,td.Kk)(()=>{d()})},[n.rerenderKey,s]),0===r.length)?null:(0,o.jsx)(eI,{openKey:"similar",title:"Similar notes",children:(0,o.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,o.jsx)(tW,{result:e,onClick:t=>{i.editNoteId(e.noteId,{secondary:(null==t?void 0:t.metaKey)||(null==t?void 0:t.ctrlKey)})}},e.id))})})}async function tQ(e,t){let n=await e.findById(t.fromNoteId);if(!n)throw Error("Unknown fromNoteId:"+t.fromNoteId);let r=null;t.toNoteId&&(r=r||await e.findById(t.toNoteId)),t.label&&(r=r||await e.findBySubject(t.label)),r=null!=r?r:await e.createNote({subject:t.label});let a=n.changeManager.modifyDocument(n=>(0,h.Ne)(n,n=>{(0,h.sW)(n,{id:r.id,label:t.label,graphId:e.assertGraph.id})}));return await Promise.all([r.ignoreSuggestedBacklink(t),r.incrementBacklinkedCount(),a])}var tJ=n(16169),tX=n(18453),t$=n(82020);class t0{dispose(){(0,t$.$)(this.listeners)}setShouldRender(e){this.shouldRender=e}setMatchingNotes(e){this.matchingNotes=e}async handleSuggestedBacklinkAdd(e){await tQ(this.noteStore,e)}async handleSuggestedBacklinkAddAll(){let e=this.suggestedIncomingBacklinks;await Promise.all(e.map(e=>tQ(this.noteStore,e)))}get suggestedIncomingBacklinks(){return this.shouldRender?this.matchingNotes.flatMap(e=>{let{node:t}=(0,tX.Q7)(e);return t?(0,x.II)({graphId:this.graphId,fromNoteId:e.id,fromNoteNode:t,toNoteId:this.note.id,queries:this.queries}):[]}).filter(e=>!this.note.ignoredBacklinkFromNoteIds.includes(e.fromNoteId)):[]}async searchNotes(e,t){if(!e)return;if(0===t.length){this.setMatchingNotes([]);return}let n=(await this.noteStore.searchStore.searchCombined(t)).map(e=>e.noteId).filter(eQ.Dw).filter(e=>e!==this.note.id),r=await this.noteStore.table.getMany(n);this.setMatchingNotes(r)}get queries(){return(0,tJ.gO)(this.note.subject).filter(e=>e.length>3)}get graphId(){return this.noteStore.assertGraph.id}get noteAdapter(){return this.noteStore.adapter}constructor(e){this.shouldRender=!1,this.matchingNotes=[],this.listeners=[],this.note=e.note,this.noteStore=e.noteStore,(0,m.makeObservable)(this),(0,td.ZP)(()=>{this.setShouldRender(!0)}),this.listeners.push((0,m.reaction)(()=>[this.shouldRender,this.queries],e=>{let[t,n]=e;this.searchNotes(t,n)}))}}(0,eU.gn)([m.observable],t0.prototype,"note",void 0),(0,eU.gn)([m.observable],t0.prototype,"noteStore",void 0),(0,eU.gn)([m.observable],t0.prototype,"shouldRender",void 0),(0,eU.gn)([m.observable],t0.prototype,"matchingNotes",void 0),(0,eU.gn)([m.action],t0.prototype,"setShouldRender",null),(0,eU.gn)([m.action],t0.prototype,"setMatchingNotes",null),(0,eU.gn)([m.computed],t0.prototype,"suggestedIncomingBacklinks",null),(0,eU.gn)([m.computed],t0.prototype,"queries",null);var t1=n(61670),t5=n(96299),t2=n(94498);let t7=(0,f.Pi)(e=>{var t;let{onClickAdd:n,onClickIgnore:r,backlink:a}=e,s=(0,x.dw)().adapter,i=(0,x.Pw)(),l=s.placeholder(a.fromNoteId),d=(0,eZ.Fg)();return(0,o.jsxs)("div",{className:"space-y-0.5 px-4",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("div",{className:"flex flex-1 items-center space-x-2 overflow-hidden text-primary",title:"Incoming backlink",children:[(0,o.jsx)(t1.Z,{className:"h-3 w-3"}),(0,o.jsx)("a",{className:"flex-1 cursor-pointer truncate text-xs leading-5",onClick:()=>i.editNote((null==l?void 0:l.value)||null),children:null==l?void 0:null===(t=l.value)||void 0===t?void 0:t.subject})]}),(0,o.jsxs)("div",{className:"ml-1 flex flex-none space-x-2",children:[(0,o.jsx)("button",{onClick:r,title:"Ignore suggestion",className:"hover:shadow-outline-purple rounded-md text-gray-300 transition duration-300 ease-in-out",children:(0,o.jsx)(t5.Z,{className:"h-3 w-3"})}),(0,o.jsx)("button",{onClick:n,title:"Add backlink",className:"hover:shadow-outline-purple rounded-md text-green-400 transition duration-300 ease-in-out",children:(0,o.jsx)(t2.Z,{className:"h-3 w-3"})})]})]}),(0,o.jsx)(h.d1,{size:"xs",className:"backlink-html-context overflow-hidden !text-xs text-gray-900 empty:hidden dark:text-near-white",html:a.contextHtml,dark:"dark"===d})]})}),t9=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.dw)(),r=(0,x.Pw)().screenHasFocus(N.oK.NoteEdit),a=(0,eF.D)(()=>new t0({note:t,noteStore:n}),[t,n]),s=a.suggestedIncomingBacklinks;return((0,l.useEffect)(()=>{a.setShouldRender(r)},[a,r]),0===s.length)?null:(0,o.jsxs)(eI,{openKey:"suggested-backlinks",title:"Suggested backlinks",children:[(0,o.jsx)("div",{className:"space-y-1",children:s.map((e,n)=>(0,o.jsx)(t7,{note:t,backlink:e,onClickAdd:()=>a.handleSuggestedBacklinkAdd(e),onClickIgnore:()=>t.ignoreSuggestedBacklink(e)},n))}),(0,o.jsx)("div",{className:"flex justify-end px-4",children:(0,o.jsx)("button",{onClick:()=>a.handleSuggestedBacklinkAddAll(),className:"flex space-x-1 text-xs text-primary",children:(0,o.jsx)("span",{children:"Add all"})})})]})});class t3{dispose(){}async fetchContact(){if(this.note.enrichment||this.note.emails.length>0||this.note.phoneNumbers.length>0)return;let e=await this.contactStore.findByName(this.note.debouncedSubject);this.setContact(e)}setContact(e){this.contact=e}constructor(e,t){this.note=e,this.contactStore=t,this.contact=null,(0,m.makeObservable)(this),this.fetchContact()}}(0,eU.gn)([m.observable],t3.prototype,"contact",void 0),(0,eU.gn)([m.action],t3.prototype,"setContact",null);let t6=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.sx)(),r=(0,eF.D)(()=>new t3(t,n),[t,n]).contact;return!r||t.isContactIgnored(r)?null:(0,o.jsx)(eI,{openKey:"suggested-contact",title:"Suggested contact",children:(0,o.jsxs)("div",{className:"mt-4 flex space-x-4 rounded-md bg-background px-4 py-4 pb-3 shadow-sm",children:[(0,o.jsx)("div",{className:"h-16 w-16 flex-none overflow-hidden rounded-md bg-gray-300",children:r.photoUrl&&(0,o.jsx)("div",{className:"inline-block h-full w-full bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(r.photoUrl,")")}})}),(0,o.jsxs)("div",{className:"flex flex-1 flex-col space-y-2 overflow-hidden",children:[(0,o.jsx)("h3",{className:"text-lg leading-5 text-primary",children:r.name}),(0,o.jsxs)("div",{className:"space-y-1 text-sm text-gray-700",children:[(0,o.jsx)("div",{className:"truncate",children:r.emailValues[0]}),(0,o.jsx)("div",{className:"truncate",children:r.phoneNumberValues[0]})]})]}),(0,o.jsxs)("div",{className:"flex flex-none items-start space-x-2",children:[(0,o.jsx)("button",{onClick:()=>t.ignoreSuggestedContact(r),title:"Ignore suggestion",className:"focus:shadow-outline-purple block cursor-pointer rounded-md text-gray-300 transition duration-300 ease-in-out focus:outline-none",children:(0,o.jsx)(t5.Z,{height:15})}),(0,o.jsx)("button",{onClick:()=>t.addSuggestedContact(r),title:"Add contact",className:"focus:shadow-outline-purple block cursor-pointer rounded-md text-green-400 transition duration-300 ease-in-out focus:outline-none",children:(0,o.jsx)(t2.Z,{height:15})})]})]})})}),t4=(0,f.Pi)(e=>{let{note:t}=e,n=(0,x.DV)();return(0,o.jsx)("div",{className:"flex flex-1 flex-col space-y-5 overflow-auto bg-coolgray-50 capacitor:pt-5 dark:bg-gray-800/30",children:t?(0,o.jsxs)(o.Fragment,{children:[t.daily&&(0,o.jsx)(tp,{note:t}),(0,o.jsxs)("div",{className:"my-4 space-y-4 pb-4",children:[(0,o.jsx)(e8,{note:t}),(0,o.jsx)(tH,{note:t}),(0,o.jsx)(t6,{note:t}),(0,o.jsx)(tr,{note:t}),n.hasCredentials&&(0,o.jsx)(tq,{note:t}),(0,o.jsx)(t9,{note:t}),(0,o.jsx)(tY,{note:t}),!t.daily&&(0,o.jsx)(tk,{note:t})]})]}):null})});var t8=n(31223),ne=n.n(t8);function nt(e,t){let[n,r]=(0,l.useState)(null),a=(0,l.useRef)({width:0,height:0});return(0,l.useLayoutEffect)(()=>{if(!n)return;let t=new ResizeObserver(t=>{let[n]=t,{width:r,height:s}=n.contentRect,i={width:r,height:s};ne()(i,a.current)||null==e||e(i)});return t.observe(n),()=>{t.disconnect()}},[n,...null!=t?t:[]]),r}var nn=n(72874),nr=n(42104),na=n(70063),ns=n(15166);let ni=e=>{let{children:t,getHtml:n}=e;return(0,o.jsx)(na.SV,{fallback:e=>{let{error:t,componentStack:r}=e;return(0,o.jsxs)("div",{className:"select-text",children:[(0,o.jsx)("h1",{className:"text-xl",children:"Sorry, something went wrong!"}),(0,o.jsx)("h2",{className:"text-sm",children:String(t)}),(0,o.jsx)("pre",{className:"text-xs",children:r}),(0,o.jsx)("div",{className:"error-boundary pt-20",dangerouslySetInnerHTML:{__html:n()}})]})},showDialog:!0,beforeCapture:ns.W,children:t})};var no=n(57335);let nl=e=>{let{onClose:t,imgSrc:n}=e;return(0,o.jsx)(R.oU,{onClose:t,children:(0,o.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center p-12",children:[(0,o.jsx)("img",{src:n,className:"max-h-full max-w-full cursor-zoom-out shadow-xl",onClick:t}),(0,o.jsxs)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"mt-5 flex cursor-pointer justify-center space-x-3 dark:text-gray-200",children:[(0,o.jsx)(no.Z,{width:25,height:25}),(0,o.jsx)("span",{children:"See original in a new window"})]})]})})},nd=(0,n(20586).Z)({exact:!0}),nc=/.+@.+/;function nu(e){let{rootStore:t,noteId:n}=e;return async e=>{var r;e.preventDefault();let a=t.assertNoteStore,s=n?await a.findById(n):void 0,{guid:i}=null!==(r=(0,h.XK)(e))&&void 0!==r?r:{};if(i&&s){s.toggleListChecked({guid:i});return}let o=e.target.getAttribute("href");if(!o)return;let l=new URL(function(e){if(!e)return"";switch(nc.test(e)?"email":nd.test(e)?"phone":e.startsWith("https://")?"https":e.startsWith("http://")?"http":null){case"email":return"mailto:".concat(e);case"phone":return"tel:".concat(e);case"http":case"https":return e;default:return"http://".concat(e)}}(o)),{graphStore:d,mainView:c}=t;if("https://reflect.app"===l.origin){let{tag:t,noteId:n,graphId:r}=function(e){var t;let{graphId:n,tag:r,noteId:a}=(null===(t=nh.exec(e))||void 0===t?void 0:t.groups)||{};return"undefined"===n?{tag:r,noteId:a}:{graphId:n,tag:r,noteId:a}}(l.pathname);if(r&&r!==d.currentGraphId&&(d.ensureVolatileGraphId(r),d.setCurrentGraphId(r)),t){c.openNotesListForTag(t),c.closeModal();return}if(n){let t=e.metaKey||e.ctrlKey;c.editNoteId(n,{secondary:t}),c.closeModal();return}}window.open(l.href,"_blank")}}let nh=RegExp("\\/g\\/(?<graphId>[\\w-]+)\\/(?:tag\\/(?<tag>[\\w-]+)|(?<noteId>[\\w-]+))"),np=(0,f.Pi)(e=>{let{backlinks:t,fromNoteId:n,fromNoteSubjects:r,expanded:a=!0,first:s}=e,[i,d]=(0,l.useState)(a),c=(0,x.dw)(),u=(0,x.Pw)(),p=(0,x.Yh)(),m=(0,eZ.Fg)(),f=(0,l.useMemo)(()=>nu({rootStore:p,noteId:n}),[p,n]),g=(0,l.useCallback)(async e=>{let t=await c.findById(n);if(!t)return;let r=e.metaKey||e.ctrlKey;u.editNote(t,{secondary:r})},[n,u,c]);return(0,l.useEffect)(()=>{d(a)},[a]),(0,o.jsxs)("div",{className:(0,el.Z)("note-incoming-backlink-item group relative"),children:[s?null:(0,o.jsx)("div",{className:"relative flex items-center px-10 py-4",children:(0,o.jsx)("div",{className:"w-full border-t border-border"})}),(0,o.jsxs)("div",{className:"relative flex items-center px-10",children:[(0,o.jsx)("a",{className:"relative block cursor-pointer select-text text-2xs text-brand",onClick:g,children:r[n]}),(0,o.jsx)("div",{className:"absolute inset-y-0 left-[15px] flex items-center justify-center",children:(0,o.jsx)("div",{onClick:()=>d(!i),className:(0,el.Z)("increase-click-area hidden transform text-coolgray-400 transition-transform group-hover:block",{"rotate-90":i}),children:(0,o.jsx)(eS.Z,{className:"w-4"})})})]}),i&&(0,o.jsx)("div",{className:"px-10",children:t.map((e,t)=>(0,o.jsx)(h.d1,{onClick:f,html:e.contextHtml,size:"xs",className:"backlink-html-context select-text text-gray-900 transition-all empty:hidden dark:text-near-white",dark:"dark"===m},"incoming-backlink-"+t))})]})});var nm=n(85862);let nf=/(auto|scroll)/;var nx=n(45778),ng=n(91523);class nv{dispose(){}async fetchSubjects(){let e=[...new Set(this.note.incomingBacklinks.map(e=>e.fromNoteId))],t=this.noteStore.table.query().clearSelect().select(["id","subject"]).where("id","in",(0,ng.pP)(e)),n=await this.noteStore.table.adapter.executeSelect(t),r={};for(let{id:e,subject:t}of n)r[e]=t;this.fromNoteSubjects=r,this.setHasFetchedSubjects(!0)}setHasFetchedSubjects(e){this.hasFetchedSubjects=e}get backlinksCount(){return this.note.incomingBacklinks.length}get groupedBacklinks(){return this.note.groupedIncomingBacklinks}constructor(e,t){this.note=e,this.noteStore=t,this.hasFetchedSubjects=!1,this.fromNoteSubjects={},(0,m.makeObservable)(this),this.fetchSubjects()}}(0,eU.gn)([m.observable],nv.prototype,"hasFetchedSubjects",void 0),(0,eU.gn)([m.observable],nv.prototype,"fromNoteSubjects",void 0),(0,eU.gn)([m.action],nv.prototype,"setHasFetchedSubjects",null);let ny=(0,f.Pi)(e=>{let{note:t,expanded:n,scrollParent:r}=e,a=(0,x.dw)(),s=(0,eF.D)(()=>new nv(t,a),[t,a]),[i,d]=(0,l.useState)(600),[c,u]=(0,l.useState)(s.backlinksCount>100);(0,l.useLayoutEffect)(()=>{d(Math.min(600,Math.round(.8*window.innerHeight)))},[]);let[h,{height:p}]=function(e){let[t,n]=(0,l.useState)({width:0,height:0});return[nt(n,void 0),t]}();return((0,l.useLayoutEffect)(()=>{p>=i-20&&u(!0)},[p,i]),s.hasFetchedSubjects)?c?(0,o.jsx)(nx.OO,{className:"mt-5 empty:hidden",style:r?{}:{height:i,maxHeight:"80vh"},customScrollParent:r,data:s.groupedBacklinks,itemContent:(e,t)=>{let[r,a]=t;return(0,o.jsx)(np,{fromNoteId:r,fromNoteSubjects:s.fromNoteSubjects,backlinks:a,expanded:n,first:0===e},r)}}):(0,o.jsx)("div",{className:"mt-5 empty:hidden",ref:h,style:{maxHeight:i},children:s.groupedBacklinks.map((e,t)=>{let[r,a]=e;return(0,o.jsx)(np,{fromNoteId:r,fromNoteSubjects:s.fromNoteSubjects,backlinks:a,expanded:n,first:0===t},r)})}):null}),nb=(0,f.Pi)(e=>{let{note:t}=e,[n,r]=eR(!0,"backlinks-expanded"),[a,s]=eR(!1,"backlinks-hidden"),i=(0,x.Pw)(),d=t.incomingBacklinks.length,c=e=>{e.metaKey||e.ctrlKey?(s(e=>!e),r(!0)):(s(!1),r(e=>!e))};(0,es.y)("ctrl+mod+b",e=>{e.preventDefault(),c(e)},{enabled:i.selectedNote===t});let[u,h]=(0,l.useState)(null),p=(0,l.useMemo)(()=>{if(!t.daily&&u){var e;return null!==(e=function(e){let t=getComputedStyle(e).position;return"fixed"===t?null:function e(t,n){return null===t||1!==t.nodeType?null:n&&"static"===getComputedStyle(t).position?e(t.parentElement,n):nf.test(getComputedStyle(t).overflow+getComputedStyle(t).overflowY+getComputedStyle(t).overflowX)?t:e(t.parentElement,n)}(e.parentElement,"absolute"===t)}(u))&&void 0!==e?e:void 0}},[u,t.daily]);return 0===d?null:(0,o.jsx)("div",{className:"flex flex-none flex-col overflow-hidden pb-8",ref:h,children:(0,o.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,o.jsxs)("h3",{className:"relative flex items-center px-10 text-xs font-medium text-coolgray-400 dark:text-coolgray-600",onClick:c,children:[(0,o.jsxs)("span",{children:["Incoming backlink",d>1?"s":""," (",d,")"]}),(0,o.jsx)("div",{className:"absolute inset-y-0 left-[15px] flex items-center justify-center",children:(0,o.jsx)("div",{className:(0,el.Z)("increase-click-area transform text-bluegray-400 transition-transform",{"rotate-90":n&&!a}),children:a?(0,o.jsx)(nm.Z,{className:"w-4"}):(0,o.jsx)(eS.Z,{className:"w-4"})})})]}),a?null:(0,o.jsx)(ny,{note:t,expanded:n,scrollParent:p},t.id)]})})});var nw=n(71083),nj=n(36556);async function nk(e){let t=await (0,nj.g0)(),n=new URL(location.origin+"/api/cors-proxy");return n.searchParams.append("url",e),await fetch(n.toString(),{method:"GET",headers:t})}let nN=async e=>{(0,eW.Ee)(e,"URL cannot be empty");try{let t=await fetch(e);return await t.blob()}catch(t){try{let t=await nk(e);return await t.blob()}catch(e){console.warn("Failed to fetch file with proxy:",e)}throw console.warn("Failed to fetch file:",t),t}};var nS=n(57558);let nC=async e=>{let{url:t,fileName:n}=e;if(t)try{let e=await fetch(t);if(!e.ok)throw Error("Network response was not ok: ".concat(e.statusText));let r=e.headers.get("content-type"),a=null==r?void 0:r.includes("application/pdf"),s=await e.blob(),i=URL.createObjectURL(s);if(a&&"function"==typeof(null===nS.Z||void 0===nS.Z?void 0:nS.Z.openPreviewWindow))nS.Z.openPreviewWindow(i);else{let e=window.document.createElement("a");e.href=i,e.target="_blank",n&&(e.download=n),e.click(),URL.revokeObjectURL(i)}}catch(e){console.error("Failed to download file",e),window.open(t,"_blank")}};var nR=n(81253),nI=n(41200);function nE(e,t){var n;e.preventDefault(),e.returnValue=t,null===nS.Z||void 0===nS.Z||null===(n=nS.Z.showWarningMessage)||void 0===n||n.call(nS.Z,t)}var nD=n(4837),nP=n(38542);let nT=(0,n(7947).yv)()?"https://reflect-assets.app":"https://dev.reflect-assets.app";async function nA(e){let t,{blob:n,fileName:r,id:a=(0,nI.O)(),metadata:s,onProgress:i,encryption:o}=e,l=await (0,nj.i1)(),d="users/".concat(l.uid,"/").concat(a);if(o){let e={directory:d,blob:n,fileName:r,contentType:n.type},t=(0,nR.n)(nT,e);return await nP.I.put(t,e),t}let c=eX.IG.ref(eJ.tO,d);if(r){let e=encodeURIComponent(r);t="inline; filename*=UTF-8''".concat(e,'; filename="').concat(e,'"')}return await nL({storageRef:c,blob:n,metadata:{contentType:n.type,contentDisposition:t,cacheControl:"private,max-age=31536000",customMetadata:s},onProgress:i}),await eX.IG.getDownloadURL(c)}async function nM(e){let t,{blob:n,fileName:r,id:a=(0,nI.O)(),metadata:s,onProgress:i,encryption:o}=e,l=e=>{nE(e,"Files are currently uploading.")};addEventListener("beforeunload",l,{capture:!0});try{let e=async()=>await nA({blob:n,fileName:r,id:a,metadata:s,onProgress:i,encryption:o});t=await (0,nD.q)(3,e)}catch(e){throw alert("Error uploading file. Please try again and ensure you are online."),e}finally{removeEventListener("beforeunload",l,{capture:!0})}return t}async function nL(e){let{storageRef:t,blob:n,metadata:r,onProgress:a}=e,s=eX.IG.uploadBytesResumable(t,n,r);a&&s.on("state_changed",e=>{a(e.bytesTransferred/e.totalBytes*100)}),await new Promise((e,t)=>s.then(e,t))}function nV(e){return async(t,n)=>{nF(t),e.info("[editorFileUploadHandler] uploading ".concat(t.name));let r=await nM({blob:t,fileName:t.name,onProgress:n,encryption:!0});return e.info("[editorFileUploadHandler] uploaded ".concat(t.name," to ").concat(r)),Promise.resolve({src:r,fileName:t.name})}}function nZ(e){return t=>{nF(t);let{url:n,finished:r}=function(e){let{blob:t,fileName:n}=e,r=(0,nj.rc)();if(!r)throw Error("User not found");let a={directory:"users/".concat(r),blob:t,fileName:n,contentType:t.type},s=(0,nR.n)(nT,a),i=nP.I.put(s,a);return{url:s,finished:i}}({blob:t,fileName:t.name});return e.info("[editorFileUploadSyncHandler] uploading ".concat(t.name," to ").concat(n)),{src:n,fileName:t.name,finished:r}}}function nF(e){if(e.size>52428800)throw alert("File is too large. 50mb is the max allowed size."),Error("File is too large.")}function nO(e){return e.startsWith("reflect-assets://")?e.replace("reflect-assets://","https://"):e}async function nB(e){try{var t,n;return null!==(n=await (null===nS.Z||void 0===nS.Z?void 0:null===(t=nS.Z.getUrlMetadata)||void 0===t?void 0:t.call(nS.Z,e)))&&void 0!==n?n:null}catch(e){return console.warn(e),null}}var nz=n(97708);async function n_(e){let t=await (0,nj.g0)(),n=(0,nz.V)("/api/predict"),r=await fetch(n.url,{method:"POST",headers:{...t,"Content-Type":"application/json"},body:JSON.stringify(e),mode:n.mode});return r.ok?((0,eW.hu)(r.body),{stream:r.body.pipeThrough(new TextDecoderStream)}):(alert(await nU(r)),{stream:new ReadableStream})}async function nU(e){let t=null;try{var n;t=await e.text();let r=JSON.parse(t),a=null==r?void 0:null===(n=r.error)||void 0===n?void 0:n.message;if(a)return String(a)}catch(e){console.error("Error parsing response",e)}return"Error fetching prediction: "+(t||"Unknown error")}var nq=n(74436);let nG="Do not wrap responses in triple quotes. Do not translate the text. Preserve the original markdown formatting, including wikilinks and backlinks.",nH=[{id:"continuation",label:"Write the next paragraph",temperature:.5,optimize:"accuracy",template:'The following text in triple quotes below has already been written:\n\n"""\n{{selectedText}}\n"""\n\nWrite the next paragraph, keeping the same voice and style. Stay on the same topic. Write at least 3 sentences. '.concat(nG)},{id:"sentence-continuation",label:"Continue writing the sentence",temperature:.5,optimize:"accuracy",template:'The following text in triple quotes below has already been written:\n\n"""\n{{selectedText}}\n"""\n\nContinue writing the sentence, keeping the same voice and style. Stay on the same topic. Write 2 sentences. '.concat(nG)},{id:"takeaways",label:"List key takeaways",temperature:.5,optimize:"accuracy",template:'My notes are below in triple quotes:\n\n"""\n{{selectedText}}\n"""\n\nWrite a markdown list (using dashes) of key takeaways from my notes. Write at least 3 items. Do not wrap responses in quotes. Use the original language - do not translate the text.'},{id:"fix-grammar",label:"Fix spelling and grammar",temperature:0,optimize:"speed",template:'Correct the text in triple quotes below into standard English and fix the grammar. Make your best effort.\n\n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the corrected text. '.concat(nG)},{id:"short-summary",label:"Write a short summary",temperature:.7,optimize:"speed",template:'Summarize the text in triple quotes but keep it concise. Summarize using plain and simple language and keep the same tense.\n            \n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the summary. '.concat(nG)},{id:"long-summary",label:"Write a longer summary",temperature:.7,optimize:"speed",template:'Summarize the text in triple quotes below into three long paragraphs. Summarize using plain and simple language and keep the same tense.\n            \n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the summary. '.concat(nG)},{id:"rephrase",label:"Rephrase my writing",temperature:.5,optimize:"accuracy",template:'Rewrite the text in triple below in your own words. Rephrase the text.\n\n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the rephrased text. '.concat(nG)},{id:"simplify",label:"Simplify and condense my writing",temperature:.5,optimize:"accuracy",template:'The following text in triple quotes below has already been written:\n\n""""\n{{selectedText}}\n"""\n\nSimplify and condense the writing. Do not return anything other than the simplified writing. '.concat(nG)},{id:"copy-editor",label:"Act as a copy editor",temperature:0,optimize:"speed",template:'Act as a copy editor. Go through the text in triple quotes below. Edit it for spelling mistakes, grammar issues, punctuation, and generally for readability and flow. Format the text into appropriately sized paragraphs. Make your best effort. \n\n"""\n{{selectedText}}\n"""\n\nReturn only the edited text. Do not wrap your response in quotes. \nDo not offer anything else other than the edited text in the response. \nDo not translate the text. \nIf in doubt, or you can\'t make edits, just return the original text.'},{id:"generate-titles",label:"Suggest a few titles options",temperature:.7,optimize:"accuracy",template:'The blog post below has already been written:\n  \n"""BLOG POST: {{selectedText}}"""\n  \nGenerate a markdown list (using dashes) of five appropriate headlines for the blog post. Do not return anything other than the headlines. '.concat(nG)},{id:"generate-tweets",label:"Suggest a few tweets based on my writing",temperature:.7,optimize:"accuracy",template:'The blog post below has already been written:\n\n"""BLOG POST: {{selectedText}}"""\n\nGenerate a markdown list (using dashes) of five tweets based off the blog post. Do not translate the text. Do not return anything other than the tweets. Do not wrap responses in quotes.'},{id:"generate-outline",label:"Generate an outline for an article",temperature:.5,optimize:"accuracy",template:'Create an outline for an essay about the topic below in the described format.\n        \nTopic:"""\n{{selectedText}}\n"""\n\nFormat:"""\n1. Introduction\n    - < sub section >\n    - < sub section >\n    - < sub section >\n2. < section >\n    - < sub section >\n    - < sub section >\n    - < sub section >\n3. < section >\n    - < sub section >\n    - < sub section >\n    - < sub section >\n4. < section >\n    - < sub section >\n    - < sub section >\n    - < sub section >\n5. Conclusion\n    - < sub section >\n    - < sub section >\n    - < sub section > \n"""\n\nDo not return anything other than the outline. '.concat(nG)},{id:"generate-overview",label:"Generate an overview for an article",temperature:.5,optimize:"accuracy",template:'The article is below in the triple quotes:\n"""\n{{selectedText}}\n"""\n\nProvide a overview of the article. Use the following format:\n"""\nSummary: \n\n< one to two line summary >\n\nKey takeaways:\n1. < first key takeaway >\n2. < second key takeaway >\n3. < third key takeaway >\n\nCounter arguments:\n1. < first main counter argument >\n2. < second main counter argument >\n"""\n\nDo not return anything other than the overview. '.concat(nG)},{id:"generate-counter-argument",label:"Generate a counter argument",temperature:.5,optimize:"accuracy",template:'Give the counter argument to the text below:\n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the counter-argument. '.concat(nG)},{id:"generate-email",label:"Generate an email",temperature:.5,optimize:"accuracy",template:'Write a professional and articulate email for the subject below:\n"""\nSubject: {{selectedText}}\n"""\n\nDo not return anything other than the email. '.concat(nG)},{id:"action-items",label:"List action items",temperature:.5,optimize:"accuracy",template:'My note is below in triple quotes:\n"""\n{{selectedText}}\n"""\n\nWrite a todo list of action items from my notes using the following format:\n\n- [ ] <first action item>\n- [ ] <second action item>\n- [ ] <third action item>\n- [ ] <fourth action item>\n\nDo not return anything other than the todo list. '.concat(nG)},{id:"blog-post",label:"Write a blog post",temperature:.5,optimize:"accuracy",template:"Write a blog post using the outline in triple quotes below. Use plain and simple language. Do not return anything other than the blog post. ".concat(nG,'\n\n"""\n{{selectedText}}\n"""\n')},{id:"format-paragraphs",label:"Format paragraphs",temperature:0,optimize:"speed",template:"Format the text in triple quotes below into paragraphs. Do not return anything other than the formatted text. ".concat(nG,'\n\n"""\n{{selectedText}}\n"""')},{id:"analogies",label:"Write analogies",temperature:.5,optimize:"accuracy",template:"Write three different analogies for the text in quotes below. Use plain and simple language. Do not return anything other than the analogies. ".concat(nG,'\n\n"""\n{{selectedText}}\n"""')},{id:"backlinks",label:"Decorate my writing with backlinks",temperature:0,optimize:"speed",template:"Decorate the text in triple quotes below with backlinks. Keep the original text, but surround each person name, company name, and other nouns with double square brackets. So if the person has a name of Jerry, convert it to [[Jerry]]. Add backlinks to all people, places, things and projects. If it starts with a capital letter, backlink it. Do not include actions or verbs. ".concat(nG,'\n     \n"""\n{{selectedText}}\n"""')},{id:"super-summarizer",label:"Super Summarizer",temperature:0,optimize:"accuracy",template:'You\'re a professional summarizer. Create a concise and comprehensive summary of the provided text, and adhere to these guidelines:  \n\n- Craft a detailed, thorough, and in-depth summary while maintaining clarity and conciseness. \n- Incorporate main ideas and essential information, eliminating extraneous language and focusing on critical aspects. \n- Rely strictly on the provided text, without including external information. \n- Format the summary in paragraph form for easy understanding starting with a bullet point at the beginning of each paragraph. \n- Write in the first-person perspective avoiding the use of things like "the speaker", "the user", and instead use the perspective of the speaker, eg "I". \n- Use markdown to cleanly format the output. \n- Bold key subject matter and indicate potential areas that may need expanded information using markdown. \n- At the beginning of each proper noun, person\'s name, project, company, workplace name, or type, surround it with double square brackets (backlinks) like this: [[Name]]. Add backlinks to all people, places, things, and projects (anything that starts with a capital letter). \n- End with a markdown checklist of action items (if any).\n\nUse the following format:\n\n## Summary title\n\n- Short summary 1\n- Short summary 2\n- Short summary 3\n- Short summary 4\n\n### Action Items\n\n- [ ] Action item 1\n- [ ] Action item 2\n- [ ] Action item 3\n\nContext in triple quotes below:\n\n """ {{selectedText}} """'},{id:"points-to-document",label:"Points to document",temperature:.3,optimize:"accuracy",template:"Turn these points into a quick document on the subject. Try and be as plithy and straightforward as possible. Bold key arguments. Use markdown to cleanly format the output.\n\nPoints:\n{{selectedText}}"},{id:"todo-list",label:"Create a todo list",temperature:.1,optimize:"accuracy",template:"Create a todo list from the text in triple quotes below. Use the following format:\n\n- [ ] <first todo list item>\n- [ ] <second todo list item>\n- [ ] <third todo list item>\n- [ ] <fourth todo list item>\n\nDo not return anything other than the todo list. ".concat(nG,'\n\n"""\n{{selectedText}}\n"""')}];(r=s||(s={})).System="system",r.Custom="custom";class nK{get templates(){return[...this.customPromptTemplates,...this.systemPromptTemplates]}get systemPromptTemplates(){return nH.map(e=>({id:e.id,label:e.label,template:e.template,type:s.System}))}get customPromptTemplates(){return this.promptTemplateStore.templates.map(e=>({id:e.id,label:e.label,template:e.template,type:s.Custom}))}setPromptTemplate(e){let{id:t,label:n,template:r}=e;return(0,nq.Yu)({id:t,label:n,template:r})}removePromptTemplate(e){let{id:t}=e;return(0,nq.Lz)(t)}createPrediction(e){let{prompt:t,temperature:n,optimize:r}=e;return(0,L.j)("prediction_created"),n_({prompt:t,temperature:n,optimize:r})}constructor(e){this.promptTemplateStore=e,(0,m.makeObservable)(this)}}function nW(){let e=(0,x.Xt)(),t=(0,l.useMemo)(()=>new nK(e),[e]);return{promptTemplates:t.templates,onPrediction:t.createPrediction.bind(t),onSetPromptTemplate:t.setPromptTemplate.bind(t),onRemovePromptTemplate:t.removePromptTemplate.bind(t)}}function nY(e){return(0,l.useCallback)(t=>{!function(e,t){let{selection:n,scrollSelectedIntoView:r=!1}=t;setTimeout(()=>{try{null==e||e.focus((0,m.toJS)(n),r)}catch(e){(0,e$.Tb)(e)}},0)}(e.current,t)},[])}(0,eU.gn)([m.computed],nK.prototype,"templates",null);var nQ=n(66292),nJ=n.n(nQ);let nX=new Map;var n$=n(52785),n0=n(88393);class n1{dispose(){return(0,t$.$)(this.listeners)}get offline(){var e;return!!(null===(e=this.savingManager.failure)||void 0===e?void 0:e.failedAt)}get offlineStatus(){var e;let t=null===(e=this.savingManager.failure)||void 0===e?void 0:e.failedAt,n=this.note.pendingChangesCount,r=t&&n>0?t.getTime():null;return{changes:n,since:r}}setIsEditable(e){this.isEditable=e}setNotePreview(e){this.notePreview=e}setImagePreviewSrc(e){this.imagePreviewSrc=e}get editorKey(){let e=[this.graph.id,this.note.id,this.note.remountCounter],t=this.isFetching;return this.note.daily&&this.note.isDailyGenerated&&t&&(e=[...e,"fetching"]),e.join("-")}get yDoc(){return this.editorKey,(0,m.untracked)(()=>this.note.editedYDoc)}get editorContent(){return(0,eW.hu)(this.yDoc,"yjsDoc should be defined"),{type:"yjs",yjsDoc:this.yDoc}}applyUpdates(){var e;let{updates:t,counter:n}=this.getUpdatesToApply();0!==t.length&&this.isEditable&&(null===(e=this.editorRef.current)||void 0===e||e.yjsApplyUpdates(t),this.markUpdatesApplied(n))}getUpdatesToApply(){let e=this.getPendingUpdates(),t=this.lastAppliedUpdateCounter,{incomingUpdates:n,counter:r}=this.note.getIncomingUpdates(t);return{updates:[...n,...e],counter:r}}getPendingUpdates(){var e,t;let n=null===(e=this.note.changeStore)||void 0===e?void 0:e.getPendingCommit(this.note);return null!==(t=null==n?void 0:n.yjsUpdatesArrays)&&void 0!==t?t:[]}markUpdatesApplied(e){this.lastAppliedUpdateCounter=e}get backlinkGenerator(){let e=this.backlinkStore,{dateFormat:t,weekStart:n}=this.preferenceStore;return new n0.q({backlinkStore:e,dateFormat:t,weekStart:n,excludeNote:this.note})}get generateTag(){let e=this.graph;return t=>e.matchTags(null!=t?t:"")}get savingManager(){return this.note.changeManager.savingManager}get noteStore(){return this.graph.noteStore}get backlinkStore(){return this.noteStore.backlinkStore}get rootStore(){return this.graph.assertRootStore}get contactStore(){return this.rootStore.contactStore}get preferenceStore(){return this.rootStore.preferenceStore}constructor(e){var t;this.lastAppliedUpdateCounter=null,this.isEditable=!1,this.notePreview=null,this.imagePreviewSrc=null,this.listeners=[],this.resetImagePreviewSrc=()=>{this.setImagePreviewSrc(null)},this.handleUpdate=e=>{this.noteStore.attachNote(this.note),this.note.changeManager.yjsHandleUpdate(e)},this.generateBacklink=e=>this.backlinkGenerator.generate(null!=e?e:""),this.handleBacklinkHover=async(e,t,n)=>{let r=await this.noteStore.findById(t.id);this.setNotePreview(n?r:null)},this.handleBacklinkAdd=async e=>await (0,n$.V)({noteStore:this.noteStore,contactStore:this.contactStore,backlink:e}),this.handleTagAdd=e=>((0,L.yV)({tagCreated:!0}),(0,L.j)("tag_created"),this.graph.onTagAdd(e)),this.handleImageClick=(e,t)=>!!t&&(this.setImagePreviewSrc(e.src),!0),this.graph=e.graph,this.note=e.note,this.editorRef=e.editorRef,this.note.ensureYDoc(),this.note.touchViewedAt(),(0,m.makeObservable)(this),this.listeners.push((0,m.reaction)(()=>({rerenderKey:this.note.rerenderKey,isEditable:this.isEditable}),()=>this.applyUpdates())),this.isFetching=null!==(t=e.isFetching)&&void 0!==t&&t}}function n5(e){let{graph:t,note:n,editorRef:r,isEditable:a,isFetching:s}=e,i=(0,x.Yh)(),o=(0,eF.D)(()=>new n1({graph:t,note:n,editorRef:r,isFetching:s}),[i,t,n,r]);return(0,l.useEffect)(()=>{o.setIsEditable(a)},[o,a]),o}(0,eU.gn)([m.observable],n1.prototype,"isEditable",void 0),(0,eU.gn)([m.observable.ref],n1.prototype,"notePreview",void 0),(0,eU.gn)([m.observable],n1.prototype,"imagePreviewSrc",void 0),(0,eU.gn)([m.computed],n1.prototype,"offline",null),(0,eU.gn)([m.computed],n1.prototype,"offlineStatus",null),(0,eU.gn)([m.action],n1.prototype,"setIsEditable",null),(0,eU.gn)([m.action],n1.prototype,"setNotePreview",null),(0,eU.gn)([m.action],n1.prototype,"setImagePreviewSrc",null),(0,eU.gn)([m.computed],n1.prototype,"editorKey",null),(0,eU.gn)([m.computed],n1.prototype,"yDoc",null),(0,eU.gn)([m.computed],n1.prototype,"editorContent",null),(0,eU.gn)([m.action],n1.prototype,"markUpdatesApplied",null),(0,eU.gn)([m.computed],n1.prototype,"backlinkGenerator",null),(0,eU.gn)([m.computed],n1.prototype,"generateTag",null);var n2=n(79978);function n7(e,t){let n=(0,n2.ze)(),r=(0,n2.zz)(),[a,s]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!a||!n.wantsSpacer||!r.isVisible)return;s(!1);let i=e.current,o=t.current;if(!i||!o)return;let l=window.innerHeight,d=i.getSelectionCoords();if(!d)return;let c=l-n.keyboardHeight.value-5,u=d.top-c;u>0&&o.scrollBy({top:u+100,behavior:"auto"})},[a,n.wantsSpacer,r.isVisible]),()=>{s(!0)}}var n9=n(43702);async function n3(e){return(0,nj.tC)("/api/transcriptions/create",e)}let n6=(0,n(7480).Z)(1);class n4{constructor(e){this.dispose=null,this.start=async e=>await n6(()=>this.startTranscription(e)),this.stop=async()=>await n6(()=>this.stopTranscription()),this.startTranscription=async e=>{await this.stopTranscription(),await this.startRemoteTranscription(e),this.logger.info("Transcription started")},this.startRemoteTranscription=async e=>{let t=async e=>{let{language:t,previousText:n,audio:r}=e,a=(0,n9._C)(r);return(await n3({language:t,prompt:n,audioBase64:a,provider:"cerebrium"})).text};this.dispose=await (0,n9.db)({transcribe:t,language:this.language,onSpeechStart:()=>e({type:"speech"}),onSpeechEnd:()=>e({type:"silence"}),onTranscriptionUpdate:t=>{let{text:n,interim:r}=t;e({type:"text",text:n,interim:r})}})},this.stopTranscription=async()=>{let e=this.dispose;this.dispose=null,e&&(this.logger.info("Stopping transcription"),await e(),this.logger.info("Transcription stopped"))},this.language="auto"===e.language?void 0:e.language,this.logger=e.logger}}let n8=(0,f.Pi)(e=>{var t;let{note:n,role:r,screenHasFocus:a}=e,s=(0,x.dw)(),i="primary"===r?s.primaryEditorView:s.secondaryEditorView,d=(0,x.Pw)(),{keyboardToolbarView:c}=(0,nr.l3)(),u=(0,x.xJ)(),{timeFormat:p,spellCheck:m,editorSize:f,getKeyboardLayoutMap:g,transcriptionLanguage:v}=(0,x.Jf)(),{onPrediction:y,promptTemplates:b,onSetPromptTemplate:w,onRemovePromptTemplate:j}=nW(),k=(0,l.useRef)(null),N=(0,eZ.Fg)(),S=n.assertGraph,C=S.templateStore,R=!a||!(null==u?void 0:u.inGoodStanding),I=(0,l.useRef)(null),E=(0,l.useRef)(!1);(0,l.useEffect)(()=>{n.touchViewedAt()},[n]);let D=(0,l.useCallback)(async e=>await s.getMergeNotesForNote(n,e),[s,n]),P=(0,l.useCallback)(async e=>{await d.mergeNotes({fromNote:n,toNoteId:e.id})},[n,d]),T=(0,nn.useReactToPrint)({content:()=>k.current,copyStyles:!0});ei(e=>{"print-note"===e.command&&a&&(null==T||T())});let A=n5({graph:S,note:n,editorRef:I,isEditable:!R}),M=nY(I);(0,l.useEffect)(()=>{if(!E.current&&a&&d.activeEditor===r&&i.selectedNoteId===n.id){var e;M({selection:null!==(e=i.selectionView.getCursor(A.editorKey))&&void 0!==e?e:"subject_end"})}},[d.activeEditor,a,i.selectedNoteId,A.editorKey]);let L=(0,l.useRef)(null),V=(t=A.editorKey,(0,l.useLayoutEffect)(()=>{var e;if(!t)return;let n=null!==(e=nX.get(t))&&void 0!==e?e:0,r=L.current;r&&(r.scrollTop=n)},[t,L]),(0,l.useMemo)(()=>{if(t)return nJ()(e=>{var n;let r=null!==(n=e.target.scrollTop)&&void 0!==n?n:0;nX.set(t,r)},300)},[t])),Z=n7(I,L),F=(0,l.useCallback)(e=>{c.setSelectionOptions(e),e.didFocus&&Z()},[]),O=(0,l.useMemo)(()=>nV(S.logger),[S]),B=(0,l.useMemo)(()=>nZ(S.logger),[S]),z=(0,l.useCallback)(()=>A.offlineStatus,[A]);(0,l.useEffect)(()=>{a&&(0,td.ZP)(()=>{var e,t;let n=i.searchQuery,r=i.searchNodeGuid;n||r?null===(e=I.current)||void 0===e||e.search({searchTerm:n,searchNodeGuid:r,activeIndex:0}):null===(t=I.current)||void 0===t||t.stopSearch()})},[a,i.searchQuery,i.searchNodeGuid]);let _=(0,l.useCallback)(()=>n.editedDocumentHtml,[n]),U=(0,l.useCallback)(()=>{E.current=!0,c.show(I),d.handleFocus({note:n,editorView:i,editor:I.current,editorKey:A.editorKey})},[A.editorKey,i,c,d,n]),q=(0,l.useCallback)(()=>{E.current=!1,c.hide(),d.handleBlur({note:n,editorView:i,editor:I.current,editorKey:A.editorKey})},[A.editorKey,i,c,d,n]),G=(0,l.useCallback)((e,t)=>{d.openNotesListForTag(t.id)},[d]),H=(0,l.useMemo)(()=>{if(S.realTimeTranscriptionEnabled)return new n4({logger:S.logger,language:v})},[S,v]);return(0,o.jsxs)(ni,{getHtml:_,children:[(0,o.jsx)("div",{ref:k,className:"flex flex-1 flex-col overflow-hidden",children:(0,o.jsx)("div",{className:"relative flex flex-1 flex-col overflow-hidden",children:(0,o.jsx)("div",{className:(0,el.Z)("flex flex-1 flex-col overflow-auto"),ref:L,onScroll:V,children:(0,o.jsxs)("div",{className:(0,el.Z)("relative flex flex-1 flex-col",d.semiScreen&&"mx-auto w-full max-w-semi-screen"),children:[(0,o.jsx)(h.Mc,{editorKey:A.editorKey,content:A.editorContent,editorRef:I,graphId:S.id,yjsOnUpdate:A.handleUpdate,templates:C.contentTemplates,onBacklinkAdd:A.handleBacklinkAdd,onBacklinkOpen:d.handleBacklinkOpen,onBacklinkHover:A.handleBacklinkHover,onImageClick:A.handleImageClick,backlinkGenerator:A.generateBacklink,tagGenerator:A.generateTag,onTagAdd:A.handleTagAdd,onTagClick:G,mergeNoteGenerator:D,onMergeNote:P,onFileUpload:O,onFileUploadSync:B,onFileUrlReplace:nO,onFileDownload:nN,onFileSave:nC,readOnly:R,editable:a,onSelection:F,onFocus:U,onBlur:q,offline:A.offline,getOfflineStatus:z,dark:"dark"===N,timeFormat:p,spellCheck:m,getKeyboardLayoutMap:g,promptTemplates:b,onSetPromptTemplate:w,onRemovePromptTemplate:j,onPrediction:y,onLinkMetadata:nB,transcriber:H,dragIndicatorEnabled:!0,viewportSelector:"main",size:f}),(0,o.jsx)(nb,{note:n})]})})})}),A.notePreview&&(0,o.jsx)(nw.f,{note:A.notePreview}),A.imagePreviewSrc&&(0,o.jsx)(nl,{imgSrc:A.imagePreviewSrc,onClose:A.resetImagePreviewSrc})]})}),re=(0,f.Pi)(e=>{let{note:t,visible:n,className:r}=e;return(0,o.jsx)("div",{className:(0,el.Z)("flex h-full flex-col",r),children:t&&t.isAttached&&(0,o.jsx)(n8,{note:t,role:"secondary",screenHasFocus:n})})}),rt=(0,f.Pi)(e=>{let{primaryNote:t,children:n,screenHasFocus:r}=e,a=(0,x.B0)(),{rightSidebarSize:s,secondaryEditorRatio:i}=a,d=(0,x.BO)(),c=(0,x.Pw)(),u=function(e){let[t,n]=(0,l.useState)(null!=e?e:null);return(0,l.useEffect)(()=>{e&&n(e)},[e]),t}(d.selectedNote),h={transition:"transform ".concat(250,"ms cubic-bezier(0.175, 0.885, 0.32, 1.1)"),transform:"translateX(100%)"},p={entering:{transform:"translateX(0%)"},entered:{transform:"translateX(0%)"},exiting:{transform:"translateX(100%)"},exited:{transform:"translateX(100%)"},unmounted:{}},m=(0,l.useRef)(1e3),f=nt(e=>{let{width:t}=e;return m.current=t}),g=c.semiScreen;return(0,o.jsx)(ex.ZP,{timeout:250,in:d.hasSelectedNote,children:e=>{var l;let m="entered"===e;return(0,o.jsxs)("div",{ref:f,className:"note-split",children:[(0,o.jsxs)(X.IF,{sidebarSize:m?i:s,sizeType:m?"ratio":"fixed",sidebarHidden:g&&!m,onResize:m?e=>a.setSecondaryEditorRatio(e):e=>a.setRightSidebarSize(e),minSidebarSize:m?300:200,sidebarPosition:"end",className:"absolute inset-0 overflow-hidden",children:[(0,o.jsx)(X.IF.Main,{className:"flex flex-row justify-center",children:(0,o.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:n})}),(0,o.jsx)(X.IF.Sidebar,{children:m?(0,o.jsx)("div",{}):(0,o.jsx)(t4,{note:t})})]}),(0,o.jsxs)("div",{className:(0,el.Z)("pointer-events-none absolute top-0 bottom-0 z-split h-full bg-background-stark pl-[3px] transition-all",["entered","entering"].includes(e)&&"shadow-2xl",!r&&"hidden"),style:{width:"".concat(100*i,"%"),right:0,...h,...p[e]},children:[(0,o.jsx)(re,{note:null!==(l=null==u?void 0:u.value)&&void 0!==l?l:null,visible:d.hasSelectedNote,className:"pointer-events-auto"}),(0,o.jsxs)("div",{className:"pointer-events-auto absolute top-4 right-4 z-50 flex gap-2",children:[(0,o.jsx)(eE.u,{label:"Open full note",children:(0,o.jsx)("button",{className:"flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-purple-50 text-purple-400 outline-none transition-all duration-50 hover:bg-purple-100 active:bg-purple-200 active:text-purple-500 dark:bg-purple-900/50",onClick:()=>{let e=null==u?void 0:u.value;e&&c.editNote(e)},tabIndex:-1,children:(0,o.jsx)(em.Z,{className:"w-3"})})}),(0,o.jsx)(eE.u,{label:"Close split-view",shortcut:"Escape",children:(0,o.jsx)("button",{className:"flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-purple-50 text-purple-400 outline-none transition-all duration-50 hover:bg-purple-100 active:bg-purple-200 active:text-purple-500 dark:bg-purple-900/50",onClick:()=>c.closeSecondary(),tabIndex:-1,children:(0,o.jsx)(ef.Z,{className:"w-4"})})})]}),(0,o.jsx)("div",{className:"pointer-events-none absolute top-0 -right-4 bottom-0 w-4 bg-background-stark"})]})]})}})}),rn=(0,f.Pi)(()=>{let e=(0,x.dw)(),t=(0,x.Pw)(),{selectedNote:n}=(0,x.Ru)(),r=null==n?void 0:n.value,a=t.screenHasFocus(N.oK.NoteEdit);return r||e.syncDown.hasSynced?r?r.canWrite?(0,o.jsx)(rt,{primaryNote:r,screenHasFocus:a,children:(0,o.jsx)(n8,{role:"primary",note:r,screenHasFocus:a})}):(0,o.jsx)(eu,{note:r}):(0,o.jsx)(eh,{}):(0,o.jsx)(ep,{})});var rr=n(18688);class ra{dispose(){this.editorView.setSelectingEdge(null)}get notes(){return this.editorView.notes}get noteIndex(){return this.notes.indexOf(this.note)}get isNoteSelected(){return this.editorView.selectedNote===this.note}get dailySubject(){let{dateFormat:e}=this.assertPreferenceStore,t=(0,rr.$X)(e);return(0,rr.p6)(this.note.dailyOrCreatedDate,t)}get rootStore(){return this.noteStore.assertRootStore}get graph(){return this.noteStore.assertGraph}get preferenceStore(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.preferenceStore}get assertPreferenceStore(){return(0,eW.hu)(this.preferenceStore,"Missing preference store"),this.preferenceStore}get mainView(){return this.editorView.mainView}get editorView(){return this.noteStore.dailyEditorView}constructor(e,t){var n=this;this.noteStore=e,this.note=t,this.navigatePrevious=function(){let{scroll:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.noteIndex>0){let t=n.noteIndex-1;n.editorView.setSelectedDate(n.notes[t].dailyOrCreatedDate,{scroll:e,edge:"end"})}},this.navigateNext=function(){let{scroll:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.noteIndex<n.notes.length-1){let t=n.noteIndex+1;n.editorView.setSelectedDate(n.notes[t].dailyOrCreatedDate,{scroll:e,edge:"start"})}},(0,m.makeObservable)(this)}}(0,eU.gn)([m.computed],ra.prototype,"noteIndex",null),(0,eU.gn)([m.computed],ra.prototype,"isNoteSelected",null),(0,eU.gn)([m.computed],ra.prototype,"dailySubject",null);let rs=(0,f.Pi)(e=>{let{graph:t,note:n,virtuosoRef:r}=e,a=(0,eZ.Fg)(),{keyboardToolbarView:s}=(0,nr.l3)(),i=(0,x.xJ)(),d=(0,x.dw)(),c=(0,x.Pw)(),u=(0,x.nB)(),p=t.templateStore,{timeFormat:m,spellCheck:f,editorSize:g,getKeyboardLayoutMap:v,transcriptionLanguage:y}=(0,x.Jf)(),{promptTemplates:b,onSetPromptTemplate:w,onRemovePromptTemplate:j,onPrediction:k}=nW(),S=(0,l.useRef)(null),C=c.screenHasFocus(N.oK.NoteDaily),R=!C||!(null==i?void 0:i.inGoodStanding),I=(0,l.useRef)(null),E=(0,l.useRef)(!1),D=(0,eF.D)(()=>new ra(d,n),[d,n]),P=n5({graph:t,note:n,editorRef:I,isEditable:!R,isFetching:!u.hasFetchedDailyNotes}),T=(0,nn.useReactToPrint)({content:()=>S.current,copyStyles:!0});ei(e=>{"print-note"===e.command&&C&&D.isNoteSelected&&(null==T||T())});let A=(0,l.useCallback)(()=>{E.current=!0,s.show(I),c.handleFocus({note:n,editorView:u,editor:I.current,editorKey:P.editorKey})},[n,u,P.editorKey,s,c]),L=(0,l.useCallback)(()=>{E.current=!1,s.hide(),c.handleBlur({note:n,editorView:u,editor:I.current,editorKey:P.editorKey})},[n,u,P.editorKey,s,c]),V=n7(I,r),Z=(0,l.useCallback)(e=>{s.setSelectionOptions(e),e.didFocus&&V()},[V,s]),F=(0,l.useMemo)(()=>nV(t.logger),[t]),O=(0,l.useMemo)(()=>nZ(t.logger),[t]),B=(0,l.useCallback)(()=>P.offlineStatus,[P]),z=nY(I);(0,l.useEffect)(()=>{u.isActive&&D.isNoteSelected&&(!E.current||u.forceFocus)&&(z({selection:u.getSelectionOption(P.editorKey),scrollSelectedIntoView:u.forceFocus}),u.resetForceFocus())},[D.isNoteSelected,u.forceFocus,u.isActive]),(0,l.useEffect)(()=>{C&&D.isNoteSelected&&(0,td.ZP)(()=>{var e,t;let n=u.searchQuery,r=u.searchNodeGuid;n||r?null===(e=I.current)||void 0===e||e.search({searchTerm:n,searchNodeGuid:r,activeIndex:0}):null===(t=I.current)||void 0===t||t.stopSearch()})},[C,D.isNoteSelected,u.searchQuery,u.searchNodeGuid]);let _=(0,l.useCallback)(()=>n.editedDocumentHtml,[n]),U=(0,l.useCallback)((e,t)=>{c.openNotesListForTag(t.id)},[c]),q=(0,l.useMemo)(()=>{if(t.realTimeTranscriptionEnabled)return new n4({logger:t.logger,language:y})},[t,y]);return t?(0,o.jsxs)(ni,{getHtml:_,children:[(0,o.jsx)("div",{className:(0,el.Z)("flex flex-shrink-0 flex-grow justify-center","border-b border-border",c.semiScreen&&"mx-auto w-full max-w-semi-screen"),ref:S,children:(0,o.jsxs)("div",{className:"flex w-full flex-1 flex-col",children:[(0,o.jsx)(h.Mc,{editorKey:P.editorKey,editorRef:I,graphId:t.id,content:P.editorContent,yjsOnUpdate:P.handleUpdate,onBacklinkAdd:P.handleBacklinkAdd,onBacklinkHover:P.handleBacklinkHover,onBacklinkOpen:c.handleBacklinkOpen,backlinkGenerator:P.generateBacklink,tagGenerator:P.generateTag,templates:p.contentTemplates,onTagAdd:P.handleTagAdd,onTagClick:U,onImageClick:P.handleImageClick,subject:D.dailySubject,editableSubject:!1,highlightSubject:n.isTodaysDailyNote,onFileUpload:F,onFileUploadSync:O,onFileUrlReplace:nO,onFileDownload:nN,onFileSave:nC,scrollSelectedIntoView:!0,onSelection:Z,onFocus:A,onBlur:L,onNavigateNext:D.navigateNext,onNavigatePrevious:D.navigatePrevious,readOnly:R,editable:C,offline:P.offline,getOfflineStatus:B,dark:"dark"===a,timeFormat:m,spellCheck:f,getKeyboardLayoutMap:v,promptTemplates:b,onSetPromptTemplate:w,onRemovePromptTemplate:j,onPrediction:k,onLinkMetadata:nB,transcriber:q,style:{minHeight:"past"===n.dailyTense?"200px":"60vh"},dragIndicatorEnabled:!0,viewportSelector:"main",size:g}),(0,o.jsx)(nb,{note:n})]})}),P.notePreview&&(0,o.jsx)(nw.f,{note:P.notePreview}),P.imagePreviewSrc&&(0,o.jsx)(nl,{imgSrc:P.imagePreviewSrc,onClose:P.resetImagePreviewSrc})]}):(0,o.jsx)(M.T,{})}),ri=(0,f.Pi)(()=>{let e=(0,x.Fq)(),t=(0,x.nB)(),n=(0,l.useRef)(null),r=(0,l.useRef)(null),a=t.notes,s=(0,l.useRef)(new Set),i=(0,l.useRef)(1e4),[d,c]=(0,l.useState)(i.current-a.length),u=t.selectedNoteIndex,h=(0,l.useCallback)(()=>{let e=d-20;return e<=0&&(i.current=2*i.current,e=i.current-a.length),c(e),null==t||t.prependNotes(20),!1},[t,d,a]),{selectingScroll:p}=t,m=function(e){let[t,n]=(0,l.useState)(e);return(0,l.useEffect)(()=>{n(e)},[e]),(0,l.useEffect)(()=>{t&&n(null)},[t]),t}(t.selectedNote);return(0,l.useEffect)(()=>{if(-1===u)return;let e=m&&!s.current.has(m.id);if(p||e){var r;null===(r=n.current)||void 0===r||r.scrollToIndex({index:u,behavior:"auto",align:"start"})}t.setSelectingScroll(!1)},[t,u,p,m]),(0,o.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",ref:r,children:(0,o.jsx)("div",{className:"flex-1 flex-col overflow-hidden",children:(0,o.jsx)(nx.OO,{ref:n,data:a,initialTopMostItemIndex:-1===u?0:u,firstItemIndex:d,itemsRendered:e=>{s.current=new Set(e.map(e=>e.data).filter(eQ.Dw).map(e=>e.id))},endReached:()=>{t.appendNotes()},startReached:h,itemContent:(t,r)=>(0,o.jsx)(f.Qj,{children:()=>(0,o.jsx)(rs,{graph:e,note:r,virtuosoRef:n},"".concat(e.id,"/").concat(r.id))}),defaultItemHeight:370})})})}),ro=(0,f.Pi)(()=>{let{selectedNote:e}=(0,x.nB)(),t=(0,x.Pw)().screenHasFocus(N.oK.NoteDaily);return(0,o.jsx)(rt,{primaryNote:e,screenHasFocus:t,children:(0,o.jsx)(ri,{})})}),rl=w()(()=>n.e(4087).then(n.bind(n,84087)).then(e=>e.NotesList),{loadableGenerated:{webpack:()=>[84087]},ssr:!1}),rd=w()(()=>Promise.all([n.e(2606),n.e(848),n.e(4480),n.e(1440)]).then(n.bind(n,71440)).then(e=>e.NotesMap),{loadableGenerated:{webpack:()=>[71440]},ssr:!1}),rc=w()(()=>n.e(9425).then(n.bind(n,99425)).then(e=>e.Tasks),{loadableGenerated:{webpack:()=>[99425]},ssr:!1}),ru=(0,f.Pi)(()=>{let{screen:e}=(0,x.Pw)();return(0,o.jsxs)(ec,{children:[(0,o.jsx)(ed,{active:e===N.oK.NoteDaily,persist:!0,children:(0,o.jsx)(ro,{})}),(0,o.jsx)(ed,{active:e===N.oK.NoteList,persist:!0,children:(0,o.jsx)(rl,{})}),(0,o.jsx)(ed,{active:e===N.oK.Map,persist:!1,children:()=>(0,o.jsx)(rd,{})}),(0,o.jsx)(ed,{active:e===N.oK.NoteEdit,persist:!0,children:(0,o.jsx)(rn,{})}),(0,o.jsx)(ed,{active:e===N.oK.TaskList,persist:!0,children:(0,o.jsx)(rc,{})})]})});var rh=n(53454);let rp=w()(()=>Promise.all([n.e(5184),n.e(1559)]).then(n.bind(n,51559)).then(e=>e.AiChat),{loadableGenerated:{webpack:()=>[51559]},ssr:!1});var rm=n(70649);function rf(e){let t=(0,l.useDeferredValue)(e),[n,r]=(0,l.useState)(t);return(0,l.useEffect)(()=>{let e=(0,td.Kk)(()=>{r(t)},{timeout:1e3});return()=>{(0,td.GK)(e)}},[t]),n}var rx=n(88975),rg=n.n(rx);function rv(e,t){return e.length>t?"..."+e.slice(-t):e}let ry=e=>{let{enabled:t,snippet:n,query:r}=e,a=t?function(e){let{snippet:t,query:n}=e;if(!t)return[];if(!n)return[[!1,tn()(t,{length:80})]];let r=0,a=[];for(let[e,s]of function*(e,t){let n=0;for(let[r,a]of function*(e,t){for(let n of(0,h._)(t)){let t=!1;for(let r of function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=[];for(let a of rg()(e,t)){let e=a[0].length;if(e<2)continue;let t=a.index;if(null==t)continue;let s=t+e;if(yield[t,s],r.length>=n)break}}(e,n))t=!0,yield r;if(t)break}}(e,t))n<r&&(yield[!1,e.slice(n,r)]),yield[!0,e.slice(r,a)],n=a;n<e.length&&(yield[!1,e.slice(n)])}(t,n)){if(0===a.length&&!e){a.push([!1,s]),r+=Math.min(s.length,rv(s,20).length);continue}let t=80-r;if(t<=0)break;if(s.length>t){let n=tn()(s,{length:t});a.push([e,n]),r+=n.length;break}a.push([e,s]),r+=s.length}return 1!==a.length||a[0][0]?a.length>1&&!a[0][0]&&(a[0][1]=rv(a[0][1],20)):a[0][1]=tn()(a[0][1],{length:80}),a}({snippet:n,query:r}):[[!1,n]];return(0,o.jsx)(o.Fragment,{children:a.map((e,t)=>{let[n,r]=e;return n?(0,o.jsx)("mark",{className:"relative bg-indigo-600/10 text-primary dark:text-indigo-400",children:r},t):(0,o.jsx)("span",{children:r},t)})})},rb=(0,f.Pi)(e=>{var t;let{query:n,result:r,selected:a,timeFormat:s,dateFormat:i,onClick:d,onMouseEnter:c}=e,u=r.timestamp,h=(0,l.useMemo)(()=>u?(0,rr.zg)(new Date(u),i,s):null,[i,s,u]);return(0,o.jsxs)("div",{style:{height:64},onClick:d,onMouseEnter:c,className:(0,el.Z)("shadow-border-b group flex cursor-pointer flex-col justify-center space-y-1 px-5 py-2 text-sm leading-5 focus:outline-none dark:text-near-white",{"bg-gray-200/50 dark:bg-white/5 dark:text-white":a}),children:[(0,o.jsxs)("div",{className:"flex space-x-2",children:[(0,o.jsx)("div",{className:"flex-1 truncate text-2xs font-medium",title:r.title,children:(0,o.jsx)(ry,{enabled:!!r.noteId,snippet:r.title,query:n})}),h&&(0,o.jsx)("div",{className:"flex-none text-[10px] text-coolgray-400",children:h})]}),r.noteId&&(0,o.jsxs)("div",{className:"truncate text-xs",title:tn()(r.contentLine,{length:200}),children:[(0,o.jsx)(ry,{enabled:!0,snippet:null!==(t=r.contentLine)&&void 0!==t?t:"",query:n}),!r.contentLine&&(0,o.jsx)("span",{className:"italic text-coolgray-400",children:"Empty"})]})]})}),rw=e=>{let{query:t,result:n}=e,r=rf(t),a=rf(n);return(0,o.jsx)(rk,{query:r,result:a},r+a.noteId)},rj=(0,f.Pi)(e=>{var t;let{query:n,result:r}=e,a=(0,eZ.Fg)(),s=(0,x.dw)().adapter,i=(0,x.Yh)(),d=r.noteId?s.placeholder(r.noteId):null,c=null==d?void 0:null===(t=d.value)||void 0===t?void 0:t.documentHtml,u=(0,l.useMemo)(()=>nu({rootStore:i}),[i]);return(0,o.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden overflow-y-scroll p-5",children:c?(0,o.jsx)(h.d1,{size:"xs",html:c,dark:"dark"===a,className:"!cursor-default",onClick:u,searchTerm:n}):(0,o.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,o.jsx)("h3",{className:"text-lg font-medium",children:r.title})})})}),rk=(0,l.memo)(rj),rN=/^#/;function rS(e){if(e.defaultPrevented)return!0;let t=window.document.activeElement;return null!=t&&!!t.closest("[data-search-badge]")}let rC=e=>{let{query:t,searchView:n}=e,r=rf(t);return(0,o.jsx)(rI,{query:r,searchView:n})},rR=(0,f.Pi)(e=>{let{query:t,searchView:n}=e,r=(0,x.Pw)(),a=(0,x.Jf)(),[s,i]=(0,l.useState)(0),d=(0,l.useRef)(null),c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{n(!1);let e=()=>n(!0);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},e),t}([n.query]),u=a.timeFormat,h=a.dateFormat,p=()=>{r.closeSearchModal()},m=e=>{c&&i(e)},f=e=>{var t;null===(t=d.current)||void 0===t||t.scrollIntoView({index:e})};return(0,es.y)(["ArrowDown","ctrl+n"],e=>{if(rS(e))return;let t=Math.min(s+1,n.count);i(t),f(t)}),(0,es.y)(["ArrowUp","ctrl+p"],e=>{if(rS(e))return;e.preventDefault();let t=Math.max(s-1,0);i(t),f(t)}),(0,es.y)(["Enter","mod+Enter"],e=>{var t,r;rS(e)||(e.preventDefault(),null===(r=n.results[s])||void 0===r||null===(t=r.onSelect)||void 0===t||t.call(r,e),p())}),(0,l.useEffect)(()=>{n.setQuery(t),i(0)},[n,t]),(0,o.jsxs)("div",{className:"flex flex-1 overflow-auto",children:[(0,o.jsx)("div",{className:"shadow-border-r flex w-56 flex-none flex-col sm:w-72 md:w-96",children:(0,o.jsx)(nx.OO,{ref:d,width:"100%",height:"100%",data:n.results,itemContent:(e,t)=>(0,o.jsx)(rb,{query:n.query,result:t,selected:s===e,timeFormat:u,dateFormat:h,onClick:e=>{t.onSelect(e),p()},onMouseEnter:()=>m(e)},t.id)})}),(0,o.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:n.results[s]?(0,o.jsx)(rw,{query:n.query,result:n.results[s]}):null})]})}),rI=(0,l.memo)(rR);var rE=n(14489),rD=n(79633),rP=n(2600),rT=n.n(rP),rA=n(86967),rM=n(1130);function rL(){let e=(0,rE._)(["COALESCE(editedAt, updatedAt, createdAt)"]);return rL=function(){return e},e}class rV{attach(){this.onAttached()}dispose(){return(0,t$.$)(this.listeners)}setMode(e){this.mode=e}toggleMode(){this.setMode("search"===this.mode?"chat":"search")}get changeModeEnabled(){return"notes"===this.searchType&&(!!this.query||this.hasAnyFilter)}get searchType(){return rN.test(this.query)?"tags":"notes"}get results(){switch(this.searchType){case"tags":return this.tagResults;case"notes":return[...this.searchByIdResults,...this.generatedResults,...this.noteResults,...this.actionResults,...this.noteActionResults];default:return[]}}get count(){return this.results.length}setQuery(e){this.query=e}setStrategy(e){this.strategy=e}setSearching(e){this.isSearching=e}removeFilter(e){let t=this.filters.findIndex(t=>t.type===e);-1!==t&&this.filters.splice(t,1)}addFilter(e){this.removeFilter(e.type),this.filters=[...this.filters,e]}getFilter(e){var t;return null!==(t=this.filters.find(t=>t.type===e))&&void 0!==t?t:null}async getFilterConditions(){let e=await Promise.all(this.filters.map(e=>e.condition()));return t=>e.map(e=>e(t))}hasFilter(e){return!!this.getFilter(e)}get hasAnyFilter(){return this.filters.length>0}get hasAnyQuery(){return this.query.length>0}get hasAnyQueryOrFilter(){return this.hasAnyFilter||this.hasAnyQuery}setNoteResults(e){this.noteResults=e}reset(){this.query="",this.filters=[],this.mode="search",this.strategy="fuzzy",this.noteResults=[]}onAttached(){this.listeners.push((0,m.reaction)(()=>[this.normalizedQuery,this.strategy,...this.filters],()=>{this.updateNoteResults()},{fireImmediately:!0}),(0,m.reaction)(()=>this.mainView.searchModalIsOpen,e=>this.handleOpenChange(e)))}handleOpenChange(e){e?this.resetIfInactive():this.lastOpenedAt=Date.now()}resetIfInactive(){this.lastOpenedAt&&Date.now()-this.lastOpenedAt>6e5&&this.reset()}async updateNoteResults(){let e=this.normalizedQuery;this.setSearching(!0);let t=e?await this.searchNoteResults(e):await this.filterNoteResults();this.setNoteResults(t),this.setSearching(!1)}async searchNoteResults(e){let t=await this.searchStore.search(e,{type:"text",exactSearch:"exact"===this.strategy||void 0}),n="semantic"===this.strategy&&await this.searchStore.search(e,{type:"embedding",similarity:.2}),r=n?rT()([...n,...t],e=>e.noteId):t,a=r.map(e=>e.noteId).filter(eQ.Dw),s=await this.getFilterConditions(),i=this.noteStore.table.query().where(e=>e.and([e("id","in",(0,ng.pP)(a)),...s(e)])).clearSelect().select("id"),o=(await this.noteStore.table.adapter.executeSelect(i)).map(e=>e.id);return r.filter(e=>e.noteId&&o.includes(e.noteId)).map(e=>({...e,onSelect:async t=>await this.onSelectNote(e.noteId,t)}))}async filterNoteResults(){var e,t;let n=await this.getFilterConditions(),r=this.noteStore.undeletedNotesQuery.where(e=>e.and(n(e))).orderBy((0,rD.i)(rL()),"desc");return this.query.length>0||this.filters.length>0||(r=r.limit(10)),e=(await this.noteStore.table.fetch(r)).map(tX.AZ),t=(e,t)=>this.onSelectNote(e.id,t),e.map(e=>({id:e.id,title:e.title.substring(0,100),contentLine:e.line.substring(0,5e3),timestamp:e.editedOrUpdatedAt,onSelect:n=>t(e,n),noteId:e.id}))}get rootStore(){return this.noteStore.assertRootStore}get searchStore(){return this.noteStore.searchStore}get mainView(){return this.rootStore.mainView}get currentGraph(){return this.noteStore.assertGraph}get preferences(){return this.rootStore.preferenceStore}get dateFormat(){var e,t;return null!==(t=null===(e=this.preferences)||void 0===e?void 0:e.dateFormat)&&void 0!==t?t:x.t6.MonthDayYear}get weekStart(){var e,t;return null!==(t=null===(e=this.preferences)||void 0===e?void 0:e.weekStart)&&void 0!==t?t:x.L8.Monday}get backlinkDateGenerator(){return new rA.e({weekStart:this.weekStart,dateFormat:this.dateFormat})}onSelectDate(e){this.noteStore.dailyEditorView.setSelectedDate(e,{scroll:!0,focus:!0,edge:"subject_end"}),this.mainView.setScreen(N.oK.NoteDaily)}get tags(){if(!this.query)return[];let e=this.query.replace(rN,"");return this.currentGraph.tags.filter(t=>t.includes(e))}get tagResults(){return this.tags.map(e=>({id:e,title:"#".concat(e),onSelect:()=>this.mainView.openNotesListForTag(e)}))}async onSelectNote(e,t){let n=await this.noteStore.findById(e);this.mainView.editNote(n,{secondary:(null==t?void 0:t.metaKey)||(null==t?void 0:t.ctrlKey),searchQuery:this.query})}get normalizedQuery(){return(0,rM.Up)(this.query)}get searchByIdResults(){var e;let t=null===(e=this.searchByIdNote)||void 0===e?void 0:e.value;return t?[{id:t.id,title:t.subject,noteId:t.id,onSelect:e=>this.onSelectNote(t.id,e)}]:[]}get searchByIdNote(){return this.query?this.noteStore.adapter.placeholder(this.query):null}get generatedResults(){if(!this.query)return[];let e=this.backlinkDateGenerator.generate(this.query).map(e=>({id:e.id,onSelect:()=>this.onSelectDate(e.dailyAt),timestamp:e.dailyAt.getTime(),title:e.label})),t=this.noteResults.map(e=>e.id);return e.filter(e=>!t.includes(e.id)).slice(0,3)}get actions(){return[{id:"daily-notes",title:"Go to daily notes",onSelect:()=>this.mainView.openTodaysNoteDailyScreen()},{id:"list-notes",title:"Go to all notes",onSelect:()=>this.mainView.openListScreen()},{id:"map",title:"Go to map",onSelect:()=>this.mainView.openMapScreen()},{id:"preferences",title:"Go to preferences",onSelect:()=>this.rootStore.openPreferencesScreen()},{id:"billing",title:"Go to billing",onSelect:()=>this.rootStore.openPreferencesScreen()},{id:"shortcuts",title:"Go to keyboard shortcuts",onSelect:()=>this.mainView.toggleShortcutsModal()},{id:"new-note",title:"Create a new note",onSelect:()=>this.mainView.createAndEditNote()},{id:"random-note",title:"Go to a random note",onSelect:()=>this.mainView.editRandomNote()},{id:"download-mac-app",title:"Install macOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-extension",title:"Install Chrome extension",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-ios-app",title:"Install iOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-mac-app",title:"Download macOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-extension",title:"Download Chrome extension",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-ios-app",title:"Download iOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"contact-support",title:"Contact support",contentLine:"support@reflect.app",onSelect:()=>window.open("mailto:support@reflect.app")},{id:"contact-feedback",title:"Give feedback",contentLine:"feedback@reflect.app",onSelect:()=>window.open("mailto:feedback@reflect.app")},{id:"help-academy",title:"Help and academy",contentLine:"reflect.academy",onSelect:()=>window.open("/academy")},{id:"discord",title:"Community discord",contentLine:"reflect.app/discord",onSelect:()=>window.open("/discord")},{id:"roadmap",title:"Roadmap",contentLine:"roadmap.reflect.app",onSelect:()=>window.open("/roadmap")}]}get actionResults(){return this.query.length<3?[]:rT()(this.actions.filter(e=>{let{title:t}=e;return t.toLowerCase().includes(this.normalizedQuery)}).slice(0,5),e=>e.id)}get noteActionResults(){return this.query?[{id:"create-note",title:"Create note '".concat(this.query,"'"),onSelect:async e=>{let t=await this.noteStore.createNote({subject:this.query});await this.onSelectNote(t.id,e)}}]:[]}constructor(e){this.noteStore=e,this.query="",this.filters=[],this.noteResults=[],this.isSearching=!1,this.strategy="fuzzy",this.mode="search",this.lastOpenedAt=null,this.listeners=[],(0,m.makeObservable)(this)}}(0,eU.gn)([m.observable],rV.prototype,"query",void 0),(0,eU.gn)([m.observable],rV.prototype,"filters",void 0),(0,eU.gn)([m.observable.shallow],rV.prototype,"noteResults",void 0),(0,eU.gn)([m.observable],rV.prototype,"isSearching",void 0),(0,eU.gn)([m.observable],rV.prototype,"strategy",void 0),(0,eU.gn)([m.observable],rV.prototype,"mode",void 0),(0,eU.gn)([m.action],rV.prototype,"setMode",null),(0,eU.gn)([m.computed],rV.prototype,"searchType",null),(0,eU.gn)([m.computed],rV.prototype,"results",null),(0,eU.gn)([m.computed],rV.prototype,"count",null),(0,eU.gn)([m.action],rV.prototype,"setQuery",null),(0,eU.gn)([m.action],rV.prototype,"setStrategy",null),(0,eU.gn)([m.action],rV.prototype,"setSearching",null),(0,eU.gn)([m.action],rV.prototype,"removeFilter",null),(0,eU.gn)([m.action],rV.prototype,"addFilter",null),(0,eU.gn)([m.action],rV.prototype,"setNoteResults",null),(0,eU.gn)([m.action],rV.prototype,"reset",null),(0,eU.gn)([(0,m.computed)({keepAlive:!0})],rV.prototype,"backlinkDateGenerator",null),(0,eU.gn)([m.computed],rV.prototype,"normalizedQuery",null),(0,eU.gn)([m.computed],rV.prototype,"searchByIdNote",null),(0,eU.gn)([m.computed],rV.prototype,"actions",null);var rZ=n(69254),rF=n(58623),rO=n(64299),rB=n(35780),rz=n(62357);let r_=rZ.v2;rZ.ZA,rZ.h_,rZ.Tr;let rU=rZ.Ee,rq=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(rZ.fC,{ref:t,className:(0,_.cn)("flex h-10 items-center space-x-1 rounded-md border bg-background p-1",n),...r})});rq.displayName=rZ.fC.displayName;let rG=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(rZ.xz,{ref:t,className:(0,_.cn)("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",n),...r})});rG.displayName=rZ.xz.displayName,l.forwardRef((e,t)=>{let{className:n,inset:r,children:a,...s}=e;return(0,o.jsxs)(rZ.fF,{ref:t,className:(0,_.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",n),...s,children:[a,(0,o.jsx)(rO.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=rZ.fF.displayName,l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(rZ.tu,{ref:t,className:(0,_.cn)("z-modal min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})}).displayName=rZ.tu.displayName;let rH=l.forwardRef((e,t)=>{let{className:n,align:r="start",alignOffset:a=-4,sideOffset:s=8,...i}=e;return(0,o.jsx)(rz.W,{children:(0,o.jsx)(rZ.VY,{ref:t,align:r,alignOffset:a,sideOffset:s,className:(0,_.cn)("z-modal min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...i})})});rH.displayName=rZ.VY.displayName,l.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,o.jsx)(rZ.ck,{ref:t,className:(0,_.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",n),...a})}).displayName=rZ.ck.displayName,l.forwardRef((e,t)=>{let{className:n,children:r,checked:a,...s}=e;return(0,o.jsxs)(rZ.oC,{ref:t,className:(0,_.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:a,...s,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(rZ.wU,{children:(0,o.jsx)(rF.Z,{className:"h-4 w-4"})})}),r]})}).displayName=rZ.oC.displayName,l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,o.jsxs)(rZ.Rk,{ref:t,className:(0,_.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(rZ.wU,{children:(0,o.jsx)(rB.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=rZ.Rk.displayName,l.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,o.jsx)(rZ.__,{ref:t,className:(0,_.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",n),...a})}).displayName=rZ.__.displayName,l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(rZ.Z0,{ref:t,className:(0,_.cn)("-mx-1 my-1 h-px bg-muted",n),...r})}).displayName=rZ.Z0.displayName;var rK=n(50295);let rW=e=>{let{label:t,active:n,onActiveChange:r,value:a,onValueChange:s,onClick:i,children:d}=e,c=l.useRef(null),u=()=>{let e=c.current;e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})};return(0,o.jsxs)("div",{className:"relative",ref:c,"data-search-badge":!0,children:[(0,o.jsxs)(rq,{value:a,onValueChange:s,className:(0,_.cn)("relative m-0 flex h-7 space-x-0 divide-x overflow-hidden rounded-full p-0 transition","ring-ring ring-offset-1 focus-within:ring-2",n?"opacity-100":"opacity-50 focus-within:opacity-80 hover:border-brand/30 hover:opacity-80",n&&"border-brand/60 text-brand"),tabIndex:-1,onClick:i,children:[(0,o.jsx)("button",{tabIndex:0,className:(0,_.cn)("h-full cursor-default select-none items-center whitespace-nowrap px-1.5 py-0 text-sm font-medium outline-none transition-colors first:pl-3 last:pr-3",n&&"hover:bg-secondary"),onClick:e=>{e.preventDefault(),r(!0),u()},children:t}),d]}),n&&(0,o.jsx)("button",{className:"absolute -top-[6px] -right-[6px] flex h-4 w-4 items-center justify-center rounded-full border-none bg-primary text-primary-foreground opacity-100 outline-none transition focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-1 hover:bg-destructive hover:text-destructive-foreground hover:opacity-100",onClick:()=>r(!1),children:(0,o.jsx)(z.Z,{className:"h-3 w-3"})})]})},rY=e=>{let{value:t,label:n,children:r}=e;return(0,o.jsxs)(r_,{value:t,children:[(0,o.jsx)(rG,{className:"h-full whitespace-nowrap rounded-none px-1.5 py-0 transition-colors first:pl-3 last:pr-3 hover:bg-secondary focus:bg-brand focus:text-brand-foreground data-[state=open]:bg-brand data-[state=open]:text-brand-foreground",children:n||"..."}),(0,o.jsx)(rH,{className:"max-h-[var(--radix-menubar-content-available-height)] overflow-auto",onCloseAutoFocus:rK.B,children:r})]})},rQ=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,o.jsxs)(rZ.Rk,{ref:t,className:(0,_.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-brand focus:text-brand-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),onSelect:rK.B,...a,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(rZ.wU,{children:(0,o.jsx)(rF.Z,{className:"h-4 w-4"})})}),r]})});rQ.displayName="SearchBadgeCheckItem";let rJ=e=>{let{label:t,value:n,onValueChange:r}=e;return(0,o.jsx)(rW,{label:t,active:n,onActiveChange:r,onClick:()=>{n&&r(!1)}})};var rX=n(56025),r$=n(44193),r0=n(6883),r1=n(10778);function r5(e){return/^relative-\d+-(day|week|month|year)-(ago|ahead)$/.test(e)}function r2(e){if(!r5(e))throw Error("Invalid relative date value: ".concat(e));return e}function r7(e){return/^custom-single-\d+$/.test(e)}function r9(e){return/^custom-range-\d+-\d+$/.test(e)}function r3(e){return"today"===e||r5(e)||r7(e)||r9(e)}function r6(e){if(!r3(e))throw Error("Invalid date value: ".concat(e))}function r4(e,t){return!e||"today"===e||e.startsWith("relative-0-")?"today":e.startsWith("relative-1-")?e:e.startsWith("relative-")?"relative":"single"===t?"custom-single":"custom-range"}function r8(e){if(!e)return null;if(r6(e),"today"===e||e.startsWith("relative-0-"))return{from:new Date,to:null};if(r5(e)){let[,t,n,r]=e.split("-"),a=new Date,s=Number.parseInt(t,10),i="ago"===r?-s:s;if("day"===n)return{from:(0,rX.Z)(a,i),to:null};if("week"===n)return{from:(0,rX.Z)(a,7*i),to:null};if("month"===n)return{from:(0,r$.Z)(a,i),to:null};if("year"===n)return{from:(0,r$.Z)(a,12*i),to:null};throw Error("Invalid date unit: ".concat(n))}if(r7(e)){let[,,t]=e.split("-");return{from:new Date(Number.parseInt(t,10)),to:null}}if(r9(e)){let[,,t,n]=e.split("-");return{from:new Date(Number.parseInt(t,10)),to:new Date(Number.parseInt(n,10))}}throw Error("Invalid date value: ".concat(e))}function ae(e){switch(e){case"1":return"one";case"2":return"two";case"3":return"three";case"4":return"four";case"5":return"five";case"6":return"six";case"7":return"seven";case"8":return"eight";case"9":return"nine";case"10":return"ten";default:return e}}var at=n(39373);let an=e=>{let{mode:t,weekStart:n,range:r,onChange:a,className:s}=e,i=n===x.L8.Monday?1:0;if("single"!==t)return(0,o.jsx)(at.f,{mode:"range",className:s,weekStartsOn:i,selected:{from:(null==r?void 0:r.from)||void 0,to:(null==r?void 0:r.to)||void 0},onSelect:e=>{if(e){var t,n;a({from:null!==(t=e.from)&&void 0!==t?t:null,to:null!==(n=e.to)&&void 0!==n?n:null})}else a(null)}});{let e=(null==r?void 0:r.from)||(null==r?void 0:r.to)||void 0;return(0,o.jsx)(at.f,{mode:"single",className:s,weekStartsOn:i,selected:e,onSelect:e=>{e?a({from:e,to:e}):a(null)}})}};var ar=n(4396),aa=n(65300),as=n(25365);let ai=aa.fC;aa.ZA;let ao=aa.B4,al=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,o.jsxs)(aa.xz,{ref:t,className:(0,_.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...a,children:[r,(0,o.jsx)(aa.JO,{asChild:!0,children:(0,o.jsx)(as.Z,{className:"h-4 w-4 opacity-50"})})]})});al.displayName=aa.xz.displayName;let ad=l.forwardRef((e,t)=>{let{className:n,children:r,position:a="popper",...s}=e;return(0,o.jsx)(rz.W,{children:(0,o.jsx)(aa.VY,{ref:t,className:(0,_.cn)("relative z-modal min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:a,...s,children:(0,o.jsx)(aa.l_,{className:(0,_.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});ad.displayName=aa.VY.displayName,l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(aa.__,{ref:t,className:(0,_.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...r})}).displayName=aa.__.displayName;let ac=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,o.jsxs)(aa.ck,{ref:t,className:(0,_.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(aa.wU,{children:(0,o.jsx)(rF.Z,{className:"h-4 w-4"})})}),(0,o.jsx)(aa.eT,{children:r})]})});ac.displayName=aa.ck.displayName,l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(aa.Z0,{ref:t,className:(0,_.cn)("-mx-1 my-1 h-px bg-muted",n),...r})}).displayName=aa.Z0.displayName;let au=e=>{let{value:t,onValueChange:n,className:r}=e;t&&r5(t)||(t="relative-1-day-ago");let[,a,s,i]=t.split("-");a||(a="1"),s||(s="day"),i||(i="ago");let l=e=>{n(r2("relative-".concat(e,"-").concat(s,"-").concat(i)))};return(0,o.jsxs)("div",{className:(0,_.cn)("flex gap-1 overflow-x-hidden",r),children:[(0,o.jsx)(ar.I,{type:"number",value:a,className:"flex-1 !ring-transparent",onChange:e=>l(e.target.value)}),(0,o.jsxs)(ai,{value:s,onValueChange:e=>{n(r2("relative-".concat(a,"-").concat(e,"-").concat(i)))},children:[(0,o.jsx)(al,{className:"flex-1 !ring-transparent",children:(0,o.jsx)(ao,{})}),(0,o.jsxs)(ad,{className:"",children:[(0,o.jsx)(ac,{value:"day",children:"day(s)"}),(0,o.jsx)(ac,{value:"week",children:"week(s)"}),(0,o.jsx)(ac,{value:"month",children:"month(s)"}),(0,o.jsx)(ac,{value:"year",children:"years(s)"})]})]}),(0,o.jsxs)(ai,{value:i,onValueChange:e=>{n(r2("relative-".concat(a,"-").concat(s,"-").concat(e)))},children:[(0,o.jsx)(al,{className:"flex-1 whitespace-nowrap !ring-transparent",children:(0,o.jsx)(ao,{})}),(0,o.jsxs)(ad,{className:"",children:[(0,o.jsx)(ac,{value:"ago",children:"ago"}),(0,o.jsx)(ac,{value:"ahead",children:"from now"})]})]})]})},ah=e=>{let{mode:t,weekStart:n,value:r,onValueChange:a,onDismiss:s}=e,[i,d]=(0,l.useState)(r4(r,t)),c=r?r8(r):null,u=e=>{d(e),r3(e)&&(a(e),s())};return(0,l.useEffect)(()=>{d(r4(r,t))},[r,t]),(0,o.jsxs)("div",{className:"flex w-[300px] flex-col gap-2",children:["single"===t&&(0,o.jsxs)(rU,{value:null!=i?i:"",onValueChange:u,children:[(0,o.jsx)(rQ,{value:"today",children:"today"}),(0,o.jsx)(rQ,{value:"relative-1-day-ago",children:"yesterday"}),(0,o.jsx)(rQ,{value:"relative-1-day-ahead",children:"tomorrow"}),(0,o.jsx)(rQ,{value:"relative-1-week-ago",children:"one week ago"}),(0,o.jsx)(rQ,{value:"relative-1-week-ahead",children:"one week from now"}),(0,o.jsx)(rQ,{value:"relative-1-month-ago",children:"one month ago"}),(0,o.jsx)(rQ,{value:"relative-1-month-ahead",children:"one month from now"}),(0,o.jsx)(rQ,{value:"relative",children:"relative date..."}),(0,o.jsx)(rQ,{value:"custom-single",children:"exact date..."})]}),"range"===t&&(0,o.jsxs)(rU,{value:null!=i?i:"",onValueChange:u,children:[(0,o.jsx)(rQ,{value:"today",children:"today"}),(0,o.jsx)(rQ,{value:"relative-1-week-ago",children:"the past week"}),(0,o.jsx)(rQ,{value:"relative-1-month-ago",children:"the past month"}),(0,o.jsx)(rQ,{value:"relative-1-year-ago",children:"the past year"}),(0,o.jsx)(rQ,{value:"relative",children:"relative range..."}),(0,o.jsx)(rQ,{value:"custom-range",children:"exact range..."})]}),i.startsWith("custom")&&(0,o.jsx)(an,{mode:t,weekStart:n,range:c,onChange:e=>{let n=(null==e?void 0:e.from)||(null==e?void 0:e.to);if(e&&n){if("single"===t)a("custom-single-".concat(n.getTime()));else{let t=e.from||n,r=e.to||n;a("custom-range-".concat(t.getTime(),"-").concat(r.getTime()))}}}}),i.startsWith("relative")&&(0,o.jsx)(au,{value:r,onValueChange:a})]})},ap=e=>{let{value:t,onValueChange:n}=e;return(0,o.jsxs)(rU,{value:null!=t?t:"",onValueChange:n,children:[(0,o.jsx)(rQ,{value:"is",children:"is..."}),(0,o.jsx)(rQ,{value:"is before",children:"is before..."}),(0,o.jsx)(rQ,{value:"is after",children:"is after..."}),(0,o.jsx)(rQ,{value:"is within",children:"is within..."})]})},am=(0,f.Pi)(e=>{let{label:t,view:n}=e,{dateFormat:r,weekStart:a}=(0,x.Jf)();return(0,o.jsxs)(rW,{label:t,active:n.active,onActiveChange:e=>{n.handleActiveChange(e)},value:n.openSegment,onValueChange:e=>n.setOpenSegment(e),children:[n.active?(0,o.jsx)(rY,{value:"operation",label:n.operationValue,children:(0,o.jsx)(ap,{value:n.operationValue,onValueChange:e=>n.handleOperationValueChange(e)})}):null,n.active&&n.operationValue?(0,o.jsx)(rY,{value:"date",label:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return"";if(r6(e),"today"===e||e.startsWith("relative-0-"))return"today";if("relative-1-day-ago"===e)return"yesterday";if("relative-1-day-ahead"===e)return"tomorrow";if(r5(e)){let[,t,r,a]=e.split("-"),s="1"===t?"":"s";return n?["the","ago"===a?"past":"feature",ae(t),r+s].join(" "):[ae(t),r+s,"ago"===a?"ago":"from now"].join(" ")}if(r7(e)){let[,,n]=e.split("-"),r=Number.parseInt(n,10);return(0,rr.p6)(new Date(r),t)}if(r9(e)){let[,,n,r]=e.split("-"),a=Number.parseInt(n,10),s=Number.parseInt(r,10),i=(0,rr.p6)(new Date(a),t),o=(0,rr.p6)(new Date(s),t);return i===o?i:"".concat(i," - ").concat(o)}return""}(n.dateValue,r,"is within"===n.operationValue),children:(0,o.jsx)(ah,{value:n.dateValue,onValueChange:e=>n.setDateValue(e),onDismiss:()=>n.handleClose(),weekStart:a,mode:n.calendarMode})}):null]})});var af=n(14630);class ax{dispose(){}setNoteId(e){this.noteId=e}setActive(e){this.isActive=e}setOpen(e){this.isOpen=e}setQuery(e){this.query=e}get note(){return this.noteId?this.adapter.placeholder(this.noteId):null}get adapter(){return this.noteStore.adapter}get table(){return this.noteStore.table}async fetchAll(){this.recentNotes=await this.fetchRecentNotes(),this.allNotes=await this.fetchNoteSubjects()}async fetchRecentNotes(){let e=this.notesQuery.limit(20);return await this.table.adapter.executeSelect(e)}async fetchNoteSubjects(){let e=this.notesQuery.clearSelect().select(["id","subject","systemMetadata"]);return await this.table.adapter.executeSelect(e)}get notesQuery(){return this.noteStore.notesEditedDescQuery.where(e=>e.and([e("subject","is not",null),e("subject","!=","")]))}get filteredNotes(){return this.query?(0,af.Gd)(this.allNotes,this.query,20).map(e=>{let{note:t}=e;return t}):this.recentNotes}constructor(e,t){this.noteStore=e,this.noteId=null,this.isActive=!1,this.isOpen=!1,this.query="",this.recentNotes=[],this.allNotes=[],this.noteId=t,(0,m.makeObservable)(this),this.fetchAll()}}(0,eU.gn)([m.observable],ax.prototype,"noteId",void 0),(0,eU.gn)([m.observable],ax.prototype,"isActive",void 0),(0,eU.gn)([m.observable],ax.prototype,"isOpen",void 0),(0,eU.gn)([m.observable],ax.prototype,"query",void 0),(0,eU.gn)([m.action],ax.prototype,"setNoteId",null),(0,eU.gn)([m.action],ax.prototype,"setActive",null),(0,eU.gn)([m.action],ax.prototype,"setOpen",null),(0,eU.gn)([m.action],ax.prototype,"setQuery",null);var ag=n(34390),av=n(22490);let ay=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ag.mY,{ref:t,className:(0,_.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",n),...r})});ay.displayName=ag.mY.displayName;let ab=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsxs)("div",{className:"-mt-1 flex items-center border-b px-2","cmdk-input-wrapper":"",children:[(0,o.jsx)(av.Z,{className:"mr-2 h-3.5 w-3.5 shrink-0 opacity-50"}),(0,o.jsx)(ag.mY.Input,{ref:t,className:(0,_.cn)("flex w-full rounded-md bg-transparent py-2 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",n),...r})]})});ab.displayName=ag.mY.Input.displayName;let aw=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ag.mY.List,{ref:t,className:(0,_.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",n),...r})});aw.displayName=ag.mY.List.displayName;let aj=l.forwardRef((e,t)=>(0,o.jsx)(ag.mY.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));aj.displayName=ag.mY.Empty.displayName,l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ag.mY.Group,{ref:t,className:(0,_.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",n),...r})}).displayName=ag.mY.Group.displayName,l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ag.mY.Separator,{ref:t,className:(0,_.cn)("-mx-1 h-px bg-border",n),...r})}).displayName=ag.mY.Separator.displayName;let ak=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(ag.mY.Item,{ref:t,className:(0,_.cn)("[&_svg]:size-4 relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0",n),...r})});ak.displayName=ag.mY.Item.displayName;let aN=(0,f.Pi)(e=>{var t,n;let{label:r,noteId:a,onNoteIdChange:s}=e,i=(0,x.dw)(),d=(0,eF.D)(()=>new ax(i,a),[i]);(0,l.useEffect)(()=>{d.setNoteId(a),d.setActive(!!a)},[a,d]);let c=(0,l.useRef)(null),u=e=>{e?s(e):s(null)};return(0,l.useEffect)(()=>{if(d.isActive&&d.isOpen){let e=setTimeout(()=>{var e;null===(e=c.current)||void 0===e||e.focus()},100);return()=>clearTimeout(e)}},[d.isActive,d.isOpen]),(0,o.jsx)(rW,{label:r,active:d.isActive,onActiveChange:e=>{d.setActive(e),e?d.setOpen(!0):(d.setOpen(!1),s(null))},value:d.isOpen?aS:"",onValueChange:e=>{e||a||d.setActive(!1),d.setOpen(!!e)},children:d.isActive?(0,o.jsx)(rY,{value:aS,label:null===(n=d.note)||void 0===n?void 0:null===(t=n.value)||void 0===t?void 0:t.subject,children:(0,o.jsxs)(ay,{shouldFilter:!1,children:[(0,o.jsx)(ab,{ref:c,placeholder:"Filter notes by subject...",value:d.query,onValueChange:e=>d.setQuery(e)}),(0,o.jsxs)(aw,{className:"max-w-xs",children:[(0,o.jsx)(aj,{children:"No note found"}),d.filteredNotes.map(e=>(0,o.jsx)(ak,{onSelect:()=>u(e.id),value:e.id,className:"aria-selected:bg-brand aria-selected:text-brand-foreground",children:(0,o.jsx)("div",{className:"max-w-[400px] truncate",children:e.subject})},e.id))]})]})}):null})}),aS="notes_seg",aC="fuzzy",aR="strategy_seg";function aI(e){let{strategy:t,onChange:n}=e,[r,a]=(0,l.useState)(t!==aC),[s,i]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t!==aC&&a(!0)},[t]);let d={exact:"Exact",fuzzy:"Fuzzy",semantic:"Semantic"}[t];return(0,o.jsx)(rW,{label:"Search type",active:r,onActiveChange:e=>{e?(a(!0),i(!0)):(a(!1),i(!1),n(aC))},value:s?aR:"",onValueChange:e=>{e===aR?(a(!0),i(!0)):i(!1)},children:(0,o.jsx)(rY,{value:aR,label:d,children:(0,o.jsxs)(rU,{value:t,onValueChange:e=>{n(e),i(!1)},children:[(0,o.jsx)(eE.u,{label:"Find results that are similar to your search term, allowing for minor spelling or typographical errors.",children:(0,o.jsx)(rQ,{value:"fuzzy",children:"Fuzzy (default)"})}),(0,o.jsx)(eE.u,{label:"Search for an exact match to your query, with no variations on the search term.",children:(0,o.jsx)(rQ,{value:"exact",children:"Exact"})}),(0,o.jsx)(eE.u,{label:"Discover content that conceptually relates to your search, even if the exact words are not used.",children:(0,o.jsx)(rQ,{value:"semantic",children:"Semantic"})})]})})})}let aE=e=>{var t,n;let{tags:r,onTagsChange:a}=e,s=(0,x.BG)(),i=r.length>0,[d,c]=(0,l.useState)(!1),u=(0,l.useRef)(null),h=(null!==(n=null===(t=s.currentGraph)||void 0===t?void 0:t.tags)&&void 0!==n?n:[]).filter(e=>!r.includes(e)),p=e=>{e&&!r.includes(e)&&a([...r,e])};return(0,l.useEffect)(()=>{if(d){let e=setTimeout(()=>{var e;null===(e=u.current)||void 0===e||e.focus()},100);return()=>clearTimeout(e)}},[d]),(0,o.jsx)(rW,{label:"Tags",active:i||d,onActiveChange:e=>{e?c(!0):(c(!1),a([]))},value:d?"tags-seg":"",onValueChange:e=>{c(!!e)},children:i||d?(0,o.jsx)(rY,{value:"tags-seg",label:(0,o.jsx)(aD,{tags:r,onDeleteTag:e=>{a(r.filter(t=>t!==e))}}),children:(0,o.jsxs)(ay,{children:[(0,o.jsx)(ab,{placeholder:"Search tags...",ref:u}),(0,o.jsxs)(aw,{className:"max-w-xs",children:[(0,o.jsx)(aj,{children:"No tag found"}),h.map(e=>(0,o.jsxs)(ak,{onSelect:()=>p(e),className:"aria-selected:bg-brand aria-selected:text-brand-foreground",children:["#",e]},e))]})]})}):null})},aD=e=>{let{tags:t,onDeleteTag:n}=e;return 0===t.length?(0,o.jsx)("span",{children:"..."}):(0,o.jsx)("span",{className:"space-x-1",children:t.map(e=>(0,o.jsxs)("span",{onClick:()=>n(e),className:"decoration-destructive/80 decoration-2 hover:text-destructive/80 hover:line-through",children:["#",e]},e))})},aP=(0,f.Pi)(e=>{let{searchFilterBarView:t}=e;return(0,o.jsxs)("div",{className:"flex flex-none gap-1 overflow-x-auto px-4 py-2",children:[(0,o.jsx)(am,{label:"Created at",view:t.createdAtView}),(0,o.jsx)(am,{label:"Updated at",view:t.editedAtView}),(0,o.jsx)(am,{label:"Daily notes",view:t.dailyView}),(0,o.jsx)(aN,{label:"Linked to",noteId:t.toNoteId,onNoteIdChange:e=>t.updateToNoteId(e)}),(0,o.jsx)(aN,{label:"Linked by",noteId:t.fromNoteId,onNoteIdChange:e=>t.updateFromNoteId(e)}),(0,o.jsx)(aE,{tags:t.tags,onTagsChange:e=>t.updateTags(e)}),(0,o.jsx)(rJ,{label:"Pinned",value:t.pinned,onValueChange:e=>t.updatePinned(e)}),(0,o.jsx)(rJ,{label:"Published",value:t.public,onValueChange:e=>t.updatePublic(e)}),(0,o.jsx)(aI,{strategy:t.strategy,onChange:e=>t.updateStrategy(e)})]})});var aT=n(17322),aA=n(14321);function aM(e,t,n){let r=n.from?(0,aT.Z)(n.from).getTime():0,a=n.to?(0,aA.Z)(n.to).getTime():Number.MAX_SAFE_INTEGER;return e.and([e(t,">=",r),e(t,"<=",a)])}class aL{condition(){return e=>aM(e,"createdAt",this.range)}constructor(e){this.range=e,this.type="createdAt"}}class aV{condition(){return e=>aM(e,e.fn.coalesce("editedAt","createdAt"),this.range)}constructor(e){this.range=e,this.type="editedAt"}}class aZ{condition(){return e=>e.and([e("dailyDate","is not",null),aM(e,"dailyDate",this.range)])}constructor(e){this.range=e,this.type="daily"}}class aF{condition(){return e=>{if(0===this.tags.length)return e.val(!0);let t=this.tags.map(t=>(0,ng.$M)(e,"tags",t));return e.and([e("tags","is not",null),...t])}}constructor(e){this.tags=e,this.type="tag"}}class aO{async condition(){let e=await this.backlinkStore.getOutgoingBacklinkNoteIds(this.fromNoteId);return t=>t("id","in",(0,ng.pP)(Array.from(e)))}constructor(e,t){this.backlinkStore=e,this.fromNoteId=t,this.type="outgoingBacklink"}}class aB{async condition(){let e=await this.backlinkStore.getIncomingBacklinkNoteIds(this.toNoteId);return t=>t("id","in",(0,ng.pP)(Array.from(e)))}constructor(e,t){this.backlinkStore=e,this.toNoteId=t,this.type="incomingBacklink"}}class az{condition(){return e=>e("pinnedIndex","is not",null)}constructor(){this.type="pinned"}}class a_{condition(){return e=>e.and([(0,ng.$M)(e,"acl","public")])}constructor(){this.type="public"}}class aU{get calendarMode(){return"is within"===this.operationValue?"range":"single"}reset(){this.setOperationValue(this.defaultOperationValue),this.setDateValue(this.defaultDateValue),this.setOpenSegment(""),this.setActive(!1)}setOperationValue(e){this.operationValue=e}setDateValue(e){this.dateValue=e}setOpenSegment(e){this.openSegment=e}setActive(e){this.active=e}handleClose(){this.setOpenSegment("")}handleActiveChange(e){this.setActive(e),e?this.setOpenSegment("operation"):(this.setOpenSegment(""),this.setOperationValue(this.defaultOperationValue),this.setDateValue(this.defaultDateValue),this.onDateRangeChange(null))}handleOperationValueChange(e){this.setOperationValue(e),e&&this.setOpenSegment("date")}calculateDateRange(){let e=this.dateValue,t=this.operationValue;if(!this.active)return null;{let n=r8(e);return n&&function(e,t){var n;let r=null!==(n=e.from)&&void 0!==n?n:e.to;if(r)switch(t){case"is":return{from:r,to:r};case"is before":return{from:null,to:r};case"is after":return{from:r,to:null};case"is within":if(e.from&&e.to)return{from:e.from,to:e.to};{let e=new Date;return{from:(0,r0.Z)([r,e]),to:(0,r1.Z)([r,e])}}}return null}(n,t)}}onAttached(){return this.listeners.push((0,m.autorun)(()=>{let e=this.calculateDateRange();this.onDateRangeChange(e)})),()=>{this.beforeDetach()}}beforeDetach(){return(0,t$.$)(this.listeners)}constructor({defaultOperationValue:e="is",defaultDateValue:t="today",onDateRangeChange:n}){this.openSegment="",this.active=!1,this.listeners=[],this.defaultOperationValue=e,this.defaultDateValue=t,this.operationValue=e,this.dateValue=t,this.onDateRangeChange=n,(0,m.makeObservable)(this)}}(0,eU.gn)([m.observable],aU.prototype,"operationValue",void 0),(0,eU.gn)([m.observable],aU.prototype,"dateValue",void 0),(0,eU.gn)([m.observable],aU.prototype,"openSegment",void 0),(0,eU.gn)([m.observable],aU.prototype,"active",void 0),(0,eU.gn)([m.action],aU.prototype,"setOperationValue",null),(0,eU.gn)([m.action],aU.prototype,"setDateValue",null),(0,eU.gn)([m.action],aU.prototype,"setOpenSegment",null),(0,eU.gn)([m.action],aU.prototype,"setActive",null);class aq{reset(){this.createdAtView.reset(),this.editedAtView.reset(),this.dailyView.reset()}get tags(){var e,t;return null!==(t=null===(e=this.searchView.getFilter("tag"))||void 0===e?void 0:e.tags)&&void 0!==t?t:[]}updateTags(e){e.length>0?this.searchView.addFilter(new aF(e)):this.searchView.removeFilter("tag")}get toNoteId(){var e,t;return null!==(t=null===(e=this.searchView.getFilter("incomingBacklink"))||void 0===e?void 0:e.toNoteId)&&void 0!==t?t:null}updateToNoteId(e){e?this.searchView.addFilter(new aB(this.noteBacklinkStore,e)):this.searchView.removeFilter("incomingBacklink")}get fromNoteId(){var e,t;return null!==(t=null===(e=this.searchView.getFilter("outgoingBacklink"))||void 0===e?void 0:e.fromNoteId)&&void 0!==t?t:null}updateFromNoteId(e){e?this.searchView.addFilter(new aO(this.noteBacklinkStore,e)):this.searchView.removeFilter("outgoingBacklink")}get pinned(){return this.searchView.hasFilter("pinned")}updatePinned(e){e?this.searchView.addFilter(new az):this.searchView.removeFilter("pinned")}get public(){return this.searchView.hasFilter("public")}updatePublic(e){e?this.searchView.addFilter(new a_):this.searchView.removeFilter("public")}get strategy(){return this.searchView.strategy}updateStrategy(e){this.searchView.setStrategy(e)}onAttached(){this.listeners.push(this.createdAtView.onAttached(),this.editedAtView.onAttached(),this.dailyView.onAttached())}dispose(){return(0,t$.$)(this.listeners)}constructor(e,t){this.searchView=e,this.noteBacklinkStore=t,this.createdAtView=new aU({onDateRangeChange:e=>{e?this.searchView.addFilter(new aL(e)):this.searchView.removeFilter("createdAt")}}),this.editedAtView=new aU({onDateRangeChange:e=>{e?this.searchView.addFilter(new aV(e)):this.searchView.removeFilter("editedAt")}}),this.dailyView=new aU({defaultOperationValue:"is within",defaultDateValue:"relative-1-year-ago",onDateRangeChange:e=>{e?this.searchView.addFilter(new aZ(e)):this.searchView.removeFilter("daily")}}),this.listeners=[],this.onAttached()}}var aG=n(35140);let aH=e=>{let{className:t,onClick:n,disabled:r}=e;return(0,o.jsx)(eE.u,{delay:r?0:300,label:r?"Add some search criteria to start a chat.":"Start an AI chat using your search results as context.",children:(0,o.jsx)("div",{children:(0,o.jsxs)(O.z,{variant:"outline",size:"sm",className:(0,_.cn)("inline-flex gap-2",t),onClick:n,disabled:r,children:[(0,o.jsx)("span",{children:"Chat with results"}),(0,o.jsx)(e6.l,{shortcut:"mod+j"})]})})})},aK=e=>{let{className:t,onClick:n,disabled:r}=e;return(0,o.jsx)("div",{children:(0,o.jsxs)(O.z,{variant:"outline",size:"sm",className:(0,_.cn)("inline-flex gap-2",t),onClick:n,disabled:r,children:[(0,o.jsx)("span",{children:"Reset"}),(0,o.jsx)(e6.l,{shortcut:"mod+Backspace"})]})})},aW=e=>{let{query:t,onChange:n,onEnterChat:r,onReset:a}=e;return(0,o.jsxs)("div",{className:"flex flex-none gap-2 px-4",style:{height:52},children:[(0,o.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,o.jsx)(aG.W,{className:"h-7 w-7"})}),(0,o.jsx)("input",{autoFocus:!0,type:"text",className:"m-0 flex-1 border-none bg-transparent p-0 text-base text-foreground outline-none focus:ring-0 dark:text-white",value:t,onChange:e=>{n(e.target.value)},autoCapitalize:"off",autoCorrect:"off",autoComplete:"off"}),(0,o.jsxs)("div",{className:"flex flex-none items-center justify-center gap-2",children:[(0,o.jsx)(aK,{disabled:!a,onClick:a,className:"flex-none"}),(0,o.jsx)(aH,{disabled:!r,onClick:r,className:"flex-none"})]})]})},aY=(0,f.Pi)(()=>{let e=(0,x.Pw)(),t=(0,x.dw)(),n=(0,x.Fq)(),r=(0,eF.D)(()=>new rV(t),[t]),a=(0,eF.D)(()=>new rm.g(t),[t]),s=(0,eF.D)(()=>new aq(r,n.noteBacklinkStore),[r,n]);return(0,es.y)("mod+j",e=>{e.preventDefault(),r.toggleMode()},{enabled:e.searchModalIsOpen}),(0,es.y)("mod+Backspace",e=>{e.preventDefault(),r.reset(),s.reset()},{enabled:e.searchModalIsOpen}),(0,o.jsx)(B.fC,{open:e.searchModalIsOpen,onOpenChange:t=>{t||e.closeSearchModal()},children:(0,o.jsx)(rh.W,{children:(0,o.jsx)(B.aV,{className:"fixed inset-0 z-50 bg-background/80 backdrop-blur-sm",children:(0,o.jsx)(Z.S,{className:"z-modal flex flex-col items-center px-4",children:(0,o.jsxs)(B.VY,{className:"sm:h-lg z-modal my-[min(64px,8vh)] flex w-full max-w-5xl flex-1 transform flex-col divide-y overflow-hidden rounded-xl bg-white shadow-2xl outline-none ring-1 ring-coolgray-900/5 transition-all dark:bg-gray-900 dark:ring-coolgray-700",role:"dialog",children:["search"===r.mode?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(aW,{query:r.query,onChange:e=>r.setQuery(e),onReset:r.hasAnyQueryOrFilter?()=>{r.reset(),s.reset()}:void 0,onEnterChat:r.changeModeEnabled?()=>r.setMode("chat"):void 0}),(0,o.jsx)(aP,{searchFilterBarView:s}),(0,o.jsx)(rC,{query:r.query,searchView:r})]}):null,"chat"===r.mode?(0,o.jsx)(rp,{query:r.query,notes:r.results,view:a,onBackToSearch:()=>r.setMode("search")}):null]})})})})})}),aQ=(0,f.Pi)(()=>{let e=(0,x.dw)(),t=(0,l.useCallback)(()=>{e.table.triggerChange([])},[]);return(0,o.jsxs)("div",{className:"space-y-1 py-2 px-6 text-sm",children:[(0,o.jsxs)("div",{className:"mb-2 flex justify-between font-medium text-slate-500",children:[(0,o.jsxs)("span",{children:["\uD83D\uDCE6 Model pool (",e.pool.models.size,")"]}),(0,o.jsx)("button",{onClick:t,className:"text-sm text-blue-500 hover:underline",children:"Change"})]}),Array.from(e.pool.models.entries()).map(e=>{let[t,n]=e;return(0,o.jsxs)("div",{className:"rounded border border-slate-200 bg-slate-100 p-1 text-xs font-medium text-slate-500",children:[n.id," (",n.subject,")"]},t)})]})}),aJ=e=>{let{className:t}=e;return(0,o.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 12C5 8.13401 8.13401 5 12 5H12.25C12.6642 5 13 5.33579 13 5.75C13 6.16421 12.6642 6.5 12.25 6.5H12C8.96243 6.5 6.5 8.96243 6.5 12C6.5 15.0376 8.96243 17.5 12 17.5C15.0376 17.5 17.5 15.0376 17.5 12V11.75C17.5 11.3358 17.8358 11 18.25 11C18.6642 11 19 11.3358 19 11.75V12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12Z",fill:"currentColor"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.6664 7.37377C18.0102 7.14376 18.1036 6.67827 17.874 6.33397C17.6443 5.98933 17.1786 5.8962 16.834 6.12596L16.8329 6.12668L16.8315 6.12763L16.8276 6.13023L16.8159 6.13821C16.8063 6.14478 16.7931 6.15384 16.7767 6.16538C16.7438 6.18846 16.6976 6.22151 16.6395 6.26452C16.5234 6.35052 16.3598 6.47653 16.1605 6.64258C15.7622 6.97446 15.2199 7.46781 14.63 8.12328C13.6427 9.22029 12.5138 10.7807 11.7092 12.8057L10.3075 11.2483C10.0304 10.9404 9.55616 10.9154 9.24828 11.1925C8.94039 11.4696 8.91543 11.9438 9.19253 12.2517L11.4425 14.7517C11.6238 14.9532 11.8997 15.0411 12.1642 14.9818C12.4286 14.9225 12.6405 14.7251 12.7184 14.4655C13.4287 12.0976 14.6735 10.3173 15.745 9.12672C16.2801 8.53219 16.769 8.08804 17.1208 7.79492C17.2965 7.64847 17.4375 7.5401 17.5324 7.46986C17.5798 7.43474 17.6156 7.40919 17.6383 7.39321L17.6625 7.37643L17.6664 7.37377Z",fill:"currentColor"})]})},aX=e=>{let{className:t}=e;return(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.75 5C6.23122 5 5 6.23122 5 7.75V16.25C5 17.7688 6.23122 19 7.75 19H16.25C17.7688 19 19 17.7688 19 16.25V9.75C19 7.12665 16.8734 5 14.25 5H7.75ZM6.5 7.75C6.5 7.05964 7.05964 6.5 7.75 6.5H10.75C11.4404 6.5 12 7.05964 12 7.75V9.25C12 10.7688 13.2312 12 14.75 12H16.25C16.9404 12 17.5 12.5596 17.5 13.25V16.25C17.5 16.9404 16.9404 17.5 16.25 17.5H7.75C7.05964 17.5 6.5 16.9404 6.5 16.25V7.75Z",fill:"currentColor"})})},a$=e=>{let{className:t}=e;return(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5C12.4142 5 12.75 5.33579 12.75 5.75V8.07023C13.2971 8.17405 13.8046 8.38929 14.2481 8.69121L16.7197 6.21967C17.0126 5.92678 17.4874 5.92678 17.7803 6.21967C18.0732 6.51256 18.0732 6.98744 17.7803 7.28033L15.3088 9.75185C15.3669 9.83713 15.4217 9.92476 15.4731 10.0146C15.6894 10.3922 15.8458 10.8086 15.9297 11.25H18.25C18.6642 11.25 19 11.5858 19 12C19 12.4142 18.6642 12.75 18.25 12.75H15.9297C15.8458 13.1914 15.6894 13.6078 15.4731 13.9854C15.4217 14.0752 15.3669 14.1629 15.3088 14.2481L17.7803 16.7197C18.0732 17.0126 18.0732 17.4874 17.7803 17.7803C17.4874 18.0732 17.0126 18.0732 16.7197 17.7803L14.2481 15.3088C13.8046 15.6107 13.2971 15.826 12.75 15.9298V18.25C12.75 18.6642 12.4142 19 12 19C11.5858 19 11.25 18.6642 11.25 18.25V15.9298C10.7029 15.826 10.1954 15.6107 9.75187 15.3088L7.28033 17.7803C6.98744 18.0732 6.51256 18.0732 6.21967 17.7803C5.92678 17.4874 5.92678 17.0126 6.21967 16.7197L8.69119 14.2481C8.63314 14.1629 8.57832 14.0752 8.52689 13.9854C8.31061 13.6078 8.15417 13.1914 8.07033 12.75H5.75C5.33579 12.75 5 12.4142 5 12C5 11.5858 5.33579 11.25 5.75 11.25H8.07033C8.15417 10.8086 8.31061 10.3922 8.52689 10.0146C8.57832 9.92476 8.63314 9.83713 8.69119 9.75185L6.21967 7.28033C5.92678 6.98744 5.92678 6.51256 6.21967 6.21967C6.51256 5.92678 6.98744 5.92678 7.28033 6.21967L9.75187 8.69121C10.1954 8.38929 10.7029 8.17405 11.25 8.07023V5.75C11.25 5.33579 11.5858 5 12 5ZM12 14.5C13.3807 14.5 14.5 13.3807 14.5 12C14.5 10.6193 13.3807 9.5 12 9.5C10.6193 9.5 9.5 10.6193 9.5 12C9.5 13.3807 10.6193 14.5 12 14.5Z",fill:"currentColor"})})},a0=e=>{let{className:t}=e;return(0,o.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.3393 5.97122C14.6343 4.67626 16.7338 4.67626 18.0288 5.97122C19.3238 7.26618 19.3238 9.36572 18.0288 10.6607L11.6333 17.0562C11.5491 17.1403 11.4462 17.2033 11.3329 17.2397L5.97996 18.9639C5.71217 19.0501 5.41863 18.9793 5.21969 18.7803C5.02075 18.5814 4.94988 18.2879 5.03614 18.0201L6.76027 12.6671C6.79676 12.5539 6.85968 12.4509 6.94383 12.3667L13.3393 5.97122ZM16.9681 7.03188C16.259 6.32271 15.1092 6.32271 14.4 7.03188L8.13253 13.2994L6.91234 17.0877L10.7007 15.8675L16.9681 9.60001C17.6773 8.89084 17.6773 7.74105 16.9681 7.03188Z",fill:"currentColor"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.3393 5.97122C14.6343 4.67626 16.7338 4.67626 18.0288 5.97122C19.3238 7.26618 19.3238 9.36572 18.0288 10.6607C17.7359 10.9536 17.261 10.9536 16.9681 10.6607L13.3393 7.03188C13.0464 6.73898 13.0465 6.26411 13.3393 5.97122Z",fill:"currentColor"})]})};var a1=n(97201);let a5=(0,f.Pi)(e=>{let{className:t}=e,{canGoForward:n,canGoBack:r}=(0,x.z)(),a=(0,_.cn)("text-gray-400 dark:text-gray-500 dark:hover:bg-accent/30 dark:hover:text-accent-foreground/90",t);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(eE.u,{label:"Go back",shortcut:"mod+BracketLeft",children:(0,o.jsx)(O.z,{onClick:()=>history.back(),variant:"ghost",size:"icon",disabled:!r,className:a,children:(0,o.jsx)(a1.Z,{className:"h-4"})})}),(0,o.jsx)(eE.u,{label:"Go forward",shortcut:"mod+BracketRight",children:(0,o.jsx)(O.z,{onClick:()=>history.forward(),variant:"ghost",size:"icon",disabled:!n,className:a,children:(0,o.jsx)(rO.Z,{className:"h-4"})})})]})}),a2=e=>{let{value:t,highlight:n}=e;return n?(0,o.jsxs)("span",{children:[(0,o.jsx)("span",{className:"font-medium underline",children:t.slice(0,1)}),(0,o.jsx)("span",{children:t.slice(1)})]}):(0,o.jsx)("span",{children:t})};var a7=n(1075),a9=n(98295);function a3(e){let{loading:t,color:n}=e;return(0,o.jsx)("div",{className:(0,_.cn)("h-5 w-5 flex-none rounded-md bg-black",{"animate-pulse":t}),style:{backgroundColor:n}})}let a6=e=>{let{children:t,onClick:n,shortcut:r}=e;return(0,o.jsxs)(a9.Xi,{onClick:n,className:"group min-w-56",children:[(0,o.jsx)("span",{children:t}),r?(0,o.jsx)("span",{className:"min-w-8 flex-1",children:" "}):null,r?(0,o.jsx)(e6.l,{shortcut:r}):null]})},a4=(0,f.Pi)(()=>{let e=(0,x.Pw)(),t=(0,x.BG)(),n=t.graphs,r=n.filter(e=>e!=t.currentGraph),a=n=>{t.setCurrentGraph(n),e.setSelectedNote(null)};return 0===r.length?null:(0,o.jsxs)(o.Fragment,{children:[r.map(e=>(0,o.jsx)(a6,{onClick:()=>a(e),shortcut:function(e){if(!Q.d)return;let t=e+1;if(!(t>=10)&&!(t<1))return"mod+".concat(t)}(n.indexOf(e)),children:(0,o.jsxs)("div",{className:"flex items-center space-x-2.5",children:[(0,o.jsx)("div",{className:"h-5 w-5 flex-none rounded-md bg-bluegray-500",style:{backgroundColor:e.colorHex}}),(0,o.jsx)("span",{children:e.name||"My Graph"})]})},e.id)),(0,o.jsx)(a9.VD,{})]})}),a8=e=>{let{side:t,align:n,children:r}=e;return(0,o.jsx)(a9.AW,{side:t,align:n,sideOffset:12,collisionPadding:12,onCloseAutoFocus:rK.B,className:"min-w-56",children:r})},se=(0,f.Pi)(()=>{let e=(0,x.Fq)(),t=(0,x.Yh)(),n=(0,x.Jf)(),r=!e.noteStore.hasSynced;return(0,o.jsxs)(a9.h_,{children:[(0,o.jsx)(a9.$F,{children:(0,o.jsxs)("div",{className:"flex items-center space-x-2.5",children:[(0,o.jsx)(a3,{loading:r,color:(null==e?void 0:e.colorHex)||"white"}),(0,o.jsx)("span",{className:"text-sm font-medium",children:(null==e?void 0:e.name)||"My Graph"})]})}),(0,o.jsxs)(a8,{side:"top",align:"start",children:[(0,o.jsx)(a4,{}),(0,o.jsx)(a6,{onClick:()=>t.openPreferencesScreen(),shortcut:"mod+,",children:"Preferences"}),(0,o.jsx)(a6,{onClick:()=>{t.openPreferencesScreen(),n.setScreen(N.JY.Billing)},children:"Billing"}),(0,o.jsx)(a9.VD,{}),(0,o.jsx)(a6,{onClick:()=>(0,I.w7)(),children:"Sign out"})]})]})}),st=e=>{let{className:t}=e;return(0,o.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5C8.41015 5.5 5.5 8.41015 5.5 12C5.5 15.5899 8.41015 18.5 12 18.5C15.5899 18.5 18.5 15.5899 18.5 12C18.5 8.41015 15.5899 5.5 12 5.5ZM4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12Z",fill:"currentColor"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.6355 8.15346C10.1833 7.4527 11.039 7 12 7C13.6569 7 15 8.34315 15 10C15 10.8365 14.6566 11.5942 14.1051 12.1375C14.0247 12.2166 13.9467 12.292 13.8707 12.3655C13.6886 12.5416 13.5179 12.7067 13.3523 12.8866C13.1234 13.1353 12.9558 13.3596 12.8555 13.5727C12.6791 13.9475 12.2323 14.1083 11.8575 13.9319C11.4827 13.7555 11.3219 13.3087 11.4983 12.9339C11.6923 12.5219 11.9754 12.1676 12.2487 11.8707C12.4459 11.6565 12.6656 11.444 12.8585 11.2574C12.9273 11.1909 12.9927 11.1276 13.0525 11.0688C13.3296 10.7958 13.5 10.4185 13.5 10C13.5 9.17157 12.8284 8.5 12 8.5C11.5201 8.5 11.093 8.72453 10.8172 9.07731C10.755 9.15694 10.7007 9.24283 10.6555 9.33377C10.4712 9.70471 10.021 9.85597 9.65011 9.67164C9.27918 9.4873 9.12791 9.03716 9.31225 8.66623C9.4029 8.48382 9.51144 8.31215 9.6355 8.15346ZM12 15.4861C12.4142 15.4861 12.75 15.8219 12.75 16.2361V16.2461C12.75 16.6603 12.4142 16.9961 12 16.9961C11.5858 16.9961 11.25 16.6603 11.25 16.2461V16.2361C11.25 15.8219 11.5858 15.4861 12 15.4861Z",fill:"currentColor"})]})},sn=(0,f.Pi)(()=>{let e=(0,x.Pw)();return(0,o.jsxs)(a9.h_,{children:[(0,o.jsx)(eE.u,{label:"Help and support",disabled:(0,tT.W)(),children:(0,o.jsx)(a9.$F,{children:(0,o.jsx)(st,{})})}),(0,o.jsxs)(a8,{side:"top",align:"end",children:[(0,o.jsx)(a6,{onClick:()=>e.openShortcutsModal(),shortcut:"mod+Slash",children:"Keyboard shortcuts"}),(0,o.jsx)(a6,{onClick:()=>window.open("/download"),children:"Download apps"}),(0,o.jsx)(a9.VD,{}),(0,o.jsx)(a6,{onClick:()=>window.open("https://reflect.app/changelog"),children:"App updates and news"}),(0,o.jsx)(a6,{onClick:()=>window.open("https://www.youtube.com/@reflect-notes"),children:"YouTube channel"}),(0,o.jsx)(a6,{onClick:()=>window.open("https://roadmap.reflect.app"),children:"Roadmap and requests"}),(0,o.jsx)(a6,{onClick:()=>window.open("https://reflect.academy"),children:"Academy and learning"}),(0,o.jsx)(a6,{onClick:()=>window.open("https://reflect.app/discord"),children:"Community Discord"}),(0,o.jsx)(a9.VD,{}),(0,o.jsx)(a6,{onClick:()=>window.open("mailto:support@reflect.app"),children:"Contact support"}),(0,o.jsx)(a6,{onClick:()=>window.open("mailto:feedback@reflect.app"),children:"Give feedback"})]})]})}),sr=(0,f.Pi)(e=>{let{className:t}=e;return(0,o.jsxs)("div",{className:(0,el.Z)("flex flex-none px-4 py-3",t),children:[(0,o.jsx)(se,{}),(0,o.jsx)(a7.L,{}),(0,o.jsx)(sn,{})]})});var sa=n(32412),ss=n(84534),si=n(65310),so=n(29485),sl=n(47270),sd=n(97655);let sc=e=>{var t;let{children:n,render:r,open:a,enabled:s=!0,placement:i="right",onOpenChange:d}=e,c=(0,l.useRef)(null),[u,h]=(0,l.useState)(!1),[p,m]=(0,l.useState)(!1),f="boolean"==typeof a,x=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(!f||t)&&(d&&(e=d(e)),e!==u&&(e?(h(!0),m(!1)):(m(!0),setTimeout(()=>h(!1),300))))},g=(0,ss.jV)(),{x:v,y,refs:b,middlewareData:w,context:j}=(0,ss.YF)({nodeId:g,placement:i,open:u,onOpenChange:e=>{x(e)},middleware:[(0,si.uY)({padding:10}),(0,so.cv)(30),(0,sl.x7)({element:c})],whileElementsMounted:si.Me}),{y:k}=null!==(t=w.arrow)&&void 0!==t?t:{},{getReferenceProps:N,getFloatingProps:S}=(0,ss.NI)([(0,ss.XI)(j,{handleClose:(0,ss.xp)(),restMs:100,enabled:s}),(0,ss.qs)(j)]),[C,R]=(0,sd.useSpring)(()=>({scale:.99,translateX:10,opacity:0,config:{duration:300,easing:sd.easings.easeOutQuart}}),[u]);return(0,l.useLayoutEffect)(()=>{u&&R.start({opacity:1,scale:1,translateX:0})},[u,R]),(0,l.useLayoutEffect)(()=>{p&&R.start({opacity:0,scale:.99,translateX:0})},[p,R]),(0,l.useEffect)(()=>{f&&x(a,!0)},[a]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"popup-reference inline-flex",...N({ref:b.setReference}),children:n(u&&!p)}),(0,o.jsx)(ss.mN,{id:g,children:(0,o.jsx)(ss.ll,{children:u&&(0,o.jsx)(eZ.Q2,{children:(0,o.jsx)("div",{ref:b.setFloating,className:"absolute z-popover drop-shadow-xl",style:{top:null!=y?y:0,left:null!=v?v:0},...S(),children:(0,o.jsx)("div",{style:{filter:"drop-shadow(rgba(17,24,39,0.15) 0px 0px 1px)"},children:(0,o.jsx)(sd.animated.div,{style:{transform:(0,sd.to)([C.scale,C.translateX],(e,t)=>"translate3d(".concat(t,"px,0,0) scale(").concat(e,")")),opacity:C.opacity},children:(0,o.jsxs)("div",{className:"flex flex-col overflow-hidden rounded-xl bg-white dark:bg-bluegray-800",children:[r({close:()=>{x(!1)}}),(0,o.jsx)("div",{ref:c,className:"arrow absolute -left-4 text-white dark:text-bluegray-800",style:{top:null!=k?k:0},children:(0,o.jsx)("svg",{viewBox:"0 0 100 100",fill:"currentColor",className:"h-4 w-4",children:(0,o.jsx)("polygon",{points:"100 0, 100 100, 50 50"})})})]})})})})})})})]})};var su=n(35636),sh=n.n(su);async function sp(){try{var e;return await (null===(e=navigator.wakeLock)||void 0===e?void 0:e.request("screen"))}catch(e){console.error("Error requesting wake lock: ".concat(e))}}var sm=n(66849);class sf{dispose(){}async start(){let e=[],t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t,{audioBitsPerSecond:128e3});let n=await sp(),r=async()=>{await (null==n?void 0:n.release()),t.getTracks().forEach(e=>e.stop())};this.mediaRecorder.addEventListener("start",()=>{this.onStart()});let a=async()=>{var t;if(await r(),0===e.length){this.onError(sm.q.NoAudioData);return}let n=new Blob(e,{type:null===(t=this.mediaRecorder)||void 0===t?void 0:t.mimeType});await this.onStop({blob:n})};this.mediaRecorder.addEventListener("stop",()=>{a()}),this.mediaRecorder.addEventListener("dataavailable",t=>{t.data.size>0&&e.push(t.data)}),this.mediaRecorder.start(),this.audioContext=new AudioContext,this.audioSource=this.audioContext.createMediaStreamSource(t),this.processingNode=this.audioContext.createScriptProcessor(2048,2,2),this.processingNode.onaudioprocess=e=>{var t;let n=(t=e.inputBuffer.getChannelData(0)).reduce((e,t)=>e+Math.abs(t),0)/t.length,r=sh()(10*n,.1,1);this.onBufferSample(r)},this.audioSource.connect(this.processingNode),this.processingNode.connect(this.audioContext.destination)}async stop(){var e,t,n,r;null===(e=this.processingNode)||void 0===e||e.disconnect(),null===(t=this.audioSource)||void 0===t||t.disconnect(),await (null===(n=this.audioContext)||void 0===n?void 0:n.close()),null===(r=this.mediaRecorder)||void 0===r||r.stop(),this.processingNode=null,this.audioSource=null,this.audioContext=null,this.mediaRecorder=null}constructor(e){this.processingNode=null,this.audioSource=null,this.audioContext=null,this.mediaRecorder=null,this.onStart=e.onStart,this.onBufferSample=e.onBufferSample,this.onStop=e.onStop,this.onError=e.onError}}var sx=n(61182);async function sg(e){var t;let{nativeEnabled:n}=e;if(!n)return sf;let r=await (null===nS.Z||void 0===nS.Z?void 0:null===(t=nS.Z.getPlatformInfo)||void 0===t?void 0:t.call(nS.Z));return r&&r.major>=22?sx.V:sf}var sv=n(53414),sy=n(95170),sb=n.n(sy),sw=n(6270);class sj{async keys(){return this.adapter.keys()}async setItem(e,t){return this.adapter.setItem(e,t)}async getItem(e){return this.adapter.getItem(e)}async removeItem(e){return this.adapter.removeItem(e)}async clear(){return this.adapter.clear()}constructor(e){let t=e.id,n=(0,sw.U)("audio-recordings-".concat(t)).replace(/-/g,"_");this.adapter=sb().createInstance({driver:sb().INDEXEDDB,name:n,storeName:n})}}class sk{async saveAudioRecording(e){let{blob:t}=e,n=(0,nI.O)();await this.storage.setItem(n,t),await this.requestUpload()}async requestUpload(e){if(this.hasUploadRequest=!0,!this.isUploading)try{for(this.isUploading=!0;this.hasUploadRequest;)this.hasUploadRequest=!1,await this.readAndUploadAudioRecordings(e)}finally{this.isUploading=!1}}async readAndUploadAudioRecordings(e){for(let t of(await this.storage.keys())){if(null==e?void 0:e.signal.aborted)return;let n=await this.storage.getItem(t);if(n){if(null==e?void 0:e.signal.aborted)return;await this.uploadAudioRecording({audioRecordingId:t,blob:n}),await this.storage.removeItem(t)}}}async uploadAudioRecording(e){let{blob:t,audioRecordingId:n}=e,r=(await this.noteStore.ensureTodaysDailyNote()).id,a=this.graph.id,s=this.user.id,i=this.initialPrompt,o=(0,eY.pO)({db:eJ.db,graphId:a,audioRecordingId:n});this.logger.info("[RecordingUploader] setting audio recording ".concat(n)),await (0,sv.setDoc)(o,{note_id:r,user_id:s,status:"processing",created_at:sv.Timestamp.now(),completed_at:null}),this.logger.info("[RecordingUploader] uploading audio recording ".concat(n));let l={processAs:"audioRecording-v2",graphId:a,noteId:r,userId:s,initialPrompt:null!=i?i:void 0,formatTranscript:String(this.transcriptionFormat),language:this.transcriptionLanguage},d=this.filterMetadata(l),c=await nM({blob:t,id:n,metadata:d});this.logger.info("[RecordingUploader] uploaded audio recording ".concat(n," to ").concat(c))}get initialPrompt(){let e=this.preferences.transcriptionPrompt;return e?"This transcription mentions names like: ".concat(e):null}get transcriptionFormat(){var e;return null===(e=this.preferences.transcriptionFormat)||void 0===e||e}get transcriptionLanguage(){var e;return null!==(e=this.preferences.transcriptionLanguage)&&void 0!==e?e:"auto"}get noteStore(){return this.graph.noteStore}filterMetadata(e){let t={};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t}get logger(){return this.graph.logger}constructor({graph:e,user:t,preferences:n}){this.hasUploadRequest=!1,this.isUploading=!1,this.graph=e,this.user=t,this.preferences=n,this.storage=new sj(this.graph)}}class sN{uploadPendingRecordings(){let e=new AbortController,t=setTimeout(()=>{this.uploader.requestUpload(e)},3e3);this.listeners.push(()=>{clearTimeout(t),e.abort()})}onStartRecording(){this.startedAt=Date.now(),this.state="recording",this.logger.info("[RecordingView] onStartRecording")}async startRecording(){if("starting"===this.state||"recording"===this.state||"processing"===this.state){console.warn("Cannot start recording when starting/recording/processing");return}(0,L.j)("recording_started"),await this.startRecordingStream()}async stopRecording(){if("recording"!==this.state){console.warn("Cannot stop recording when not recording");return}this.setState("processing"),await this.stopRecordingStream()}async cancelRecording(){if("recording"!==this.state){console.warn("Cannot cancel recording when not recording");return}this.setState("cancelling"),await this.stopRecordingStream()}onStopRecording(e){let{blob:t}=e;this.logger.info("[RecordingView] onStopRecording"),"processing"===this.state&&this.uploader.saveAudioRecording({blob:t}),this.setState("idle")}async dispose(){var e;"recording"===this.state&&await this.stopRecording(),null===(e=this.recordingStream)||void 0===e||e.dispose()}addWaveformBar(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;this.waveformBars.push(e),this.waveformBars=this.waveformBars.slice(-1*t)}get normalizedWaveformBars(){return this.waveformBars.map(e=>e)}get hasWaveformBars(){return this.waveformBars.length>0}get messageState(){return"error-no-audio-data"===this.state?"error-no-audio-data":this.isPending||this.recordingStore.isProcessing?"processing":"default"}calculateDurationFormatted(){return(0,rr.sY)(this.startedAt,Date.now())}setDurationFormatted(e){this.durationFormatted=e}resetWaveformBars(){this.waveformBars=[]}setState(e){this.state=e}get isPending(){return this.pendingCount>0}get pendingCount(){let e=this.storeProcessingCount;return"processing"===this.state?Math.max(e,1):e}async toggleRecording(){"recording"===this.state?await this.stopRecording():await this.startRecording()}onBufferSample(e){this.bufferSampleCounter++,this.bufferSampleCounter%this.bufferSampleRate==0&&(this.addWaveformBar(e),this.setDurationFormatted(this.calculateDurationFormatted()))}onError(e,t){e===sm.q.NoAudioData?this.setState("error-no-audio-data"):this.setState("error"),t&&(0,eD.Am)({description:t,duration:2e4,icon:"error"})}async startRecordingStream(){if(this.setState("starting"),!this.recordingStream){let e=await sg({nativeEnabled:!0});this.recordingStream=new e({onStart:()=>this.onStartRecording(),onStop:e=>this.onStopRecording(e),onBufferSample:e=>this.onBufferSample(e),onError:(e,t)=>this.onError(e,t),onCancel:()=>this.setState("idle")})}this.logger.info("[RecordingView] starting recording stream using ".concat(this.recordingStream.constructor.name)),await this.recordingStream.start()}async stopRecordingStream(){var e;await (null===(e=this.recordingStream)||void 0===e?void 0:e.stop())}get storeProcessingCount(){return this.graph.audioRecordingStore.processingCount}get recordingStore(){return this.graph.audioRecordingStore}get preferenceStore(){return this.graph.assertRootStore.preferenceStore}get logger(){return this.graph.logger}constructor({graph:e,user:t,preferences:n}){this.state="idle",this.startedAt=0,this.durationFormatted="0:00",this.waveformBars=[],this.recordingStream=null,this.listeners=[],this.bufferSampleRate=2,this.bufferSampleCounter=0,this.graph=e,this.user=t,this.uploader=new sk({graph:e,user:t,preferences:n}),(0,m.makeObservable)(this),this.uploadPendingRecordings()}}(0,eU.gn)([m.observable],sN.prototype,"state",void 0),(0,eU.gn)([m.observable],sN.prototype,"durationFormatted",void 0),(0,eU.gn)([m.observable.shallow],sN.prototype,"waveformBars",void 0),(0,eU.gn)([m.observable],sN.prototype,"uploader",void 0),(0,eU.gn)([m.action],sN.prototype,"onStartRecording",null),(0,eU.gn)([m.action],sN.prototype,"addWaveformBar",null),(0,eU.gn)([m.computed],sN.prototype,"normalizedWaveformBars",null),(0,eU.gn)([m.computed],sN.prototype,"hasWaveformBars",null),(0,eU.gn)([m.computed],sN.prototype,"messageState",null),(0,eU.gn)([m.action],sN.prototype,"setDurationFormatted",null),(0,eU.gn)([m.action],sN.prototype,"resetWaveformBars",null),(0,eU.gn)([m.action],sN.prototype,"setState",null),(0,eU.gn)([m.computed],sN.prototype,"isPending",null),(0,eU.gn)([m.computed],sN.prototype,"pendingCount",null);var sS=n(74565),sC=n.n(sS);let sR=e=>{let{waveformBars:t,width:n,height:r}=e,a=(0,l.useRef)(null),s=(0,l.useCallback)(e=>{let t=a.current,s=t.getContext("2d"),i=window.devicePixelRatio;t.width=n*i,t.height=r*i,s.scale(i,i),s.clearRect(0,0,t.width,t.height),s.fillStyle="#f87171";let o=Math.floor(n/5),l=sC()(e).slice(0,o);for(let e=0;e<o;e++){var d;let t=null!==(d=l[e])&&void 0!==d?d:-1,a=5*e,i=2*Math.log1p(t),o=sh()(i*r,2,r),c=(r-o)/2;-1===t?s.globalAlpha=.5:s.globalAlpha=1,s.fillRect(n-a,c,2.5,o)}},[n,r]);(0,l.useEffect)(()=>{s(t)},[s,t]);let i=(0,l.useMemo)(()=>({width:n,height:r}),[n,r]);return(0,o.jsx)(sI,{ref:a,style:i})},sI=(0,l.memo)((0,l.forwardRef)((e,t)=>(0,o.jsx)("canvas",{...e,ref:t})));sI.displayName="WaveformCanvas";let sE=(0,f.Pi)(e=>{let{view:t,width:n,height:r}=e;return(0,o.jsx)(sR,{waveformBars:t.normalizedWaveformBars,width:n,height:r})});var sD=n(28972);let sP=(0,f.Pi)(e=>{let{view:t}=e,n="starting"===t.state,r=()=>{(0,eD.Am)({description:"Uploading and processing your audio memo. The transcription will be added to your daily note.",duration:8e3,icon:"mic"})},a=(e,t)=>{switch("".concat(t,"->").concat(e)){case"recording->processing":case"recording->idle":r()}};return(0,l.useEffect)(()=>(0,m.reaction)(()=>t.state,a),[t]),(0,l.useEffect)(()=>{t.resetWaveformBars()},[t]),(0,o.jsxs)("div",{className:"flex space-x-1 overflow-hidden py-2 px-2",children:[(0,o.jsx)("div",{className:"h-[22px] w-[200px] flex-1",children:n?(0,o.jsx)("div",{className:"ml-2 flex h-full items-center",children:(0,o.jsx)(sD.X,{})}):(0,o.jsx)(sE,{view:t,width:200,height:22})}),(0,o.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,o.jsx)("span",{className:"px-2 text-sm font-medium tabular-nums",children:n?"0:00":t.durationFormatted})})]})}),sT=(0,f.Pi)(()=>{var e,t;let{online:n}=(0,x.Yh)(),r=(0,x.Fq)(),a=(0,x.xJ)(),s=(0,x.Jf)();(0,eW.hu)(r,"AudioRecording must be used inside a graph"),(0,eW.hu)(a,"AudioRecording must be used inside a user");let i=(0,eF.D)(()=>new sN({graph:r,user:a,preferences:s}),[r,a,s]),d=!n&&"recording"!==i.state,c="starting"===i.state,u="recording"===i.state,h=i.isPending;e=["starting","recording","processing","cancelling"].includes(i.state),t="Audio recording in progress.",(0,l.useEffect)(()=>{if(!e)return;let n=e=>{nE(e,t)};return window.addEventListener("beforeunload",n,{capture:!0}),()=>{window.removeEventListener("beforeunload",n,{capture:!0})}},[e,t]),(0,es.y)("mod+shift+r",e=>{e.preventDefault(),d||i.toggleRecording()}),(0,es.y)("Escape",e=>{!e.defaultPrevented&&u&&confirm("Are you sure you want to cancel the recording?")&&(e.preventDefault(),i.cancelRecording())});let p=!u&&i.pendingCount>0;return(0,o.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,o.jsx)("div",{className:"relative flex flex-none items-center justify-center",children:(0,o.jsx)(sc,{render:()=>(0,o.jsx)(sP,{view:i}),open:c||u,children:()=>(0,o.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,o.jsx)(eE.u,{delay:500,label:d?"Go online to record":u?"Stop recording":"Record audio memo",shortcut:d?void 0:"mod+shift+r",disabled:(0,tT.W)(),children:(0,o.jsx)("button",{onClick:()=>void i.toggleRecording(),disabled:d,className:(0,el.Z)("relative flex h-[24px] w-[24px] flex-none cursor-default items-center justify-center rounded-full disabled:opacity-50",{"bg-red-100 ring-[1.5px] ring-red-200 dark:bg-transparent dark:ring-red-500":u}),children:u?(0,o.jsx)("div",{className:"absolute h-[10px] w-[10px] rounded-sm bg-red-600"}):(0,o.jsx)(sa.Z,{className:(0,el.Z)("transition ease-in-out",{"text-coolgray-500 hover:text-coolgray-900 dark:hover:text-white":!h,"animate-pulse text-primary dark:text-primary-dk":h})})})}),p&&(0,o.jsx)(eE.u,{label:"Processing ".concat(i.pendingCount," audio memo").concat(i.pendingCount>1?"s":"","..."),children:(0,o.jsx)("div",{className:"pointer-events-none absolute -top-2 -right-2 flex items-center justify-center rounded-full bg-purple-500 px-1 text-[10px] font-medium tabular-nums text-white",children:i.pendingCount})})]})})})})});var sA=n(20282);class sM{get manager(){return this.graph.jobQueueStore.manager}get query(){let e=this.manager.table,t=e.query().selectAll().where("contextId","=",this.manager.contextId);return new sA.y({table:e,query:t})}dispose(){}constructor(e){this.graph=e,(0,m.makeObservable)(this)}}(0,eU.gn)([m.computed],sM.prototype,"query",null);let sL=(0,f.Pi)(()=>{let e=(0,x.Fq)(),t=(0,eF.D)(()=>new sM(e),[e]);return(0,o.jsxs)("div",{className:"mx-2 flex flex-1 flex-col",children:[(0,o.jsxs)("h3",{className:"flex-none px-4 text-xs font-medium leading-5 tracking-wide text-coolgray-400",children:["Job queue (",t.query.results.length,")"]}),(0,o.jsx)("div",{className:"mt-2 flex flex-1 flex-col",children:t.query.results.map(e=>(0,o.jsxs)("div",{className:"px-4 py-1 text-xs text-coolgray-500",children:[(0,o.jsxs)("div",{children:[e.task,"(",e.args,")"]}),(0,o.jsxs)("div",{className:"inline-flex items-center",children:[(0,o.jsx)("span",{className:"mr-1",children:"Status:"}),(0,o.jsx)("span",{className:"rounded px-1.5 py-0.5 font-medium ".concat("running"===e.status?"bg-blue-100 text-blue-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:e.status})]})]},e.id))})]})}),sV=e=>{let{children:t}=e;return(0,o.jsx)("nav",{className:"mt-6 flex-none space-y-1 px-4",children:t})},sZ=e=>{let{children:t,selected:n=!1,shortcut:r,onClick:a}=e;return(0,o.jsxs)("a",{onMouseDown:a,className:(0,el.Z)(["group flex items-center space-x-3 px-2.5 py-1.5 capacitor:py-2.5","cursor-default rounded-md text-sm font-medium capacitor:rounded-lg","capacitor:active:opacity-90","hover:bg-gray-200/50 dark:hover:bg-white/3","@container",n?"bg-gray-200/50 text-primary dark:bg-transparent dark:text-primary-dk":"text-coolgray-900 dark:text-near-white dark:hover:text-white"]),children:[t,r&&(0,o.jsx)("span",{className:(0,el.Z)("hidden flex-1 items-end justify-end",Q.Zx?"@[190px]:inline-flex":"@[230px]:inline-flex"),children:(0,o.jsx)(e6.l,{shortcut:r,className:"invisible group-hover:visible"})})]})},sF=e=>{let{name:t,description:n,index:r,completed:a,ignored:s,open:i}=e;return(0,o.jsx)("div",{className:(0,el.Z)("group relative rounded-md transition-all duration-200",i&&"bg-gray-200 ring-8 ring-gray-200 dark:bg-dark-black-900 dark:ring-dark-black-900",s&&"opacity-30"),children:(0,o.jsxs)("button",{className:"flex cursor-default items-start text-left text-sm font-medium",children:[a?(0,o.jsx)(sO,{}):(0,o.jsx)(sB,{index:r}),(0,o.jsxs)("span",{className:"ml-3 flex min-w-0 flex-col space-y-0.5 pr-1",children:[(0,o.jsx)("span",{className:(0,el.Z)("text-sm font-medium",a?"text-gray-600 dark:text-gray-500":"text-indigo-600"),children:t}),(0,o.jsx)("span",{className:"text-xs font-medium text-gray-400",children:n})]})]})})},sO=()=>(0,o.jsx)("span",{className:"flex-shrink-0",children:(0,o.jsx)("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-indigo-600",children:(0,o.jsx)(t2.Z,{className:"h-4 w-4 text-white","aria-hidden":"true"})})}),sB=e=>{let{index:t}=e;return(0,o.jsx)("span",{className:"flex-shrink-0",children:(0,o.jsx)("span",{className:"flex h-7 w-7 items-center justify-center rounded-full border-2 border-indigo-600",children:(0,o.jsx)("span",{className:"text-indigo-600",children:t})})})};var sz=n(93714);let s_=e=>{let{onClick:t,className:n="",children:r}=e;return(0,o.jsx)("span",{className:"".concat(n," inline-flex rounded-md"),children:(0,o.jsx)("button",{onClick:t,type:"button",className:"inline-flex cursor-pointer items-center space-x-1 rounded-md border border-transparent px-3 py-2 text-sm font-medium leading-4 text-bluegray-500 dark:text-near-white",children:r})})},sU=e=>{let{children:t}=e;return(0,o.jsx)("footer",{className:"mt-5 flex flex-none justify-between rounded-br-xl rounded-bl-xl bg-gray-50 px-6 py-4 dark:bg-gray-700",children:t})},sq=e=>{let{children:t}=e;return(0,o.jsx)("div",{className:"min-h-[200px] w-[550px]",children:t})},sG=()=>{let e=(0,x.xJ)(),t=async()=>{await (null==e?void 0:e.updateTraits({onboardingBacklinkIgnored:!0}))};return(0,o.jsxs)(sq,{children:[(0,o.jsxs)("div",{className:"mb-2 flex flex-1 flex-col space-y-4 px-7 pt-7",children:[(0,o.jsxs)("div",{className:"flex-none space-y-3 text-base",children:[(0,o.jsx)("p",{className:"font-semibold",children:"Backlinks are the key to organizing your notes"}),(0,o.jsxs)("p",{children:["To use a backlink, type ",(0,o.jsx)("code",{className:"font-mono",children:"[["})," and select a note from the list. If you type a note that doesn't exist, and then hit return, it will be created automatically."]})]}),(0,o.jsxs)("div",{className:"relative flex-none overflow-hidden rounded-md ring-2 ring-purple-200",children:[(0,o.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,o.jsx)(sz.Z,{className:"h-10 w-10 text-purple-400"})}),(0,o.jsxs)("video",{className:"relative min-h-[266px]",autoPlay:!0,loop:!0,muted:!0,controls:!0,children:[(0,o.jsx)("source",{src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fstep-onboarding-backlinks.mp4?alt=media&token=e84bc6b9-88c8-4d47-89bc-5df0b87a773d",type:"video/mp4"}),"Your browser does not support the video tag."]})]})]}),(0,o.jsx)(sU,{children:(0,o.jsx)(s_,{onClick:t,children:"Ignore"})})]})},sH=()=>{let e=(0,x.xJ)(),t=async()=>{await (null==e?void 0:e.updateTraits({onboardingLinksIgnored:!0}))};return(0,o.jsxs)(sq,{children:[(0,o.jsxs)("div",{className:"mb-2 flex flex-1 flex-col space-y-4 px-7 pt-7",children:[(0,o.jsxs)("div",{className:"flex-none space-y-3 text-base",children:[(0,o.jsx)("p",{className:"font-semibold",children:"Bookmark websites and capture text with a single click"}),(0,o.jsxs)("p",{children:["Reflect lets you capture text and links from any website. To get started,"," ",(0,o.jsx)("a",{className:"text-blue-500",href:"https://reflect.app/extension",target:"_blank",rel:"noreferrer",children:"install our Chrome extension"})," ","and watch this video."]})]}),(0,o.jsxs)("div",{className:"relative flex-none overflow-hidden rounded-md ring-2 ring-purple-200",children:[(0,o.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,o.jsx)(sz.Z,{className:"h-10 w-10 text-purple-400"})}),(0,o.jsxs)("video",{className:"relative min-h-[266px]",autoPlay:!0,loop:!0,muted:!0,controls:!0,children:[(0,o.jsx)("source",{src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fstep-onboarding-links.mp4?alt=media&token=cb8eff93-8f76-4046-9ebb-e5725ed246de",type:"video/mp4"}),"Your browser does not support the video tag."]})]})]}),(0,o.jsxs)(sU,{children:[(0,o.jsx)(s_,{onClick:t,children:"Ignore"}),(0,o.jsx)(C.KM,{onClick:()=>{window.open("/extension","_blank")},children:"Install Chrome extension"})]})]})};var sK=n(12891);let sW=e=>{let{showAppleModal:t,setShowAppleModal:n}=e,r=(0,x.xJ)(),a=async()=>{await (null==r?void 0:r.updateTraits({onboardingAddMeetingIgnored:!0}))};return(0,o.jsxs)(sq,{children:[(0,o.jsxs)("div",{className:"mb-2 flex flex-1 flex-col space-y-4 px-7 pt-7",children:[(0,o.jsxs)("div",{className:"flex-none space-y-3 text-base",children:[(0,o.jsx)("p",{className:"font-semibold",children:"Quickly take meeting notes by importing your calendar events"}),(0,o.jsx)("p",{children:"We support both Google Calendar and Office 365 integrations."})]}),(0,o.jsxs)("div",{className:"relative flex-none overflow-hidden rounded-md ring-2 ring-purple-200",children:[(0,o.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,o.jsx)(sz.Z,{className:"h-10 w-10 text-purple-400"})}),(0,o.jsxs)("video",{className:"relative min-h-[261px]",autoPlay:!0,loop:!0,muted:!0,controls:!0,children:[(0,o.jsx)("source",{src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fstep-onboarding-meetings.mp4?alt=media&token=64a78563-fac3-422e-9850-75e1d8cf4327",type:"video/mp4"}),"Your browser does not support the video tag."]})]})]}),(0,o.jsxs)(sU,{children:[(0,o.jsx)(s_,{onClick:a,children:"Ignore"}),(0,o.jsx)(sK.F,{showAppleModal:t,setShowAppleModal:n,buttonClassName:"!bg-indigo-600 !text-white !border-none",buttonLabel:"Connect your calendar",placement:"top"})]})]})},sY=(0,f.Pi)(()=>{let e=(0,x.xJ)(),[t,n]=(0,l.useState)(!1),r=[{key:"backlink",name:"Create a backlink",description:"See the power of your connected thoughts.",popoverRender:()=>(0,o.jsx)(sG,{}),completed:(null==e?void 0:e.traits.backlinkCreated)===!0,ignored:(null==e?void 0:e.traits.onboardingBacklinkIgnored)===!0},{key:"links",name:"Save a link",description:"Quickly bookmark websites and capture text.",popoverRender:()=>(0,o.jsx)(sH,{}),completed:(null==e?void 0:e.traits.linkCreated)===!0,ignored:(null==e?void 0:e.traits.onboardingLinksIgnored)===!0},{key:"meetings",name:"Add a meeting",description:"Retain notes from all your meetings.",popoverRender:()=>(0,o.jsx)(sW,{showAppleModal:t,setShowAppleModal:n}),completed:(null==e?void 0:e.traits.meetingAdded)===!0,ignored:(null==e?void 0:e.traits.onboardingAddMeetingIgnored)===!0}],a=(0,l.useCallback)(()=>!!window.document.fullscreenElement||t,[t]);return!(null==e?void 0:e.ready)||r.every(e=>e.completed||e.ignored)?null:(0,o.jsxs)("div",{className:"mx-2 flex-none",children:[(0,o.jsx)("h3",{className:"flex-none px-4 text-xs font-medium leading-5 tracking-wide text-coolgray-400",children:"Account setup"}),(0,o.jsx)("div",{className:"space-y-4 px-4 py-5",children:r.map((e,t)=>(0,o.jsx)(sc,{render:e.popoverRender,onOpenChange:e=>!!a()||e,enabled:!a(),children:n=>(0,o.jsx)(sF,{open:n,name:e.name,description:e.description,index:t+1,completed:e.completed,ignored:e.ignored})},e.key))})]})});var sQ=n(56808);let sJ=e=>{let{children:t,onChange:n,itemIds:r,itemHeight:a}=e,s=(0,l.useRef)(r);(0,l.useEffect)(()=>{s.current=r},[r]);let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return o=>{let l=r[o],d=ne()(e,r),c=e=>"zIndex"===e||d;return t&&o===n?{y:s*a+i,scale:1.05,zIndex:1,shadow:10,config:e=>"y"===e?sd.config.stiff:sd.config.default,immediate:c}:{y:e.indexOf(l)*a,scale:1,zIndex:0,shadow:0,immediate:c}}},[d,c]=(0,sd.useSprings)(r.length,i(r),[r]),u=(0,sQ.useDrag)(e=>{let{args:[t],active:o,movement:[,l]}=e,d=r[t],u=s.current.indexOf(d),h=sh()(Math.round((u*a+l)/a),0,r.length-1),p=(0,eQ.LF)(s.current,u,h);c.start(i(p,o,t,u,l)),o||(s.current=p,null==n||n(p))},{threshold:5,dependencies:[r,a]}),h=l.Children.toArray(t);return(0,o.jsx)("div",{className:"relative",style:{height:r.length*a},children:d.map((e,t)=>{let{zIndex:n,shadow:a,y:s,scale:i}=e;return(0,l.createElement)(sd.animated.div,{...u(t),key:r[t],"data-item-id":r[t],className:"absolute left-0 right-0 origin-center touch-none",style:{zIndex:n,filter:a.to(e=>"drop-shadow(0 0 ".concat(e,"px rgba(15, 23, 42, 0.1))")),y:s,scale:i,transformOrigin:"50% 50% 0px"}},h[t])})})},sX=(0,f.Pi)(e=>{let{note:t,selected:n,onClick:r}=e;return(0,o.jsx)("div",{onMouseDown:r,className:(0,el.Z)("mx-2 flex cursor-default flex-col rounded-md px-2 py-1 leading-5","hover:bg-gray-200/50 dark:hover:bg-white/3",n&&"bg-gray-200/50 dark:bg-transparent",n?"text-gray-800 dark:text-primary-dk":"text-gray-500 hover:text-gray-800 dark:text-near-white dark:hover:text-white"),children:(0,o.jsx)("div",{className:"flex items-center space-x-2",children:(0,o.jsx)("div",{className:"flex-1 truncate text-2xs font-medium",children:t.title})})})}),s$=(0,f.Pi)(()=>{let e=(0,x.dw)(),t=(0,x.Pw)(),n=[N.oK.NoteEdit,N.oK.NoteDaily].includes(t.screen),{pinnnedNotesIndexAsc:r}=e,{selectedNote:a}=t,s=(0,l.useMemo)(()=>nJ()(async t=>{await e.updatePinnedIndexes(t)},500),[e]);return 0===r.count?null:(0,o.jsxs)("div",{className:"mx-2 flex flex-1 flex-col",children:[(0,o.jsx)("h3",{className:"flex-none px-4 text-xs font-medium leading-5 tracking-wide text-coolgray-400",children:"Pinned notes"}),(0,o.jsx)("div",{className:"mt-2 flex flex-1 flex-col",children:(0,o.jsx)(sJ,{itemHeight:33,itemIds:r.placeholders.map(e=>e.id),onChange:e=>void s(e),children:r.placeholders.map(e=>{let r=e.value;return r?(0,o.jsx)(sX,{note:r,selected:n&&r===a,onClick:e=>{t.editNote(r,{secondary:e.metaKey||e.ctrlKey})}},e.id):null})})})]})}),s0=()=>(0,o.jsx)("div",{className:"app-region-drag pointer-events-none absolute inset-x-0 top-0 z-0 h-8 ipad:hidden"}),s1=(0,f.Pi)(()=>{let e=(0,x.Pw)();return(0,o.jsx)("div",{className:"flex flex-1 flex-col",children:(0,o.jsxs)("div",{className:"flex flex-1 cursor-text items-center space-x-1 rounded-[7px] border border-coolgray-900/15 bg-white px-2 py-1.5 text-2xs text-coolgray-400 shadow-app-input shadow-black/5 transition duration-150 ease-in-out hover:bg-white hover:text-coolgray-700 capacitor:active:opacity-70 dark:border-white/5 dark:bg-white/5 dark:text-coolgray-500 dark:shadow-black/10 dark:hover:text-near-white",onClick:()=>e.openSearchModal(),children:[(0,o.jsx)("div",{className:"flex-none",children:(0,o.jsx)(aG.W,{})}),(0,o.jsx)("div",{className:"w-0 flex-1 truncate",children:"Search anything..."}),(0,o.jsx)(e6.l,{shortcut:"mod+k",ghost:!0,className:"text-xs"})]})})});var s5=n(52149);let s2=(0,f.Pi)(()=>{let e=(0,x.xJ)(),t=(0,x.Jf)(),n=(0,x.Yh)(),r=()=>{n.openPreferencesScreen(),t.setScreen(N.JY.Billing)};return(0,o.jsx)("div",{className:"flex flex-none",children:(0,o.jsxs)("a",{onClick:()=>r(),className:"flex w-full cursor-pointer justify-between border-t border-gray-200 bg-gray-100 py-2 px-4 text-sm transition duration-100 hover:bg-gray-200 dark:border-gray-800 dark:bg-gray-900",children:[(0,o.jsxs)("span",{className:"text-gray-900 dark:text-near-white",children:[(0,o.jsxs)("strong",{children:[null==e?void 0:e.trialDaysLeft," days left"]})," in your trial"]}),(0,o.jsxs)("span",{className:"flex space-x-1.5 font-medium text-indigo-700 dark:text-primary-dk",children:[(0,o.jsx)("span",{children:"Upgrade"})," ",(0,o.jsx)(s5.Z,{className:"w-3.5"})]})]})})}),s7=(0,f.Pi)(()=>{let e=(0,x.Fq)(),t=(0,x.xJ)(),n=(0,x.Pw)(),r=(0,n2.ze)(),[a,s]=(0,l.useState)(!1),i=t&&t.isTrialing&&t.trialDaysLeft<5,d=(0,tT.W)()&&!r.isHidden;return(0,l.useEffect)(()=>{let e=e=>{(0,e6.r)(e)&&s(!0)},t=()=>{s(!1)};return window.document.addEventListener("keydown",e),window.document.addEventListener("keyup",t),()=>{window.document.removeEventListener("keydown",e),window.document.removeEventListener("keyup",t)}},[]),(0,o.jsxs)("div",{className:"relative flex flex-1 flex-col overflow-y-auto bg-coolgray-50 electron:pt-6 capacitor:pt-5 ipad:pt-10 dark:bg-gray-800/30",children:[(0,o.jsx)(s0,{}),(0,o.jsx)("div",{className:"app-region-no-drag absolute top-2 right-2 z-10 hidden electron:flex ipad:top-2 ipad:flex",children:(0,o.jsx)(a5,{className:"h-6 w-6 ipad:h-10 ipad:w-9"})}),(0,o.jsxs)("div",{className:"flex flex-none flex-col space-y-5 overflow-hidden py-5",children:[(0,o.jsxs)("div",{className:"flex flex-none gap-3 px-4",children:[(0,o.jsx)(s1,{}),(0,o.jsx)(sT,{})]}),(0,o.jsxs)(sV,{children:[(0,o.jsxs)(sZ,{selected:n.screen===N.oK.NoteDaily,onClick:()=>n.openNoteDailyScreen(),shortcut:"mod+shift+d",children:[(0,o.jsx)(a0,{}),(0,o.jsx)(a2,{value:"Daily notes",highlight:a})]}),(0,o.jsxs)(sZ,{selected:n.screen===N.oK.NoteList||n.screen===N.oK.NoteEdit,onClick:()=>n.openListScreen(),shortcut:"mod+shift+a",children:[(0,o.jsx)(aX,{}),(0,o.jsx)(a2,{value:"All notes",highlight:a})]}),(0,o.jsxs)(sZ,{selected:n.screen===N.oK.TaskList,onClick:()=>n.openTaskView(),shortcut:(0,eO.ob)()===eO.t4.App?"mod+shift+t":void 0,children:[(0,o.jsx)(aJ,{}),(0,o.jsx)(a2,{value:"Tasks",highlight:(0,eO.ob)()===eO.t4.App&&a})]}),(0,o.jsxs)(sZ,{selected:n.screen===N.oK.Map,onClick:()=>n.openMapScreen(),shortcut:"mod+shift+m",children:[(0,o.jsx)(a$,{}),(0,o.jsx)(a2,{value:"Map",highlight:a})]})]}),(0,o.jsx)(s$,{}),(null==e?void 0:e.hasFlag("pool_debug"))?(0,o.jsx)(sL,{}):null,(null==e?void 0:e.hasFlag("pool_debug"))?(0,o.jsx)(aQ,{}):null]}),(0,o.jsx)(a7.L,{}),(0,o.jsx)(sY,{}),(0,o.jsx)(sr,{className:(0,el.Z)(d&&"hidden")}),i&&(0,o.jsx)(s2,{})]})}),s9=w()(()=>n.e(9655).then(n.bind(n,89655)).then(e=>e.ShortcutsModal),{loadableGenerated:{webpack:()=>[89655]},ssr:!1}),s3=(0,f.Pi)(()=>{let e=(0,x.dw)(),t=(0,x.Pw)(),n=(0,x.B0)(),r=function(e){let t=window.matchMedia(e),[n,r]=(0,l.useState)(t.matches);return(0,l.useEffect)(()=>{let e=e=>{r(e.matches)};return(0,$.XU)(t,e),()=>{(0,$.nd)(t,e)}},[]),n}("(max-width: 960px)"),{leftSidebarSize:a}=n;return(0,l.useEffect)(()=>{t.setSemiScreenMedia(r)},[t,r]),(0,l.useEffect)(()=>{let{dailyStore:n,dailyEditorView:r}=e;n.updateGeneratedNotes(r.range),t.ensureSelectedNote()},[t,e]),(0,o.jsxs)(Z.S,{className:"flex flex-col overflow-hidden bg-background-stark",children:[(0,o.jsx)(eo,{}),(0,o.jsx)(ea,{}),(0,o.jsxs)(X.IF,{sidebarPosition:"start",sidebarSize:a,sizeType:"fixed",sidebarHidden:t.semiScreen,minSidebarSize:175,onResize:e=>n.setLeftSidebarSize(e),className:"flex-1 overflow-hidden",children:[(0,o.jsx)(X.IF.Sidebar,{children:(0,o.jsx)(s7,{})}),(0,o.jsx)(X.IF.Main,{className:"flex flex-col",children:(0,o.jsx)(F.S,{children:(0,o.jsx)(ru,{})})})]}),(0,o.jsx)(aY,{}),t.shortcutsModalIsOpen&&(0,o.jsx)(s9,{onClose:()=>t.closeModal()}),(0,o.jsx)(J,{})]})}),s6=w()(()=>n.e(9927).then(n.bind(n,59927)).then(e=>e.Preferences),{loadableGenerated:{webpack:()=>[59927]},ssr:!1}),s4=w()(()=>n.e(9190).then(n.bind(n,39190)).then(e=>e.Toasts),{loadableGenerated:{webpack:()=>[39190]},ssr:!1});var s8=n(20906),ie=n(18638);let it=Number.parseInt("1742412921");async function ir(){var e;let t=await fetch("/api/app-version?client=".concat(it),{method:"GET"}),n=await t.json(),r=Number.parseInt(n.timestamp);if((0,eW.Rn)(r,"Invalid remote version ".concat(n.timestamp)),r>it)return 2;let a=await (null===nS.Z||void 0===nS.Z?void 0:null===(e=nS.Z.getVersion)||void 0===e?void 0:e.call(nS.Z));if(a){let e=n.min_desktop_version;if((0,eW.Ee)(e,"Invalid min electron version"),(0,ie.q)(a,e,"<"))return 3}return 1}async function ia(){try{return await ir()}catch(e){return console.warn("Error checking app update:",e),0}}function is(e){let{online:t}=e,n=(0,l.useRef)(0),r=(0,l.useRef)(null),a=(0,l.useRef)(t);(0,l.useEffect)(()=>{if(a.current=t,!t){var e;null===(e=r.current)||void 0===e||e.call(r),r.current=null}},[t]);let s=(0,l.useCallback)(()=>{a.current&&window.location.reload()},[]),d=(0,l.useCallback)(()=>{window.open("https://reflect.app/download","_blank")},[]),c=(0,l.useCallback)(()=>{n.current=Date.now()},[]),u=(0,l.useCallback)(async()=>{if(Date.now()-n.current<864e5)return;let e=await ia(),t=null;if(e===i.NEW_WEB_VERSION?t={title:"A new version of Reflect is available",description:"Do you want to update now?",duration:36e5,action:(0,o.jsx)(ii,{onDismiss:c,onConfirm:s})}:e===i.NEW_ELECTRON_VERSION&&(t={title:"\uD83D\uDE35 We cannot update your desktop app",description:"Please download the latest version and reinstall it.",duration:36e5,action:(0,o.jsx)(io,{onDismiss:c,onDownload:d})}),t){var a;null===(a=r.current)||void 0===a||a.call(r);let{dismiss:e}=(0,eD.Am)(t);r.current=e}},[c,s,d]);return(0,l.useEffect)(()=>{let e=setTimeout(()=>void u(),5e3);return()=>clearTimeout(e)},[u]),(0,l.useEffect)(()=>{let e=setInterval(()=>void u(),36e5);return()=>clearInterval(e)},[u]),(0,l.useEffect)(()=>{let e=()=>{u()};return window.addEventListener("online",e),()=>window.removeEventListener("online",e)},[u]),null}(0,eW.Rn)(it,"Invalid local version"),(a=i||(i={}))[a.ERROR=0]="ERROR",a[a.UPDATED_TO_DATE=1]="UPDATED_TO_DATE",a[a.NEW_WEB_VERSION=2]="NEW_WEB_VERSION",a[a.NEW_ELECTRON_VERSION=3]="NEW_ELECTRON_VERSION";let ii=e=>{let{onConfirm:t,onDismiss:n}=e;return(0,o.jsxs)("div",{className:"grid gap-1",children:[(0,o.jsx)(s8.gD,{altText:"update",onClick:t,children:(0,o.jsx)("span",{className:"whitespace-nowrap",children:"Update"})}),(0,o.jsx)(s8.gD,{altText:"dismiss",onClick:n,children:(0,o.jsx)("span",{className:"whitespace-nowrap",children:"Later"})})]})},io=e=>{let{onDownload:t,onDismiss:n}=e;return(0,o.jsxs)("div",{className:"grid gap-1",children:[(0,o.jsx)(s8.gD,{altText:"update",onClick:t,children:(0,o.jsx)("span",{className:"whitespace-nowrap",children:"Download"})}),(0,o.jsx)(s8.gD,{altText:"dismiss",onClick:n,children:(0,o.jsx)("span",{className:"whitespace-nowrap",children:"Later"})})]})};async function il(){return await ia()!==i.ERROR}function id(e){let{online:t}=e,n=function(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=()=>{t(!1)},n=()=>{t(!0)};return window.addEventListener("blur",e,{passive:!0}),window.addEventListener("focus",n,{passive:!0}),()=>{window.removeEventListener("blur",e),window.removeEventListener("focus",n)}},[]),e}(),r=function(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=setTimeout(()=>{t(!0)},864e5);return()=>{clearTimeout(e)}}),e}(),a=function(){let e=(0,l.useRef)(0),[t,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let t=setInterval(()=>{n(Date.now()-e.current>3e5)},3e5);return()=>{clearInterval(t)}},[]),(0,l.useEffect)(()=>{let t=()=>{e.current=Date.now(),n(!1)};return window.addEventListener("mouseover",t,{passive:!0}),window.addEventListener("pointerdown",t,{passive:!0}),()=>{window.removeEventListener("mouseover",t),window.removeEventListener("pointerdown",t)}},[]),t}(),s=t&&!n&&r&&a;return(0,l.useEffect)(()=>{if(!s)return;let e=!1;return il().then(t=>{t&&!e&&window.location.reload()}),()=>{e=!0}},[s]),null}function ic(e){let{online:t}=e;return(0,l.useEffect)(()=>{if(!t)return;let e=!1;return il().then(t=>{t&&!e&&nP.I.uploadPending()}),()=>{e=!0}},[t]),null}var iu=n(54047);let ih=iu.fC;iu.xz;let ip=iu.h_,im=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(iu.aV,{className:(0,_.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...r,ref:t})});im.displayName=iu.aV.displayName;let ix=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsxs)(ip,{children:[(0,o.jsx)(im,{}),(0,o.jsx)(iu.VY,{ref:t,className:(0,_.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...r})]})});function ig(e){let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,_.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...n})}function iv(e){let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,_.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})}ix.displayName=iu.VY.displayName,ig.displayName="AlertDialogHeader",iv.displayName="AlertDialogFooter";let iy=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(iu.Dx,{ref:t,className:(0,_.cn)("text-lg font-semibold",n),...r})});iy.displayName=iu.Dx.displayName;let ib=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(iu.dk,{ref:t,className:(0,_.cn)("text-sm text-muted-foreground",n),...r})});ib.displayName=iu.dk.displayName;let iw=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(iu.aU,{ref:t,className:(0,_.cn)((0,O.d)(),n),...r})});iw.displayName=iu.aU.displayName;let ij=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(iu.$j,{ref:t,className:(0,_.cn)((0,O.d)({variant:"outline"}),"mt-2 sm:mt-0",n),...r})});ij.displayName=iu.$j.displayName;var ik=n(71324),iN=n(55673),iS=n(60288);async function iC(){var e;if(!nS.Z)return!1;let t=await (null===nS.Z||void 0===nS.Z?void 0:null===(e=nS.Z.getVersion)||void 0===e?void 0:e.call(nS.Z));return!t||(0,ie.q)(t,"3.0.2","<")}class iR{dispose(){return(0,t$.$)(this.listeners)}async checkOutOfDateElectron(){let e=await iC();this.setIsOutOfDateElectron(e)}async handleOutOfSpace(){var e;let t=await (0,iN.i9)();this.setAvailableQuota(null!==(e=null==t?void 0:t.quota)&&void 0!==e?e:null),this.setIsOpen(!0),this.requestMoreStorage()}async requestMoreStorage(){(0,L.j)("persistent_storage_permission_requested");let e=await (0,iN.lr)();(0,L.j)("persistent_storage_permission_result",{persisted:e})}get isBrowserLimited(){return null!=this.availableQuota&&this.availableQuota<524288e3}setAvailableQuota(e){this.availableQuota=e}setIsOpen(e){this.isOpen=e}setIsOutOfDateElectron(e){this.isOutOfDateElectron=e}get sqlite(){return iS.v}constructor(){this.availableQuota=null,this.isOpen=!1,this.isOutOfDateElectron=!1,this.listeners=[],(0,m.makeObservable)(this);let e=(0,m.reaction)(()=>this.sqlite.ioFailed,e=>{e&&this.handleOutOfSpace()});this.listeners.push(e),this.checkOutOfDateElectron()}}(0,eU.gn)([m.observable],iR.prototype,"availableQuota",void 0),(0,eU.gn)([m.observable],iR.prototype,"isOpen",void 0),(0,eU.gn)([m.observable],iR.prototype,"isOutOfDateElectron",void 0),(0,eU.gn)([m.action],iR.prototype,"setAvailableQuota",null),(0,eU.gn)([m.action],iR.prototype,"setIsOpen",null),(0,eU.gn)([m.action],iR.prototype,"setIsOutOfDateElectron",null);let iI=(0,f.Pi)(()=>{var e,t;let n=(0,eF.D)(()=>new iR,[]);return(0,o.jsx)(ih,{open:n.isOpen,onOpenChange:e=>n.setIsOpen(e),children:(0,o.jsxs)(ix,{children:[(0,o.jsxs)(ig,{children:[(0,o.jsx)(iy,{children:"Error writing to disk"}),n.isOutOfDateElectron?(0,o.jsx)(ib,{className:"space-y-2",asChild:!0,children:(0,o.jsx)("div",{children:(0,o.jsxs)("p",{children:["Your Reflect app is out of date. Please"," ",(0,o.jsx)("a",{href:"https://reflect.app/downloads",target:"_blank",rel:"noreferrer",children:"update to the latest version"}),"."]})})}):n.isBrowserLimited?(0,o.jsx)(ib,{className:"space-y-2",asChild:!0,children:(0,o.jsxs)("div",{children:[(0,o.jsxs)("p",{children:["Your browser is only allowing us to store"," ",(0,ik.t)(null!==(e=n.availableQuota)&&void 0!==e?e:0)," of data. The reason could be either:"]}),(0,o.jsxs)("ul",{className:"list-disc space-y-2 pl-6",children:[(0,o.jsx)("li",{children:"You are in a guest session"}),(0,o.jsx)("li",{children:'You have enabled "Delete data when you close all windows" in\n                  Chrome (or other browser)'}),(0,o.jsx)("li",{children:"You are running out of disk space"})]}),(0,o.jsx)("p",{children:"If none of these are the case, please contact support."})]})}):(0,o.jsx)(ib,{className:"space-y-2",asChild:!0,children:(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{children:"Please double check that there is enough space on your disk and try again."}),(0,o.jsx)("p",{children:"If the problem persists, please contact support."}),(0,o.jsxs)("p",{children:["Browser quota: ",(0,ik.t)(null!==(t=n.availableQuota)&&void 0!==t?t:0)]})]})})]}),(0,o.jsxs)(iv,{children:[(0,o.jsx)(iw,{onClick:e=>{e.preventDefault(),window.open("mailto:support@reflect.app")},children:"Contact support"}),(0,o.jsx)(ij,{children:"Close"})]})]})})});var iE=n(65929);async function iD(){var e;let t=await (null===nS.Z||void 0===nS.Z?void 0:null===(e=nS.Z.getVersion)||void 0===e?void 0:e.call(nS.Z));(0,L.j)("app_loaded",{version:N.q4,electron:!!nS.Z,electron_version:t,sha:"32af0847ae7861836d4dc86bc6d272675057dd56",branch:"master",user_agent:navigator.userAgent}),(0,iE.n)({message:"app_loaded",data:{version:N.q4,electron:!!nS.Z,electron_version:t}})}let iP=(0,f.Pi)(()=>{let e=(0,x.Yh)();return ei(t=>{"open-preferences"===t.command&&e.togglePreferencesScreen()}),(0,es.y)("mod+,",t=>{t.preventDefault(),e.togglePreferencesScreen()}),(0,l.useEffect)(()=>{iD()},[]),(0,o.jsxs)(o.Fragment,{children:[(()=>{switch(e.screen){case N.z2.Main:return(0,o.jsx)(s3,{});case N.z2.Preferences:return(0,o.jsx)(s6,{})}})(),(0,o.jsx)(s4,{}),(0,o.jsx)(iI,{}),(0,o.jsx)(is,{online:e.online}),(0,o.jsx)(id,{online:e.online}),(0,o.jsx)(ic,{online:e.online})]})}),iT=e=>{let{path:t}=e,n=(0,y.useRouter)();return(0,l.useEffect)(()=>{n.push(t)},[t]),null},iA=(0,f.Pi)(()=>{let e=(0,x.Yh)();switch(console.log("LoadingState:",e.loadingState),e.loadingState){case N.Gu.Auth:return(0,o.jsx)(j,{});case N.Gu.GraphSetup:return(0,o.jsx)(iT,{path:"/setup"});case N.Gu.GraphEncryptionSetup:return(0,o.jsx)(k,{});case N.Gu.Migrating:return(0,o.jsx)(T,{graph:e.currentGraph,message:"Preparing your notes. This may take a sec..."});case N.Gu.MigrationFailed:return(0,o.jsx)(E,{title:"Migration failed",message:"We are sorry about this! Please contact support@reflect.app",refreshLabel:"Try again"});case N.Gu.MigrationOffline:return(0,o.jsx)(E,{title:"Can't reach the database",message:"\n            Migration failed because your device seems to be offline.\n            Please try again, and if the problem persists, contact us at support@reflect.app",refreshLabel:"Try again"});case N.Gu.VersionUnsupported:return(0,o.jsx)(E,{title:"Update required",message:"A new version of Reflect has been released.",refreshLabel:"Upgrade now"});case N.Gu.MainScreen:return(0,o.jsx)(iP,{});case N.Gu.Loading:return(0,o.jsx)(V,{delayedTimeout:!0});default:return null}});n(20991);var iM=n(24601);class iL{get routePath(){let e=this.routeState;switch(e.rootScreen){case N.z2.Preferences:return"/preferences/".concat(e.preferenceScreen);case N.z2.Main:switch(e.mainScreen){case N.oK.NoteList:if(e.graphId){let t=e.noteListQuery?"/".concat(e.noteListQuery):"";return"/g/".concat(e.graphId,"/list").concat(t)}break;case N.oK.NoteEdit:case N.oK.NoteDaily:if(e.noteId)return"/g/".concat(e.graphId,"/").concat(e.noteId);break;case N.oK.Map:if(e.graphId)return"/g/".concat(e.graphId,"/map");break;case N.oK.TaskList:if(e.graphId)return"/g/".concat(e.graphId,"/tasks")}}return"/"}get routeState(){var e,t,n,r;return{rootScreen:this.rootStore.screen,mainScreen:this.rootStore.mainView.screen,preferenceScreen:this.rootStore.preferenceStore.screen,graphId:(null===(e=this.rootStore.graphStore.currentGraph)||void 0===e?void 0:e.id)||null,noteListQuery:(null===(n=this.rootStore.noteStore)||void 0===n?void 0:null===(t=n.listView)||void 0===t?void 0:t.query)||null,noteId:(null===(r=this.rootStore.mainView)||void 0===r?void 0:r.selectedNoteId)||null}}setRouteState(e){var t,n,r,a;let s,i;let{rootScreen:o,mainScreen:l,preferenceScreen:d,graphId:c,noteListQuery:u,noteId:h}=e;h&&l===N.oK.NoteDaily&&(s=(0,iM.cB)(h)),h&&l===N.oK.NoteEdit&&(i=h),o&&this.rootStore.setScreen(o),l&&this.rootStore.mainView.setScreen(l),d&&this.rootStore.preferenceStore.setScreen(d),c&&(this.rootStore.graphStore.ensureVolatileGraphId(c),this.rootStore.graphStore.setCurrentGraphId(c)),s&&(null===(t=this.rootStore.noteStore)||void 0===t||t.dailyEditorView.setSelectedDate(s)),i&&(null===(n=this.rootStore.noteStore)||void 0===n||n.primaryEditorView.setSelectedNoteId(i)),u&&(null===(a=this.rootStore.noteStore)||void 0===a||null===(r=a.listView)||void 0===r||r.setQuery(u))}constructor(e){this.rootStore=e,(0,m.makeObservable)(this)}}(0,eU.gn)([m.computed],iL.prototype,"routePath",null),(0,eU.gn)([m.computed],iL.prototype,"routeState",null);let iV=(0,f.Pi)(e=>{var t;let{state:n}=e,r=(0,x.Yh)(),a=(0,x.z)(),s=(0,l.useMemo)(()=>new iL(r),[r]),i=(0,l.useRef)();return(0,l.useEffect)(()=>{n&&s.setRouteState(n)},[n,s]),(0,l.useEffect)(()=>{s.routePath!==i.current&&(i.current=s.routePath,a.addToStack(s.routePath,s.routeState),(0,L.Md)())},[s.routePath]),t=(0,l.useCallback)(e=>{let{state:t}=e;(i.current=location.pathname,(0,N.iO)(t)&&"object"==typeof t&&null!==t&&"stackId"in t)?(s.setRouteState(t),a.handleForwardBack(t)):console.warn("Unhandled popstate: ",t)},[a,s]),(0,l.useEffect)(()=>(window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)),[t]),(0,es.y)("mod+BracketLeft",e=>{e.preventDefault(),history.back()},{capture:!0}),(0,es.y)("mod+BracketRight",e=>{e.preventDefault(),history.forward()},{capture:!0}),null}),iZ=e=>{let{state:t={},ready:n=!0}=e;return(0,l.useEffect)(()=>{var e,t;console.log("Registering service worker (serwist)"),null===(t=window.serwist)||void 0===t||null===(e=t.register)||void 0===e||e.call(t)},[]),(0,l.useEffect)(()=>{let e=setInterval(c,12e5);return()=>clearInterval(e)},[]),(0,d.N)(),(0,l.useEffect)(()=>{console.log("Loaded app",{version:N.q4,sha:"32af0847ae7861836d4dc86bc6d272675057dd56",branch:"master"})},[]),(0,o.jsxs)(u.AppProvider,{ready:n,children:[(0,o.jsx)(iA,{}),(0,o.jsx)(iV,{state:t}),(0,o.jsx)(v,{})]})}},63722:function(e,t,n){n.d(t,{e:function(){return s}});var r=n(60893),a=n(41466);class s{async dispose(){this.keyboardView.dispose(),await this.keyboardToolbarView.dispose()}constructor(){this.keyboardView=new a.q,this.keyboardToolbarView=new r.q}}},42104:function(e,t,n){n.d(t,{F0:function(){return l},l3:function(){return d},ze:function(){return c},zz:function(){return u}});var r=n(11527),a=n(50959),s=n(43884),i=n(63722);let o=(0,a.createContext)(void 0),l=e=>{let{children:t}=e,n=(0,s.D)(()=>new i.e,[]);return(0,r.jsx)(o.Provider,{value:n,children:t})};function d(){let e=(0,a.useContext)(o);if(!e)throw Error("useCapacitorView must be used within a CapacitorViewProvider");return e}function c(){let{keyboardView:e}=d();return e}function u(){let{keyboardToolbarView:e}=d();return e}},79978:function(e,t,n){n.d(t,{ze:function(){return r.ze},zz:function(){return r.zz}}),n(63722);var r=n(42104);n(60893),n(41466)},60893:function(e,t,n){n.d(t,{q:function(){return m}});var r=n(15767),a=n(13061),s=n(69971),i=n(31223),o=n.n(i),l=n(25674),d=n.n(l),c=n(44838),u=n(90708);class h extends u.Uw{setItems(){}show(){}hide(){}getHasExternalKeyboard(){return Promise.resolve({isConnected:!1})}}let p=(0,u.fo)("KeyboardToolbar",{web:new h});class m{async dispose(){for(let e of this.listeners)(await Promise.resolve(e))()}observeEditor(){this.listeners.push((0,c.reaction)(()=>{let{canIndent:e,canDedent:t,canMoveUp:n,canMoveDown:r}=this;return{canIndent:e,canDedent:t,canMoveUp:n,canMoveDown:r}},e=>this.updateToolbar(e),{fireImmediately:!0,equals:o()}))}async observePlugin(){let e=await p.getHasExternalKeyboard();this.setHasExternalKeyboard(e.isConnected),this.listeners.push((await p.addListener("action",e=>{this.handleCommand(e)})).remove),this.listeners.push((await p.addListener("visibility",e=>{this.setIsVisible(e.isVisible)})).remove),this.listeners.push((await p.addListener("externalKeyboard",e=>{this.setHasExternalKeyboard(e.isConnected)})).remove)}setSelectionOptions(e){this.canIndent=e.canIndent,this.canDedent=e.canDedent,this.canMoveUp=e.canMoveUp,this.canMoveDown=e.canMoveDown,this.selectedSubject=e.selectedSubject}setIsVisible(e){this.isVisible=e}setHasExternalKeyboard(e){this.hasExternalKeyboard=e}show(e){this.editorRef=e,p.show()}hide(){p.hide()}updateToolbar(e){p.setItems({items:function(e){let{canIndent:t,canDedent:n,canMoveUp:r,canMoveDown:a}=e;return[{type:"action",icon:"slash",action:"insertCommand"},{type:"action",icon:"bullet-list",action:"insertBullet"},{type:"action",icon:"todo-list",action:"insertTask"},{type:"action",icon:"backlink",action:"insertBacklink"},{type:"action",icon:"hashtag",action:"insertTag"},{type:"action",icon:"outdent",action:"outdent",disabled:!n},{type:"action",icon:"indent",action:"indent",disabled:!t},{type:"action",icon:"move-up",action:"moveUp",disabled:!r,canHide:!0},{type:"action",icon:"move-down",action:"moveDown",disabled:!a,canHide:!0},{type:"action",icon:"image",action:"insertImage"}]}(e)})}handleCommand(e){var t;let{action:n}=e,r=null===(t=this.editorRef)||void 0===t?void 0:t.current;switch(n){case"insertCommand":null==r||r.insertText("/");break;case"insertBullet":null==r||r.turnToBulletList();break;case"insertTask":null==r||r.turnToTaskList();break;case"insertBacklink":null==r||r.insertText("[[");break;case"insertTag":null==r||r.insertText("#");break;case"indent":null==r||r.indentListItem();break;case"outdent":null==r||r.dedentListItem();break;case"moveUp":null==r||r.moveUpListItem();break;case"moveDown":null==r||r.moveDownListItem();break;case"insertImage":this.insertImage();break;case"dismiss":null==r||r.blur()}}async insertImage(){let e=this.editorRef.current,t=[];try{t=(await a.V1.pickImages({width:1e3,quality:80,presentationStyle:"popover"})).photos}catch(e){console.warn(e)}for(let n of t){let{path:t}=n;if(!t)continue;let r=await s.fy.readFile({path:t}),a=d()(t.split("/")),i=await fetch("data:text/plain;base64,"+r.data),o=new File([await i.arrayBuffer()],a);null==e||e.uploadImages([o])}}constructor(){this.canIndent=!1,this.canDedent=!1,this.canMoveUp=!1,this.canMoveDown=!1,this.selectedSubject=!1,this.isVisible=!1,this.hasExternalKeyboard=!1,this.editorRef={current:null},this.listeners=[],(0,c.makeObservable)(this),this.observeEditor(),this.observePlugin()}}(0,r.gn)([c.observable],m.prototype,"canIndent",void 0),(0,r.gn)([c.observable],m.prototype,"canDedent",void 0),(0,r.gn)([c.observable],m.prototype,"canMoveUp",void 0),(0,r.gn)([c.observable],m.prototype,"canMoveDown",void 0),(0,r.gn)([c.observable],m.prototype,"selectedSubject",void 0),(0,r.gn)([c.observable],m.prototype,"isVisible",void 0),(0,r.gn)([c.observable],m.prototype,"hasExternalKeyboard",void 0),(0,r.gn)([c.action],m.prototype,"setSelectionOptions",null),(0,r.gn)([c.action],m.prototype,"setIsVisible",null),(0,r.gn)([c.action],m.prototype,"setHasExternalKeyboard",null)},41466:function(e,t,n){n.d(t,{q:function(){return o}});var r=n(15767),a=n(90708),s=n(6268),i=n(44838);class o{dispose(){this.listeners.forEach(e=>e.remove())}hasKeyboardPlugin(){return a.dV.isPluginAvailable("Keyboard")}setHeight(e){this.keyboardHeight={type:"exact",value:e}}setStatus(e){this.status=e}get wantsSpacer(){return"showing"===this.status||"visible"===this.status}get isHidden(){return"hidden"===this.status||"hiding"===this.status}async observeKeyboard(){this.hasKeyboardPlugin()&&this.listeners.push(await s.N1.addListener("keyboardWillShow",e=>{this.setHeight(e.keyboardHeight),this.setStatus("showing")}),await s.N1.addListener("keyboardDidShow",e=>{this.setHeight(e.keyboardHeight),this.setStatus("visible")}),await s.N1.addListener("keyboardWillHide",()=>{this.setStatus("hiding")}),await s.N1.addListener("keyboardDidHide",()=>{this.setStatus("hidden")}))}constructor(){this.listeners=[],this.keyboardHeight={type:"approx",value:380},this.status="hidden",(0,i.makeObservable)(this),this.observeKeyboard()}}(0,r.gn)([i.observable],o.prototype,"keyboardHeight",void 0),(0,r.gn)([i.observable],o.prototype,"status",void 0),(0,r.gn)([i.action],o.prototype,"setHeight",null),(0,r.gn)([i.action],o.prototype,"setStatus",null),(0,r.gn)([i.computed],o.prototype,"wantsSpacer",null),(0,r.gn)([i.computed],o.prototype,"isHidden",null)},68783:function(e,t,n){n.d(t,{k:function(){return P}});var r=n(95170),a=n.n(r),s=n(86534),i=n(41200),o=n(86655),l=n(44719),d=n(66292),c=n.n(d),u=n(71157),h=n(9793),p=n(53342);let m={key:"preferences-store",version:25},f={key:"user-store",version:25},x={key:"graph-store",version:34},g={key:"credential-store",version:25},v={key:"change-store",version:27,debounceInterval:500,saveOnUnload:!0,migrations:[{from:26,to:27,migrate:e=>{var t;return{...e,pendingCommits:(null!==(t=e.pendingCommits)&&void 0!==t?t:[]).map(e=>{try{let{noteRef:t,...n}=e,{graphId:r,noteId:a}=(0,h.l7)(t.id);return{...n,graphId:r,noteId:a}}catch(e){return null}}).filter(p.Dw)}}}]},y={key:"ui-state-store",version:1,debounceInterval:500},b={key:"task-filter-store",version:1},w={key:"notes-map-filter-store",version:1};async function j(e){let{key:t,version:n}=e,r=N({key:t,version:n}),a=await o.j.getItem(r);if(a&&"string"==typeof a)try{let e=JSON.parse(a);if(e&&"object"==typeof e)return e}catch(e){console.error("Error parsing stored item:",e)}return null}async function k(e){let{snapshot:t,key:n,version:r}=e,a=N({key:n,version:r}),s=JSON.stringify(t);await o.j.setItem(a,s)}function N(e){let{key:t,version:n}=e;return"".concat(t,"-").concat(n)}async function S(e,t){let{key:n,version:r,debounceInterval:a=2e3,saveOnUnload:i,migrations:o=[]}=t,l=async t=>{"onPersist"in e&&"function"==typeof e.onPersist&&e.onPersist(),await k({snapshot:t,key:n,version:r})},d=c()(l,a);(0,s.cfB)(e,d),i&&window.addEventListener("beforeunload",()=>{l((0,s.vMv)(e))});let u=await C({key:n,version:r,migrations:o});u&&(0,s.Xx3)(e,u)}async function C(e){let{key:t,version:n,migrations:r}=e;return await j({key:t,version:n})||R({migrations:r,key:t,version:n})}async function R(e){let{migrations:t,key:n,version:r}=e,a=t.find(e=>e.to===r);if(!a)return null;let s=await j({key:n,version:a.from});if(s)try{return a.migrate(s)}catch(e){(0,u.Tb)(e)}return null}var I=n(22341);async function E(){l.k.info("Setting up root store...");let e=new I.M({});return console.time("Loading stores"),await S(e.preferenceStore,m),await S(e.userStore,f),await S(e.graphStore,x),await S(e.credentialStore,g),await S(e.changeStore,v),await S(e.uiStateStore,y),await S(e.taskFilterStore,b),await S(e.notesMapFilterStore,w),console.timeEnd("Loading stores"),(0,s.m83)(e)||(0,s.v5r)(e),e}(0,s.QbW)({modelIdGenerator:i.O}),o.j.setup(a());let D=null;async function P(){return D||(D=await E()),D}},70649:function(e,t,n){n.d(t,{g:function(){return d},_:function(){return c}});var r=n(15767),a=n(44838),s=n(18734),i=n(39833),o=n(36556);async function l(e,t){let n=await (0,o.g0)(),r={messages:e,notes:t,localTime:new Date().toString()},a=await fetch("/api/search/answer",{method:"POST",headers:{...n,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw Error("Failed to fetch: ".concat(await a.text()));return(0,i.hu)(a.body),a.body.pipeThrough(new TextDecoderStream)}class d{dispose(){}sendMessage(e){if(!this.canSendMessage)return;(0,s.j)("ai_chat_message_sent");let t=this.pushMessage({role:"user",content:e},{role:"assistant",state:"loading",content:""});this.fetchAnswer(t-1)}async fetchAnswer(e){let t;let n=this.messages.slice(0,e);try{let e=await l(n,this.notes);t={role:"assistant",state:"stream",content:"",stream:e}}catch(e){console.error("Failed to fetch answer",e),t={role:"assistant",state:"error",content:String(e)}}this.messages[e].content||this.setMessage(e,t)}finishStream(e){let t=this.messages.length-1,n=this.messages[t];n&&"assistant"===n.role&&!n.content&&this.setMessage(t,{role:"assistant",state:"answer",content:e})}async appendFootnotes(e){let{answer:t,citedNoteIds:n}=function(e,t){let n=new Map;return{answer:e.replace(/\[\^?(\d+(?:\s*,\s*\d+)*)]/g,(e,r)=>r.split(",").map(e=>Number.parseInt(e.trim())).map(e=>{var r;let a=t[e-1];if(!a)return e;let s=null!==(r=n.get(a))&&void 0!==r?r:n.size+1;return n.set(a,s),"^".concat(s)}).map(e=>"[".concat(e,"]")).join("")),citedNoteIds:Array.from(n.keys())}}(e,this.notes.map(e=>e.id));return t+"\n\n"+(await Promise.all(n.map(e=>this.noteStore.findById(e)))).map((e,t)=>e?"[^".concat(t+1,"]: [").concat(e.title,"](").concat(c).concat(e.id,")"):"").filter(e=>e).join("\n")}get isLoading(){let e=this.messages[this.messages.length-1];return!!e&&"user"!==e.role&&"answer"!==e.state&&"error"!==e.state}get canSendMessage(){return!this.isLoading}setMessage(e,t){this.messages[e]=t}pushMessage(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.messages.push(...t)}setNotes(e){this.notes=e}constructor(e){this.noteStore=e,this.messages=[],this.notes=[],this.stream=null,(0,a.makeObservable)(this)}}(0,r.gn)([a.observable],d.prototype,"messages",void 0),(0,r.gn)([a.observable],d.prototype,"notes",void 0),(0,r.gn)([a.observable],d.prototype,"stream",void 0),(0,r.gn)([a.action],d.prototype,"setMessage",null),(0,r.gn)([a.action],d.prototype,"pushMessage",null),(0,r.gn)([a.action],d.prototype,"setNotes",null);let c="#REFLECT-NOTE-ID-"},12891:function(e,t,n){n.d(t,{F:function(){return L}});var r=n(11527),a=n(13756),s=n(73793),i=n(57673),o=n(72811),l=n(50959),d=n(84534),c=n(65310),u=n(29485),h=n(98425),p=n(97655),m=n(4814),f=n(46935);let x=(0,l.createContext)(void 0),g=x.Provider,v=e=>{let{children:t,buttonClassName:n,buttonLabel:a,enabled:s=!0,placement:i="bottom-end"}=e,[o,x]=(0,l.useState)(!1),[v,y]=(0,l.useState)(!1),b=e=>{e?(x(!0),y(!1)):(y(!0),setTimeout(()=>x(!1),300))},w=(0,d.jV)(),{x:j,y:k,refs:N,context:S}=(0,d.YF)({nodeId:w,placement:i,open:o,onOpenChange:b,middleware:[(0,c.uY)({padding:5}),(0,u.cv)(5),(0,c.RR)()],whileElementsMounted:c.Me}),{getReferenceProps:C,getFloatingProps:R}=(0,d.NI)([(0,d.eS)(S,{enabled:s}),(0,d.qs)(S),(0,d.bQ)(S)]),[I,E]=(0,p.useSpring)(()=>({scale:.95,opacity:0,config:{duration:300,easing:p.easings.easeOutQuart}}),[o]);return(0,l.useLayoutEffect)(()=>{o&&E.start({opacity:1,scale:1})},[o,E]),(0,l.useLayoutEffect)(()=>{v&&E.start({opacity:0,scale:.99})},[v,E]),(0,r.jsxs)(g,{value:{onClose:()=>{b(!1)}},children:[(0,r.jsx)("div",{className:"popover-menu-reference",...C({ref:N.setReference}),children:(0,r.jsxs)("button",{className:(0,m.Z)("inline-flex items-center justify-center rounded-md border border-coolgray-200 bg-background px-3 py-1.5 text-sm font-medium text-coolgray-600 outline-none ring-offset-coolgray-100 hover:bg-coolgray-50 dark:border-coolgray-800 dark:text-coolgray-300 dark:ring-offset-dark-black-900 dark:hover:bg-gray-800",n),children:[(0,r.jsx)("span",{children:a}),(0,r.jsx)(h.Z,{className:"-mr-1 ml-1 h-4 w-4","aria-hidden":"true"})]})}),(0,r.jsx)(d.mN,{id:w,children:(0,r.jsx)(d.ll,{children:o&&(0,r.jsx)(f.Q2,{children:(0,r.jsx)("div",{ref:N.setFloating,className:"absolute z-popover drop-shadow-2xl",style:{top:null!=k?k:0,left:null!=j?j:0},...R(),children:(0,r.jsx)("div",{className:"drop-shadow-sm",children:(0,r.jsx)(p.animated.div,{style:{transform:(0,p.to)([I.scale],e=>"scale(".concat(e,")")),opacity:I.opacity},children:(0,r.jsx)("div",{className:"z-popover flex origin-top-right flex-col divide-y divide-coolgray-100 overflow-x-hidden rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:divide-coolgray-900 dark:bg-coolgray-800",children:t})})})})})})})]})},y=e=>{let{onClick:t,children:n}=e,a=(0,l.useContext)(x);return(0,r.jsx)("div",{className:"popover-menu-item",children:(0,r.jsx)("button",{className:"duration-120 flex w-full cursor-pointer items-center space-x-2 whitespace-nowrap px-4 py-2 text-left text-sm text-bluegray-700 transition-all hover:bg-bluegray-100 hover:text-bluegray-900 dark:text-near-white hover:dark:bg-bluegray-800",onClick:()=>{null==t||t(),null==a||a.onClose()},children:n})})};var b=n(18734),w=n(87823),j=n(47183),k=n(77927),N=n(64467),S=n(71357),C=n(47329),R=n(36556),I=n(7653),E=n(2808),D=n(53097);let P=(0,E.j)("relative w-full rounded-lg p-4 [&>svg~*]:pl-7 [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-secondary-foreground",{variants:{variant:{default:"bg-secondary text-secondary-foreground",error:"bg-red-50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),T=l.forwardRef((e,t)=>{let{className:n,variant:a,...s}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,D.cn)(P({variant:a}),n),...s})});T.displayName="Alert",l.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h5",{ref:t,className:(0,D.cn)("mb-1 font-medium leading-none tracking-tight",n),...a})}).displayName="AlertTitle";let A=l.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,D.cn)("text-sm [&_p]:leading-relaxed",n),...a})});A.displayName="AlertDescription";let M=e=>{let{onClose:t}=e,[n,a]=(0,l.useState)(""),[s,i]=(0,l.useState)(""),[o,d]=(0,l.useState)({type:"idle"}),c=async()=>{d({type:"loading"});try{let e=await (0,R.tC)("/api/credentials/auth/apple",{email:n,password:s});if("error"===e.status){d({type:"error",error:e.message});return}d({type:"idle"}),t()}catch(e){console.error("Unable to connect apple account:",e),d({type:"error",error:"Unknown error"})}};return(0,r.jsx)(S.u,{onClose:t,children:(0,r.jsxs)("div",{className:"flex min-h-[420px] w-[460px] flex-1 flex-col px-10 py-10",children:[(0,r.jsx)("h3",{className:"text-center text-2xl font-medium",children:"Connect an iCloud Calendar"}),(0,r.jsxs)("form",{className:"mt-3 flex flex-1 flex-col",onSubmit:e=>{e.preventDefault(),c()},children:[(0,r.jsxs)("div",{className:"flex-1 space-y-4",children:["error"===o.type?(0,r.jsxs)(T,{variant:"error",children:[(0,r.jsx)(k.Z,{className:"h-5 w-5 fill-current text-red-400"}),(0,r.jsx)(A,{children:o.error})]}):(0,r.jsxs)(T,{children:[(0,r.jsx)(j.Z,{className:"h-5 w-5"}),(0,r.jsxs)(A,{children:["To sync your iCloud calendar, please generate an app-specific password."," ",(0,r.jsx)("a",{className:"text-primary",href:"https://support.apple.com/en-us/HT204397",target:"_blank",rel:"noreferrer",children:"Learn\xa0how"})]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"block space-y-1.5 text-sm font-medium",children:[(0,r.jsx)("span",{children:"Apple ID"}),(0,r.jsx)(C.o,{value:n,onChange:e=>a(e),autoFocus:!0,autoComplete:"off",placeholder:"your@email.com",disabled:"loading"===o.type,required:!0})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"block space-y-1.5 text-sm font-medium",children:[(0,r.jsx)("span",{children:"App-specific Password"}),(0,r.jsx)(C.o,{value:s,onChange:e=>i(e),autoComplete:"off",placeholder:"xxxx-xxxx-xxxx-xxxx",disabled:"loading"===o.type,required:!0})]})})]}),(0,r.jsx)("footer",{className:"mt-4",children:(0,r.jsxs)(N.M,{loading:"loading"===o.type,children:[(0,r.jsx)("span",{children:"Connect calendar"}),(0,r.jsx)(I.f,{title:"command return",shortcut:"mod+Enter",className:"absolute right-2"})]})})]})]})})},L=(0,o.Pi)(e=>{let{showAppleModal:t,setShowAppleModal:n,buttonClassName:o,placement:l,buttonLabel:d="Connect an account"}=e,c=async e=>{if("apple"===e)n(!0);else{let t=await (0,w.CL)(e);window.open(t),(0,b.yV)({credentialAuth:!0}),(0,b.j)("credential_auth",{provider:e})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(v,{buttonLabel:d,buttonClassName:o,placement:l,children:[(0,r.jsxs)(y,{onClick:()=>c("google"),children:[(0,r.jsx)(a.S,{className:"w-3"}),(0,r.jsx)("span",{children:"Connect a Google account"})]}),(0,r.jsxs)(y,{onClick:()=>c("microsoft"),children:[(0,r.jsx)(s.D,{className:"w-3"}),(0,r.jsx)("span",{children:"Connect a Microsoft account"})]}),(0,r.jsxs)(y,{onClick:()=>c("apple"),children:[(0,r.jsx)(i.Z,{className:"w-3"}),(0,r.jsx)("span",{children:"Connect an iCloud account"})]})]}),t&&(0,r.jsx)(M,{onClose:()=>n(!1)})]})})},56335:function(e,t,n){n.d(t,{m:function(){return s}});var r=n(11527),a=n(4814);n(50959);let s=e=>{let{onClick:t,disabled:n,className:s="",small:i=!1,type:o="button",children:l}=e;return(0,r.jsx)("span",{className:"inline-flex",children:(0,r.jsx)("button",{onClick:t,type:o,disabled:n,className:(0,a.Z)(s,i?"px-4 py-2":"px-4 py-2 md:px-4 md:py-2","focus:shadow-outline-indigo inline-flex items-center space-x-2 rounded-md border border-transparent bg-indigo-100 text-2xs font-medium leading-5 text-indigo-600 outline-none hover:bg-indigo-50 focus:border-indigo-300 focus:outline-none active:bg-indigo-200 disabled:pointer-events-none disabled:cursor-default disabled:opacity-75 dark:border dark:border-gray-800 dark:bg-gray-900 dark:text-near-white dark:hover:bg-gray-800 dark:hover:text-white"),children:l})})}},32271:function(e,t,n){n.d(t,{zx:function(){return s},mI:function(){return l.m},KM:function(){return s},kq:function(){return o},Mm:function(){return d.M}});var r=n(11527),a=n(4814);n(50959);let s=e=>{let{onClick:t,type:n="button",className:s="",children:i,disabled:o}=e;return(0,r.jsx)("button",{onClick:t,type:n,disabled:o,className:(0,a.Z)("inline-flex cursor-pointer items-center space-x-1 rounded-md border border-transparent bg-indigo-600 px-3 py-2 text-sm font-medium leading-4 text-white shadow-sm transition duration-300 ease-in-out hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:bg-gray-500",s),children:i})};var i=n(53097);let o=e=>{let{onClick:t,className:n="",children:a}=e;return(0,r.jsx)("button",{onClick:t,type:"button",className:(0,i.cn)("focus:shadow-outline-indigo inline-flex cursor-pointer items-center space-x-1 rounded-md border border-transparent bg-indigo-100 px-3 py-2 text-sm font-medium leading-4 text-indigo-700 transition duration-150 ease-in-out hover:bg-indigo-50 focus:border-indigo-300 focus:outline-none active:bg-indigo-200 dark:bg-indigo-900 dark:text-white",n),children:a})};var l=n(56335),d=n(11850)},64467:function(e,t,n){n.d(t,{M:function(){return i}});var r=n(11527),a=n(4814);n(50959);var s=n(53097);let i=e=>{let{loading:t=!1,onClick:n,disabled:i,className:l,children:d,type:c="submit"}=e,u=t||i;return(0,r.jsxs)("button",{type:c,onClick:n,disabled:u,className:(0,s.cn)("focus:shadow-outline-purple relative inline-flex w-full min-w-28 items-center justify-center overflow-hidden rounded-md border-none bg-purple-600 px-4 py-2 text-base font-medium leading-6 text-white shadow-sm outline-none transition duration-300 ease-in-out focus:outline-none",u&&"cursor-auto opacity-50",!u&&"hover:bg-purple-500 active:bg-purple-700",l),children:[(0,r.jsx)("div",{className:(0,a.Z)("absolute inset-0 flex items-center justify-center transition duration-200 ease-in-out",!t&&"-translate-y-full opacity-0"),children:(0,r.jsx)(o,{})}),(0,r.jsx)("div",{className:(0,a.Z)("flex items-center space-x-2 transition duration-200 ease-in-out",t&&"translate-y-full opacity-0"),children:d})]})};function o(){return(0,r.jsxs)("svg",{className:"h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},11850:function(e,t,n){n.d(t,{M:function(){return s}});var r=n(11527),a=n(4814);n(50959);let s=e=>{let{label:t="Submit",loadingLabel:n="Loading...",loading:s=!1,onClick:i,disabled:o,className:l}=e;return(0,r.jsx)("span",{className:"flex w-full rounded-md shadow-sm",children:(0,r.jsxs)("button",{type:"submit",onClick:i,disabled:s||o,className:(0,a.Z)("relative inline-flex w-full min-w-28 justify-center shadow-sm","rounded-md border border-transparent bg-purple-600 px-4 py-2","text-base font-medium leading-6 text-white sm:text-sm sm:leading-5","focus:shadow-outline-purple hover:bg-purple-500 focus:border-purple-700 focus:outline-none","active:bg-purple-700","transition duration-300 ease-in-out",(s||o)&&"cursor-auto opacity-50",l),children:[s&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("svg",{className:"absolute left-0 ml-2 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,r.jsx)("span",{children:s?n:t})]})})}},79819:function(e,t,n){n.d(t,{L:function(){return c},X:function(){return u}});var r=n(11527),a=n(4814),s=n(72811),i=n(50959),o=n(79978),l=n(11161);let d=(0,i.createContext)(void 0);function c(){return(0,i.useContext)(d)}let u=e=>(0,l.W)()?(0,r.jsx)(h,{...e}):(0,r.jsx)(p,{...e}),h=(0,s.Pi)(e=>{let{children:t,className:n,...s}=e,l=(0,o.ze)(),c=(0,i.useRef)(null);return(0,r.jsx)(d.Provider,{value:c,children:(0,r.jsxs)("div",{...s,className:(0,a.Z)("h-full overflow-y-auto",n),ref:c,children:[t,l.wantsSpacer&&(0,r.jsx)("div",{style:{height:"".concat(l.keyboardHeight.value,"px")}})]})})}),p=e=>{let{children:t,className:n,...s}=e;return(0,r.jsx)("div",{...s,className:(0,a.Z)("h-full overflow-y-auto",n),children:t})}},5992:function(e,t,n){n.d(t,{S:function(){return u}});var r=n(11527),a=n(4814),s=n(79978),i=n(11161),o=n(43884),l=n(15767),d=n(44838);class c{setDiv(e){this.divRef=e}observeBodyStyle(){let e=window.document.body,t=new MutationObserver(()=>{this.setBodyHeight(e.style.height||null)});t.observe(e,{attributes:!0,attributeFilter:["style"]}),this.listeners.push(()=>t.disconnect())}setBodyHeight(e){this.bodyHeight=e}dispose(){for(let e of this.listeners)e()}constructor({keyboardToolbarView:e}){this.divRef=null,this.bodyHeight=null,this.listeners=[],this.keyboardToolbarView=e,(0,d.makeObservable)(this),this.observeBodyStyle(),this.listeners.push((0,d.reaction)(()=>({bodyHeight:this.bodyHeight,hasExternalKeyboard:this.keyboardToolbarView.hasExternalKeyboard}),e=>{var t;let{bodyHeight:n,hasExternalKeyboard:r}=e;null===(t=this.divRef)||void 0===t||t.style.setProperty("height",(r?null:n)||"100vh")},{fireImmediately:!0}))}}function u(e){return(0,i.W)()?(0,r.jsx)(h,{...e}):(0,r.jsx)(p,{...e})}function h(e){let{as:t,children:n,style:i,className:l,...d}=e,u=(0,s.zz)(),h=(0,o.D)(()=>new c({keyboardToolbarView:u}),[u]);return(0,r.jsx)(t||"div",{...d,className:(0,a.Z)("fixed top-0 right-0 left-0",l),style:{...i,height:"100vh"},ref:e=>h.setDiv(e),children:n})}function p(e){let{as:t,children:n,className:s,...i}=e;return(0,r.jsx)(t||"div",{...i,className:(0,a.Z)("fixed inset-0",s),children:n})}(0,l.gn)([d.observable],c.prototype,"keyboardToolbarView",void 0),(0,l.gn)([d.observable],c.prototype,"divRef",void 0),(0,l.gn)([d.observable],c.prototype,"bodyHeight",void 0),(0,l.gn)([d.action],c.prototype,"setDiv",null),(0,l.gn)([d.action],c.prototype,"setBodyHeight",null)},89252:function(e,t,n){n.d(t,{X:function(){return s}});var r=n(11527),a=n(4814);n(50959);let s=e=>{let{checked:t,disabled:n,variant:s="square",onChange:i,onClick:o}=e;return(0,r.jsx)("input",{type:"checkbox",onChange:e=>null==i?void 0:i(e.target.checked),onClick:o,checked:!!t,disabled:n,readOnly:!0,className:(0,a.Z)("note-checkbox form-checkbox relative h-4 w-4 cursor-pointer border-gray-300 text-indigo-600 transition duration-100 hover:scale-105 focus:outline-none focus:ring focus:ring-indigo-500 focus:ring-offset-secondary active:scale-95",t?"border-indigo-600":"dark:border-gray-700",!t&&"dark:bg-gray-900","round"===s?"rounded-full":"rounded")})}},15166:function(e,t,n){n.d(t,{W:function(){return r}});function r(e,t){t instanceof Error&&"ChunkLoadError"===t.name&&(console.warn("ChunkLoadError: Loading chunk failed, reloading the page"),location.reload()),e.setTag("error-boundary",!0)}},71667:function(e,t,n){n.d(t,{S:function(){return i}});var r=n(11527),a=n(70063);n(50959);var s=n(15166);let i=e=>{let{children:t}=e;return(0,r.jsx)(a.SV,{fallback:o,showDialog:!0,beforeCapture:s.W,children:t})},o=e=>{var t;let{error:n,componentStack:a}=e,s=(t=n)instanceof Error&&(null==t?void 0:t.name)==="UnsupportedDocumentVersionError"?"This document is not supported by this version of the app. Please update your app to the latest version by closing and re-opening it, or by refreshing the tab.":null;return s?(0,r.jsx)("div",{className:"flex select-text items-center justify-center p-10",children:(0,r.jsx)("h1",{className:"text-center text-sm",children:s})}):(0,r.jsxs)("div",{className:"select-text p-10",children:[(0,r.jsx)("h1",{className:"text-xl",children:"Sorry, something went wrong!"}),(0,r.jsx)("h2",{className:"text-sm",children:String(n)}),(0,r.jsx)("pre",{className:"text-xs",children:a})]})}},51085:function(e,t,n){n.d(t,{fc:function(){return c}});var r=n(11527),a=n(98476),s=n.n(a);n(50959);let i="gtm.reflect.app",o="GTM-WHVKHFD",l=e=>{let{gtmId:t=o,gtmDomain:n=i}=e;return t?(0,r.jsx)(s(),{id:"google-tag-manager",strategy:"afterInteractive",children:"\n        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n        'https://".concat(n,"/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n        })(window,document,'script','dataLayer','").concat(t,"');\n      ")}):null},d=e=>{let{gtmId:t=o,gtmDomain:n=i}=e;return t?(0,r.jsx)("noscript",{dangerouslySetInnerHTML:{__html:'<iframe src="https://'.concat(n,"/ns.html?id=").concat(t,'" height="0" width="0" style="display: none; visibility: hidden;" />')}}):null},c=e=>{let{gtmId:t=o,gtmDomain:n=i}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l,{gtmId:t,gtmDomain:n}),(0,r.jsx)(d,{gtmId:t,gtmDomain:n})]})}},32412:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(11527);n(50959);let a=e=>{let{className:t}=e;return(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.99976 8C7.99976 5.79086 9.79062 4 11.9998 4C14.2089 4 15.9998 5.79086 15.9998 8V10C15.9998 12.2091 14.2089 14 11.9998 14C9.79062 14 7.99976 12.2091 7.99976 10V8ZM11.9998 12.5C13.3805 12.5 14.4998 11.3807 14.4998 10V8C14.4998 6.61929 13.3805 5.5 11.9998 5.5C10.619 5.5 9.49976 6.61929 9.49976 8V10C9.49976 11.3807 10.619 12.5 11.9998 12.5Z",fill:"currentColor"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.51254 12.0385C6.9055 11.9075 7.33024 12.1199 7.46123 12.5128C8.08813 14.3935 9.93737 15.5 11.9998 15.5C14.0621 15.5 15.9113 14.3935 16.5382 12.5128C16.6692 12.1199 17.0939 11.9075 17.4869 12.0385C17.8798 12.1695 18.0922 12.5942 17.9612 12.9872C17.1736 15.3502 15.0422 16.7156 12.7497 16.9601L12.7497 19.25C12.7497 19.6642 12.4139 20 11.9997 20C11.5855 20 11.2497 19.6642 11.2497 19.25L11.2497 16.9601C8.95729 16.7156 6.82588 15.3502 6.0382 12.9872C5.90722 12.5942 6.11959 12.1695 6.51254 12.0385Z",fill:"currentColor"})]})}},35140:function(e,t,n){n.d(t,{W:function(){return a}});var r=n(11527);n(50959);let a=e=>{let{className:t}=e;return(0,r.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,r.jsx)("path",{d:"M13.8588 13.8588C14.7183 12.9992 15.25 11.8117 15.25 10.5C15.25 7.87665 13.1234 5.75 10.5 5.75C7.87665 5.75 5.75 7.87665 5.75 10.5C5.75 13.1234 7.87665 15.25 10.5 15.25C11.8117 15.25 12.9992 14.7183 13.8588 13.8588ZM13.8588 13.8588L18.5 18.5",stroke:"currentColor",strokeWidth:"1.5"})})}},7653:function(e,t,n){n.d(t,{f:function(){return i}});var r=n(11527),a=n(53097),s=n(53989);let i=e=>{let{title:t,shortcut:n,className:i}=e;return(0,r.jsx)("span",{title:t,className:(0,a.cn)("inline-flex items-center rounded-sm bg-white/10 px-1 text-sm font-medium uppercase tracking-widest ring-[3px] ring-white/10",i),children:(0,r.jsx)(s.l,{shortcut:n,ghost:!0})})}},21622:function(e,t,n){n.d(t,{T:function(){return s}});var r=n(11527);n(50959);var a=n(66297);let s=e=>{let{duration:t=500,startAt:n=0,children:s}=e;return(0,r.jsx)("div",{className:"absolute inset-0 flex select-none items-center justify-center bg-coolgray-50 media-dark:bg-app-black dark:bg-app-black",children:(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-8 text-center",children:[(0,r.jsx)(a.P,{duration:t,startAt:n}),(0,r.jsx)("div",{className:"hidden text-gray-900",children:"Loading..."}),s]})})}},360:function(e,t,n){n.d(t,{E:function(){return s}});var r=n(11527),a=n(91307);n(50959);let s=e=>{let{onClick:t}=e;return(0,r.jsx)("nav",{className:"fixed right-0 top-0 z-[100] px-4 py-4",children:(0,r.jsxs)("button",{"aria-label":"Close",onClick:t,className:"flex cursor-pointer items-center space-x-2 text-sm text-coolgray-900/50 outline-none transition-all duration-300 hover:text-gray-900 focus:ring-purple-600 dark:text-near-white",tabIndex:-1,children:[(0,r.jsx)("kbd",{className:"inline-flex items-center justify-center rounded-md bg-white px-1.5 py-0.5 font-sans text-[10px] font-medium shadow-md shadow-black/5 ring-1 ring-coolgray-900/10 dark:border-white/10 dark:bg-white/10",children:"Esc"}),(0,r.jsx)(a.Z,{className:"w-5"})]})})}},60279:function(e,t,n){n.d(t,{o:function(){return d}});var r=n(11527),a=n(34259),s=n(4814);n(50959);var i=n(46935),o=n(68186),l=n(360);let d=e=>{let{onClose:t,children:n,className:d}=e;return(0,o.y)("Escape",e=>{e.preventDefault(),null==t||t()}),(0,r.jsx)(a.V,{open:!0,static:!0,as:"div",className:"relative z-modal",onClose:()=>!1,children:(0,r.jsx)(i.Q2,{children:(0,r.jsxs)("div",{className:"fixed inset-0 flex bg-white dark:bg-black",children:[t?(0,r.jsx)(l.E,{onClick:t}):null,(0,r.jsx)("div",{className:"flex flex-1 items-center justify-center overflow-y-auto p-4",children:(0,r.jsx)(a.V.Panel,{className:(0,s.Z)("flex flex-1 flex-col","max-h-full max-w-4xl",d),children:n})})]})})})}},71357:function(e,t,n){n.d(t,{u:function(){return d}});var r=n(11527),a=n(34259),s=n(4814);n(50959);var i=n(46935),o=n(68186),l=n(360);let d=e=>{let{onClose:t,children:n,className:d}=e;return(0,o.y)("Escape",e=>{e.preventDefault(),null==t||t()}),(0,r.jsx)(a.V,{open:!0,static:!0,as:"div",className:"relative z-modal",onClose:()=>!1,children:(0,r.jsxs)(i.Q2,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-700/15 backdrop-blur-sm dark:bg-black"}),t?(0,r.jsx)(l.E,{onClick:t}):null,(0,r.jsx)("div",{className:"fixed inset-0 overflow-y-auto p-4",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,r.jsx)(a.V.Panel,{className:(0,s.Z)("flex transform flex-col overflow-hidden rounded-xl bg-white shadow-2xl ring-1 ring-coolgray-900/5 dark:bg-gray-900 dark:ring-coolgray-700",d),children:n})})})]})})}},1009:function(e,t,n){n.d(t,{r:function(){return o}});var r=n(11527),a=n(91307),s=n(4814);n(50959);var i=n(21240);let o=e=>{let{open:t=!0,onClose:n,children:o}=e;return(0,r.jsx)(i.y,{in:t,children:(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex select-none items-center justify-center overflow-y-auto bg-gradient-to-b from-bluegray-900 to-near-black px-4 pt-4 pb-20",role:"modal",children:[n&&(0,r.jsx)("nav",{className:"absolute right-0 top-0 px-4 py-4",children:(0,r.jsxs)("button",{role:"button","aria-label":"Close",onClick:n,className:"flex cursor-pointer items-center space-x-2 text-sm text-near-white outline-none transition hover:text-gray-900",children:[(0,r.jsx)("span",{children:"Close"}),(0,r.jsx)("span",{className:"rounded-md bg-dark-black-800 px-1.5 py-0.5 text-xs",children:"Esc"}),(0,r.jsx)(a.Z,{height:15,width:15})]})}),(0,r.jsx)("div",{className:(0,s.Z)(["inline-block align-bottom","relative px-4 py-4","transform transition-all","text-gray-900"]),role:"dialog",children:o})]})})}},96113:function(e,t,n){n.d(t,{oU:function(){return h},rG:function(){return p.r},u_:function(){return o}});var r=n(11527);n(50959);var a=n(79819),s=n(5992),i=n(21240);let o=e=>{let{open:t=!0,onClose:n,children:o}=e;return(0,r.jsx)(i.y,{in:t,children:(0,r.jsx)(s.S,{className:"z-50",children:(0,r.jsxs)(a.X,{children:[(0,r.jsx)("div",{className:"fixed inset-0 transition-opacity",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-100 dark:bg-gray-900",onClick:n})}),(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 pt-4 pb-20 text-center",children:(0,r.jsx)("div",{className:"transform rounded-xl bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-2xl ring-1 ring-coolgray-900/5 transition-all dark:bg-gray-900 dark:text-white dark:ring-coolgray-800 sm:my-8 sm:w-full sm:max-w-sm sm:p-6 sm:align-middle",role:"dialog",children:o})})]})})})};var l=n(62357),d=n(68186),c=n(91307);let u=e=>{let{onClick:t}=e;return(0,r.jsx)("nav",{className:"fixed right-0 top-0 z-[100] px-4 py-4",children:(0,r.jsxs)("button",{"aria-label":"Close",onClick:t,className:"flex cursor-pointer items-center space-x-2 text-sm text-bluegray-500 outline-none transition-all duration-300 hover:text-gray-900 focus:ring-purple-600 dark:text-near-white",tabIndex:-1,children:[(0,r.jsx)("span",{children:"Close"}),(0,r.jsx)("span",{className:"rounded-md bg-bluegray-200 px-1.5 py-0.5 text-xs dark:bg-dark-black-800",children:"Esc"}),(0,r.jsx)(c.Z,{height:15,width:15})]})})},h=e=>{let{open:t=!0,onClose:n,children:a}=e;return(0,d.y)("Escape",e=>{e.defaultPrevented||(e.preventDefault(),null==n||n())},{enabled:t&&"function"==typeof n,capture:!0}),(0,r.jsx)(l.W,{children:(0,r.jsx)(i.y,{in:t,children:(0,r.jsx)("div",{tabIndex:-1,className:"fixed inset-0 z-50 overflow-y-auto bg-white focus:outline-none dark:bg-black",role:"modal",children:(0,r.jsxs)("div",{className:"flex min-h-screen items-center justify-center px-4 pt-4 pb-20",children:[n&&(0,r.jsx)(u,{onClick:n}),(0,r.jsx)("div",{className:"p-4 dark:text-gray-900",role:"dialog",children:a})]})})})})};var p=n(1009)},71083:function(e,t,n){n.d(t,{f:function(){return C}});var r=n(11527),a=n(50959),s=n(8680),i=n(72906),o=n(50295),l=n(53097),d=n(62357);let c=i.fC;i.xz;let u=a.forwardRef((e,t)=>{let{className:n,align:a="center",sideOffset:s=4,...c}=e;return(0,r.jsx)(d.W,{children:(0,r.jsx)(i.VY,{ref:t,align:a,sideOffset:s,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),onOpenAutoFocus:o.B,onCloseAutoFocus:o.B,...c})})});u.displayName=i.VY.displayName;let h=()=>{let[e,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=e=>{let n=e.clientX,r=e.clientY;t({current:{getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,x:n,y:r})}})};return window.document.addEventListener("mousemove",e),()=>window.document.removeEventListener("mousemove",e)},[]),e?(0,r.jsx)(i.tW,{virtualRef:e}):null};var p=n(51842),m=n.n(p);function f(e){let{note:t}=e,n=(0,s.v_)(),[i,o]=(0,a.useState)(null),l=(0,a.useCallback)(async()=>{t.asin?o(await n.findByAsin(t.asin)):o(null)},[n,t.asin]);return((0,a.useEffect)(()=>{l()},[t.asin,l]),i)?(0,r.jsxs)("div",{style:{width:300},className:"flex flex-1 px-3 py-3",children:[(0,r.jsx)("div",{className:"h-32 w-20 flex-none overflow-hidden rounded-md",children:(0,r.jsx)("div",{className:"inline-block h-full w-full bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(i.coverSrc,")")}})}),(0,r.jsxs)("div",{className:"ml-4 flex-1 space-y-1",children:[(0,r.jsx)("h3",{className:"text-sm text-primary",title:i.title,children:(0,r.jsx)("a",{href:i.listingUrl,target:"_blank",rel:"noreferrer",children:m()(i.title,{length:100})})}),(0,r.jsx)("p",{className:"text-sm text-gray-800 dark:text-near-white",children:i.authors.join(", ")})]})]}):null}var x=n(75422),g=n(46935);function v(e){let{note:t}=e,n=(0,g.Fg)();return(0,r.jsx)("div",{style:{width:350,height:200},className:"backlink-html-context overflow-hidden px-5 py-4 text-gray-900 dark:text-near-white",children:(0,r.jsx)(x.d1,{size:"xs",html:t.documentHtml,dark:"dark"===n})})}var y=n(18975),b=n(64615);function w(e){var t;let{person:n}=e;return(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)("div",{className:"relative flex h-10 w-10 flex-none items-center justify-center overflow-hidden rounded-md bg-coolgray-50 dark:bg-black",children:[(0,r.jsx)(y.Z,{className:"h-8 w-8 text-bluegray-200"}),n.avatar&&(0,r.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(n.avatar,")")}})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col space-y-1",children:[(0,r.jsx)("h3",{className:"text-sm leading-tight text-primary dark:text-primary-dk",children:null===(t=n.name)||void 0===t?void 0:t.fullName}),n.bio&&(0,r.jsx)("div",{className:"text-2xs text-gray-900 dark:text-near-white",title:n.bio,children:m()(n.bio,{length:100})})]})]})}function j(e){let{company:t}=e;return(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)("div",{className:"relative flex h-10 w-10 flex-none items-center justify-center overflow-hidden rounded-md bg-coolgray-50 dark:bg-black",children:[(0,r.jsx)(b.Z,{className:"h-8 w-8 text-bluegray-200"}),t.logo&&(0,r.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(t.logo,")")}})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col space-y-1",children:[(0,r.jsx)("h3",{className:"text-sm text-primary dark:text-primary-dk",children:t.name}),t.description&&(0,r.jsx)("div",{className:"text-2xs",title:t.description,children:m()(t.description,{length:50})})]})]})}function k(e){let{note:t}=e,{person:n,company:a}=t.enrichment||{};return(0,r.jsxs)("div",{style:{width:300},className:"flex flex-1 flex-col justify-between space-y-3 p-3",children:[n&&(0,r.jsx)(w,{person:n}),a&&(0,r.jsx)(j,{company:a})]})}async function N(e,t){return!!(e.asin&&await t.findByAsin(e.asin))}async function S(e){var t,n,r,a,s;let{note:i,bookStore:o}=e;return(null===(r=i.enrichment)||void 0===r?void 0:null===(n=r.person)||void 0===n?void 0:null===(t=n.name)||void 0===t?void 0:t.fullName)||(null===(s=i.enrichment)||void 0===s?void 0:null===(a=s.company)||void 0===a?void 0:a.name)?"enrichment":await N(i,o)?"book":"content"}let C=e=>{let{note:t}=e,n=(0,s.v_)(),[i,o]=(0,a.useState)(null);return(0,a.useEffect)(()=>{S({note:t,bookStore:n}).then(o)},[t,n]),(0,r.jsxs)(c,{open:!0,children:[(0,r.jsx)(h,{}),(0,r.jsxs)(u,{className:"h-auto w-auto overflow-hidden p-0",side:"bottom",align:"start",sideOffset:20,alignOffset:20,collisionPadding:8,avoidCollisions:!0,children:["enrichment"===i&&(0,r.jsx)(k,{note:t}),"book"===i&&(0,r.jsx)(f,{note:t}),"content"===i&&(0,r.jsx)(v,{note:t})]})]})}},62357:function(e,t,n){n.d(t,{W:function(){return r.W}});var r=n(53454)},53454:function(e,t,n){n.d(t,{W:function(){return i}});var r=n(11527);n(50959);var a=n(10422),s=n(46935);let i=e=>{let{children:t}=e;return a.createPortal((0,r.jsx)(s.Q2,{children:t}),document.body)}},80092:function(e,t,n){n.d(t,{k:function(){return a}});var r=n(11527);n(50959);let a=e=>{let{progress:t}=e;return(0,r.jsx)("div",{className:"h-3 w-60 overflow-hidden rounded-md bg-coolgray-200 media-dark:bg-white/5 dark:bg-white/5",style:{maskImage:"radial-gradient(white, black)"},children:(0,r.jsx)("div",{className:"duration-250 h-full w-full rounded-md bg-coolgray-400 transition-all duration-200 ease-linear media-dark:bg-primary dark:bg-primary",style:{transform:"translate3d(".concat(-((1-t)*100),"%, 0, 0)")}})})}},66297:function(e,t,n){n.d(t,{P:function(){return i}});var r=n(11527),a=n(50959),s=n(80092);let i=e=>{let{duration:t,startAt:n=0}=e,[i,o]=(0,a.useState)(n);return(0,a.useEffect)(()=>{let e=setInterval(()=>{o(t=>t>=1?(clearInterval(e),1):t+.01)},t/100);return()=>clearInterval(e)},[]),(0,r.jsx)(s.k,{progress:i})}},53989:function(e,t,n){n.d(t,{l:function(){return f},r:function(){return u}});var r=n(11527),a=n(8680),s=n(31428),i=n(48536),o=n(96697);function l(e){return(d[e]||e).toLowerCase()}let d={Enter:i.p4,Backspace:i.wT,Escape:i.qd,ArrowRight:i.Vs,ArrowLeft:i.rE,ArrowUp:i.Dc,ArrowDown:i.Di,Command:o.Pw,Option:o.uX,Control:o.Ao,Shift:o.cb};var c=n(53097);function u(e){return!e.ctrlKey&&!e.altKey&&("Shift"===e.key&&e.metaKey||"Meta"===e.key&&e.shiftKey)}function h(e){let{keys:t,className:n,ghost:a}=e;return(0,r.jsx)("div",{className:(0,c.cn)("flex items-center justify-center uppercase",a?"":"rounded-md border border-coolgray-300 bg-white px-1 py-0.5 text-[10px] font-semibold shadow-sm dark:border-white/10 dark:bg-white/5",n),children:t.map((e,t)=>(0,r.jsx)("kbd",{className:(0,c.cn)("block text-center font-shortcut",1===e.length?"-mx-0.5 min-w-[1lh]":"mx-0.5",a?"":"rounded-md py-0 leading-4"),children:e},t))})}function p(e){let{keys:t,className:n,ghost:a}=e;return(0,r.jsx)("div",{className:"flex gap-x-0.5",children:t.map((e,t)=>(0,r.jsx)(h,{keys:[e],className:n,ghost:a},t))})}function m(e){let{shortcut:t,className:n,ghost:i}=e,o=function(e){let t=(0,a.Jf)().getKeyboardLayoutMap();return e?(0,s.SP)(e,{layout:null!=t?t:void 0})().map(l):[]}(t);return(0,r.jsx)(h,{keys:o,className:n,ghost:i})}function f(e){let{shortcut:t,className:n,ghost:a}=e;if(Array.isArray(t)){let e=[];for(let[s,i]of t.entries())s>0&&e.push((0,r.jsx)("span",{className:"mx-0.5 text-coolgray-500",children:"or"})),e.push((0,r.jsx)(f,{shortcut:i,className:n,ghost:a}));return(0,r.jsx)("div",{className:"flex gap-x-0.5",children:e})}return t&&"object"==typeof t?(0,r.jsx)(p,{keys:t.keys,className:n,ghost:a}):(0,r.jsx)(m,{shortcut:t,className:n,ghost:a})}},1075:function(e,t,n){n.d(t,{L:function(){return a}});var r=n(11527);n(50959);let a=()=>(0,r.jsx)("div",{className:"flex-1"})},28972:function(e,t,n){n.d(t,{X:function(){return a}});var r=n(11527);n(50959);let a=e=>{let{className:t=""}=e;return(0,r.jsx)("div",{className:"h-3 w-3 animate-slow-spin rounded-full border border-dashed border-accent ".concat(t)})}},46929:function(e,t,n){n.d(t,{IF:function(){return u}});var r=n(11527),a=n(50959),s=n(56808),i=n(53097);let o=e=>{let{axis:t="x",className:n="",gutterSize:a=1,sidebarPosition:s="left",...o}=e;return(0,r.jsx)("div",{style:"x"===t?{width:a}:{height:a},className:(0,i.cn)("relative z-10 cursor-col-resize bg-coolgray-900/8 transition-all duration-500 before:absolute hover:bg-primary hover:bg-opacity-50 dark:border-black dark:bg-white/5 dark:hover:bg-primary","before:-inset-0.5 capacitor:before:-inset-1","touch-none",n),...o})},l=e=>{let{axis:t,onDrag:n,onDragStart:i,...l}=e,d=(0,a.useRef)(!1),c=(0,s.useDrag)(e=>{!d.current&&e.active&&(null==i||i()),n(e),d.current=e.active},{axis:t});return(0,r.jsx)(o,{axis:t,...c(),...l})};var d=n(4814);let c=(0,a.forwardRef)((e,t)=>{let{children:n,className:a,gutterSize:s=1,sidebarSize:i=60,minMainSize:o=80,sizeType:l="fixed",sidebarPosition:c="end",axis:u="x"}=e,h="fixed"===l?"".concat(i,"px"):"".concat(100*i,"%"),p="end"===c?"minmax(".concat(o,"px, auto) ").concat(s,"px ").concat(h):"".concat(h," ").concat(s,"px minmax(").concat(o,"px, auto)");return(0,r.jsx)("div",{className:(0,d.Z)("grid",a),style:"x"===u?{gridTemplateColumns:p}:{gridTemplateRows:p},ref:t,children:n})});function u(e){let{children:t,sidebarSize:n,sidebarHidden:s=!1,onResize:i,minSidebarSize:o=30,sidebarPosition:d="end",sizeType:u="fixed",axis:h="x",gutterSize:p=1,...m}=e,f=(0,a.useRef)(null),x=(0,a.useRef)(null),g=e=>{e=Math.max(o,e);let t=x.current;return null!==t&&(e=Math.min(e,t-o)),e},[v,y]=a.Children.toArray(t);return(0,r.jsxs)(c,{ref:f,axis:h,sidebarSize:s?0:n,sidebarPosition:d,sizeType:s?"fixed":u,gutterSize:p,...m,children:[v,(0,r.jsx)(l,{sidebarPosition:d,axis:h,onDrag:e=>{let{delta:[t]}=e;if(null===x.current)return;let r="fixed"==u?n:x.current*n,a=g("end"===d?r-t:r+t);i("fixed"===u?a:a/x.current)},onDragStart:()=>{let e=f.current;if(!e)return;let t=e.getBoundingClientRect(),n="x"===h?t.width:t.height;x.current=n},gutterSize:p}),y]})}c.displayName="SplitGridLayout",u.Sidebar=e=>{let{children:t}=e;return(0,r.jsx)("div",{className:"split-grid-sidebar flex flex-col overflow-hidden",children:t})},u.Main=e=>{let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,d.Z)("split-grid-main overflow-hidden",n),children:t})}},47329:function(e,t,n){n.d(t,{o:function(){return s}});var r=n(11527),a=n(4814);n(50959);let s=e=>{let{value:t,onChange:n,onClick:s,onBlur:i,onFocus:o,required:l,autoComplete:d,pattern:c,autoFocus:u,disabled:h,placeholder:p,className:m,readOnly:f,type:x="text",error:g=!1}=e;return(0,r.jsx)("input",{type:x,required:l,value:t,autoComplete:d,autoFocus:u,disabled:h,placeholder:p,pattern:c,onChange:e=>null==n?void 0:n(e.target.value),onClick:s,onBlur:i,onFocus:o,readOnly:f,className:(0,a.Z)("block w-full rounded-md border border-coolgray-900/15 px-3 py-2 text-sm text-black shadow-app-input shadow-black/2 outline-none transition-all duration-300 focus:border-purple-300 focus:ring focus:ring-purple-200/50 dark:border-gray-800 dark:bg-gray-900 dark:text-white dark:focus:border-purple-600 dark:focus:ring-purple-900/50",g&&"border-red-300 text-red-900 placeholder-red-300 focus:border-red-500 focus:outline-none focus:ring-red-500",m)})}},60154:function(e,t,n){n.d(t,{u:function(){return r.u}});var r=n(99086)},99086:function(e,t,n){n.d(t,{u:function(){return m}});var r=n(11527),a=n(50959),s=n(53989),i=n(46935),o=n(91063),l=n(53097);let d=o.zt,c=o.fC,u=o.xz,h=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,collisionPadding:s=4,...i}=e;return(0,r.jsx)(o.VY,{ref:t,sideOffset:a,collisionPadding:s,className:(0,l.cn)("z-tooltip max-w-sm overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...i})});h.displayName=o.VY.displayName;let p=o.h_,m=e=>{let{label:t,children:n,disabled:a=!1,delay:o=700,shortcut:l}=e;return a?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)(d,{children:(0,r.jsxs)(c,{delayDuration:o,children:[(0,r.jsx)(u,{asChild:!0,children:n}),(0,r.jsx)(p,{children:(0,r.jsx)(i.Q2,{children:(0,r.jsxs)(h,{className:"flex items-center space-x-2.5",children:[(0,r.jsx)("p",{children:t}),l?(0,r.jsx)(s.l,{shortcut:l}):null]})})})]})})}},21240:function(e,t,n){n.d(t,{y:function(){return s}});var r=n(11527);n(50959);var a=n(57162);let s=e=>{let{in:t,children:n,duration:s=120}=e,i={transition:"opacity ".concat(s,"ms"),opacity:0},o={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0},unmounted:{}};return(0,r.jsx)(a.ZP,{timeout:s,in:t,mountOnEnter:!0,unmountOnExit:!0,children:e=>(0,r.jsx)("div",{style:{...i,...o[e]},children:n})})}},49753:function(e,t,n){n.d(t,{d:function(){return l},z:function(){return d}});var r=n(11527),a=n(3766),s=n(2808),i=n(50959),o=n(53097);let l=(0,s.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 transition",{variants:{variant:{default:"bg-brand text-brand-foreground hover:bg-brand/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-accent",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground hover:text-accent-foreground/70",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:n,variant:s,size:i,asChild:d=!1,...c}=e,u=d?a.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:s,size:i,className:n})),ref:t,...c})});d.displayName="Button"},39373:function(e,t,n){n.d(t,{f:function(){return d}});var r=n(11527),a=n(97201),s=n(64299);n(50959);var i=n(95266),o=n(49753),l=n(53097);function d(e){let{className:t,classNames:n,showOutsideDays:d=!0,...c}=e;return(0,r.jsx)(i._W,{showOutsideDays:d,className:(0,l.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,o.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:(0,l.cn)("h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20","single"===c.mode?"rounded-md":""),day:(0,l.cn)((0,o.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...n},components:{IconLeft:()=>(0,r.jsx)(a.Z,{className:"h-4 w-4"}),IconRight:()=>(0,r.jsx)(s.Z,{className:"h-4 w-4"})},...c})}d.displayName="Calendar"},98295:function(e,t,n){n.d(t,{$F:function(){return h},AW:function(){return p},Ju:function(){return x},VD:function(){return g},Xi:function(){return m},bO:function(){return f},h_:function(){return u}});var r=n(11527),a=n(30716),s=n(64299),i=n(58623),o=n(65178),l=n(50959),d=n(53097),c=n(62357);let u=a.fC,h=a.xz;a.ZA,a.Uv,a.Tr,a.Ee,l.forwardRef((e,t)=>{let{className:n,inset:i,children:o,...l}=e;return(0,r.jsxs)(a.fF,{ref:t,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",i&&"pl-8",n),...l,children:[o,(0,r.jsx)(s.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=a.fF.displayName,l.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.tu,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...s})}).displayName=a.tu.displayName;let p=l.forwardRef((e,t)=>{let{className:n,sideOffset:s=4,collisionPadding:i=4,...o}=e;return(0,r.jsx)(c.W,{children:(0,r.jsx)(a.VY,{ref:t,sideOffset:s,collisionPadding:i,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-lg border border-border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o})})});p.displayName=a.VY.displayName;let m=l.forwardRef((e,t)=>{let{className:n,inset:s,...i}=e;return(0,r.jsx)(a.ck,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",n),...i})});m.displayName=a.ck.displayName;let f=l.forwardRef((e,t)=>{let{className:n,children:s,checked:o,...l}=e;return(0,r.jsxs)(a.oC,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:o,...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(a.wU,{children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})}),s]})});f.displayName=a.oC.displayName,l.forwardRef((e,t)=>{let{className:n,children:s,...i}=e;return(0,r.jsxs)(a.Rk,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(a.wU,{children:(0,r.jsx)(o.Z,{className:"h-8 w-8"})})}),s]})}).displayName=a.Rk.displayName;let x=l.forwardRef((e,t)=>{let{className:n,inset:s,...i}=e;return(0,r.jsx)(a.__,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",n),...i})});x.displayName=a.__.displayName;let g=l.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",n),...s})});g.displayName=a.Z0.displayName},4396:function(e,t,n){n.d(t,{I:function(){return i}});var r=n(11527),a=n(50959),s=n(53097);let i=a.forwardRef((e,t)=>{let{className:n,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...i})});i.displayName="Input"},20906:function(e,t,n){n.d(t,{FN:function(){return h},Mi:function(){return f},VW:function(){return d},_i:function(){return c},gD:function(){return p},lj:function(){return x},sA:function(){return m}});var r=n(11527),a=n(4271),s=n(2808),i=n(83600),o=n(50959),l=n(53097);let d=a.zt,c=o.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.l_,{hotkey:["FAKE_KEYBOARD_CODE"],ref:t,className:(0,l.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[480px]",n),...s})});c.displayName=a.l_.displayName;let u=(0,s.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),h=o.forwardRef((e,t)=>{let{className:n,variant:s,...i}=e;return(0,r.jsx)(a.fC,{ref:t,className:(0,l.cn)(u({variant:s}),n),...i})});h.displayName=a.fC.displayName;let p=o.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.aU,{ref:t,className:(0,l.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...s})});p.displayName=a.aU.displayName;let m=o.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.x8,{ref:t,className:(0,l.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...s,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});m.displayName=a.x8.displayName;let f=o.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.Dx,{ref:t,className:(0,l.cn)("text-sm font-semibold",n),...s})});f.displayName=a.Dx.displayName;let x=o.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(a.dk,{ref:t,className:(0,l.cn)("text-sm opacity-90",n),...s})});x.displayName=a.dk.displayName},48491:function(e,t,n){n.d(t,{Am:function(){return c},pm:function(){return u}});var r=n(50959);let a=0,s=new Map;function i(e){if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)}let o=[],l={toasts:[]};function d(e){l=function(e,t){switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,5)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?i(n):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}}(l,e),o.forEach(e=>{e(l)})}function c(e){let{...t}=e,n=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:n});return d({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||r()}}}),{id:n,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function u(){let[e,t]=r.useState(l);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},79717:function(e,t,n){n.d(t,{D:function(){return o},h:function(){return l}});var r=n(68504),a=n(17322),s=n(2600),i=n.n(s);function o(e,t){var n;let r=(n=(n=e).trim().toLowerCase()).length<3?[]:c.filter(e=>e.toLowerCase().includes(n));return r.length>0?l(r.flatMap(e=>d(e,t))):l(d(e,t))}function l(e){return i()(e,e=>e[0].toDateString())}function d(e,t){return(0,r.Qc)(e,t).map(e=>[(0,a.Z)(e.date()),e.text])}let c=["Today","Yesterday","Tomorrow","This Sunday","This Monday","This Tuesday","This Wednesday","This Thursday","This Friday","This Saturday","This week","This weekend","This month","Next Sunday","Next Monday","Next Tuesday","Next Wednesday","Next Thursday","Next Friday","Next Saturday","Next week","Next weekend","Next month","Last Sunday","Last Monday","Last Tuesday","Last Wednesday","Last Thursday","Last Friday","Last Saturday","Last week","Last weekend","Last month"]},86967:function(e,t,n){n.d(t,{e:function(){return j}});var r=n(15767),a=n(56025),s=n(44193),i=n(89675),o=n(55818),l=n(43193),d=n(62648),c=n(39679),u=n(13514),h=n(52900),p=n.n(h),m=n(44838),f=n(8680),x=n(18688),g=n(79717);function v(e,t,n){return 1===e?t:n||"".concat(t,"s")}var y=n(24601),b=n(43012),w=n(70951);class j{generate(e){return e?this.generateRelative(e).slice(0,3):[]}generateRelative(e){let t=[],n=e.toLowerCase().replace(/\bone\b/g,"1").replace(/\btwo\b/g,"2").replace(/\bthree\b/g,"3").replace(/\bfour\b/g,"4").replace(/\bfive\b/g,"5").replace(/\bsix\b/g,"6").replace(/\bseven\b/g,"7").replace(/\beight\b/g,"8").replace(/\bnine\b/g,"9").replace(/\bten\b/g,"10");for(let[s,i]of(0,g.h)([...this.exactDateMatch(e),...(0,g.D)(e),...this.relativeDateMatch(n)])){var r,a;r=this.minValidDate,a=this.maxValidDate,(0,b.Z)(s,r)&&(0,w.Z)(s,a)&&t.push({id:"relative-".concat((0,y.l5)(s),"-").concat(p()(i)),label:"".concat(i," (").concat((0,x.p6)(s,this.dateFormat),")"),insertLabel:(0,x.l6)(s,this.dateFormat),dailyAt:s})}return t}get minValidDate(){return(0,u.Z)(new Date,15)}get maxValidDate(){return(0,o.Z)(new Date,15)}relativeDateMatch(e){return this.relativeDateOptionsForQuery(e).filter(t=>{let[n,r]=t;return r.toLowerCase().includes(e)})}exactDateMatch(e){if(!/\d\//.test(e))return[];let t=(0,x.sG)(e,this.dateFormat);return t?[[t,e]]:[]}relativeDateOptionsForQuery(e){let t=function(e){let t=e.match(/\d+/);if(t)return Number.parseInt(t[0],10)}(e);if(!t)return[];let n=new Date;return[[(0,a.Z)(n,t),"".concat(t," ").concat(v(t,"day")," from now")],[(0,i.Z)(n,t),"".concat(t," ").concat(v(t,"week")," from now")],[(0,s.Z)(n,t),"".concat(t," ").concat(v(t,"month")," from now")],[(0,o.Z)(n,t),"".concat(t," ").concat(v(t,"year")," from now")],[(0,l.Z)(n,t),"".concat(t," ").concat(v(t,"day")," ago")],[(0,c.Z)(n,t),"".concat(t," ").concat(v(t,"week")," ago")],[(0,d.Z)(n,t),"".concat(t," ").concat(v(t,"month")," ago")],[(0,u.Z)(n,t),"".concat(t," ").concat(v(t,"year")," ago")]]}constructor({dateFormat:e=f.t6.MonthDayYear,weekStart:t=f.L8.Monday}){this.dateFormat=e,this.weekStart=t,(0,m.makeObservable)(this)}}(0,r.gn)([m.computed],j.prototype,"minValidDate",null),(0,r.gn)([m.computed],j.prototype,"maxValidDate",null)},88393:function(e,t,n){n.d(t,{q:function(){return c}});var r=n(84715),a=n.n(r),s=n(2600),i=n.n(s),o=n(8680),l=n(1130),d=n(86967);class c{async generate(e){if(!e)return this.getSampleBacklinks();{let t=(0,l.Ue)(e),n=await this.backlinkStore.searchBacklinks(t,this.maxItems),r=this.dateGenerator.generate(t);return this.normalizeBacklinks([...r,...n],t)}}async getSampleBacklinks(){let e=await this.backlinkStore.getSampleBacklinks(this.sampleMaxItems+5);return i()(e,e=>e.id).slice(0,this.sampleMaxItems)}normalizeBacklinks(e,t){let n=e,r=this.excludeNote;return r&&(n=n.filter(e=>e.id!==r.id)),(n=a()(n,e=>e.normalizedLabel===t?-1:0)).slice(0,this.maxItems)}constructor({backlinkStore:e,dateFormat:t=o.t6.MonthDayYear,weekStart:n=o.L8.Monday,maxItems:r=50,sampleMaxItems:a=5,excludeNote:s}){this.backlinkStore=e,this.excludeNote=s,this.maxItems=r,this.sampleMaxItems=a,this.dateGenerator=new d.e({dateFormat:t,weekStart:n})}}},96233:function(e,t,n){n.d(t,{N:function(){return i},z:function(){return s}});var r=n(66530),a=n(50959);function s(){(0,r.setCookie)(null,"indexApp","1",{maxAge:93312e4,path:"/"})}function i(){(0,a.useEffect)(()=>{s()},[])}},50295:function(e,t,n){n.d(t,{B:function(){return r}});function r(e){e.preventDefault()}},4837:function(e,t,n){n.d(t,{q:function(){return r}});function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((r,a)=>{let s=async e=>{try{r(await t())}catch(t){e>0?(console.error(t),setTimeout(()=>s(e-1),n)):a(t)}};s(e)})}},48536:function(e,t,n){n.d(t,{DB:function(){return s},Dc:function(){return h},Di:function(){return p},GS:function(){return i},PV:function(){return a},Vs:function(){return c},iW:function(){return r},p4:function(){return o},qd:function(){return d},rE:function(){return u},wT:function(){return l}});let r="⌘",a="⌥",s="⌃",i="⇧",o="↩",l="⌫",d="⎋",c="→",u="←",h="↑",p="↓"},68186:function(e,t,n){n.d(t,{y:function(){return i}});var r=n(31428),a=n(50959),s=n(8680);function i(e,t){let{type:n="keydown",enabled:i=!0,capture:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=(0,s.Jf)().getKeyboardLayoutMap(),d=(0,a.useRef)(null),c=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{c.current=(0,r.on)(e,t,{layout:null!=l?l:void 0})},[t,e,l]),(0,a.useEffect)(()=>{if(!i||!c.current)return;let e=d.current||window,t=e=>{var t;return null===(t=c.current)||void 0===t?void 0:t.call(c,e)};return e.addEventListener(n,t,{capture:o}),()=>e.removeEventListener(n,t,{capture:o})},[o,n,i]),d}},43884:function(e,t,n){n.d(t,{D:function(){return a}});var r=n(50959);function a(e,t){let n=(0,r.useRef)(null),a=(0,r.useMemo)(()=>{var t,r;null===(t=n.current)||void 0===t||t.dispose();let a=e();return n.current=a,null===(r=a.attach)||void 0===r||r.call(a),a},t);return(0,r.useEffect)(()=>()=>{var e;null===(e=n.current)||void 0===e||e.dispose(),n.current=null},[]),a}},96697:function(e,t,n){n.d(t,{Ao:function(){return o},G6:function(){return c},Pw:function(){return s},Zx:function(){return a},cb:function(){return l},d:function(){return d},uX:function(){return i}});var r=n(48536);let a=/Mac|iP(hone|[ao]d)/.test(navigator.platform),s=a?r.iW:"ctrl",i=a?r.PV:"alt",o=a?r.DB:"ctrl",l=a?r.GS:"shift";/Mac/.test(navigator.platform);let d=/electron/i.test(navigator.userAgent),c=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},53097:function(e,t,n){n.d(t,{cn:function(){return s}});var r=n(4814),a=n(47899);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m)((0,r.W)(t))}},99321:function(e,t,n){n.d(t,{_A:function(){return s},b9:function(){return o},nL:function(){return l},w7:function(){return i}});var r=n(67645),a=n(36556);async function s(e){let t=await (0,a.lI)();return fetch("/api/auth/client-token",{method:"POST",headers:{Authorization:"Firebase ".concat(t),"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({client_token:e,id_token:t})})}function i(){window.location.href="/sign-out.html"}async function o(e){let{email:t,authType:n}=e;try{return{otpTokenId:(await (0,r.C8)("/api/auth/otp/send",{email:t,auth_type:n})).otp_token_id}}catch(e){if(e instanceof r.ZE&&404===e.status)return{otpTokenId:null};throw e}}async function l(e){let{email:t,otpToken:n,otpTokenId:a}=e;return{accessToken:(await (0,r.C8)("/api/auth/otp/validate",{email:t,otp_token:n,otp_token_id:a})).access_token}}},61182:function(e,t,n){n.d(t,{V:function(){return m}});var r=n(15767),a=n(35636),s=n.n(a),i=n(44838),o=n(65728),l=n(18612),d=n(57558),c=n(71157),u=n(66849);let h=o.ZP.union([o.ZP.literal("noMicrophoneAccess"),o.ZP.literal("noScreenCaptureAccess"),o.ZP.literal("other")]),p=o.ZP.union([o.ZP.object({command:o.ZP.literal("recording-started")}),o.ZP.object({command:o.ZP.literal("recording-process-ended")}),o.ZP.object({command:o.ZP.literal("recording-sample"),args:o.ZP.object({level:o.ZP.number()})}),o.ZP.object({command:o.ZP.literal("recording-finished"),args:o.ZP.object({buffer:o.ZP.instanceof(Uint8Array)})}),o.ZP.object({command:o.ZP.literal("recording-error"),args:o.ZP.object({errorType:h,errorMessage:o.ZP.union([o.ZP.string(),o.ZP.null()]).optional()})})]);class m{dispose(){this.listeners.forEach(e=>e())}setState(e){this.state=e}setError(e,t){this.setState("error"),this.onError(e,t)}assertState(e){if(!e.includes(this.state))throw Error("Expected state to be one of ".concat(e.join(", "),", got ").concat(this.state))}start(){this.assertState(["idle","finished","error"]),null===d.Z||void 0===d.Z||d.Z.startRecording(),this.scheduleVerifyReceivingSamples()}stop(){this.assertState(["recording"]),null===d.Z||void 0===d.Z||d.Z.stopRecording()}scheduleVerifyReceivingSamples(){this.verifyReceivingSamplesTimeout=setTimeout(this.verifyReceivingSamples.bind(this),3e3)}verifyReceivingSamples(){if(0===this.currentRecordingSampleCount){null===d.Z||void 0===d.Z||d.Z.stopRecording();let e="No audio samples received. Process might be hanging.";(0,c.uT)(e),this.setError(u.q.Internal,e)}}cancelVerifyReceivingSamples(){this.verifyReceivingSamplesTimeout&&(clearTimeout(this.verifyReceivingSamplesTimeout),this.verifyReceivingSamplesTimeout=null)}async handleMessage(e){let t=p.safeParse(e.data);if(!t.success){console.warn("Invalid message from Electron",t.error,e.data);return}let n=t.data;switch(n.command){case"recording-started":this.handleRecordingStarted();break;case"recording-process-ended":this.handleRecordingProcessEnded();break;case"recording-sample":this.handleRecordingSample(n.args.level);break;case"recording-finished":await this.handleRecordingFinished(n.args.buffer);break;case"recording-error":await this.handleRecordingError(n.args)}}handleRecordingStarted(){this.currentRecordingSampleCount=0,this.setState("recording"),this.onStart()}handleRecordingProcessEnded(){if(this.cancelVerifyReceivingSamples(),"finished"!==this.state){let e="Recording process ended without posting finished message.";(0,c.uT)(e),this.setError(u.q.Internal,e)}}handleRecordingSample(e){let t=s()(e/.7,0,1);this.onBufferSample(t),this.currentRecordingSampleCount+=1}async handleRecordingFinished(e){this.setState("finished");let t=new Blob([e],{type:"audio/mp4"});await this.onStop({blob:t})}async handleRecordingError(e){let{errorType:t,errorMessage:n}=e;if("noMicrophoneAccess"===t)this.onCancel(),await (0,l.Z)(100),this.askForPermission("use your microphone","microphone");else if("noScreenCaptureAccess"===t)this.onCancel(),await (0,l.Z)(100),this.askForPermission("capture your system audio (you'll have to allow screen recording)","screenRecording");else if(n){let e=Error(n);(0,c.Tb)(e),this.setError(u.q.Internal,n)}}askForPermission(e,t){confirm("It looks like you haven't given us permission to ".concat(e,". Would you like to open your system preferences to change this?"))&&(null===d.Z||void 0===d.Z||d.Z.openSystemPreference(t))}constructor(e){this.listeners=[],this.state="idle",this.currentRecordingSampleCount=0,this.verifyReceivingSamplesTimeout=null,this.onStart=e.onStart,this.onBufferSample=e.onBufferSample,this.onStop=e.onStop,this.onError=e.onError,this.onCancel=e.onCancel;let t=e=>void this.handleMessage(e);window.addEventListener("message",t),this.listeners.push(()=>window.removeEventListener("message",t)),(0,i.makeObservable)(this)}}(0,r.gn)([i.observable],m.prototype,"state",void 0),(0,r.gn)([i.action],m.prototype,"setState",null),(0,r.gn)([i.action],m.prototype,"setError",null)},66849:function(e,t,n){var r,a;n.d(t,{q:function(){return r}}),(a=r||(r={})).NoAudioData="NoAudioData",a.Internal="Internal"},57558:function(e,t,n){n.d(t,{Z:function(){return a},u:function(){return r}});let r=window.electron;var a=r}}]);